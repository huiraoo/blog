<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Java Â· æ¡†æ¶ Â· MyBatis-Plus</title>
    <url>/blog/2019/11/27/java-frame-mybatis-plus/</url>
    <content><![CDATA[<p><strong>å®˜æ–¹ç½‘ç«™</strong>ï¼š<a href="https://mybatis.plus/" target="_blank" rel="noopener">https://mybatis.plus/</a></p>
<p><strong>GitHub</strong>ï¼š<a href="https://github.com/baomidou/mybatis-plus" target="_blank" rel="noopener">https://github.com/baomidou/mybatis-plus</a></p>
<p><strong>ç‰¹æ€§ä»‹ç»ï¼š</strong></p>
<ul>
<li>å¼ºå¤§çš„ CRUD æ“ä½œ</li>
<li>ä¸»é”®è‡ªåŠ¨ç”Ÿæˆ</li>
<li>å¼ºå¤§çš„ä»£ç ç”Ÿæˆå™¨</li>
</ul>
<p><strong>å¼•å…¥</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Java</category>
      </categories>
  </entry>
  <entry>
    <title>Java Â· æ¡†æ¶ Â· JPA</title>
    <url>/blog/2019/11/27/java-frame-jpa/</url>
    <content><![CDATA[<h2 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h2><p>ç®€å•è¯´ï¼ŒORM å°±æ˜¯é€šè¿‡å®ä¾‹å¯¹è±¡çš„è¯­æ³•ï¼Œå®Œæˆå…³ç³»å‹æ•°æ®åº“çš„æ“ä½œçš„æŠ€æœ¯ï¼Œ<strong>å¯¹è±¡-å…³ç³»æ˜ å°„ï¼ˆObject/Relational Mappingï¼‰</strong> çš„ç¼©å†™ï¼ŒORM çš„ä¸»è¦åŠŸèƒ½æ˜¯æŠŠæ•°æ®åº“æ˜ å°„æˆå¯¹è±¡ã€‚</p>
<ul>
<li><p>æ•°æ®åº“è¡¨ï¼ˆtableï¼‰â€“&gt; ç±»ï¼ˆclassï¼‰</p>
</li>
<li><p>è®°å½•ï¼ˆrecordï¼Œè¡Œæ•°æ®ï¼‰â€“&gt; å¯¹è±¡ï¼ˆobjectï¼‰</p>
</li>
<li><p>å­—æ®µï¼ˆfieldï¼‰â€“&gt; å¯¹è±¡çš„å±æ€§ï¼ˆattributeï¼‰</p>
</li>
</ul>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-11-27-142500.png" alt></p>
<p>ğŸŒ°</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ•°æ®åº“å†™æ³•</span></span><br><span class="line">SELECT id, first_name, last_name, phone, birth_date, sex FROM person WHERE id = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ORMå†™æ³•</span></span><br><span class="line">p = Person.get(<span class="number">10</span>);</span><br><span class="line">name = p.first_name;</span><br><span class="line">phone = p.phone</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ Dao æŒä¹…å±‚çš„è§£å†³æ–¹æ¡ˆä¸­ï¼Œå¤§éƒ¨åˆ†æ˜¯é‡‡ç”¨ Spring Data JPA æˆ– MyBatis è§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸”ä¼ ç»Ÿä¼ä¸šå¤šç”¨å‰è€…ï¼Œäº’è”ç½‘ä¼ä¸šå¤šç”¨åè€…ã€‚Spring Data JPA æ˜¯ Spring Data åœ¨ JPA å’Œ ORM æ¡†æ¶ä¹‹é—´æŠ½è±¡å°è£…å±‚ï¼Œå®ƒä¸ç›´æ¥ä»£æ›¿ ORM æ¡†æ¶ï¼Œé»˜è®¤ä½å±‚ä½¿ç”¨çš„ ORM æ¡†æ¶æ˜¯ Hibernateã€‚</p>
<h2 id="JPA"><a href="#JPA" class="headerlink" title="JPA"></a>JPA</h2><p>Java Persistence APIï¼Œå¯ä»¥é€šè¿‡æ³¨è§£æˆ–è€… XML æè¿°<strong>å¯¹è±¡-å…³ç³»è¡¨</strong>ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œå¹¶å°†å®ä½“å¯¹è±¡æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ï¼ŒJPA æ˜¯ä¸€å¥— ORM è§„èŒƒã€‚</p>
<p><strong><a href="https://spring.io/projects/spring-data-jpa#learn" target="_blank" rel="noopener">Spring Data JPA</a></strong>ï¼šæ˜¯ Spring æä¾›çš„ä¸€å¥—ç®€åŒ– JPA å¼€å‘çš„æ¡†æ¶ï¼ŒæŒ‰ç…§çº¦å®šå¥½çš„æ–¹æ³•å‘½åè§„åˆ™å†™ dao å±‚æ¥å£ï¼Œå°±å¯ä»¥åœ¨ä¸å†™æ¥å£å®ç°çš„æƒ…å†µä¸‹ï¼Œå®ç°å¯¹æ•°æ®åº“çš„è®¿é—®å’Œæ“ä½œï¼Œå¯ä»¥ç†è§£ä¸º JPA è§„èŒƒçš„å†æ¬¡å°è£…æŠ½è±¡ï¼Œåº•å±‚è¿˜æ˜¯ä½¿ç”¨äº† Hibernate çš„ JPA æŠ€æœ¯å®ç°ã€‚</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-11-27-143900.jpg" alt></p>
<p><strong>æ¥å£çº¦å®šå‘½åè§„åˆ™</strong></p>
<table>
<thead>
<tr>
<th align="left">Keyword</th>
<th align="left">Sample</th>
<th align="left">JPQL snippet</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>And</code></td>
<td align="left"><code>findByLastnameAndFirstname</code></td>
<td align="left"><code>â€¦ where x.lastname = ?1 and x.firstname = ?2</code></td>
</tr>
<tr>
<td align="left"><code>Or</code></td>
<td align="left"><code>findByLastnameOrFirstname</code></td>
<td align="left"><code>â€¦ where x.lastname = ?1 or x.firstname = ?2</code></td>
</tr>
<tr>
<td align="left"><code>Is</code>, <code>Equals</code></td>
<td align="left"><code>findByFirstname</code>,<code>findByFirstnameEquals</code></td>
<td align="left"><code>â€¦ where x.firstname = ?1</code></td>
</tr>
<tr>
<td align="left"><code>Between</code></td>
<td align="left"><code>findByStartDateBetween</code></td>
<td align="left"><code>â€¦ where x.startDate between ?1 and ?2</code></td>
</tr>
<tr>
<td align="left"><code>LessThan</code></td>
<td align="left"><code>findByAgeLessThan</code></td>
<td align="left"><code>â€¦ where x.age &lt; ?1</code></td>
</tr>
<tr>
<td align="left"><code>LessThanEqual</code></td>
<td align="left"><code>findByAgeLessThanEqual</code></td>
<td align="left"><code>â€¦ where x.age &lt;= ?1</code></td>
</tr>
<tr>
<td align="left"><code>GreaterThan</code></td>
<td align="left"><code>findByAgeGreaterThan</code></td>
<td align="left"><code>â€¦ where x.age &gt; ?1</code></td>
</tr>
<tr>
<td align="left"><code>GreaterThanEqual</code></td>
<td align="left"><code>findByAgeGreaterThanEqual</code></td>
<td align="left"><code>â€¦ where x.age &gt;= ?1</code></td>
</tr>
<tr>
<td align="left"><code>After</code></td>
<td align="left"><code>findByStartDateAfter</code></td>
<td align="left"><code>â€¦ where x.startDate &gt; ?1</code></td>
</tr>
<tr>
<td align="left"><code>Before</code></td>
<td align="left"><code>findByStartDateBefore</code></td>
<td align="left"><code>â€¦ where x.startDate &lt; ?1</code></td>
</tr>
<tr>
<td align="left"><code>IsNull</code>, <code>Null</code></td>
<td align="left"><code>findByAge(Is)Null</code></td>
<td align="left"><code>â€¦ where x.age is null</code></td>
</tr>
<tr>
<td align="left"><code>IsNotNull</code>, <code>NotNull</code></td>
<td align="left"><code>findByAge(Is)NotNull</code></td>
<td align="left"><code>â€¦ where x.age not null</code></td>
</tr>
<tr>
<td align="left"><code>Like</code></td>
<td align="left"><code>findByFirstnameLike</code></td>
<td align="left"><code>â€¦ where x.firstname like ?1</code></td>
</tr>
<tr>
<td align="left"><code>NotLike</code></td>
<td align="left"><code>findByFirstnameNotLike</code></td>
<td align="left"><code>â€¦ where x.firstname not like ?1</code></td>
</tr>
<tr>
<td align="left"><code>StartingWith</code></td>
<td align="left"><code>findByFirstnameStartingWith</code></td>
<td align="left"><code>â€¦ where x.firstname like ?%</code></td>
</tr>
<tr>
<td align="left"><code>EndingWith</code></td>
<td align="left"><code>findByFirstnameEndingWith</code></td>
<td align="left"><code>â€¦ where x.firstname like %?</code></td>
</tr>
<tr>
<td align="left"><code>Containing</code></td>
<td align="left"><code>findByFirstnameContaining</code></td>
<td align="left"><code>â€¦ where x.firstname like %?%</code></td>
</tr>
<tr>
<td align="left"><code>OrderBy</code></td>
<td align="left"><code>findByAgeOrderByLastnameDesc</code></td>
<td align="left"><code>â€¦ where x.age = ?1 order by x.lastname desc</code></td>
</tr>
<tr>
<td align="left"><code>Not</code></td>
<td align="left"><code>findByLastnameNot</code></td>
<td align="left"><code>â€¦ where x.lastname &lt;&gt; ?1</code></td>
</tr>
<tr>
<td align="left"><code>In</code></td>
<td align="left"><code>findByAgeIn(Collection ages)</code></td>
<td align="left"><code>â€¦ where x.age in ?1</code></td>
</tr>
<tr>
<td align="left"><code>NotIn</code></td>
<td align="left"><code>findByAgeNotIn(Collection ages)</code></td>
<td align="left"><code>â€¦ where x.age not in ?1</code></td>
</tr>
<tr>
<td align="left"><code>True</code></td>
<td align="left"><code>findByActiveTrue()</code></td>
<td align="left"><code>â€¦ where x.active = true</code></td>
</tr>
<tr>
<td align="left"><code>False</code></td>
<td align="left"><code>findByActiveFalse()</code></td>
<td align="left"><code>â€¦ where x.active = false</code></td>
</tr>
<tr>
<td align="left"><code>IgnoreCase</code></td>
<td align="left"><code>findByFirstnameIgnoreCase</code></td>
<td align="left"><code>â€¦ where UPPER(x.firstame) = UPPER(?1)</code></td>
</tr>
</tbody></table>
<p><strong>maven åæ ‡</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>yml é…ç½®</strong></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#é…ç½®æ•°æ®æº</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    druid:</span></span><br><span class="line"><span class="attr">      type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="attr">      driverClassName:</span> <span class="string">net.sf.log4jdbc.sql.jdbcapi.DriverSpy</span></span><br><span class="line"><span class="attr">      url:</span> <span class="attr">jdbc:log4jdbc:mysql://localhost:3306/yshop</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#é…ç½® Jpa</span></span><br><span class="line"><span class="attr">  jpa:</span></span><br><span class="line"><span class="attr">    hibernate:</span></span><br><span class="line">      <span class="comment"># ç”Ÿäº§ç¯å¢ƒè®¾ç½®æˆ noneï¼Œé¿å…ç¨‹åºè¿è¡Œæ—¶è‡ªåŠ¨æ›´æ–°æ•°æ®åº“ç»“æ„</span></span><br><span class="line"><span class="attr">      ddl-auto:</span> <span class="string">update</span></span><br></pre></td></tr></table></figure>

<h2 id="JPA-vs-MyBatis"><a href="#JPA-vs-MyBatis" class="headerlink" title="JPA vs MyBatis"></a>JPA vs MyBatis</h2><h3 id="Mybatis"><a href="#Mybatis" class="headerlink" title="Mybatis"></a>Mybatis</h3><p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>SQL è¯­å¥å¯ä»¥è‡ªç”±æ§åˆ¶ï¼Œæ›´çµæ´»ï¼Œæ€§èƒ½æ›´é«˜</li>
<li>SQL ä¸ä»£ç åˆ†ç¦»ï¼Œæ˜“äºé˜…è¯»å’Œç»´æŠ¤</li>
<li>æä¾› XML æ ‡ç­¾ï¼Œæ”¯æŒåŠ¨æ€ SQL è¯­å¥</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>ç®€å• CRUD æ“ä½œè¿˜å¾—å†™ SQL è¯­å¥</li>
<li>XML ä¸­æœ‰å¤§é‡çš„ SQL éœ€è¦ç»´æŠ¤</li>
<li>MyBatis è‡ªèº«åŠŸèƒ½æœ‰é™ï¼Œä½†æ”¯æŒ Plugin</li>
</ul>
<h3 id="JPA-1"><a href="#JPA-1" class="headerlink" title="JPA"></a>JPA</h3><p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>ç§»æ¤æ€§æ¯”è¾ƒå¥½</li>
<li>æä¾›äº†å¾ˆå¤š CRUD æ–¹æ³•ï¼Œå¼€å‘æ•ˆç‡é«˜</li>
<li>å¯¹è±¡åŒ–ç¨‹åº¦é«˜</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>æ¡†æ¶æ¯”è¾ƒé‡ï¼Œå­¦ä¹ æˆæœ¬è¾ƒé«˜</li>
<li>æ€§èƒ½ä¸å¥½æ§åˆ¶</li>
</ul>
<p><strong>Hibernate</strong>ï¼š</p>
<ul>
<li>é‡ç‚¹å…³æ³¨<strong>å¯¹è±¡åˆ°å…³ç³»</strong>çš„æ˜ å°„ï¼Œè®¾è®¡ä¸Šå¸Œæœ›é€šè¿‡é¢å‘å¯¹è±¡çš„æ–¹å¼å†™ SQLï¼Œå¯ä»¥æ›´å¥½çš„å±è”½ä¸åŒæ•°æ®åº“ä¹‹é—´çš„å·®å¼‚ï¼ŒæŠ½è±¡ç¨‹åº¦æ›´é«˜ã€‚</li>
<li>å®Œæ•´åœ° ORM æ¡†æ¶ï¼Œä¸éœ€è¦è‡ªè¡Œå†™ SQLï¼Œæ¡†æ¶æ¯”è¾ƒé‡ï¼Œå­¦ä¹ æˆæœ¬è¾ƒé«˜ï¼Œæ€§èƒ½ä¸å¥½æ§åˆ¶ï¼ŒåŠŸèƒ½å¼ºå¤§ä¸”æ–‡æ¡£ä¸°å¯Œã€‚</li>
</ul>
<p><strong>Mybatis</strong>ï¼š</p>
<ul>
<li>é‡ç‚¹å…³æ³¨<strong>å…³ç³»åˆ°å¯¹è±¡</strong>çš„æ˜ å°„ï¼Œæ›´çµæ´»ï¼Œä½†å—é™äºå¼€å‘ç¼–å†™ SQL ä»£ç æ°´å¹³ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸å…¼å®¹ä¸åŒæ•°æ®åº“ SQL çš„æƒ…å†µã€‚</li>
<li>ä¸å®Œæ•´çš„ ORM æ¡†æ¶ï¼Œä¸èƒ½è‡ªåŠ¨å»ºè¡¨ï¼Œéœ€è¦è‡ªè¡Œå†™å…¨éƒ¨çš„ SQLï¼Œè½»é‡çº§æ¡†æ¶ï¼Œå­¦ä¹ æˆæœ¬ä½ï¼Œæ€§èƒ½å¥½æ§åˆ¶ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
  </entry>
  <entry>
    <title>Java Â· é¡¹ç›®è§£æ Â· yshopæ„åƒå•†åŸç³»ç»Ÿ</title>
    <url>/blog/2019/11/26/java-project-yshop/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><a href="https://gitee.com/guchengwuyue/yshopmall" target="_blank" rel="noopener"><strong>yshop</strong></a> åŸºäºå½“å‰æµè¡ŒæŠ€æœ¯ç»„åˆçš„å‰åç«¯åˆ†ç¦»å•†åŸç³»ç»Ÿï¼Œ åŒ…å«å•†åŸã€æ‹¼å›¢ã€ç ä»·ã€ ç§’æ€ã€ä¼˜æƒ åˆ¸ã€ç§¯åˆ†ã€åˆ†é”€ç­‰åŠŸèƒ½ï¼Œé€‚åˆä¼ä¸šæˆ–ä¸ªäººäºŒæ¬¡å¼€å‘ã€‚</p>
<ul>
<li><strong>ä½“éªŒ</strong>ï¼š<a href="https://yshop.dayouqiantu.cn/" target="_blank" rel="noopener">https://yshop.dayouqiantu.cn</a>  </li>
<li><strong>ç™»å½•</strong>ï¼šadmin/123456</li>
</ul>
<h3 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h3><ul>
<li>yshop-apiï¼šå…¬ä¼—å· API æ¨¡å—ï¼ˆH5ï¼‰</li>
<li>yshop-mpï¼šå¾®ä¿¡ç›¸å…³æ¨¡å—</li>
<li>yshop-commonï¼šå…¬å…±æ¨¡å—</li>
<li>yshop-systemï¼šå•†åŸç³»ç»Ÿæ¨¡å—</li>
<li>yshop-loggingï¼šæ—¥å¿—æ¨¡å—</li>
<li>yshop-toolsï¼šç¬¬ä¸‰æ–¹å·¥å…·æ¨¡å—</li>
<li>yshop-generatorï¼šä»£ç ç”Ÿæˆæ¨¡å—</li>
</ul>
<h3 id="åç«¯æŠ€æœ¯"><a href="#åç«¯æŠ€æœ¯" class="headerlink" title="åç«¯æŠ€æœ¯"></a>åç«¯æŠ€æœ¯</h3><ul>
<li><a href="https://spring.io/projects/spring-boot/" target="_blank" rel="noopener">Spring Boot</a></li>
<li><a href="https://mybatis.org/mybatis-3/zh/index.html" target="_blank" rel="noopener">MyBatis</a>ã€<a href="https://mp.baomidou.com/" target="_blank" rel="noopener">MyBatis-Plus</a></li>
<li><a href="https://spring.io/projects/spring-security" target="_blank" rel="noopener">Spring Security</a></li>
<li><a href="https://spring.io/projects/spring-data-jpa" target="_blank" rel="noopener">JPA</a></li>
<li><a href="https://github.com/alibaba/druid" target="_blank" rel="noopener">Druid</a></li>
<li><a href="https://github.com/qos-ch/slf4j" target="_blank" rel="noopener">Slf4j</a></li>
<li><a href="https://github.com/alibaba/fastjson" target="_blank" rel="noopener">fastjson</a></li>
<li><a href="https://github.com/lcobucci/jwt" target="_blank" rel="noopener">JWT</a></li>
<li><a href="https://redis.io/" target="_blank" rel="noopener">Redis</a></li>
<li><a href="http://www.quartz-scheduler.org/" target="_blank" rel="noopener">Quartz</a></li>
<li><a href="https://www.mysql.com/" target="_blank" rel="noopener">MySQL</a></li>
<li><a href="https://swagger.io/" target="_blank" rel="noopener">Swagger</a></li>
<li><a href="https://github.com/Wechat-Group/WxJava" target="_blank" rel="noopener">WxJava</a></li>
<li><a href="https://projectlombok.org/" target="_blank" rel="noopener">Lombok</a></li>
<li><a href="https://www.hutool.cn/" target="_blank" rel="noopener">Hutool</a></li>
<li><a href="https://mapstruct.org/" target="_blank" rel="noopener">Mapstruct</a></li>
</ul>
<h3 id="å‰ç«¯æŠ€æœ¯"><a href="#å‰ç«¯æŠ€æœ¯" class="headerlink" title="å‰ç«¯æŠ€æœ¯"></a>å‰ç«¯æŠ€æœ¯</h3><ul>
<li><a href="https://cn.vuejs.org/" target="_blank" rel="noopener">Vue</a> </li>
<li><a href="https://element.eleme.cn/#/zh-CN" target="_blank" rel="noopener">Element</a></li>
</ul>
<h3 id="å•†åŸåŠŸèƒ½"><a href="#å•†åŸåŠŸèƒ½" class="headerlink" title="å•†åŸåŠŸèƒ½"></a>å•†åŸåŠŸèƒ½</h3><ul>
<li>å•†å“æ¨¡å—ï¼šå•†å“æ·»åŠ ã€è§„æ ¼è®¾ç½®ï¼Œå•†å“ä¸Šä¸‹æ¶ç­‰</li>
<li>è®¢å•æ¨¡å—ï¼šä¸‹å•ã€è´­ç‰©è½¦ã€æ”¯ä»˜ï¼Œå‘è´§ã€æ”¶è´§ã€è¯„ä»·ã€é€€æ¬¾ç­‰</li>
<li>è¥é”€æ¨¡å—ï¼šç§¯åˆ†ã€ä¼˜æƒ åˆ¸ã€åˆ†é”€ã€ç ä»·ã€æ‹¼å›¢ã€ç§’æ€(ã€åˆ°åº—æ ¸é”€ç­‰</li>
<li>å¾®ä¿¡æ¨¡å—ï¼šè‡ªå®šä¹‰èœå•ã€è‡ªåŠ¨å›å¤ã€å¾®ä¿¡æˆæƒã€å›¾æ–‡ç®¡ç†ã€æ¨¡æ¿æ¶ˆæ¯æ¨é€</li>
<li>é…ç½®æ¨¡å—ï¼šå„ç§é…ç½®</li>
<li>ç”¨æˆ·æ¨¡å—ï¼šç™»é™†ã€æ³¨å†Œã€ä¼šå‘˜å¡ç­‰</li>
<li>å…¶ä»–ç­‰</li>
</ul>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
  </entry>
  <entry>
    <title>çŸ¥è¯†ç•™å­˜ç‡</title>
    <url>/blog/2019/11/26/ilearning/</url>
    <content><![CDATA[<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-11-26-101100.jpeg" alt></p>
]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
  </entry>
  <entry>
    <title>Java Â· æ¡†æ¶ Â· Spring</title>
    <url>/blog/2019/11/25/java-frame-spring/</url>
    <content><![CDATA[<h2 id="Spring-IOC"><a href="#Spring-IOC" class="headerlink" title="Spring IOC"></a>Spring IOC</h2><p><strong>IOC</strong>ï¼šInversion Of Controlï¼Œå³æ§åˆ¶åè½¬ï¼Œæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ã€‚åœ¨ä¼ ç»Ÿçš„ Java SE ç¨‹åºè®¾è®¡ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨å¯¹è±¡å†…éƒ¨é€šè¿‡ new çš„æ–¹å¼æ¥åˆ›å»ºå¯¹è±¡ï¼Œæ˜¯ç¨‹åºä¸»åŠ¨åˆ›å»ºä¾èµ–å¯¹è±¡ï¼›è€Œåœ¨ Spring ç¨‹åºè®¾è®¡ä¸­ï¼ŒIOC æ˜¯æœ‰ä¸“é—¨çš„å®¹å™¨å»æ§åˆ¶å¯¹è±¡ã€‚</p>
<p><strong>æ§åˆ¶</strong>ï¼šå°±æ˜¯å¯¹è±¡çš„åˆ›å»ºã€åˆå§‹åŒ–ã€é”€æ¯ã€‚</p>
<p><strong>åè½¬</strong>ï¼šå…¶å®æ˜¯åè½¬çš„æ§åˆ¶æƒï¼Œå‰é¢æåˆ°æ˜¯ç”± Spring æ¥æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œé‚£ä¹ˆå¯¹è±¡çš„æ§åˆ¶å°±å®Œå…¨è„±ç¦»äº†æˆ‘ä»¬çš„æ§åˆ¶ï¼Œæ§åˆ¶æƒäº¤ç»™äº† Spring ã€‚</p>
<ul>
<li>åˆ›å»ºå¯¹è±¡ï¼šåŸæ¥æ˜¯ new ä¸€ä¸ªï¼Œç°åœ¨æ˜¯ç”± Spring å®¹å™¨åˆ›å»ºã€‚</li>
<li>åˆå§‹åŒ–å¯¹è±¡ï¼šåŸæ¥æ˜¯å¯¹è±¡è‡ªå·±é€šè¿‡æ„é€ å™¨æˆ–è€… setter æ–¹æ³•ç»™ä¾èµ–çš„å¯¹è±¡èµ‹å€¼ï¼Œç°åœ¨æ˜¯ç”± Spring å®¹å™¨è‡ªåŠ¨æ³¨å…¥ã€‚</li>
<li>é”€æ¯å¯¹è±¡ï¼šåŸæ¥æ˜¯ç›´æ¥ç»™å¯¹è±¡èµ‹å€¼ æˆ–åšä¸€äº›é”€æ¯æ“ä½œï¼Œç°åœ¨æ˜¯ Spring å®¹å™¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸè´Ÿè´£é”€æ¯å¯¹è±¡ã€‚</li>
</ul>
<p><strong>æ€»ç»“</strong>ï¼šIOC è§£å†³äº†ç¹ççš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„æ“ä½œï¼Œé™ä½ç¨‹åºé—´çš„è€¦åˆï¼ˆä¾èµ–å…³ç³»ï¼‰ã€‚</p>
<p><strong>DI</strong>ï¼šDependency injectionï¼Œå³ä¾èµ–æ³¨å…¥ï¼Œæ˜¯ä¸€ç§å®ç°ï¼Œè€Œ IOC æ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ã€‚ç¨‹åºæŠŠä¾èµ–äº¤ç»™å®¹å™¨ï¼Œå®¹å™¨å¸®ä½ ç®¡ç†ä¾èµ–ï¼Œè¿™å°±æ˜¯ä¾èµ–æ³¨å…¥çš„æ ¸å¿ƒã€‚</p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Java</category>
      </categories>
  </entry>
  <entry>
    <title>Nginx ç¬”è®°</title>
    <url>/blog/2019/11/25/ilearning-nginx/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><a href="http://nginx.org/" target="_blank" rel="noopener"><strong>Nginx</strong></a>ï¼šæ˜¯ä¸€æ¬¾è½»é‡çº§çš„ Web æœåŠ¡å™¨ã€åå‘ä»£ç†æœåŠ¡å™¨ï¼Œç”±äºå®ƒçš„å†…å­˜å ç”¨å°‘ï¼ˆä¸€ä¸ª worker è¿›ç¨‹åªå ç”¨ 10-12M å†…å­˜ï¼‰ã€å¯åŠ¨æå¿«ã€é«˜å¹¶å‘èƒ½åŠ›å¼ºï¼Œåœ¨äº’è”ç½‘é¡¹ç›®ä¸­å¹¿æ³›åº”ç”¨ã€‚</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-11-25-104100.jpeg" alt></p>
<h3 id="ä»£ç†"><a href="#ä»£ç†" class="headerlink" title="ä»£ç†"></a>ä»£ç†</h3><p><strong>æ­£å‘ä»£ç†</strong></p>
<p>ç”±äºé˜²ç«å¢™çš„åŸå› ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½ç›´æ¥è®¿é—®è°·æ­Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å€ŸåŠ© VPN æ¥å®ç°ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªç®€å•çš„æ­£å‘ä»£ç†çš„ä¾‹å­ã€‚è¿™é‡Œä½ èƒ½å¤Ÿå‘ç°ï¼Œ<strong>æ­£å‘ä»£ç†â€œä»£ç†â€çš„æ˜¯å®¢æˆ·ç«¯</strong>ï¼Œå®¢æˆ·ç«¯æ˜¯çŸ¥é“ç›®æ ‡çš„ï¼Œè€Œç›®æ ‡æ˜¯ä¸çŸ¥é“å®¢æˆ·ç«¯æ˜¯é€šè¿‡ VPN è®¿é—®çš„ã€‚</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-11-25-104200.jpeg" alt></p>
<p><strong>åå‘ä»£ç†</strong></p>
<p>å½“æˆ‘ä»¬åœ¨å¤–ç½‘è®¿é—®ç™¾åº¦çš„æ—¶å€™ï¼Œå…¶å®ä¼šè¿›è¡Œä¸€ä¸ªè½¬å‘ï¼Œä»£ç†åˆ°å†…ç½‘å»ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„åå‘ä»£ç†ï¼Œ<strong>å³åå‘ä»£ç†â€œä»£ç†â€çš„æ˜¯æœåŠ¡å™¨ç«¯</strong>ï¼Œè€Œä¸”è¿™ä¸€ä¸ªè¿‡ç¨‹å¯¹äºå®¢æˆ·ç«¯è€Œè¨€æ˜¯é€æ˜çš„ã€‚</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-11-25-104300.jpeg" alt></p>
<p><strong>web æœåŠ¡å™¨å¯¹æ¯”</strong></p>
<table>
<thead>
<tr>
<th><strong>å¯¹æ¯”é¡¹ \ æœåŠ¡å™¨</strong></th>
<th><strong>Apache</strong></th>
<th><strong>Nginx</strong></th>
<th><strong>Lighttpd</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Proxyä»£ç†</td>
<td>éå¸¸å¥½</td>
<td>éå¸¸å¥½</td>
<td>ä¸€èˆ¬</td>
</tr>
<tr>
<td>Rewriter</td>
<td>å¥½</td>
<td>éå¸¸å¥½</td>
<td>ä¸€èˆ¬</td>
</tr>
<tr>
<td>Fcgi</td>
<td>ä¸å¥½</td>
<td>å¥½</td>
<td>éå¸¸å¥½</td>
</tr>
<tr>
<td>çƒ­éƒ¨ç½²</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>ç³»ç»Ÿå‹åŠ›</td>
<td>å¾ˆå¤§</td>
<td>å¾ˆå°</td>
<td>æ¯”è¾ƒå°</td>
</tr>
<tr>
<td>ç¨³å®šæ€§</td>
<td>å¥½</td>
<td>éå¸¸å¥½</td>
<td>ä¸å¥½</td>
</tr>
<tr>
<td>å®‰å…¨æ€§</td>
<td>å¥½</td>
<td>ä¸€èˆ¬</td>
<td>ä¸€èˆ¬</td>
</tr>
<tr>
<td>é™æ€æ–‡ä»¶å¤„ç†</td>
<td>ä¸€èˆ¬</td>
<td>éå¸¸å¥½</td>
<td>å¥½</td>
</tr>
<tr>
<td>åå‘ä»£ç†</td>
<td>ä¸€èˆ¬</td>
<td>éå¸¸å¥½</td>
<td>ä¸€èˆ¬</td>
</tr>
</tbody></table>
<h3 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h3><p>è´Ÿè½½å‡è¡¡ä½œä¸ºæµé‡è½¬å‘æœåŠ¡ï¼Œå°†æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚é€šè¿‡è´Ÿè½½å‡è¡¡é›†ç¾¤è½¬å‘è‡³åç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨å†å°†å“åº”é€šè¿‡å†…ç½‘è¿”å›ç»™è´Ÿè½½å‡è¡¡ã€‚åŸºç¡€æ¶æ„æ˜¯é‡‡ç”¨é›†ç¾¤éƒ¨ç½²ï¼Œæä¾›å››å±‚ï¼ˆTCP åè®®å’Œ UDP åè®®ï¼‰å’Œä¸ƒå±‚ï¼ˆHTTP å’Œ HTTPS åè®®ï¼‰çš„è´Ÿè½½å‡è¡¡ï¼Œå¯å®ç°ä¼šè¯åŒæ­¥ï¼Œä»¥æ¶ˆé™¤æœåŠ¡å™¨å•ç‚¹æ•…éšœï¼Œæå‡å†—ä½™ï¼Œä¿è¯æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-11-25-112200.png" alt></p>
<ul>
<li><strong>ç¡¬ä»¶è´Ÿè½½å‡è¡¡</strong>ï¼šæ˜¯ç›´æ¥åœ¨æœåŠ¡å™¨å’Œå¤–éƒ¨ç½‘ç»œé—´å®‰è£…è´Ÿè½½å‡è¡¡è®¾å¤‡ï¼Œè¿™ç§è®¾å¤‡é€šå¸¸æ˜¯ä¸€ä¸ªç‹¬ç«‹äºç³»ç»Ÿçš„ç¡¬ä»¶ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºè´Ÿè½½å‡è¡¡å™¨ï¼Œä¾‹å¦‚ F5ã€‚</li>
<li><strong>è½¯ä»¶è´Ÿè½½å‡è¡¡</strong>ï¼šæ˜¯æŒ‡åœ¨ä¸€å°æˆ–å¤šå°æœåŠ¡å™¨ç›¸åº”çš„æ“ä½œç³»ç»Ÿä¸Šå®‰è£…ä¸€ä¸ªæˆ–å¤šä¸ªé™„åŠ è½¯ä»¶æ¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œä¾‹å¦‚ Nginxã€LVSã€‚</li>
<li><strong>å››å±‚è´Ÿè½½å‡è¡¡</strong>ï¼šæ˜¯æŒ‡åŸºäº<strong>IP + ç«¯å£</strong>çš„è´Ÿè½½å‡è¡¡ï¼Œå¸¸è§ä¾‹å­æœ‰ï¼šLVSï¼ŒF5ã€‚</li>
<li><strong>ä¸ƒå±‚è´Ÿè½½å‡è¡¡</strong>ï¼šæ˜¯åŸºäº<strong>è™šæ‹ŸURLæˆ–ä¸»æœºIP</strong>çš„è´Ÿè½½å‡è¡¡ï¼Œå¸¸è§ä¾‹å­æœ‰ï¼š HAProxyï¼ŒMySQL Proxyã€‚</li>
</ul>
<h2 id="Nginx-è¿›ç¨‹"><a href="#Nginx-è¿›ç¨‹" class="headerlink" title="Nginx è¿›ç¨‹"></a>Nginx è¿›ç¨‹</h2><p>å¯åŠ¨ Nginx åï¼Œå…¶å®å°±æ˜¯åœ¨ 80 ç«¯å£å¯åŠ¨äº† Socket æœåŠ¡è¿›è¡Œç›‘å¬ï¼ŒNginx æ¶‰åŠ Master è¿›ç¨‹å’Œ Worker è¿›ç¨‹ã€‚</p>
<ul>
<li><strong>Master è¿›ç¨‹</strong>ï¼šè¯»å–å¹¶éªŒè¯é…ç½®æ–‡ä»¶ <code>nginx.conf</code>ï¼Œç®¡ç† worker è¿›ç¨‹ã€‚</li>
<li><strong>Worker è¿›ç¨‹</strong>ï¼šæ¯ä¸€ä¸ª Worker è¿›ç¨‹éƒ½ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹ï¼ˆé¿å…çº¿ç¨‹åˆ‡æ¢ï¼‰ï¼Œå¤„ç†è¿æ¥å’Œè¯·æ±‚ï¼ŒWorker è¿›ç¨‹çš„ä¸ªæ•°ç”±é…ç½®æ–‡ä»¶å†³å®šï¼Œä¸€èˆ¬å’Œ CPU ä¸ªæ•°ç›¸å…³ï¼ˆæœ‰åˆ©äºè¿›ç¨‹åˆ‡æ¢ï¼‰ï¼Œé…ç½®å‡ ä¸ªå°±æœ‰å‡ ä¸ª Worker è¿›ç¨‹ã€‚</li>
</ul>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-11-25-134000.jpeg" alt></p>
<p><strong>æ€è€ƒ1ï¼šNginx å¦‚ä½•åšåˆ°çƒ­éƒ¨ç½²ï¼Ÿ</strong></p>
<p>æ‰€è°“çƒ­éƒ¨ç½²ï¼Œå°±æ˜¯é…ç½®æ–‡ä»¶ <code>nginx.conf</code> ä¿®æ”¹åï¼Œä¸éœ€è¦ stop nginxï¼Œä¸éœ€è¦ä¸­æ–­è¯·æ±‚ï¼Œå°±èƒ½è®©é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼</p>
<p><strong>å®ç°æ–¹æ¡ˆ</strong>ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶ <code>nginx.conf</code> åï¼Œé‡æ–°ç”Ÿæˆæ–°çš„ worker è¿›ç¨‹ï¼Œå½“ç„¶ä¼šä»¥æ–°çš„é…ç½®è¿›è¡Œå¤„ç†ï¼Œè€Œä¸”æ–°çš„è¯·æ±‚éƒ½å¿…é¡»äº¤ç»™æ–°çš„ worker è¿›ç¨‹ï¼Œè‡³äºè€ worker è¿›ç¨‹ï¼Œç­‰æŠŠé‚£äº›ä»¥å‰çš„è¯·æ±‚å¤„ç†å®Œæ¯•ï¼Œkill æ‰å³å¯ã€‚</p>
<p><strong>æ€è€ƒ2ï¼šNginx å¦‚ä½•åšåˆ°é«˜å¹¶å‘ä¸‹çš„é«˜æ•ˆå¤„ç†ï¼Ÿ</strong></p>
<p><strong>å®ç°æ–¹æ¡ˆ</strong>ï¼šNginx é‡‡ç”¨äº† Linux çš„ epoll æ¨¡å‹ï¼Œepoll æ¨¡å‹åŸºäºäº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œå®ƒå¯ä»¥ç›‘æ§å¤šä¸ªäº‹ä»¶æ˜¯å¦å‡†å¤‡å®Œæ¯•ï¼Œå¦‚æœ OKï¼Œé‚£ä¹ˆæ”¾å…¥ epoll é˜Ÿåˆ—ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œworker åªéœ€è¦ä» epoll é˜Ÿåˆ—å¾ªç¯å¤„ç†å³å¯ã€‚</p>
<p><strong>æ€è€ƒ3ï¼šNginx æŒ‚äº†æ€ä¹ˆåŠï¼Ÿ</strong></p>
<p><strong>å®ç°æ–¹æ¡ˆ</strong>ï¼šKeepalived + Nginx å®ç°é«˜å¯ç”¨</p>
<ul>
<li>è¯·æ±‚ä¸è¦ç›´æ¥æ‰“åˆ° Nginx ä¸Šï¼Œåº”è¯¥å…ˆé€šè¿‡ Keepalivedï¼ˆè¿™å°±æ˜¯æ‰€è°“è™šæ‹Ÿ IPï¼ŒVIPï¼‰ï¼Œæ¶ˆé™¤å•ç‚¹æ•…éšœ</li>
<li>Keepalived åº”è¯¥èƒ½ç›‘æ§ Nginx çš„ç”Ÿå‘½çŠ¶æ€ï¼ˆæä¾›ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„è„šæœ¬ï¼Œå®šæœŸæ£€æŸ¥ Nginx è¿›ç¨‹çŠ¶æ€ï¼Œè¿›è¡Œæƒé‡å˜åŒ–ï¼Œä»è€Œå®ç° Nginx æ•…éšœåˆ‡æ¢ï¼‰</li>
</ul>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-11-25-113000.jpeg" alt></p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><ul>
<li>å®‰è£…</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">rpm -ivh http://nginx.org/packages/centos/<span class="number">7</span>/noarch/RPMS/nginx-release-centos-<span class="number">7</span>-<span class="number">0</span>.el7.ngx.noarch.rpm</span><br><span class="line">yum install -y nginx</span><br></pre></td></tr></table></figure>

<ul>
<li>è·¯å¾„</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib64/nginx /etc/nginx /usr/share/nginx /usr/share/man/man8/nginx.<span class="number">8</span>.gz</span><br><span class="line"></span><br><span class="line">- Nginxé…ç½®è·¯å¾„ï¼š/etc/nginx/nginx.conf</span><br><span class="line">- PIDç›®å½•ï¼š/var/run/nginx.pid</span><br><span class="line">- é”™è¯¯æ—¥å¿—ï¼š/var/log/nginx/error.log</span><br><span class="line">- è®¿é—®æ—¥å¿—ï¼š/var/log/nginx/access.log</span><br><span class="line">- é»˜è®¤ç«™ç‚¹ç›®å½•ï¼š/usr/share/nginx/html</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  zentao.smocer.top;</span><br><span class="line"></span><br><span class="line">        access_log  /var/log/nginx/zentao.access.log;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">          try_files /_not_exists_ @backend;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location @backend &#123;</span><br><span class="line">           proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">           proxy_set_header Host            $http_host;</span><br><span class="line">           proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">           </span><br><span class="line">        proxy_pass http://10.133.0.53:8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><blockquote>
<p>å¯åŠ¨</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nginx</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ£€æŸ¥é…ç½®</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nginx -t</span><br></pre></td></tr></table></figure>

<blockquote>
<p>çƒ­åŠ è½½</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æŸ¥è¯¢è¿›ç¨‹</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps -ef | grep nginx</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åœæœåŠ¡</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nginx -s stop</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
  </entry>
  <entry>
    <title>Java Â· æ¡†æ¶ Â· MyBatis</title>
    <url>/blog/2019/11/25/java-frame-mybatis/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><a href="https://mybatis.org/mybatis-3/zh/index.html" target="_blank" rel="noopener">MyBatis</a> æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ï¼Œå®ƒæ”¯æŒå®šåˆ¶åŒ– SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„ã€‚MyBatis é¿å…äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†ã€‚MyBatis å¯ä»¥ä½¿ç”¨ç®€å•çš„ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸç”Ÿç±»å‹ã€æ¥å£å’Œ Java çš„ POJOï¼ˆPlain Old Java Objectsï¼Œæ™®é€šè€å¼ Java å¯¹è±¡ï¼‰ä¸ºæ•°æ®åº“ä¸­çš„è®°å½•ã€‚</p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>MyBatis çš„åŸºæœ¬å·¥ä½œåŸç†æ˜¯ï¼š</p>
<ul>
<li>å…ˆå°è£… SQL</li>
<li>æ¥ç€è°ƒç”¨ JDBC æ“ä½œæ•°æ®åº“</li>
<li>æœ€åæŠŠæ•°æ®åº“è¿”å›çš„è¡¨ç»“æœå°è£…æˆ Java ç±»</li>
</ul>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-11-25-103400.png" alt></p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>å¦‚æœä½¿ç”¨ <a href="http://maven.apache.org/" target="_blank" rel="noopener">Maven</a> æ¥æ„å»ºé¡¹ç›®ï¼Œåˆ™éœ€å°†ä¸‹é¢çš„ dependency ä»£ç ç½®äº <code>pom.xml</code> æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><p>ä½¿ç”¨ MyBatis å®ç°æ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥ï¼š</p>
<ul>
<li>è¡¨ <code>user</code></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">CREATE TABLE `user` (</span><br><span class="line">  `id` int(<span class="number">11</span>) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `username` varchar(<span class="number">32</span>) NOT NULL COMMENT <span class="string">'ç”¨æˆ·åç§°'</span>,</span><br><span class="line">  `birthday` datetime DEFAULT NULL COMMENT <span class="string">'ç”Ÿæ—¥'</span>,</span><br><span class="line">  `sex` char(<span class="number">1</span>) NOT NULL COMMENT <span class="string">'æ€§åˆ«'</span>,</span><br><span class="line">  `address` varchar(<span class="number">255</span>) DEFAULT NULL COMMENT <span class="string">'åœ°å€'</span>,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=<span class="number">5</span> DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from user;</span><br><span class="line">+----+----------+---------------------+-----+--------------------+</span><br><span class="line">| id | username | birthday            | sex | address            |</span><br><span class="line">+----+----------+---------------------+-----+--------------------+</span><br><span class="line">|  <span class="number">1</span> | rao      | <span class="number">1990</span>-<span class="number">08</span>-<span class="number">07</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> | ç”·  | é™•è¥¿çœè¥¿å®‰å¸‚         |</span><br><span class="line">|  <span class="number">2</span> | yu       | <span class="number">1990</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> | å¥³  | å±±ä¸œçœèæ³½å¸‚         |</span><br><span class="line">|  <span class="number">3</span> | rao      | <span class="number">2019</span>-<span class="number">11</span>-<span class="number">24</span> <span class="number">04</span>:<span class="number">54</span>:<span class="number">31</span> | å¥³  | å±±ä¸œçœé’å²›å¸‚         |</span><br><span class="line">+----+----------+---------------------+-----+--------------------+</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸»é…ç½®æ–‡ä»¶ <code>SqlMapperConfig.xml</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- MyBatisä¸»é…ç½®æ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®ç¯å¢ƒ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- é…ç½®mysqlç¯å¢ƒ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- é…ç½®äº‹åŠ¡ç±»å‹ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- é…ç½®æ•°æ®æº --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.cj.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/mybatisdb"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æŒ‡å®šæ˜ å°„é…ç½®æ–‡ä»¶çš„ä½ç½® --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- XMLæ–¹å¼ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"com/rao/dao/IUserMapper.xml"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ³¨è§£æ–¹å¼ --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mapper class="com.rao.dao.IUserDao"/--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å®ä½“ç±» <code>User.java</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rao.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * userè¡¨å®ä½“ç±»</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Rao Hui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-11-24 15:12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getBirthday</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(String sex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">", username='"</span> + username + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", birthday="</span> + birthday +</span><br><span class="line">                <span class="string">", sex='"</span> + sex + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", address='"</span> + address + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Dao æ¥å£ <code>IUserDao.java</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rao.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rao.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·çš„æŒä¹…å±‚æ¥å£</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Rao Hui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-11-24 15:17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//@Select("select * from user") // æ³¨è§£æ–¹å¼</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿å­˜ç”¨æˆ·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°ç”¨æˆ·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤ç”¨æˆ·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(Integer userId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æ˜ å°„é…ç½®æ–‡ä»¶ <code>IUserMapper.xml</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.rao.dao.IUserDao"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æŸ¥è¯¢ç”¨æˆ· --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"com.rao.domain.User"</span>&gt;</span></span><br><span class="line">        select * from user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æ’å…¥ç”¨æˆ· --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"saveUser"</span> <span class="attr">parameterType</span>=<span class="string">"com.rao.domain.User"</span>&gt;</span></span><br><span class="line">        insert into user (username,sex,birthday,address) values (#&#123;username&#125;,#&#123;sex&#125;,#&#123;birthday&#125;,#&#123;address&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æ›´æ–°ç”¨æˆ· --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span> <span class="attr">parameterType</span>=<span class="string">"com.rao.domain.User"</span>&gt;</span></span><br><span class="line">        update user set username=#&#123;username&#125;,sex=#&#123;sex&#125;,birthday=#&#123;birthday&#125;,address=#&#123;address&#125; where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- åˆ é™¤ç”¨æˆ· --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteUser"</span> <span class="attr">parameterType</span>=<span class="string">"java.lang.Integer"</span>&gt;</span></span><br><span class="line">        delete from user where id=#&#123;uid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>æ¥å£æµ‹è¯•ç±» <code>MybatisTest.java</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.rao.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rao.dao.IUserDao;</span><br><span class="line"><span class="keyword">import</span> com.rao.domain.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * mybatiså…¥é—¨æµ‹è¯•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Rao Hui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-11-24 15:49</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line">    <span class="keyword">private</span> IUserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 1. è¯»å–é…ç½®æ–‡ä»¶</span></span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. åˆ›å»ºSqlSessionFactoryå·¥å‚</span></span><br><span class="line">        SqlSessionFactoryBuilder builder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory factory = builder.build(in);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. ä½¿ç”¨å·¥å‚ç”Ÿäº§SqlSessionå¯¹è±¡</span></span><br><span class="line">        session = factory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. ä½¿ç”¨SqlSessionåˆ›å»ºDaoæ¥å£çš„ä»£ç†å¯¹è±¡</span></span><br><span class="line">        userDao = session.getMapper(IUserDao.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        session.commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. ä½¿ç”¨ä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users)</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSaveUser</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setUsername(<span class="string">"hui"</span>);</span><br><span class="line">        user.setSex(<span class="string">"ç”·"</span>);</span><br><span class="line">        user.setAddress(<span class="string">"å±±ä¸œçœé’å²›å¸‚"</span>);</span><br><span class="line">        user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">        userDao.saveUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateUser</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(<span class="number">3</span>);</span><br><span class="line">        user.setUsername(<span class="string">"liu"</span>);</span><br><span class="line">        user.setSex(<span class="string">"å¥³"</span>);</span><br><span class="line">        user.setAddress(<span class="string">"å±±ä¸œçœé’å²›å¸‚"</span>);</span><br><span class="line">        user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">        userDao.updateUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteUser</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        userDao.deleteUser(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.bilibili.com/video/av71389596" target="_blank" rel="noopener">æ¥æº</a></p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
  </entry>
  <entry>
    <title>Java Â· é«˜çº§ç‰¹æ€§</title>
    <url>/blog/2019/11/20/java-object-and-class/</url>
    <content><![CDATA[<h2 id="åå°„-Reflection"><a href="#åå°„-Reflection" class="headerlink" title="åå°„ (Reflection)"></a>åå°„ (Reflection)</h2><h3 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h3><p><strong>åå°„æœºåˆ¶</strong>ï¼šåœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯ä»¥åŠ¨æ€è®¿é—® Java å¯¹è±¡çš„å±æ€§ã€æ–¹æ³•ã€æ„é€ æ–¹æ³•ç­‰ã€‚</p>
<p><strong>åœºæ™¯</strong>ï¼šå¾ˆå¤šæ¡†æ¶éƒ½è¿ç”¨äº†åå°„åŸç†ï¼Œä¾‹å¦‚ MyBatis çš„å®ä½“ç±»ï¼ŒSpring çš„ AOP ç­‰éƒ½æœ‰åå°„çš„å®ç°ã€‚</p>
<h3 id="ç›¸å…³ç±»"><a href="#ç›¸å…³ç±»" class="headerlink" title="ç›¸å…³ç±»"></a>ç›¸å…³ç±»</h3><ul>
<li>java.lang.Classï¼šä»£è¡¨ç±»çš„å®ä½“ï¼Œåœ¨è¿è¡Œçš„ Java åº”ç”¨ç¨‹åºä¸­è¡¨ç¤ºç±»å’Œæ¥å£</li>
<li>java.lang.reflect.Methodï¼šä»£è¡¨ç±»çš„æ–¹æ³•</li>
<li>java.lang.reflect.Fieldï¼šä»£è¡¨ç±»çš„æˆå‘˜å˜é‡</li>
<li>java.lang.reflect.Constructorï¼šä»£è¡¨ç±»çš„æ„é€ æ–¹æ³•</li>
</ul>
<h4 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h4><ul>
<li><strong>è·å–ç±»ç›¸å…³æ–¹æ³•</strong></li>
</ul>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td>asSubclass(Class<u> clazz)</u></td>
<td>æŠŠä¼ é€’çš„ç±»çš„å¯¹è±¡è½¬æ¢æˆä»£è¡¨å…¶å­ç±»çš„å¯¹è±¡</td>
</tr>
<tr>
<td>Cast</td>
<td>æŠŠå¯¹è±¡è½¬æ¢æˆä»£è¡¨ç±»æˆ–æ˜¯æ¥å£çš„å¯¹è±¡</td>
</tr>
<tr>
<td>getClassLoader()</td>
<td>è·å¾—ç±»çš„åŠ è½½å™¨</td>
</tr>
<tr>
<td>getClasses()</td>
<td>è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­åŒ…å«è¯¥ç±»ä¸­æ‰€æœ‰å…¬å…±ç±»å’Œæ¥å£ç±»çš„å¯¹è±¡</td>
</tr>
<tr>
<td>getDeclaredClasses()</td>
<td>è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­åŒ…å«è¯¥ç±»ä¸­æ‰€æœ‰ç±»å’Œæ¥å£ç±»çš„å¯¹è±¡</td>
</tr>
<tr>
<td>forName(String className)</td>
<td>æ ¹æ®ç±»åè¿”å›ç±»çš„å¯¹è±¡</td>
</tr>
<tr>
<td>getName()</td>
<td>è·å¾—ç±»çš„å®Œæ•´è·¯å¾„åå­—</td>
</tr>
<tr>
<td>newInstance()</td>
<td>åˆ›å»ºç±»çš„å®ä¾‹</td>
</tr>
<tr>
<td>getPackage()</td>
<td>è·å¾—ç±»çš„åŒ…</td>
</tr>
<tr>
<td>getSimpleName()</td>
<td>è·å¾—ç±»çš„åå­—</td>
</tr>
<tr>
<td>getSuperclass()</td>
<td>è·å¾—å½“å‰ç±»ç»§æ‰¿çš„çˆ¶ç±»çš„åå­—</td>
</tr>
<tr>
<td>getInterfaces()</td>
<td>è·å¾—å½“å‰ç±»å®ç°çš„ç±»æˆ–æ˜¯æ¥å£</td>
</tr>
</tbody></table>
<ul>
<li><strong>è·å–ç±»ä¸­å±æ€§ç›¸å…³çš„æ–¹æ³•</strong></li>
</ul>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td>getField(String name)</td>
<td>è·å¾—æŸä¸ªå…¬æœ‰çš„å±æ€§å¯¹è±¡</td>
</tr>
<tr>
<td>getFields()</td>
<td>è·å¾—æ‰€æœ‰å…¬æœ‰çš„å±æ€§å¯¹è±¡</td>
</tr>
<tr>
<td>getDeclaredField(String name)</td>
<td>è·å¾—æŸä¸ªå±æ€§å¯¹è±¡</td>
</tr>
<tr>
<td>getDeclaredFields()</td>
<td>è·å¾—æ‰€æœ‰å±æ€§å¯¹è±¡</td>
</tr>
</tbody></table>
<ul>
<li><strong>è·å–ç±»ä¸­æ„é€ å™¨ç›¸å…³çš„æ–¹æ³•</strong></li>
</ul>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td>getConstructor(Classâ€¦&lt;?&gt; parameterTypes)</td>
<td>è·å¾—è¯¥ç±»ä¸­ä¸å‚æ•°ç±»å‹åŒ¹é…çš„å…¬æœ‰æ„é€ æ–¹æ³•</td>
</tr>
<tr>
<td>getConstructors()</td>
<td>è·å¾—è¯¥ç±»çš„æ‰€æœ‰å…¬æœ‰æ„é€ æ–¹æ³•</td>
</tr>
<tr>
<td>getDeclaredConstructor(Classâ€¦&lt;?&gt; parameterTypes)</td>
<td>è·å¾—è¯¥ç±»ä¸­ä¸å‚æ•°ç±»å‹åŒ¹é…çš„æ„é€ æ–¹æ³•</td>
</tr>
<tr>
<td>getDeclaredConstructors()</td>
<td>è·å¾—è¯¥ç±»æ‰€æœ‰æ„é€ æ–¹æ³•</td>
</tr>
</tbody></table>
<ul>
<li><strong>è·å¾—ç±»ä¸­æ–¹æ³•ç›¸å…³çš„æ–¹æ³•</strong></li>
</ul>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td>getMethod(String name, Classâ€¦&lt;?&gt; parameterTypes)</td>
<td>è·å¾—è¯¥ç±»æŸä¸ªå…¬æœ‰çš„æ–¹æ³•</td>
</tr>
<tr>
<td>getMethods()</td>
<td>è·å¾—è¯¥ç±»æ‰€æœ‰å…¬æœ‰çš„æ–¹æ³•</td>
</tr>
<tr>
<td>getDeclaredMethod(String name, Classâ€¦&lt;?&gt; parameterTypes)</td>
<td>è·å¾—è¯¥ç±»æŸä¸ªæ–¹æ³•</td>
</tr>
<tr>
<td>getDeclaredMethods()</td>
<td>è·å¾—è¯¥ç±»æ‰€æœ‰æ–¹æ³•</td>
</tr>
</tbody></table>
<ul>
<li><strong>è·å¾—ç±»ä¸­æ³¨è§£ç›¸å…³çš„æ–¹æ³•</strong></li>
</ul>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td>getAnnotation(Class<a> annotationClass)</a></td>
<td>è¿”å›è¯¥ç±»ä¸­ä¸å‚æ•°ç±»å‹åŒ¹é…çš„å…¬æœ‰æ³¨è§£å¯¹è±¡</td>
</tr>
<tr>
<td>getAnnotations()</td>
<td>è¿”å›è¯¥ç±»æ‰€æœ‰çš„å…¬æœ‰æ³¨è§£å¯¹è±¡</td>
</tr>
<tr>
<td>getDeclaredAnnotation(Class<a> annotationClass)</a></td>
<td>è¿”å›è¯¥ç±»ä¸­ä¸å‚æ•°ç±»å‹åŒ¹é…çš„æ‰€æœ‰æ³¨è§£å¯¹è±¡</td>
</tr>
<tr>
<td>getDeclaredAnnotations()</td>
<td>è¿”å›è¯¥ç±»æ‰€æœ‰çš„æ³¨è§£å¯¹è±¡</td>
</tr>
</tbody></table>
<h4 id="Field"><a href="#Field" class="headerlink" title="Field"></a>Field</h4><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td>equals(Object obj)</td>
<td>å±æ€§ä¸objç›¸ç­‰åˆ™è¿”å›true</td>
</tr>
<tr>
<td>get(Object obj)</td>
<td>è·å¾—objä¸­å¯¹åº”çš„å±æ€§å€¼</td>
</tr>
<tr>
<td>set(Object obj, Object value)</td>
<td>è®¾ç½®objä¸­å¯¹åº”å±æ€§å€¼</td>
</tr>
</tbody></table>
<h4 id="Method"><a href="#Method" class="headerlink" title="Method"></a>Method</h4><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td>invoke(Object obj, Objectâ€¦ args)</td>
<td>ä¼ é€’objectå¯¹è±¡åŠå‚æ•°è°ƒç”¨è¯¥å¯¹è±¡å¯¹åº”çš„æ–¹æ³•</td>
</tr>
</tbody></table>
<h4 id="Constructor"><a href="#Constructor" class="headerlink" title="Constructor"></a>Constructor</h4><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td>newInstance(Objectâ€¦ initargs)</td>
<td>æ ¹æ®ä¼ é€’çš„å‚æ•°åˆ›å»ºç±»çš„å¯¹è±¡</td>
</tr>
</tbody></table>
<h3 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><ul>
<li>å®ä½“ç±» <code>Book.java</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Bookå®ä½“ç±»</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Rao Hui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-11-26 09:39</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String TAG = <span class="string">"BookTag"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Book&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", author='"</span> + author + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">(String name, String author)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.author = author;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAuthor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> author;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAuthor</span><span class="params">(String author)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.author = author;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">declareMethod</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">        String string = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">switch</span> (index)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                string = <span class="string">"I am declaredMethod 1 !"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                string = <span class="string">"I am declaredMethod 2 !"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                string = <span class="string">"I am declaredMethod 1 !"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>åå°„ç±» <code>ReflectBook.java</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Bookå®ä½“ç±»åå°„æµ‹è¯•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Rao Hui</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-11-26 09:44</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectBook</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åå°„åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">            reflectNewInstance();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åå°„ç§æœ‰æ„é€ æ–¹æ³•</span></span><br><span class="line">            reflectPrivateConstrcutor();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åå°„ç§æœ‰æ–¹æ³•</span></span><br><span class="line">            reflectPrivateMethod();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åå°„ç§æœ‰å±æ€§</span></span><br><span class="line">            reflectPrivateField();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åå°„åˆ›å»ºå¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">reflectNewInstance</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Class&lt;?&gt; classBook = Class.forName(<span class="string">"Book"</span>);</span><br><span class="line">        Object objectBook = classBook.newInstance();</span><br><span class="line">        Book book = (Book)objectBook;</span><br><span class="line">        book.setName(<span class="string">"SREè¿ç»´è§£å¯†"</span>);</span><br><span class="line">        book.setAuthor(<span class="string">"Google"</span>);</span><br><span class="line">        System.out.println(book.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åå°„ç§æœ‰æ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">reflectPrivateConstrcutor</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Class&lt;?&gt; classBook = Class.forName(<span class="string">"Book"</span>);</span><br><span class="line">        Constructor&lt;?&gt; declaredConstructorBook = classBook.getDeclaredConstructor(String.class,String.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å–æ¶ˆæƒé™æ§åˆ¶æ£€æŸ¥</span></span><br><span class="line">        declaredConstructorBook.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Book book = (Book)declaredConstructorBook.newInstance(<span class="string">"é«˜æ€§èƒ½ MySQL"</span>, <span class="string">"hui"</span>);</span><br><span class="line">        System.out.println(book.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åå°„ç§æœ‰æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">reflectPrivateMethod</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Class&lt;?&gt; classBook = Class.forName(<span class="string">"Book"</span>);</span><br><span class="line">        Method method = classBook.getDeclaredMethod(<span class="string">"declareMethod"</span>, <span class="keyword">int</span>.class);</span><br><span class="line">        method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¼ é€’objectå¯¹è±¡åŠå‚æ•°è°ƒç”¨è¯¥å¯¹è±¡å¯¹åº”çš„æ–¹æ³•</span></span><br><span class="line">        String string = (String)method.invoke(classBook.newInstance(), <span class="number">0</span>);</span><br><span class="line">        System.out.println(string);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åå°„ç§æœ‰å±æ€§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">reflectPrivateField</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Class&lt;?&gt; classBook = Class.forName(<span class="string">"Book"</span>);</span><br><span class="line">        Object objectBook = classBook.newInstance();</span><br><span class="line">        Field fieldTag = classBook.getDeclaredField(<span class="string">"TAG"</span>);</span><br><span class="line">        fieldTag.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        String tag = (String) fieldTag.get(objectBook);</span><br><span class="line">        System.out.println(tag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Java</category>
      </categories>
  </entry>
  <entry>
    <title>æƒé™ç”³è¯·</title>
    <url>/blog/2019/11/19/permission/</url>
    <content><![CDATA[<h2 id="æœåŠ¡å™¨"><a href="#æœåŠ¡å™¨" class="headerlink" title="æœåŠ¡å™¨"></a>æœåŠ¡å™¨</h2><ul>
<li><p>æƒ æ™®å³éœ€å³ä¾›ï¼š<a href="mailto:dts_jxjg@dxc.com" target="_blank" rel="noopener">dts_jxjg@dxc.com</a>ï¼ŒDXC çƒ­çº¿ï¼š68066686</p>
</li>
<li><p>ä¸œè½¯å¤§æ•°æ®å³éœ€å³ä¾›ï¼š<a href="mailto:dts.dsj@neusoft.com" target="_blank" rel="noopener">dts.dsj@neusoft.com</a>ï¼ŒDSJ çƒ­çº¿ï¼š15318710660</p>
</li>
<li><p>ç”³è¯·ç›®æ ‡æœåŠ¡å™¨ï¼š10.163.192.0/19ï¼Œç«¯å£ï¼š3306</p>
</li>
</ul>
<h2 id="ç‰¹æƒè´¦å·"><a href="#ç‰¹æƒè´¦å·" class="headerlink" title="ç‰¹æƒè´¦å·"></a>ç‰¹æƒè´¦å·</h2><p>æ—å…†ç£Š 01460160ï¼Œå¼ åŠ å½¬ a0021120</p>
<h2 id="ç›‘æ§"><a href="#ç›‘æ§" class="headerlink" title="ç›‘æ§"></a>ç›‘æ§</h2><p>æé”¦æ¶› 18002036</p>
]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
  </entry>
  <entry>
    <title>Java Â· åŸºæœ¬ç¨‹åºè®¾è®¡</title>
    <url>/blog/2019/11/18/java-basic-programming-structure/</url>
    <content><![CDATA[<h2 id="å‘½å"><a href="#å‘½å" class="headerlink" title="å‘½å"></a>å‘½å</h2><ul>
<li><p><strong>åŒ…å</strong>ï¼šç»Ÿä¸€ä½¿ç”¨å°å†™ï¼Œç‚¹åˆ†éš”ç¬¦ä¹‹é—´æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªè‡ªç„¶è¯­ä¹‰çš„è‹±è¯­å•è¯ã€‚åŒ…åç»Ÿä¸€ä½¿ç”¨å•æ•°å½¢å¼ï¼Œä½†æ˜¯ç±»åå¦‚æœæœ‰å¤æ•°å«ä¹‰ï¼Œç±»åå¯ä»¥ä½¿ç”¨å¤æ•°å½¢å¼ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">æ­£ä¾‹ï¼šåº”ç”¨å·¥å…·ç±»åŒ…åä¸º com.alibaba.ai.utilã€ç±»åä¸º MessageUtils</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ç±»å</strong>ï¼šä½¿ç”¨ <code>UpperCamelCase</code> é£æ ¼ï¼Œä½†ä»¥ä¸‹æƒ…å½¢ä¾‹å¤–ï¼š<code>DO / BO / DTO / VO / AO / PO / UID</code> ç­‰ã€‚</p>
<ul>
<li><em>æŠ½è±¡ç±»å</em>ï¼šä½¿ç”¨ <code>Abstract</code> æˆ– <code>Base</code> å¼€å¤´ã€‚</li>
<li><em>å¼‚å¸¸ç±»å</em>ï¼šä½¿ç”¨ <code>Exception</code> ç»“å°¾ã€‚</li>
<li><em>æµ‹è¯•ç±»å</em>ï¼šä»¥å®ƒè¦æµ‹è¯•çš„ç±»çš„åç§°å¼€å§‹ï¼Œä»¥ <code>Test</code> ç»“å°¾ã€‚</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">æ­£ä¾‹ï¼šJavaServerlessPlatform / UserDO / XmlService / TcpUdpDeal / TaPromotion </span><br><span class="line">åä¾‹ï¼šjavaserverlessplatform / UserDo / XMLService / TCPUDPDeal / TAPromotion</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æ–¹æ³•åã€å‚æ•°åã€æˆå‘˜å˜é‡ã€å±€éƒ¨å˜é‡</strong>ï¼šéƒ½ç»Ÿä¸€ä½¿ç”¨ <code>lowerCamelCase</code> é£æ ¼ï¼Œå¿…é¡»éµä»é©¼å³°å½¢å¼ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">æ­£ä¾‹ï¼šlocalValue / getHttpMessage() / inputUserId</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å¸¸é‡å</strong>ï¼šå…¨éƒ¨å¤§å†™ï¼Œå•è¯é—´ç”¨ä¸‹åˆ’çº¿éš”å¼€ï¼ŒåŠ›æ±‚è¯­ä¹‰è¡¨è¾¾å®Œæ•´æ¸…æ¥šï¼Œä¸è¦å«Œåå­—é•¿ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">æ­£ä¾‹ï¼šMAX_STOCK_COUNT / CACHE_EXPIRED_TIME </span><br><span class="line">åä¾‹ï¼šMAX_COUNT / EXPIRED_TIME</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å„å±‚å‘½åè§„èŒƒ</strong></p>
<ul>
<li><code>Service/DAO</code> å±‚æ–¹æ³•å‘½å<ul>
<li>è·å–å•ä¸ªå¯¹è±¡çš„æ–¹æ³•ç”¨ <code>get</code> åšå‰ç¼€</li>
<li>è·å–å¤šä¸ªå¯¹è±¡çš„æ–¹æ³•ç”¨ <code>list</code> åšå‰ç¼€ï¼Œå¤æ•°å½¢å¼ç»“å°¾å¦‚ï¼š<code>listObjects</code></li>
<li>è·å–ç»Ÿè®¡å€¼çš„æ–¹æ³•ç”¨ <code>count</code> åšå‰ç¼€</li>
<li>æ’å…¥çš„æ–¹æ³•ç”¨ <code>save/insert</code> åšå‰ç¼€</li>
<li>åˆ é™¤çš„æ–¹æ³•ç”¨ <code>remove/delete</code> åšå‰ç¼€</li>
<li>ä¿®æ”¹çš„æ–¹æ³•ç”¨ <code>update</code> åšå‰ç¼€</li>
</ul>
</li>
<li>é¢†åŸŸæ¨¡å‹å‘½å<ul>
<li>æ•°æ®å¯¹è±¡ï¼š<code>xxxDO</code>ï¼Œxxx å³ä¸ºæ•°æ®è¡¨å</li>
<li>æ•°æ®ä¼ è¾“å¯¹è±¡ï¼š<code>xxxDTO</code>ï¼Œxxx ä¸ºä¸šåŠ¡é¢†åŸŸç›¸å…³çš„åç§°</li>
<li>å±•ç¤ºå¯¹è±¡ï¼š<code>xxxVO</code>ï¼Œxxx ä¸€èˆ¬ä¸ºç½‘é¡µåç§°</li>
<li><code>POJO</code> æ˜¯ <code>DO/DTO/BO/VO</code> çš„ç»Ÿç§°ï¼Œç¦æ­¢å‘½åæˆ <code>xxxPOJO</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><h3 id="æ³¨é‡Šç±»å‹"><a href="#æ³¨é‡Šç±»å‹" class="headerlink" title="æ³¨é‡Šç±»å‹"></a>æ³¨é‡Šç±»å‹</h3><ul>
<li>å•è¡Œæ³¨é‡Šï¼š<code>//</code></li>
<li>å¤šè¡Œæ³¨é‡Šï¼š<code>/*..*/</code></li>
<li>æ–‡æ¡£æ³¨é‡Šï¼š<code>/**..*/</code></li>
</ul>
<h3 id="æ³¨é‡Šè§„èŒƒ"><a href="#æ³¨é‡Šè§„èŒƒ" class="headerlink" title="æ³¨é‡Šè§„èŒƒ"></a>æ³¨é‡Šè§„èŒƒ</h3><ul>
<li>ç±»ã€ç±»å±æ€§ã€ç±»æ–¹æ³•çš„æ³¨é‡Šå¿…é¡»ä½¿ç”¨ <code>Javadoc</code> è§„èŒƒï¼Œä½¿ç”¨ <code>/**..*/</code> æ ¼å¼ã€‚</li>
<li>æŠ½è±¡æ–¹æ³•å¿…é¡»è¦ç”¨ <code>Javadoc</code> æ³¨é‡Šã€é™¤äº†è¿”å›å€¼ã€å‚æ•°ã€ å¼‚å¸¸è¯´æ˜å¤–ï¼Œè¿˜å¿…é¡»æŒ‡å‡ºè¯¥æ–¹æ³•å®ç°çš„åŠŸèƒ½ã€‚</li>
<li>æ‰€æœ‰çš„ç±»éƒ½å¿…é¡»æ·»åŠ åˆ›å»ºè€…å’Œåˆ›å»ºæ—¥æœŸã€‚</li>
<li>æ–¹æ³•å†…éƒ¨å•è¡Œæ³¨é‡Šã€‚</li>
<li>æ‰€æœ‰çš„æšä¸¾ç±»å‹å­—æ®µå¿…é¡»è¦æœ‰æ³¨é‡Šï¼Œè¯´æ˜æ¯ä¸ªæ•°æ®é¡¹çš„ç”¨é€”ã€‚</li>
</ul>
<h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><p>Java ä¸­ï¼Œä¸€å…±æœ‰ 8 ç§åŸºæœ¬ç±»å‹ï¼Œå…¶ä¸­æœ‰ 4 ç§æ•´å‹ã€2 ç§æµ®ç‚¹ç±»å‹ã€1 ç§å­—ç¬¦ç±»å‹ã€1 ç§å¸ƒå°”ç±»å‹ã€‚</p>
<h3 id="æ•´å‹"><a href="#æ•´å‹" class="headerlink" title="æ•´å‹"></a>æ•´å‹</h3><table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>å­˜å‚¨</th>
<th>å–å€¼èŒƒå›´</th>
</tr>
</thead>
<tbody><tr>
<td><strong>int</strong></td>
<td>4 å­—èŠ‚</td>
<td>-2147483648 ï½ 2147483647ï¼ˆçº¦20äº¿ï¼‰</td>
</tr>
<tr>
<td>short</td>
<td>2 å­—èŠ‚</td>
<td>-32768 ï½ 32767</td>
</tr>
<tr>
<td>long</td>
<td>8 å­—èŠ‚</td>
<td>-9223372036854775808 ï½ 9223372036854775807</td>
</tr>
<tr>
<td>byte</td>
<td>1 å­—èŠ‚</td>
<td>-128 ï½ 127</td>
</tr>
</tbody></table>
<blockquote>
<p>æé†’ï¼šJava æ²¡æœ‰ä»»ä½•æ— ç¬¦å·ç±»å‹ï¼ˆunsignedï¼‰ï¼Œä¸”æ•´å‹çš„èŒƒå›´ä¸è¿è¡Œ Java ä»£ç çš„æœºå™¨æ— å…³ã€‚</p>
</blockquote>
<h3 id="æµ®ç‚¹å‹"><a href="#æµ®ç‚¹å‹" class="headerlink" title="æµ®ç‚¹å‹"></a>æµ®ç‚¹å‹</h3><table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>å­˜å‚¨</th>
<th>å–å€¼èŒƒå›´</th>
</tr>
</thead>
<tbody><tr>
<td>float</td>
<td>4 å­—èŠ‚</td>
<td>æœ‰æ•ˆä½æ•° 6ï½7 ä½</td>
</tr>
<tr>
<td><strong>double</strong></td>
<td>8 å­—èŠ‚</td>
<td>æœ‰æ•ˆä½æ•° 15 ä½</td>
</tr>
</tbody></table>
<blockquote>
<p>è­¦å‘Šï¼šæµ®ç‚¹æ•°å€¼ä¸é€‚ç”¨äºç¦æ­¢å‡ºç°èˆå…¥è¯¯å·®çš„é‡‘èè®¡ç®—ä¸­ã€‚</p>
</blockquote>
<h3 id="char"><a href="#char" class="headerlink" title="char"></a>char</h3><p>char ç±»å‹ç”¨äºè¡¨ç¤ºå•ä¸ªå­—ç¬¦ï¼Œæ˜¯ä¸€ä¸ªå•ä¸€çš„ 16 ä½ Unicode å­—ç¬¦ï¼Œæœ€å°å€¼æ˜¯ <code>\u0000</code>ï¼ˆå³ä¸º 0ï¼‰ï¼Œæœ€å¤§å€¼æ˜¯ <code>\uffff</code>ï¼ˆå³ä¸º 65,535ï¼‰ï¼Œå»ºè®®ä¸è¦åœ¨ç¨‹åºä¸­ä½¿ç”¨ char ç±»å‹ã€‚</p>
<h3 id="boolean"><a href="#boolean" class="headerlink" title="boolean"></a>boolean</h3><p>å¸ƒå°”ç±»å‹æœ‰ä¸¤ä¸ªå€¼ï¼šfalse å’Œ trueï¼Œç”¨äºåˆ¤å®šé€»è¾‘æ¡ä»¶ï¼Œæ•´å‹å€¼å’Œå¸ƒå°”å€¼ä¹‹é—´ä¸èƒ½è¿›è¡Œç›¸äº’è½¬æ¢ã€‚</p>
<h2 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h2><p>åœ¨ Java ä¸­ï¼Œæ¯ä¸€ä¸ªå˜é‡å±äºä¸€ç§ç±»å‹ï¼ˆTypeï¼‰ï¼Œåœ¨å£°æ˜å˜é‡æ—¶ï¼Œå˜é‡æ‰€å±çš„ç±»å‹ä½äºå˜é‡åä¹‹å‰ï¼Œå£°æ˜å˜é‡ä¹‹åï¼Œå¿…é¡»ç”¨èµ‹å€¼è¯­å¥å¯¹å˜é‡è¿›è¡Œæ˜¾å¼åˆå§‹åŒ–ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">double</span> salary = <span class="number">6500.0</span>;</span><br><span class="line"><span class="keyword">int</span> vacationDays = <span class="number">12</span>;</span><br><span class="line"><span class="keyword">long</span> earthPopulation = xx;</span><br><span class="line"><span class="keyword">boolean</span> done = <span class="keyword">false</span>;</span><br><span class="line">Box box = <span class="keyword">new</span> Box();</span><br></pre></td></tr></table></figure>

<h2 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h2><p>åœ¨ Java ä¸­ï¼Œåˆ©ç”¨å…³é”®å­— final æŒ‡ç¤ºå¸¸é‡ï¼Œfinal è¡¨ç¤ºè¿™ä¸ªå˜é‡åªèƒ½è¢«èµ‹å€¼ä¸€æ¬¡ï¼Œä¸€æ—¦èµ‹å€¼åå°±ä¸èƒ½æ”¹å†ä¿®æ”¹äº†ï¼Œä¹ æƒ¯ä¸Šå¸¸é‡åä½¿ç”¨å…¨å¤§å†™ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">double</span> CM_PER_INCH = <span class="number">2.54</span>;</span><br></pre></td></tr></table></figure>

<h2 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h2><table>
<thead>
<tr>
<th align="center"><strong>ä¼˜å…ˆçº§</strong></th>
<th align="center"><strong>è¿ç®—ç¬¦</strong></th>
<th align="center"><strong>ç®€ä»‹</strong></th>
<th align="center"><strong>ç»“åˆæ€§</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center"><code>[ ]</code>ã€<code>.</code>ã€<code>( )</code></td>
<td align="center">æ–¹æ³•è°ƒç”¨ï¼Œå±æ€§è·å–</td>
<td align="center">ä»å·¦å‘å³</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">!ã€~ã€ ++ã€ â€“</td>
<td align="center">ä¸€å…ƒè¿ç®—ç¬¦</td>
<td align="center">ä»å³å‘å·¦</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">* ã€/ ã€%</td>
<td align="center">ä¹˜ã€é™¤ã€å–æ¨¡ï¼ˆä½™æ•°ï¼‰</td>
<td align="center">ä»å·¦å‘å³</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">+ ã€ -</td>
<td align="center">åŠ å‡æ³•</td>
<td align="center">ä»å·¦å‘å³</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">&lt;&lt;ã€ &gt;&gt;ã€ &gt;&gt;&gt;</td>
<td align="center">å·¦å³ä½ç§»</td>
<td align="center">ä»å·¦å‘å³</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">&lt; ã€&lt;= ã€&gt;ã€ &gt;=ã€ instanceof</td>
<td align="center">å¯¹è±¡æ˜¯å¦å±äºåŒç±»å‹</td>
<td align="center">ä»å·¦å‘å³</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">== ã€!=</td>
<td align="center">æ˜¯å¦ç›¸ç­‰</td>
<td align="center">ä»å·¦å‘å³</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">&amp;</td>
<td align="center">æŒ‰ä½ä¸</td>
<td align="center">ä»å·¦å‘å³</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">^</td>
<td align="center">æŒ‰ä½å¼‚æˆ–</td>
<td align="center">ä»å·¦å‘å³</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">|</td>
<td align="center">æŒ‰ä½æˆ–</td>
<td align="center">ä»å·¦å‘å³</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">&amp;&amp;</td>
<td align="center">çŸ­è·¯ä¸</td>
<td align="center">ä»å·¦å‘å³</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">||</td>
<td align="center">çŸ­è·¯æˆ–</td>
<td align="center">ä»å·¦å‘å³</td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">?:</td>
<td align="center">ä¸‰å…ƒè¿ç®—ç¬¦</td>
<td align="center">ä»å³å‘å·¦</td>
</tr>
<tr>
<td align="center">14</td>
<td align="center">=ã€ += ã€-= ã€*= ã€/=ã€ %=ã€ &amp;=ã€ |=ã€ ^=ã€ &lt;ã€&lt;= ã€&gt;ã€&gt;= ã€&gt;&gt;=</td>
<td align="center">æ··åˆèµ‹å€¼è¿ç®—ç¬¦</td>
<td align="center">ä»å³å‘å·¦</td>
</tr>
</tbody></table>
<blockquote>
<p>æé†’ï¼š&amp;&amp; å’Œ || æ˜¯æŒ‰ç…§â€œçŸ­è·¯â€æ–¹å¼æ±‚å€¼ï¼Œå¦‚æœç¬¬ä¸€ä¸ªæ“ä½œæ•°å·²ç»èƒ½å¤Ÿç¡®å®šè¡¨è¾¾å¼çš„å€¼ï¼Œç¬¬äºŒä¸ªæ“ä½œæ•°å°±ä¸å¿…è¦è®¡ç®—äº†ã€‚&amp; å’Œ | è¿™ä¸¤ä¸ªè¿ç®—ç¬¦ä¸å‰é¢éå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯ä¸æŒ‰â€œçŸ­è·¯â€æ–¹å¼è®¡ç®—ï¼Œå³åœ¨å¾—åˆ°è®¡ç®—ç»“æœä¹‹å‰ï¼Œä¸€å®šè¦è®¡ç®—ä¸¤ä¸ªæ“ä½œæ•°çš„å€¼ã€‚</p>
</blockquote>
<h2 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h2><p>ä»æ¦‚å¿µä¸Šè®²ï¼ŒJava å­—ç¬¦ä¸²å°±æ˜¯ Unicode å­—ç¬¦åºåˆ—ã€‚Java æ²¡æœ‰å†…ç½®çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œè€Œæ˜¯åœ¨æ ‡å‡† Java ç±»åº“ä¸­æä¾›äº†ä¸€ä¸ªé¢„å®šä¹‰ç±»ï¼Œå«åš Stringã€‚Java æœ‰è‡ªåŠ¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå¦‚æœä¸€å—å†…å­˜ä¸å†ä½¿ç”¨äº†ï¼Œç³»ç»Ÿæœ€ç»ˆä¼šå°†å…¶å›æ”¶ã€‚</p>
<ul>
<li><p><strong>æ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰</strong>ï¼šä½¿ç”¨ <code>equals</code> æ–¹æ³•ï¼Œä¸åŒºåˆ†å¤§å°å†™ä½¿ç”¨ <code>equalsIgnoreCase</code> æ–¹æ³•ï¼Œä¸è¦ä½¿ç”¨ <code>==</code> è¿ç®—ç¬¦ã€‚</p>
</li>
<li><p><strong>ç©ºä¸²</strong>ï¼šç©ºä¸² â€œâ€ æ˜¯é•¿åº¦ä¸º 0 çš„å­—ç¬¦ä¸²ï¼Œç”¨ä»¥ä¸‹æ–¹å¼å¯ä»¥æ£€æŸ¥æ˜¯å¦ä¸ºç©ºã€‚</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (str.length() == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> (str.equals(<span class="string">""</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Null ä¸²</strong>ï¼šè¡¨ç¤ºç›®å‰æ²¡æœ‰ä»»ä½•å¯¹è±¡ä¸è¯¥å˜é‡å…³è”ï¼Œæ£€æŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²æ—¢ä¸æ˜¯ null ä¹Ÿä¸ä¸ºç©ºä¸²ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (str != <span class="keyword">null</span> &amp;&amp; str.length() != <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>å­—ç¬¦ä¸² <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html" target="_blank" rel="noopener">API</a></strong>ï¼š<code>java.lang.string</code></li>
</ul>
<h2 id="è¾“å…¥è¾“å‡º"><a href="#è¾“å…¥è¾“å‡º" class="headerlink" title="è¾“å…¥è¾“å‡º"></a>è¾“å…¥è¾“å‡º</h2><p><strong>è¯»å–è¾“å…¥</strong>ï¼šä½¿ç”¨ <code>java.util.Scanner</code> ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This program demonstrates console input.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> v1.0 2019-11-20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Rao Hui</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Scanner in = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// get frist input</span></span><br><span class="line">        System.out.print(<span class="string">"What is your name? "</span>);</span><br><span class="line">        String name = in.nextLine();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// get second input</span></span><br><span class="line">        System.out.print(<span class="string">"How old are you? "</span>);</span><br><span class="line">        <span class="keyword">int</span> age = in.nextInt();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// dispaly output on console</span></span><br><span class="line">        System.out.println(<span class="string">"Hello, "</span> + name + <span class="string">". Next year, you'll be "</span> + (age + <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ ¼å¼åŒ–è¾“å‡º</strong>ï¼šä½¿ç”¨ <code>System.out.printf()</code></p>
<ul>
<li>dï¼šæ•´æ•°ç±»å‹</li>
<li>cï¼šUnicode å­—ç¬¦</li>
<li>bï¼šBoolean å€¼</li>
<li>sï¼šString</li>
<li>fï¼šæµ®ç‚¹æ•°ï¼ˆåè¿›åˆ¶ï¼‰</li>
<li>eï¼šæµ®ç‚¹æ•°ï¼ˆç§‘å­¦è®¡æ•°ï¼‰</li>
<li>xï¼šæ•´æ•°</li>
<li>hï¼šæ•£åˆ—ç ï¼ˆåå…­è¿›åˆ¶ï¼‰</li>
<li>%ï¼šå­—ç¬¦ â€œ%â€</li>
</ul>
<h2 id="æ§åˆ¶æµ"><a href="#æ§åˆ¶æµ" class="headerlink" title="æ§åˆ¶æµ"></a>æ§åˆ¶æµ</h2><ul>
<li><strong>æ¡ä»¶è¯­å¥</strong>ï¼šif (condition) statement</li>
<li><strong>å¾ªç¯</strong>ï¼šwhile (condition) statementã€do statement while (condition)ã€for (int i = 1;  i &lt;= n;  i++)</li>
<li><strong>å¤šé‡é€‰æ‹©</strong>ï¼šswitchâ€¦caseâ€¦</li>
<li><strong>ä¸­æ–­æ§åˆ¶</strong>ï¼šbreakï¼ˆè·³å‡ºå¾ªç¯ï¼‰ã€continueï¼ˆè·³è½¬åˆ°ä¸‹ä¸€æ¬¡å¾ªç¯ï¼‰</li>
</ul>
<h2 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h2><p>æ•°ç»„æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œç”¨æ¥å­˜å‚¨åŒä¸€ç±»å‹å€¼çš„é›†åˆã€‚ç”¨äºæ•°ç»„çš„å¢å¼º for å¾ªç¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">      <span class="keyword">int</span>[] numbers = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>&#125;;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> x : numbers )&#123;</span><br><span class="line">         System.out.print( x );</span><br><span class="line">         System.out.print(<span class="string">","</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.print(<span class="string">"\n"</span>);</span><br><span class="line">      String[] names =&#123;<span class="string">"James"</span>, <span class="string">"Larry"</span>, <span class="string">"Tom"</span>, <span class="string">"Lacy"</span>&#125;;</span><br><span class="line">      <span class="keyword">for</span>( String name : names ) &#123;</span><br><span class="line">         System.out.print( name );</span><br><span class="line">         System.out.print(<span class="string">","</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å…³é”®å­—"><a href="#å…³é”®å­—" class="headerlink" title="å…³é”®å­—"></a>å…³é”®å­—</h2><table>
<thead>
<tr>
<th>ç±»åˆ«</th>
<th>å…³é”®å­—</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>è®¿é—®æ§åˆ¶</td>
<td>private</td>
<td>ç§æœ‰çš„</td>
</tr>
<tr>
<td></td>
<td>protected</td>
<td>å—ä¿æŠ¤çš„</td>
</tr>
<tr>
<td></td>
<td>public</td>
<td>å…¬å…±çš„</td>
</tr>
<tr>
<td>ç±»ã€æ–¹æ³•å’Œå˜é‡ä¿®é¥°ç¬¦</td>
<td>abstract</td>
<td>å£°æ˜æŠ½è±¡</td>
</tr>
<tr>
<td></td>
<td>class</td>
<td>ç±»</td>
</tr>
<tr>
<td></td>
<td>extends</td>
<td>ç»§æ‰¿</td>
</tr>
<tr>
<td></td>
<td>final</td>
<td>ä¸å¯æ”¹å˜çš„</td>
</tr>
<tr>
<td></td>
<td>implements</td>
<td>å®ç°ï¼ˆæ¥å£ï¼‰</td>
</tr>
<tr>
<td></td>
<td>interface</td>
<td>æ¥å£</td>
</tr>
<tr>
<td></td>
<td>native</td>
<td>æœ¬åœ°</td>
</tr>
<tr>
<td></td>
<td>new</td>
<td>åˆ›å»º</td>
</tr>
<tr>
<td></td>
<td>static</td>
<td>é™æ€</td>
</tr>
<tr>
<td></td>
<td>strictfp</td>
<td>ä¸¥æ ¼</td>
</tr>
<tr>
<td></td>
<td>synchronized</td>
<td>çº¿ç¨‹åŒæ­¥</td>
</tr>
<tr>
<td></td>
<td>transient</td>
<td>çŸ­æš‚</td>
</tr>
<tr>
<td></td>
<td>volatile</td>
<td>æ˜“å¤±</td>
</tr>
<tr>
<td>ç¨‹åºæ§åˆ¶</td>
<td>break</td>
<td>è·³å‡ºå¾ªç¯</td>
</tr>
<tr>
<td></td>
<td>continue</td>
<td>ç»§ç»­</td>
</tr>
<tr>
<td></td>
<td>switch</td>
<td>æ ¹æ®å€¼é€‰æ‹©æ‰§è¡Œ</td>
</tr>
<tr>
<td></td>
<td>case</td>
<td>å®šä¹‰ä¸€ä¸ªå€¼ä»¥ä¾› switch é€‰æ‹©</td>
</tr>
<tr>
<td></td>
<td>default</td>
<td>é»˜è®¤</td>
</tr>
<tr>
<td></td>
<td>do</td>
<td>è¿è¡Œ</td>
</tr>
<tr>
<td></td>
<td>if</td>
<td>å¦‚æœ</td>
</tr>
<tr>
<td></td>
<td>else</td>
<td>å¦åˆ™</td>
</tr>
<tr>
<td></td>
<td>for</td>
<td>å¾ªç¯</td>
</tr>
<tr>
<td></td>
<td>instanceof</td>
<td>å®ä¾‹</td>
</tr>
<tr>
<td></td>
<td>return</td>
<td>è¿”å›</td>
</tr>
<tr>
<td></td>
<td>while</td>
<td>å¾ªç¯</td>
</tr>
<tr>
<td>é”™è¯¯å¤„ç†</td>
<td>assert</td>
<td>æ–­è¨€è¡¨è¾¾å¼æ˜¯å¦ä¸ºçœŸ</td>
</tr>
<tr>
<td></td>
<td>catch</td>
<td>æ•æ‰å¼‚å¸¸</td>
</tr>
<tr>
<td></td>
<td>finally</td>
<td>æœ‰æ²¡æœ‰å¼‚å¸¸éƒ½æ‰§è¡Œ</td>
</tr>
<tr>
<td></td>
<td>throw</td>
<td>æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸å¯¹è±¡</td>
</tr>
<tr>
<td></td>
<td>throws</td>
<td>å£°æ˜ä¸€ä¸ªå¼‚å¸¸å¯èƒ½è¢«æŠ›å‡º</td>
</tr>
<tr>
<td></td>
<td>try</td>
<td>æ•è·å¼‚å¸¸</td>
</tr>
<tr>
<td>åŒ…</td>
<td>import</td>
<td>å¼•å…¥</td>
</tr>
<tr>
<td></td>
<td>package</td>
<td>åŒ…</td>
</tr>
<tr>
<td>æ•°æ®åŸºæœ¬ç±»å‹</td>
<td>byte</td>
<td>å­—èŠ‚å‹</td>
</tr>
<tr>
<td></td>
<td>short</td>
<td>çŸ­æ•´å‹</td>
</tr>
<tr>
<td></td>
<td>int</td>
<td>æ•´å‹</td>
</tr>
<tr>
<td></td>
<td>long</td>
<td>é•¿æ•´å‹</td>
</tr>
<tr>
<td></td>
<td>float</td>
<td>å•ç²¾åº¦æµ®ç‚¹</td>
</tr>
<tr>
<td></td>
<td>double</td>
<td>åŒç²¾åº¦æµ®ç‚¹</td>
</tr>
<tr>
<td></td>
<td>char</td>
<td>å­—ç¬¦å‹</td>
</tr>
<tr>
<td></td>
<td>boolean</td>
<td>å¸ƒå°”å‹</td>
</tr>
<tr>
<td>å˜é‡åº”ç”¨</td>
<td>super</td>
<td>è¶…ç±»</td>
</tr>
<tr>
<td></td>
<td>this</td>
<td>æœ¬ç±»</td>
</tr>
<tr>
<td></td>
<td>void</td>
<td>æ— è¿”å›å€¼</td>
</tr>
<tr>
<td>ä¿ç•™å…³é”®å­—</td>
<td>goto</td>
<td>æ˜¯å…³é”®å­—ï¼Œä½†ä¸èƒ½ä½¿ç”¨</td>
</tr>
<tr>
<td></td>
<td>const</td>
<td>æ˜¯å…³é”®å­—ï¼Œä½†ä¸èƒ½ä½¿ç”¨</td>
</tr>
<tr>
<td></td>
<td>null</td>
<td>ç©º</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
  </entry>
  <entry>
    <title>Java Â· å¼€å‘ç¯å¢ƒ</title>
    <url>/blog/2019/11/18/java-ide/</url>
    <content><![CDATA[<h2 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h2><ul>
<li><a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener">Java JDK</a></li>
<li><a href="http://www.jetbrains.com/" target="_blank" rel="noopener">IntelliJ IDEA</a></li>
</ul>
<h2 id="æ­å»ºæ­¥éª¤"><a href="#æ­å»ºæ­¥éª¤" class="headerlink" title="æ­å»ºæ­¥éª¤"></a>æ­å»ºæ­¥éª¤</h2><ul>
<li>å®‰è£…</li>
<li>é…ç½®ç¯å¢ƒå˜é‡</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/profile</span></span><br><span class="line"></span><br><span class="line">JAVA_HOME=<span class="string">"/Library/Java/JavaVirtualMachines/jdk-13.0.1.jdk/Contents/Home"</span></span><br><span class="line">export JAVA_HOME</span><br><span class="line">PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH:</span>.</span><br><span class="line">CLASS_PATH=<span class="string">"<span class="variable">$JAVA_HOME</span>/lib"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># source /etc/profile</span></span><br><span class="line"></span><br><span class="line">âœ  ~ java -version</span><br><span class="line">java version <span class="string">"13.0.1"</span> <span class="number">2019</span>-<span class="number">10</span>-<span class="number">15</span></span><br><span class="line">Java(TM) SE Runtime Environment (build <span class="number">13.0</span>.<span class="number">1</span>+<span class="number">9</span>)</span><br><span class="line">Java HotSpot(TM) <span class="number">64</span>-Bit Server VM (build <span class="number">13.0</span>.<span class="number">1</span>+<span class="number">9</span>, mixed mode, sharing)</span><br><span class="line"></span><br><span class="line">~ root<span class="comment"># echo $PATH</span></span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk-<span class="number">13.0</span>.<span class="number">1</span>.jdk/Contents/Home/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:.</span><br><span class="line">~ root<span class="comment"># echo $JAVA_HOME</span></span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk-<span class="number">13.0</span>.<span class="number">1</span>.jdk/Contents/Home</span><br><span class="line">~ root<span class="comment"># echo $CLASS_PATH</span></span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk-<span class="number">13.0</span>.<span class="number">1</span>.jdk/Contents/Home/lib</span><br></pre></td></tr></table></figure>

<ul>
<li>é…ç½® IDEï¼ˆ<strong>File -&gt; Project Structure -&gt; SDKs -&gt; JDK home path</strong>ï¼‰</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hello World!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure>

<h2 id="Java-æœ¯è¯­"><a href="#Java-æœ¯è¯­" class="headerlink" title="Java æœ¯è¯­"></a>Java æœ¯è¯­</h2><table>
<thead>
<tr>
<th>æœ¯è¯­å</th>
<th>ç¼©å†™</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td>Java Development Kit</td>
<td>JDK</td>
<td>ç¼–å†™ Java ç¨‹åºçš„ç¨‹åºå‘˜ä½¿ç”¨çš„è½¯ä»¶ï¼ŒåŒ…å«ç¼–è¯‘å™¨</td>
</tr>
<tr>
<td>Java Runtime Environmen</td>
<td>JRE</td>
<td>è¿è¡Œ Java ç¨‹åºçš„ç”¨æˆ·ä½¿ç”¨çš„è½¯ä»¶ï¼ŒåŒ…å«è™šæ‹Ÿæœº</td>
</tr>
<tr>
<td>Standard Edition</td>
<td>SE</td>
<td>ç”¨äºæ¡Œé¢æˆ–ç®€å•æœåŠ¡å™¨åº”ç”¨çš„ Java å¹³å°</td>
</tr>
<tr>
<td>Enterprise Edition</td>
<td>EE</td>
<td>ç”¨äºå¤æ‚çš„æœåŠ¡å™¨åº”ç”¨çš„ Java å¹³å°</td>
</tr>
<tr>
<td>Micro Edition</td>
<td>ME</td>
<td>ç”¨äºæ‰‹æœºæˆ–å…¶ä»–å°å‹è®¾å¤‡çš„ Java å¹³å°</td>
</tr>
<tr>
<td>Data Access Object</td>
<td>DAO</td>
<td>æ•°æ®è®¿é—®å¯¹è±¡ï¼Œä¸»è¦æ˜¯å°†æ•°æ®åº“æ“ä½œéƒ½å°è£…èµ·æ¥ï¼Œå¯¹å¤–æä¾›æ¥å£</td>
</tr>
<tr>
<td>Data Transfer Object</td>
<td>DTO</td>
<td>æ³›æŒ‡ç”¨äºè¡¨ç¤ºå±‚ä¸æœåŠ¡å±‚ä¹‹é—´çš„æ•°æ®ä¼ è¾“å¯¹è±¡</td>
</tr>
</tbody></table>
<h2 id="Java-å‘½ä»¤è¡Œå·¥å…·"><a href="#Java-å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="Java å‘½ä»¤è¡Œå·¥å…·"></a>Java å‘½ä»¤è¡Œå·¥å…·</h2><table>
<thead>
<tr>
<th>å·¥å…·</th>
<th>è¯´æ˜</th>
<th>ä½¿ç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>javac</td>
<td>Java ç¼–è¯‘å™¨ï¼Œå°† .java ç¼–è¯‘æˆ .class å­—èŠ‚ç æ–‡ä»¶</td>
<td>javac HelloWorld.java</td>
</tr>
<tr>
<td>java</td>
<td>Java æ‰§è¡Œç¨‹åºçš„å‘½ä»¤ï¼Œæ‰§è¡Œ .class æ–‡ä»¶</td>
<td>java HelloWorld</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· è¿ç»´å®è·µ Â· å¤‡ä»½æ¢å¤</title>
    <url>/blog/2019/11/16/mysql-practice-recovery/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><ul>
<li><strong>é¡¹ç›®</strong>ï¼šæµ·å°”æ¨¡å—å•†èµ„æºå¹³å°ï¼ˆHDYï¼‰</li>
<li><strong>æ•°æ®åº“</strong>ï¼šMySQL 5.5.27</li>
<li><strong>æ•°æ®é‡</strong>ï¼š</li>
</ul>
<h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><ul>
<li>ç”³è¯·æœåŠ¡å™¨ - é¡¹ç›®ç»ç†</li>
<li>ç”³è¯·ç‰¹æƒè´¦å·ï¼ˆDBAã€DTS å¤‡ä»½ï¼‰- é¡¹ç›®ç»ç†</li>
<li>æ­å»ºæ•°æ®åº“ - DBA</li>
<li>å®‰è£…æ¢å¤è½¯ä»¶ï¼Œå¹¶è¿›è¡Œç›¸å…³å‚æ•°é…ç½® - DTS</li>
<li>å¯åŠ¨æ¢å¤</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ•°æ®æ¢å¤</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql   <span class="number">26</span>K Nov <span class="number">15</span> <span class="number">11</span>:<span class="number">36</span> mysql-bin.<span class="number">000001</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">919</span>K Nov <span class="number">15</span> <span class="number">11</span>:<span class="number">36</span> mysql-bin.<span class="number">000002</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql   <span class="number">126</span> Nov <span class="number">15</span> <span class="number">11</span>:<span class="number">38</span> mysql-bin.<span class="number">000003</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql   <span class="number">126</span> Nov <span class="number">15</span> <span class="number">11</span>:<span class="number">38</span> mysql-bin.<span class="number">000004</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql   <span class="number">126</span> Nov <span class="number">15</span> <span class="number">11</span>:<span class="number">39</span> mysql-bin.<span class="number">000005</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql   <span class="number">126</span> Nov <span class="number">15</span> <span class="number">11</span>:<span class="number">45</span> mysql-bin.<span class="number">000006</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql   <span class="number">126</span> Nov <span class="number">15</span> <span class="number">11</span>:<span class="number">46</span> mysql-bin.<span class="number">000007</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">1.1</span>G Nov <span class="number">15</span> <span class="number">16</span>:<span class="number">18</span> mysql-bin.<span class="number">000008</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">1.1</span>G Nov <span class="number">15</span> <span class="number">16</span>:<span class="number">21</span> mysql-bin.<span class="number">000009</span></span><br><span class="line">...</span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql <span class="number">1073790463</span> Nov <span class="number">16</span> <span class="number">08</span>:<span class="number">27</span> mysql-bin.<span class="number">000325</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">681747155</span> Nov <span class="number">16</span> <span class="number">08</span>:<span class="number">31</span> mysql-bin.<span class="number">000326</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql       <span class="number">6194</span> Nov <span class="number">16</span> <span class="number">08</span>:<span class="number">27</span> mysql-bin.index</span><br><span class="line"></span><br><span class="line"><span class="comment"># å›æ»šæ—¥å¿—</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>ä½ç©ºæ è¿‡ï¼Œç²¾ç¡®åˆ¶å¯¼</title>
    <url>/blog/2019/11/15/think-direction/</url>
    <content><![CDATA[<p><a href="https://baike.baidu.com/item/%E8%92%8B%E5%87%A1/21973556?fr=aladdin" target="_blank" rel="noopener">è’‹å‡¡ </a>è°ˆèŒåœºè¿›åŒ–å†ç¨‹ï¼Œæ€»ç»“çš„å…«å­—ç»éªŒï¼šä½ç©ºæ è¿‡ï¼Œç²¾ç¡®åˆ¶å¯¼</p>
<p><strong>ä½ç©ºæ è¿‡</strong>ï¼šå¯¹äºå’Œç›®æ ‡å…³è”ä¸å¤§ï¼Œå®¢è§‚ä¸Šå´å¿…é¡»åšçš„äº‹æƒ…ï¼Œä¸€å®šè¦ä»¥æœ€å°çš„ä»£ä»·å’Œç²¾åŠ›è€—è´¹é‡å®Œæˆï¼Œä¸éœ€è¦ä¼˜ç§€ã€‚</p>
<p><strong>ç²¾ç¡®åˆ¶å¯¼</strong>ï¼šå¯¹äºæ—¢å®šç›®æ ‡ï¼Œå°±è¦ç²¾ç¡®é”å®šï¼Œæ’é™¤å¹²æ‰°å…¨åŠ›ä»¥èµ´ï¼Œç›´åˆ°ç›®æ ‡è¾¾æˆã€‚æ¯”å¦‚ç¼–ç¨‹ï¼Œè¦é’»ç ”çš„å¾ˆæ·±ï¼Œè¿™æ˜¯æˆé•¿çš„æ•²é—¨ç –ï¼</p>
]]></content>
      <categories>
        <category>æ‚è°ˆ</category>
      </categories>
  </entry>
  <entry>
    <title>CentOS 6 ä¸ CentOS 7 å¯åœæœåŠ¡</title>
    <url>/blog/2019/11/15/liunx-service/</url>
    <content><![CDATA[<h2 id="CentOS-6"><a href="#CentOS-6" class="headerlink" title="CentOS 6"></a>CentOS 6</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®æœåŠ¡è‡ªå¯åŠ¨</span></span><br><span class="line">chkconfig --add mysqld          <span class="comment"># æ·»åŠ æœåŠ¡</span></span><br><span class="line">chkconfig mysqld on             <span class="comment"># å¼€æœºè‡ªå¯æœåŠ¡</span></span><br><span class="line">chkconfig mysqld off            <span class="comment"># å…³é—­å¼€æœºè‡ªå¯</span></span><br><span class="line">chkconfig --list | grep mysqld  <span class="comment"># æŸ¥çœ‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹çŠ¶æ€ã€å¯åŠ¨ã€åœæ­¢ã€é‡å¯</span></span><br><span class="line">service mysqld status/start/stop/restart</span><br></pre></td></tr></table></figure>

<h2 id="CentOS-7"><a href="#CentOS-7" class="headerlink" title="CentOS 7"></a>CentOS 7</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">systemctl enable mysqld.service  <span class="comment"># å¼€æœºè‡ªå¯æœåŠ¡</span></span><br><span class="line">systemctl disable mysqld.service <span class="comment"># å…³é—­å¼€æœºè‡ªå¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹çŠ¶æ€ã€å¯åŠ¨ã€åœæ­¢ã€é‡å¯</span></span><br><span class="line">systemctl status/start/stop/restart mysqld.service</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· å®æ—¶ä¼šè¯è§£æ</title>
    <url>/blog/2019/11/15/mysql-live-session/</url>
    <content><![CDATA[<h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><ul>
<li><code>show processlist</code>ï¼ŒæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œåˆ—å‡ºå‰ 100 æ¡</li>
<li><code>show full processlist</code>ï¼Œåˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹</li>
</ul>
<h2 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mysql&gt; show processlist;</span><br><span class="line">+--------+---------+--------------------+--------------------+---------+------+----------+------------------+</span><br><span class="line">| Id     | User    | Host               | db                 | Command | Time | State    | Info             |</span><br><span class="line">+--------+---------+--------------------+--------------------+---------+------+----------+------------------+</span><br><span class="line">| <span class="number">106125</span> | tdmsdev | <span class="number">10.153</span>.<span class="number">96.89</span>:<span class="number">56808</span> | tdm                | Sleep   |  <span class="number">597</span> |          | NULL             |</span><br><span class="line">| <span class="number">106134</span> | tdmsdev | <span class="number">10.153</span>.<span class="number">96.89</span>:<span class="number">56827</span> | tdm                | Sleep   |  <span class="number">596</span> |          | NULL             |</span><br><span class="line">| <span class="number">106178</span> | hdm     | <span class="number">10.133</span>.<span class="number">0.53</span>:<span class="number">60606</span>  | information_schema | Sleep   |    <span class="number">4</span> |          | NULL             |</span><br><span class="line">| <span class="number">106179</span> | sre     | localhost          | NULL               | Query   |    <span class="number">0</span> | starting | show processlist |</span><br><span class="line">+--------+---------+--------------------+--------------------+---------+------+----------+------------------+</span><br><span class="line"><span class="number">4</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Id</strong>ï¼šçº¿ç¨‹æ ‡è¯†ï¼Œ<code>kill</code> æŸçº¿ç¨‹æ—¶ä½¿ç”¨</li>
<li><strong>User</strong>ï¼šæ˜¾ç¤ºå½“å‰ç”¨æˆ·ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œ <code>SQL</code> è¯­å¥çš„ç”¨æˆ·</li>
<li><strong>Host</strong>ï¼šæ˜¾ç¤ºæ‰§è¡Œ <code>SQL</code> çš„ <code>IP</code> å’Œç«¯å£ï¼Œå¯ä»¥ç”¨æ¥è¿½è¸ªé—®é¢˜çš„æ¥æº</li>
<li><strong>db</strong>ï¼šæ˜¾ç¤ºè¯¥çº¿ç¨‹è¿æ¥çš„æ˜¯å“ªä¸ªæ•°æ®åº“</li>
<li><strong>Command</strong>ï¼šæ˜¾ç¤ºå½“å‰æ‰§è¡Œçš„å‘½ä»¤ï¼Œä¸€èˆ¬ï¼š<code>Sleep</code> ä¼‘çœ ï¼Œ<code>Query</code> æŸ¥è¯¢ï¼Œ<code>Connect</code> è¿æ¥ï¼Œ<code>Binlog Dump</code> å¤åˆ¶</li>
<li><strong>Time</strong>ï¼šä¼šè¯æŒç»­æ—¶é—´ï¼Œå•ä½ï¼ˆç§’ï¼‰</li>
<li><strong>State</strong>ï¼šæ˜¾ç¤ºä½¿ç”¨å½“å‰è¿æ¥çš„çŠ¶æ€ï¼Œå¾ˆé‡è¦åˆ—ã€‚è¯·æ³¨æ„ï¼Œ<code>State</code> åªæ˜¯è¯­å¥æ‰§è¡Œä¸­çš„æŸä¸€ä¸ªçŠ¶æ€ï¼Œä»¥æŸ¥è¯¢ä¸ºä¾‹ï¼Œéœ€è¦ç»è¿‡ <code>copying to tmp tableï¼Œsorting resultï¼Œsending data</code> ç­‰çŠ¶æ€æ‰ç®—å®Œæˆã€‚</li>
<li><strong>Info</strong>ï¼šæ˜¾ç¤ºæ‰§è¡Œçš„ <code>SQL</code> è¯­å¥ï¼Œåˆ¤æ–­é—®é¢˜çš„é‡è¦ä¾æ®ã€‚</li>
</ul>
<h2 id="State"><a href="#State" class="headerlink" title="State"></a>State</h2><ul>
<li><strong>Sleeping</strong>ï¼šå·²å¤„ç†å®Œï¼Œæ­£åœ¨ç­‰å¾…å®¢æˆ·ç«¯å‘é€æ–°è¯·æ±‚ã€‚</li>
<li><strong>Sending data</strong>ï¼šçº¿ç¨‹æ­£åœ¨å¤„ç† <code>select</code> è¯­å¥ï¼Œå¹¶å°†æ•°æ®å‘é€åˆ°å®¢æˆ·ç«¯ã€‚ç”±äºåœ¨æ­¤çŠ¶æ€æœŸé—´å‘ç”Ÿçš„æ“ä½œå¾€å¾€ä¼šæ‰§è¡Œå¤§é‡ç£ç›˜è®¿é—®ï¼ˆè¯»å–ï¼‰ï¼Œå› æ­¤å®ƒé€šå¸¸æ˜¯ç»™å®šæŸ¥è¯¢ç”Ÿå‘½å‘¨æœŸä¸­è¿è¡Œæ—¶é—´æœ€é•¿çš„çŠ¶æ€ï¼Œå±äºæ…¢æŸ¥è¯¢ã€‚</li>
<li><strong>Creating tmp table</strong>ï¼šæ­£åœ¨åˆ›å»ºä¸´æ—¶è¡¨ä»¥å­˜æ”¾éƒ¨åˆ†æŸ¥è¯¢ç»“æœã€‚</li>
<li><strong>Copying to tmp table on disk</strong>ï¼šç”±äºä¸´æ—¶ç»“æœé›†å¤§äº <code>tmp_table_size</code>ï¼Œæ­£åœ¨å°†ä¸´æ—¶è¡¨ä»å†…å­˜å­˜å‚¨è½¬ä¸ºç£ç›˜å­˜å‚¨ä»¥æ­¤èŠ‚çœå†…å­˜ï¼Œå¯ä»¥é€šè¿‡å˜é‡ <code>tmp_table_size</code> å’Œ <code>max_heap_table_size</code> æ¥æ§åˆ¶å†…å­˜è¡¨å¤§å°ä¸Šé™ã€‚</li>
<li><strong>Waiting for table flush</strong>ï¼šçº¿ç¨‹æ­£åœ¨æ‰§è¡Œ <code>flush tables</code> å¹¶ä¸”æ­£åœ¨ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å…³é—­å®ƒä»¬çš„è¡¨ã€‚ä½†æ˜¯ï¼Œè¦é‡æ–°æ‰“å¼€è¡¨ï¼Œå®ƒå¿…é¡»ç­‰åˆ°æ‰€æœ‰å…¶ä»–çº¿ç¨‹å…³é—­äº†ç›¸å…³è¡¨ã€‚</li>
<li><strong>Writing to net</strong>ï¼šæœåŠ¡å™¨æ­£åœ¨å°†æ•°æ®åŒ…å†™å…¥ç½‘ç»œã€‚</li>
<li><strong>Killed</strong>ï¼šé€šå¸¸å‘é€äº†ä¸€ä¸ª kill è¯·æ±‚ç»™æŸçº¿ç¨‹ï¼ŒæŸäº›æƒ…å†µä¸‹ï¼Œçº¿ç¨‹å¯èƒ½ä»ç„¶éœ€è¦å¾ˆçŸ­çš„æ—¶é—´æ‰èƒ½æ­»æ‰ï¼Œå¦‚æœçº¿ç¨‹è¢«æŸä¸ªå…¶ä»–çº¿ç¨‹é”å®šï¼Œåˆ™ä¸€æ—¦å¦ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾å…¶é”å®šï¼Œkill å°±ä¼šé©¬ä¸Šç”Ÿæ•ˆã€‚</li>
<li><strong>System lock</strong>ï¼šæ­£åœ¨ç­‰å¾…å–å¾—ä¸€ä¸ªå¤–éƒ¨çš„ç³»ç»Ÿé”ã€‚å¦‚æœå½“å‰æ²¡æœ‰è¿è¡Œå¤šä¸ª <code>mysqld</code> æœåŠ¡åŒæ—¶è¯·æ±‚åŒä¸€ä¸ªè¡¨ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡å¢åŠ  <code>--skip-external-locking</code> å‚æ•°æ¥ç¦æ­¢å¤–éƒ¨ç³»ç»Ÿé”ã€‚</li>
</ul>
<blockquote>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/general-thread-states.html" target="_blank" rel="noopener">å®˜æ–¹å‚è€ƒ</a></p>
</blockquote>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· å¥åº·æ£€æŸ¥</title>
    <url>/blog/2019/11/15/mysql-health-check/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>MySQL è¿è¡ŒçŠ¶å†µå¥åº·æ£€æŸ¥ï¼Œæä¾›æŠ€æœ¯è¯„ä¼°å’Œå»ºè®®ä¼˜åŒ–æ•°æ®åº“ï¼Œé€šè¿‡ç›‘æ§å‘Šè­¦ï¼Œä»è€Œä¼˜åŒ–æ¨¡å¼ã€æœåŠ¡å™¨é…ç½®ã€æŸ¥è¯¢å’Œå¤åˆ¶ï¼Œæ˜¾è‘—æé«˜æ€§èƒ½ã€å¯æ‰©å±•æ€§ã€å¯ç”¨æ€§å’Œå®‰å…¨æ€§ã€‚</p>
<h2 id="æ£€æŸ¥é¡¹"><a href="#æ£€æŸ¥é¡¹" class="headerlink" title="æ£€æŸ¥é¡¹"></a>æ£€æŸ¥é¡¹</h2><ul>
<li><strong>æ¶æ„ï¼š</strong>è¯„ä¼°å¹¶æ¨èæ•°æ®åº“æ¶æ„å’Œè®¾è®¡ä¼˜åŒ–</li>
<li><strong>é…ç½®ï¼š</strong>è¯„ä¼° MySQL é…ç½®å¹¶æ ¹æ®æ‚¨çš„ç‰¹å®šåº”ç”¨æå‡ºæ›´æ”¹å»ºè®®</li>
<li><strong>æ€§èƒ½ï¼š</strong>ç›‘è§†æŸ¥è¯¢å¹¶æå‡º SQL ä»£ç æ›´æ”¹å»ºè®®ï¼Œä»¥æé«˜æ€§èƒ½</li>
<li><strong>æ€§èƒ½ï¼š</strong>ç›‘è§†å†…å­˜ä½¿ç”¨ï¼ˆç¼“å­˜ã€å‘½ä¸­ç‡ç­‰ï¼‰å¹¶æå‡ºæ›´æ”¹å»ºè®®</li>
<li><strong>å¤‡ä»½ï¼š</strong>è¯„ä¼°å¤‡ä»½é…ç½®å¹¶æå‡ºæ›´æ”¹å»ºè®®ï¼Œä»¥æé«˜å¤‡ä»½/è¿˜åŸæ€§èƒ½</li>
<li><strong>å®‰å…¨æ€§ï¼š</strong>å‘ç°å®‰å…¨æ¼æ´å¹¶æ¨èæ›´ä¸¥æ ¼çš„å®‰å…¨é…ç½®</li>
</ul>
<p><strong>å¯¹è±¡</strong></p>
<ul>
<li>MySQL åº”ç”¨å¼€å‘</li>
<li>é¡¹ç›®ç»ç†</li>
<li>MySQL DBA</li>
</ul>
<p><strong>ä¸»é¢˜</strong></p>
<ul>
<li><strong>MySQL æ€§èƒ½è°ƒä¼˜ï¼š</strong>åŸºç¡€çŸ¥è¯†æˆ–é«˜çº§æç¤ºå’ŒæŠ€å·§</li>
<li><strong>MySQL ä¼ä¸šç‰ˆï¼š</strong>MySQL Enterprise Monitorã€é¡¾é—®ç¨‹åºã€Query Analyzerã€å¤‡ä»½å’Œåˆ†åŒº</li>
<li><strong>MySQL Workbenchï¼š</strong>é€šè¿‡è®¾è®¡æé«˜æ•°æ®åº“æ€§èƒ½</li>
<li><strong>MySQL åˆ†åŒºï¼š</strong>æ”¹å–„é«˜è´Ÿè½½æƒ…å†µä¸‹çš„æ€§èƒ½</li>
<li><strong>MySQL ä¼ä¸šçº§å¤‡ä»½ï¼š</strong>å¿«é€Ÿã€ä¸€è‡´çš„è”æœºâ€œçƒ­â€å¤‡ä»½</li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· æ¡ˆä¾‹åˆ†æ Â· Waiting for table flush</title>
    <url>/blog/2019/11/14/mysql-case-waiting-for-table-flush/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>MES å·¥å‚åé¦ˆä¸šåŠ¡æŸ¥è¯¢æ…¢ï¼Œç™»å½•æ•°æ®åº“æ‰‹å·¥æ‰§è¡Œ <code>SQL</code> æ“ä½œä¹Ÿæ²¡æœ‰å“åº”ï¼Œæ€€ç–‘æ˜¯ <code>02:00</code> æ‰§è¡Œçš„å¤‡ä»½ä»»åŠ¡å¯¼è‡´ã€‚</p>
<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><ul>
<li>ç™»å½•æ•°æ®åº“ï¼Œæ‰§è¡Œ <code>show processlist</code> æŸ¥çœ‹å½“å‰ä¼šè¯ï¼Œå‘ç°å¤§é‡çº¿ç¨‹çŠ¶æ€ä¸º <code>Waiting for tables flush</code>ã€‚</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mysql&gt; show processlist;</span><br><span class="line">+---------+-----------------+----------------------+--------------------+-------------+-------+---------------------------------------------------------------+------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Id      | User            | Host                 | db                 | Command     | Time  | State                                                         | Info                                                                                                 |</span><br><span class="line">+---------+-----------------+----------------------+--------------------+-------------+-------+---------------------------------------------------------------+------------------------------------------------------------------------------------------------------+</span><br><span class="line">| <span class="number">3074726</span> | cosmo_dsj       | <span class="number">10.138</span>.<span class="number">225.194</span>:<span class="number">41311</span> | NULL               | Binlog Dump | <span class="number">31808</span> | Master has sent all binlog to slave; waiting <span class="keyword">for</span> more updates | NULL                                                                                                 |</span><br><span class="line">| <span class="number">3080884</span> | cosmo_t         | %                    | cosmo_im_1021      | Connect     | <span class="number">12515</span> | Sending <span class="keyword">data</span>                                                  | CALL  procedure_imp_table                                                                            |</span><br><span class="line">| <span class="number">3082179</span> | cosmo_t         | <span class="number">10.138</span>.<span class="number">228.42</span>:<span class="number">36560</span>  | cosmo_im_1021      | Sleep       |    <span class="number">19</span> |                                                               | NULL                                                                                                 |</span><br><span class="line">| <span class="number">3082727</span> | root            | localhost            | NULL               | Query       |  <span class="number">6180</span> | Waiting <span class="keyword">for</span> table flush                                       | FLUSH NO_WRITE_TO_BINLOG TABLES                                                                      |</span><br><span class="line">| <span class="number">3082888</span> | cosmo_r         | <span class="number">10.180</span>.<span class="number">221.43</span>:<span class="number">52153</span>  | cosmo_im_1021      | Sleep       |     <span class="number">5</span> |                                                               | NULL                                                                                                 |</span><br><span class="line">| <span class="number">3082892</span> | cosmo_r         | <span class="number">10.180</span>.<span class="number">221.43</span>:<span class="number">52155</span>  | cosmo_im_1021      | Sleep       |     <span class="number">1</span> |                                                               | NULL                                                                                                 |</span><br><span class="line">| <span class="number">3082919</span> | cosmo_t         | %                    | cosmo_im_1021      | Connect     |  <span class="number">6125</span> | Waiting <span class="keyword">for</span> table flush                                       | CALL procedure_assembly_work                                                                         |</span><br><span class="line">| <span class="number">3082940</span> | cosmo_t         | %                    | cosmo_im_1021      | Connect     |  <span class="number">6104</span> | Waiting <span class="keyword">for</span> table flush                                       | UPDATE board_datas bo inner join (</span><br><span class="line">            SELECT times,</span><br><span class="line">                   cNum                 |</span><br><span class="line">| <span class="number">3083094</span> | cosmo_t         | <span class="number">10.180</span>.<span class="number">221.45</span>:<span class="number">59111</span>  | cosmo_im_1021      | Query       |     <span class="number">6</span> | Waiting <span class="keyword">for</span> table flush                                       | SELECT a.*,TIMESTAMPDIFF(MINUTE,a.CallTime,NOW()) as Tdiff from</span><br><span class="line">(SELECT DISTINCT pmcall.Call_ID ,ca |</span><br><span class="line">| <span class="number">3083127</span> | cosmo_t         | %                    | cosmo_im_1021      | Connect     |  <span class="number">5924</span> | Waiting <span class="keyword">for</span> table flush                                       | UPDATE board_datas bo inner join (</span><br><span class="line">            SELECT times,</span><br><span class="line">                   cNum                 |</span><br><span class="line">| <span class="number">3083260</span> | cosmo_t         | %                    | cosmo_im_1021      | Connect     |  <span class="number">5744</span> | Waiting <span class="keyword">for</span> table flush                                       | UPDATE board_datas bo inner join (</span><br><span class="line">            SELECT times,</span><br><span class="line">                   cNum                 |</span><br></pre></td></tr></table></figure>

<ul>
<li><p>æ‰¾åˆ°é¦–æ¬¡å‡ºç°æ­¤çŠ¶æ€æ‰§è¡Œçš„æ“ä½œ <code>FLUSH NO_WRITE_TO_BINLOG TABLES</code>ï¼Œæ‰§è¡Œæ—¶é—´ <code>6125s</code>ï¼Œçº¿ç¨‹ID <code>3082727</code>ï¼Œè¿™æ˜¯ <code>XtraBackup</code> æ‰§è¡Œå…¨é‡å¤‡ä»½çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸»è¦ä½œç”¨æ˜¯å…³é—­æ‰€æœ‰æ‰“å¼€çš„è¡¨ï¼Œå¼ºåˆ¶å…³é—­æ‰€æœ‰æ­£åœ¨ä½¿ç”¨çš„è¡¨ï¼Œå¹¶åˆ·æ–°æŸ¥è¯¢ç¼“å­˜å’Œé¢„å‡†å¤‡è¯­å¥ç¼“å­˜ã€‚</p>
</li>
<li><p>å¤‡ä»½æ­£å¸¸æ‰§è¡Œè¿™ä¸ªæ“ä½œæ˜¯ä¸ä¼šé”è¡¨çš„ï¼Œä½†æ˜¯å¦‚æœåœ¨æ­¤æœŸé—´å­˜åœ¨æ…¢æŸ¥è¯¢ <code>CALL procedure_imp_table</code>ï¼Œæ‰§è¡Œæ—¶é—´ <code>12515s</code>ï¼Œçº¿ç¨‹ID <code>3080884</code>ï¼Œå°±ä¼šå ç”¨å…¨å±€åªè¯»é”ï¼Œé˜»æ­¢å…³é—­æ‰“å¼€çš„è¡¨ã€‚</p>
</li>
<li><p><strong>ç»“è®º</strong>ï¼šä½¿ç”¨ <code>mysqldumpã€XtraBackup</code> å¤‡ä»½æœŸé—´å‡ºç°äº†æ…¢æŸ¥è¯¢å¹¶ä¸”æ…¢æŸ¥è¯¢é•¿æ—¶é—´é˜»å¡ï¼Œå°±ä¼šå‡ºç°  <code>Waiting for tables flush</code>ã€‚</p>
</li>
</ul>
<h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><ul>
<li>æ‰¾å‡ºè¶…æ—¶çš„æ…¢æŸ¥è¯¢ï¼Œæ‰§è¡Œ <code>kill 3080884</code> ï¼Œé—®é¢˜è§£å†³</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; kill 3080884;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show processlist;</span><br><span class="line">+<span class="comment">---------+-----------------+----------------------+--------------------+-------------+-------+---------------------------------------------------------------+------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Id      | User            | Host                 | db                 | Command     | Time  | State                                                         | Info                                                                                                 |</span><br><span class="line">+<span class="comment">---------+-----------------+----------------------+--------------------+-------------+-------+---------------------------------------------------------------+------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">|       1 | event_scheduler | localhost            | NULL               | Daemon      |     4 | Waiting for next activation                                   | NULL                                                                                                 |</span><br><span class="line">| 3061488 | cosmo_t         | 10.180.199.156:49161 | cosmo_im_1021      | Sleep       |    34 |                                                               | NULL                                                                                                 |</span><br><span class="line">| 3074726 | cosmo_dsj       | 10.138.225.194:41311 | NULL               | Binlog Dump | 31920 | Master has sent all binlog to slave; waiting for more updates | NULL                                                                                                 |</span><br><span class="line">| 3080883 | cosmo_t         | 10.138.42.106:42146  | cosmo_im_1021      | Sleep       |   144 |                                                               | NULL                                                                                                 |</span><br><span class="line">| 3081434 | cosmo_t         | 10.138.42.106:44741  | cosmo_im_1021      | Sleep       |   144 |                                                               | NULL                                                                                                 |</span><br><span class="line">| 3082179 | cosmo_t         | 10.138.228.42:36560  | cosmo_im_1021      | Sleep       |   131 |                                                               | NULL                                                                                                 |</span><br><span class="line">| 3082888 | cosmo_r         | 10.180.221.43:52153  | cosmo_im_1021      | Sleep       |     1 |                                                               | NULL                                                                                                 |</span><br><span class="line">| 3082892 | cosmo_r         | 10.180.221.43:52155  | cosmo_im_1021      | Sleep       |     4 |                                                               | NULL                                                                                                 |</span><br><span class="line">| 3083094 | cosmo_t         | 10.180.221.45:59111  | cosmo_im_1021      | Sleep       |    27 |                                                               | NULL                                                                                                 |</span><br><span class="line">| 3083531 | cosmo_r         | 10.180.207.197:61769 | cosmo_im_1021      | Sleep       |     3 |                                                               | NULL</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>VPN</title>
    <url>/blog/2019/11/13/vpn/</url>
    <content><![CDATA[<p><a href="http://vpn.haier.net/" target="_blank" rel="noopener">Haier VPN ç³»ç»Ÿä½¿ç”¨æŒ‡å—</a></p>
<h4 id="é’å²›"><a href="#é’å²›" class="headerlink" title="é’å²›"></a>é’å²›</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">cu.vpn.haier.net:<span class="number">10445</span>  <span class="comment"># è”é€š</span></span><br><span class="line">ct.vpn.haier.net:<span class="number">10445</span>  <span class="comment"># ç”µä¿¡</span></span><br></pre></td></tr></table></figure>

<h4 id="åŒ—äº¬"><a href="#åŒ—äº¬" class="headerlink" title="åŒ—äº¬"></a>åŒ—äº¬</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="number">123.103</span>.<span class="number">113.249</span>:<span class="number">8443</span></span><br></pre></td></tr></table></figure>

<h4 id="mac-è®¿é—®å†…ç½‘"><a href="#mac-è®¿é—®å†…ç½‘" class="headerlink" title="mac è®¿é—®å†…ç½‘"></a>mac è®¿é—®å†…ç½‘</h4><ul>
<li>è¿æ— çº¿ <code>Haier-Corp</code></li>
<li>ä½¿ç”¨å·¥å·ç™»å½• <code>1.1.1.3</code></li>
<li>æ‰“å¼€ç½‘ç»œåå¥½è®¾ç½®ï¼Œä¿®æ”¹ <code>DNS</code> ä¸ºï¼š<code>10.138.40.212ã€10.138.40.213</code></li>
</ul>
]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
  </entry>
  <entry>
    <title>CentOS 6 ä¸ CentOS 7 é˜²ç«å¢™è®¾ç½®åŠå¼€æ”¾ç«¯å£</title>
    <url>/blog/2019/11/13/linux-firewall/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><a href="https://www.centos.org/" target="_blank" rel="noopener">CentOS</a> å‡çº§åˆ° 7 ä¹‹åï¼Œå†…ç½®çš„é˜²ç«å¢™å·²ç»ä» <code>iptables</code> å˜æˆäº† <code>firewalld</code>ï¼Œä¸åŒæ“ä½œç³»ç»Ÿè®¾ç½®çš„æ–¹å¼ä¸åŒã€‚</p>
<h2 id="CentOS-6"><a href="#CentOS-6" class="headerlink" title="CentOS 6"></a>CentOS 6</h2><ul>
<li>æ‰“å¼€/å…³é—­/é‡å¯é˜²ç«å¢™</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">chkconfig iptables on       <span class="comment"># å¼€å¯é˜²ç«å¢™</span></span><br><span class="line">chkconfig iptables off      <span class="comment"># å…³é—­é˜²ç«å¢™</span></span><br><span class="line">service iptables start      <span class="comment"># å¼€å¯é˜²ç«å¢™</span></span><br><span class="line">service iptables stop       <span class="comment"># å…³é—­é˜²ç«å¢™</span></span><br><span class="line">service iptables restarted  <span class="comment"># é‡å¯é˜²ç«å¢™</span></span><br><span class="line">iptables -F                 <span class="comment"># æ¸…é™¤é˜²ç«å¢™è§„åˆ™</span></span><br></pre></td></tr></table></figure>

<ul>
<li>æ‰“å¼€ç«¯å£</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">/sbin/iptables -I INPUT -p tcp --dport <span class="number">22</span> -j ACCEPT   <span class="comment"># æ‰“å¼€22ç«¯å£</span></span><br><span class="line">/sbin/iptables -I INPUT -p tcp --dport <span class="number">3306</span> -j ACCEPT <span class="comment"># æ‰“å¼€3306ç«¯å£</span></span><br><span class="line">/etc/rc.d/init.d/iptables save   <span class="comment"># ä¿å­˜é˜²ç«å¢™</span></span><br><span class="line">/etc/init.d/iptables restart     <span class="comment"># é‡å¯é˜²ç«å¢™</span></span><br></pre></td></tr></table></figure>

<ul>
<li>æŸ¥çœ‹æ‰“å¼€çš„ç«¯å£</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">/etc/init.d/iptables status</span><br></pre></td></tr></table></figure>

<h2 id="CentOS-7"><a href="#CentOS-7" class="headerlink" title="CentOS 7"></a>CentOS 7</h2><ul>
<li>æ‰“å¼€/å…³é—­/é‡å¯é˜²ç«å¢™</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">systemctl start firewalld  <span class="comment"># å¯ç”¨é˜²ç«å¢™</span></span><br><span class="line">systemctl stop firewalld   <span class="comment"># åœæ­¢é˜²ç«å¢™</span></span><br><span class="line">systemctl status firewalld <span class="comment"># æŸ¥çœ‹çŠ¶æ€</span></span><br></pre></td></tr></table></figure>

<ul>
<li>æ‰“å¼€ç«¯å£</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=<span class="number">80</span>/tcp <span class="comment"># æ°¸ä¹…ç”Ÿæ•ˆå†åŠ ä¸Š--permanent</span></span><br><span class="line">firewall-cmd --reload                        <span class="comment"># æ›´æ–°é˜²ç«å¢™è§„åˆ™</span></span><br></pre></td></tr></table></figure>

<ul>
<li>æŸ¥çœ‹æ‰“å¼€çš„ç«¯å£</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">firewall-cmd --zone=public --list-ports</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
  </entry>
  <entry>
    <title>PostgreSQL</title>
    <url>/blog/2019/11/13/postgresql/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><ul>
<li><strong>æè¿°</strong>ï¼šäººåŠ›é¢˜åº“æ•°æ®åº“å³å°†ä¸‹çº¿ï¼Œéœ€è¦ä¿å­˜æ•°æ®å‰¯æœ¬åˆ°æœ¬åœ°æ•°æ®åº“ã€‚</li>
<li><strong>æºåº“</strong>ï¼š<code>PostgreSQL 9.2.8</code></li>
<li><strong>ç›®æ ‡åº“</strong>ï¼š<code>10.133.0.52</code> / <code>PostgreSQL 11.5</code></li>
</ul>
<table>
<thead>
<tr>
<th>è¿ç§»è¡¨</th>
<th>è¯´æ˜</th>
<th>æ•°æ®é‡</th>
<th>çŠ¶æ€</th>
</tr>
</thead>
<tbody><tr>
<td>t_ems_base</td>
<td>é¢˜åº“</td>
<td>3139</td>
<td><strong>OK</strong></td>
</tr>
<tr>
<td>t_ems_base_category</td>
<td>é¢˜åº“ç±»åˆ«</td>
<td>164</td>
<td><strong>OK</strong></td>
</tr>
<tr>
<td>t_ems_item</td>
<td>è¯•é¢˜</td>
<td>500378</td>
<td><strong>OK</strong></td>
</tr>
<tr>
<td>t_ems_item_option</td>
<td>è¯•é¢˜é€‰é¡¹</td>
<td>1250290</td>
<td><strong>OK</strong></td>
</tr>
<tr>
<td>t_ems_paper</td>
<td>è¯•å·</td>
<td>3262</td>
<td><strong>OK</strong></td>
</tr>
<tr>
<td>t_ems_paper_item_rel</td>
<td>è¯•å·è¯•é¢˜</td>
<td>1920540</td>
<td><strong>OK</strong></td>
</tr>
<tr>
<td>t_ems_info</td>
<td>è€ƒè¯•</td>
<td>36229</td>
<td><strong>OK</strong></td>
</tr>
<tr>
<td>t_ems_result</td>
<td>è€ƒè¯•æˆç»©</td>
<td>1052490</td>
<td><strong>OK</strong></td>
</tr>
<tr>
<td>t_ems_result_detail</td>
<td>è€ƒè¯•ç­”é¢˜è¯¦æƒ…</td>
<td>69602800</td>
<td><strong>ï¼Ÿ</strong></td>
</tr>
</tbody></table>
<h2 id="PostgreSQL"><a href="#PostgreSQL" class="headerlink" title="PostgreSQL"></a>PostgreSQL</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><ul>
<li>æ“ä½œç³»ç»Ÿï¼šCentOS Linux release 7.4.1708 (Core)</li>
<li>å®‰è£…ç‰ˆæœ¬ï¼š<a href="https://www.postgresql.org/" target="_blank" rel="noopener">PostgreSQL</a> 11</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½rpmåŒ…</span></span><br><span class="line">yum install https://download.postgresql.org/pub/repos/yum/<span class="number">11</span>/redhat/rhel-<span class="number">7</span>-x86_64/pgdg-redhat11-<span class="number">11</span>-<span class="number">2</span>.noarch.rpm -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line">yum -y install postgresql11 postgresql11-server postgresql11-libs</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–æ•°æ®åº“</span></span><br><span class="line">/usr/pgsql-<span class="number">11</span>/bin/postgresql-<span class="number">11</span>-setup initdb <span class="comment"># /usr/pgsql-11/bin/initdb -D /data/postgresql</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¼€æœºè‡ªå¯åŠ¨PostgreSQLå’Œå¯åŠ¨æœåŠ¡</span></span><br><span class="line">systemctl enable postgresql-<span class="number">11</span></span><br><span class="line">systemctl start postgresql-<span class="number">11</span></span><br><span class="line">systemctl status postgresql-<span class="number">11</span></span><br><span class="line"></span><br><span class="line">â— postgresql-<span class="number">11</span>.service - PostgreSQL <span class="number">11</span> database server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/postgresql-<span class="number">11</span>.service; enabled; vendor preset: disablesd)</span><br><span class="line">   Active: active (running) since ä¸‰ <span class="number">2019</span>-<span class="number">11</span>-<span class="number">13</span> <span class="number">10</span>:<span class="number">11</span>:<span class="number">05</span> CST; <span class="number">6</span>s ago</span><br><span class="line">     Docs: https://www.postgresql.org/docs/<span class="number">11</span>/static/</span><br><span class="line">  <span class="keyword">Process</span>: <span class="number">84380</span> ExecStartPre=/usr/pgsql-<span class="number">11</span>/bin/postgresql-<span class="number">11</span>-check-db-dir $&#123;PGDATA&#125; (code=exited, status=<span class="number">0</span>/SUCCESS)</span><br><span class="line"> Main PID: <span class="number">84386</span> (postmaster)</span><br><span class="line">   CGroup: /system.slice/postgresql-<span class="number">11</span>.service</span><br><span class="line">           â”œâ”€<span class="number">84386</span> /usr/pgsql-<span class="number">11</span>/bin/postmaster -D /var/lib/pgsql/<span class="number">11</span>/<span class="keyword">data</span>/</span><br><span class="line">           â”œâ”€<span class="number">84388</span> postgres: logger   </span><br><span class="line">           â”œâ”€<span class="number">84390</span> postgres: checkpointer   </span><br><span class="line">           â”œâ”€<span class="number">84391</span> postgres: background writer   </span><br><span class="line">           â”œâ”€<span class="number">84392</span> postgres: walwriter   </span><br><span class="line">           â”œâ”€<span class="number">84393</span> postgres: autovacuum launcher   </span><br><span class="line">           â”œâ”€<span class="number">84394</span> postgres: stats collector   </span><br><span class="line">           â”œâ”€<span class="number">84395</span> postgres: logical replication launcher   </span><br><span class="line">           â””â”€<span class="number">84417</span> /usr/pgsql-<span class="number">11</span>/bin/postmaster -D /var/lib/pgsql/<span class="number">11</span>/<span class="keyword">data</span>/</span><br><span class="line">           </span><br><span class="line"><span class="comment"># ä¿®æ”¹æ•°æ®å­˜å‚¨ç›®å½•</span></span><br><span class="line">systemctl stop postgresql-<span class="number">11</span></span><br><span class="line">mkdir /<span class="keyword">data</span>/postgresql</span><br><span class="line">chown -R postgres:postgres postgresql</span><br><span class="line">chmod <span class="number">700</span> /<span class="keyword">data</span>/postgresql</span><br><span class="line">vi /<span class="keyword">data</span>/postgresql/postgresql.conf  <span class="comment"># data_directory = '/data/postgresql'</span></span><br><span class="line">vi /usr/lib/systemd/system/postgresql-<span class="number">11</span>.service <span class="comment"># Environment=PGDATA=/data/postgresql</span></span><br><span class="line">systemctl restart postgresql-<span class="number">11</span></span><br><span class="line"></span><br><span class="line">$ su - postgres</span><br><span class="line">-bash-<span class="number">4.2</span>$ psql</span><br><span class="line">postgres=<span class="comment"># show data_directory;</span></span><br><span class="line">  data_directory  </span><br><span class="line">------------------</span><br><span class="line"> /<span class="keyword">data</span>/postgresql</span><br></pre></td></tr></table></figure>

<h3 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ su - postgres</span><br><span class="line">-bash-<span class="number">4.2</span>$ psql</span><br><span class="line">psql (<span class="number">11.5</span>)</span><br><span class="line">postgres=<span class="comment"># select version();</span></span><br><span class="line">                                                 version                                                 </span><br><span class="line">---------------------------------------------------------------------------------------------------------</span><br><span class="line"> PostgreSQL <span class="number">11.5</span> on x86_64-pc-linux-gnu, compiled by gcc (GCC) <span class="number">4.8</span>.<span class="number">5</span> <span class="number">20150623</span> (Red Hat <span class="number">4.8</span>.<span class="number">5</span>-<span class="number">36</span>), <span class="number">64</span>-bit</span><br><span class="line"> </span><br><span class="line"><span class="comment"># é…ç½®Navicateå¯ç™»å½• &lt;postgres/Haier@123&gt;</span></span><br><span class="line">vi /<span class="keyword">data</span>/postgresql/postgresql.conf  <span class="comment"># listen_addresses = '*'</span></span><br><span class="line">vi /<span class="keyword">data</span>/postgresql/pg_hba.conf  <span class="comment"># æ–‡ä»¶æœ«å°¾æ·»åŠ  host  all  all  0.0.0.0/0  trust</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>PostgreSQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· binlog æ—¥å¿—</title>
    <url>/blog/2019/11/07/mysql-binlog/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><strong>Binlog</strong>ï¼šä¹Ÿç§°äºŒè¿›åˆ¶æ—¥å¿—ï¼Œæ˜¯ MySQL æœ€é‡è¦çš„æ—¥å¿—ï¼Œè®°å½•æ‰€æœ‰æ•°æ®åº“è¡¨ç»“æ„å˜æ›´ï¼ˆå¦‚ <code>CREATE</code>ã€<code>ALTER TABLE</code>ï¼‰ä»¥åŠè¡¨æ•°æ®ä¿®æ”¹ï¼ˆå¦‚ <code>INSERT</code>ã€<code>UPDATE</code>ã€<code>DELETE</code>ï¼‰ï¼Œä¸ä¼šè®°å½• <code>SELECT</code> å’Œ <code>SHOW</code> è¿™ç±»æ“ä½œï¼Œä¸»è¦ä½œç”¨ï¼š<strong>å¤åˆ¶</strong>ï¼ˆä¸»ä»åŒæ­¥ï¼‰ã€<strong>æ¢å¤</strong>å’Œ<strong>å®¡è®¡</strong>ã€‚</p>
<table>
<thead>
<tr>
<th>æ—¥å¿—æ ¼å¼</th>
<th>è®°å½•è¯´æ˜</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td><code>STATEMENT</code></td>
<td>è®°å½•çš„æ˜¯ä¿®æ”¹ <code>SQL</code> è¯­å¥</td>
<td>æ—¥å¿—æ–‡ä»¶å°ï¼ŒèŠ‚çº¦ <code>IO</code></td>
<td>å‡†ç¡®æ€§å·®ï¼Œä¸€äº›ç³»ç»Ÿå‡½æ•°ä¸èƒ½å‡†ç¡®å¤åˆ¶</td>
</tr>
<tr>
<td><code>ROW</code></td>
<td>è®°å½•çš„æ˜¯æ¯è¡Œå®é™…æ•°æ®çš„å˜æ›´</td>
<td>å‡†ç¡®æ€§å¼ºï¼Œèƒ½å‡†ç¡®å¤åˆ¶æ•°æ®çš„å˜æ›´</td>
<td>æ–‡ä»¶æ—¥å¿—å¤§ï¼Œè¾ƒå¤§çš„ç£ç›˜å’Œç½‘ç»œ <code>IO</code></td>
</tr>
<tr>
<td><code>MIXED</code></td>
<td>ä»¥ä¸Šä¸¤ç§æ¨¡å¼çš„æ··åˆ</td>
<td>å‡†ç¡®æ€§å¼ºï¼Œæ–‡ä»¶å¤§å°é€‚ä¸­</td>
<td>æœ‰å¯èƒ½å‘ç”Ÿä¸»ä»ä¸ä¸€è‡´é—®é¢˜</td>
</tr>
</tbody></table>
<h2 id="é…ç½®å‚æ•°"><a href="#é…ç½®å‚æ•°" class="headerlink" title="é…ç½®å‚æ•°"></a>é…ç½®å‚æ•°</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">binlog_format    = mixed</span><br><span class="line">log_bin          = /<span class="keyword">data</span>/mysql/mysql-bin.log</span><br><span class="line">expire_logs_days = <span class="number">7</span></span><br><span class="line">max_binlog_size  = <span class="number">1</span>G</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>log_bin = { on | off | base_name }</td>
<td>æŒ‡å®šæ˜¯å¦å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—æˆ–è€…æŒ‡å®šä¸€ä¸ªæ—¥å¿—è·¯å¾„</td>
</tr>
<tr>
<td>binlog_format = { mixed | row | statement }</td>
<td>æŒ‡å®šäºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼</td>
</tr>
<tr>
<td>expire_logs_days</td>
<td>æŒ‡å®šäºŒè¿›åˆ¶æ—¥å¿—è¿‡æœŸæ—¶é—´</td>
</tr>
<tr>
<td>sql_log_bin = { on | off }</td>
<td>æŒ‡å®šæ˜¯å¦å¯ç”¨è®°å½•äºŒè¿›åˆ¶æ—¥å¿—</td>
</tr>
<tr>
<td>log_bin_index</td>
<td>æŒ‡å®š <code>mysql-bin.index</code> æ–‡ä»¶è·¯å¾„</td>
</tr>
<tr>
<td>max_binlog_size</td>
<td>æŒ‡å®šäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æœ€å¤§å€¼</td>
</tr>
<tr>
<td>binlog_cache_size</td>
<td>æŒ‡å®šäº‹åŠ¡æ—¥å¿—ç¼“å­˜åŒºå¤§å°</td>
</tr>
<tr>
<td>max_binlog_cache_size</td>
<td>æŒ‡å®šäºŒè¿›åˆ¶æ—¥å¿—ç¼“å­˜æœ€å¤§å€¼</td>
</tr>
<tr>
<td>sync_binlog = { 0 | n }</td>
<td>æŒ‡å®šå†™ç¼“å†²å¤šå°‘æ¬¡ï¼Œåˆ·ä¸€æ¬¡ç›˜</td>
</tr>
</tbody></table>
<h2 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h2><ul>
<li><strong>æŸ¥çœ‹ binlog</strong>ï¼š<a href="https://huiraoo.github.io/blog/2019/11/07/mysql-tool-mysqlbinlog/">mysqlbinlog</a></li>
<li><strong>åˆ é™¤ binlog</strong></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰‹å·¥åˆ é™¤</span></span><br><span class="line">purge master logs to <span class="string">"mysql-bin.xx"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªåŠ¨æ¸…ç†</span></span><br><span class="line">set global expire_logs_days=N;</span><br><span class="line">flush logs;</span><br></pre></td></tr></table></figure>

<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><ul>
<li><a href="https://huiraoo.github.io/blog/2019/11/07/mysql-case-binlog-overflow/">MySQL Â· æ¡ˆä¾‹åˆ†æ Â· å¤§äº‹åŠ¡å¯¼è‡´ binlog æš´å¢</a></li>
<li>MySQL Â· æ¡ˆä¾‹åˆ†æ Â· æœªè®¾ç½®è¿‡æœŸæ—¶é—´å¯¼è‡´ binlog å †ç§¯</li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· æ¡ˆä¾‹åˆ†æ Â· å¤§äº‹åŠ¡å¯¼è‡´ binlog æš´å¢</title>
    <url>/blog/2019/11/07/mysql-case-binlog-overflow/</url>
    <content><![CDATA[<h2 id="é—®é¢˜ç°è±¡"><a href="#é—®é¢˜ç°è±¡" class="headerlink" title="é—®é¢˜ç°è±¡"></a>é—®é¢˜ç°è±¡</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[root@cosmoim-db04 data]<span class="comment"># ll -h</span></span><br><span class="line">total <span class="number">819</span>G</span><br><span class="line">....</span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">214</span> Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">53</span> relay-log.<span class="number">001998</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">54</span> relay-log.<span class="number">001999</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">29</span>M Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">54</span> relay-log.<span class="number">002000</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">214</span> Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">54</span> relay-log.<span class="number">002001</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">55</span> relay-log.<span class="number">002002</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">29</span>M Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">55</span> relay-log.<span class="number">002003</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">214</span> Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">55</span> relay-log.<span class="number">002004</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">55</span> relay-log.<span class="number">002005</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">29</span>M Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">55</span> relay-log.<span class="number">002006</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">214</span> Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">55</span> relay-log.<span class="number">002007</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">56</span> relay-log.<span class="number">002008</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">29</span>M Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">56</span> relay-log.<span class="number">002009</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">214</span> Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">56</span> relay-log.<span class="number">002010</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">56</span> relay-log.<span class="number">002011</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">29</span>M Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">56</span> relay-log.<span class="number">002012</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">214</span> Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">56</span> relay-log.<span class="number">002013</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">57</span> relay-log.<span class="number">002014</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">29</span>M Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">57</span> relay-log.<span class="number">002015</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">214</span> Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">57</span> relay-log.<span class="number">002016</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">58</span> relay-log.<span class="number">002017</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">29</span>M Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">58</span> relay-log.<span class="number">002018</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">214</span> Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">58</span> relay-log.<span class="number">002019</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">58</span> relay-log.<span class="number">002020</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">29</span>M Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">58</span> relay-log.<span class="number">002021</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">214</span> Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">58</span> relay-log.<span class="number">002022</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">59</span> relay-log.<span class="number">002023</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">29</span>M Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">59</span> relay-log.<span class="number">002024</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">214</span> Nov  <span class="number">6</span> <span class="number">21</span>:<span class="number">59</span> relay-log.<span class="number">002025</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Nov  <span class="number">6</span> <span class="number">22</span>:<span class="number">00</span> relay-log.<span class="number">002026</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">29</span>M Nov  <span class="number">6</span> <span class="number">22</span>:<span class="number">00</span> relay-log.<span class="number">002027</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">214</span> Nov  <span class="number">6</span> <span class="number">22</span>:<span class="number">00</span> relay-log.<span class="number">002028</span></span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<h2 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h2><p>è§£æ <code>relaylog</code> æ—¥å¿—ï¼Œå‘ç°æ‰§è¡Œçš„æ˜¯ä¸€ä¸ª <code>update</code> å¤§äº‹åŠ¡</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mysqlbinlog --base64-output=decode-rows --verbose relay-log.<span class="number">001999</span></span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment">#191106 21:53:01 server id 13823283  end_log_pos 342 CRC32 0x50ae56cd 	Table_map: `cosmo-aps`.`bns_aps_versiontolineinfo` mapped to number 417</span></span><br><span class="line"><span class="comment"># at 505</span></span><br><span class="line"><span class="comment">#191106 21:53:01 server id 13823283  end_log_pos 8504 CRC32 0xc3c33b83 	Update_rows: table id 417</span></span><br><span class="line"><span class="comment"># at 8667</span></span><br><span class="line"><span class="comment">#191106 21:53:01 server id 13823283  end_log_pos 16666 CRC32 0xc7ccd23c 	Update_rows: table id 417</span></span><br><span class="line"><span class="comment"># at 16829</span></span><br><span class="line"><span class="comment">#191106 21:53:01 server id 13823283  end_log_pos 24828 CRC32 0x870a1ba0 	Update_rows: table id 417</span></span><br><span class="line"><span class="comment"># at 24991</span></span><br><span class="line"><span class="comment">#191106 21:53:01 server id 13823283  end_log_pos 32990 CRC32 0x310a7ba8 	Update_rows: table id 417</span></span><br><span class="line"><span class="comment"># at 33153</span></span><br><span class="line"><span class="comment">#191106 21:53:01 server id 13823283  end_log_pos 41152 CRC32 0x84202102 	Update_rows: table id 417</span></span><br><span class="line"><span class="comment"># at 41315</span></span><br><span class="line"><span class="comment">#191106 21:53:01 server id 13823283  end_log_pos 49314 CRC32 0xaaf45c6e 	Update_rows: table id 417</span></span><br><span class="line"><span class="comment"># at 49477</span></span><br><span class="line"><span class="comment">#191106 21:53:01 server id 13823283  end_log_pos 57476 CRC32 0x3e307bcb 	Update_rows: table id 417</span></span><br><span class="line"><span class="comment"># at 57639</span></span><br><span class="line"><span class="comment">#191106 21:53:01 server id 13823283  end_log_pos 65638 CRC32 0x4832b399 	Update_rows: table id 417</span></span><br><span class="line"><span class="comment"># at 65801</span></span><br><span class="line"><span class="comment">#191106 21:53:01 server id 13823283  end_log_pos 73800 CRC32 0x941f87fe 	Update_rows: table id 417</span></span><br><span class="line"><span class="comment"># at 73963</span></span><br><span class="line"><span class="comment">#191106 21:53:01 server id 13823283  end_log_pos 81962 CRC32 0xbacbfa92 	Update_rows: table id 417</span></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="comment">#191106 21:53:01 server id 13823283  end_log_pos 38061530 CRC32 0x15876ee5 	Update_rows: table id 417 flags: STMT_END_F</span></span><br><span class="line"><span class="comment">### UPDATE `cosmo-aps`.`bns_aps_versiontolineinfo`</span></span><br><span class="line"><span class="comment">### WHERE</span></span><br><span class="line"><span class="comment">###   @1='be2080a3-3815-48ee-b73e-2f18cbe3b4a8'</span></span><br><span class="line"><span class="comment">###   @2=NULL</span></span><br><span class="line"><span class="comment">###   @3='9790'</span></span><br><span class="line"><span class="comment">###   @4=''</span></span><br><span class="line"><span class="comment">###   @5='CE0EQ8000'</span></span><br><span class="line"><span class="comment">###   @6='XQG52-Q718(ç°)'</span></span><br><span class="line"><span class="comment">###   @7=''</span></span><br><span class="line"><span class="comment">###   @8=NULL</span></span><br><span class="line"><span class="comment">###   @9='N500'</span></span><br><span class="line"><span class="comment">###   @10='30'</span></span><br><span class="line"><span class="comment">###   @11='T6'</span></span><br><span class="line"><span class="comment">###   @12=''</span></span><br><span class="line"><span class="comment">###   @13=1</span></span><br><span class="line"><span class="comment">###   @14=''</span></span><br><span class="line"><span class="comment">###   @15='åœ¨äº§'</span></span><br><span class="line"><span class="comment">###   @16=''</span></span><br><span class="line"><span class="comment">###   @17=''</span></span><br><span class="line"><span class="comment">###   @18=''</span></span><br><span class="line"><span class="comment">###   @19='ç®¡ç†å‘˜'</span></span><br><span class="line"><span class="comment">###   @20='2018-08-31 18:03:59'</span></span><br><span class="line"><span class="comment">###   @21='ç®¡ç†å‘˜'</span></span><br><span class="line"><span class="comment">###   @22='2019-11-06 21:53:00'</span></span><br><span class="line"><span class="comment">###   @23=0</span></span><br><span class="line"><span class="comment">###   @24=0</span></span><br><span class="line"><span class="comment">###   @25='1'</span></span><br><span class="line"><span class="comment">###   @26='00'</span></span><br><span class="line"><span class="comment">### SET</span></span><br><span class="line"><span class="comment">###   @1='be2080a3-3815-48ee-b73e-2f18cbe3b4a8'</span></span><br><span class="line"><span class="comment">###   @2=NULL</span></span><br><span class="line"><span class="comment">###   @3='9790'</span></span><br><span class="line"><span class="comment">###   @4=''</span></span><br><span class="line"><span class="comment">###   @5='CE0EQ8000'</span></span><br><span class="line"><span class="comment">###   @6='XQG52-Q718(ç°)'</span></span><br><span class="line"><span class="comment">###   @7=''</span></span><br><span class="line"><span class="comment">###   @8=NULL</span></span><br><span class="line"><span class="comment">###   @9='N500'</span></span><br><span class="line"><span class="comment">###   @10='30'</span></span><br><span class="line"><span class="comment">###   @11='T6'</span></span><br><span class="line"><span class="comment">###   @12=''</span></span><br><span class="line"><span class="comment">###   @13=1</span></span><br><span class="line"><span class="comment">###   @14=''</span></span><br><span class="line"><span class="comment">###   @15='åœ¨äº§'</span></span><br><span class="line"><span class="comment">###   @16=''</span></span><br><span class="line"><span class="comment">###   @17=''</span></span><br><span class="line"><span class="comment">###   @18=''</span></span><br><span class="line"><span class="comment">###   @19='ç®¡ç†å‘˜'</span></span><br><span class="line"><span class="comment">###   @20='2018-08-31 18:03:59'</span></span><br><span class="line"><span class="comment">###   @21='ç®¡ç†å‘˜'</span></span><br><span class="line"><span class="comment">###   @22='2019-11-06 21:53:01'</span></span><br><span class="line"><span class="comment">###   @23=0</span></span><br><span class="line"><span class="comment">###   @24=0</span></span><br><span class="line"><span class="comment">###   @25='1'</span></span><br><span class="line"><span class="comment">###   @26='00'</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· å·¥å…· Â· mysqlbinlog</title>
    <url>/blog/2019/11/07/mysql-tool-mysqlbinlog/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><a href="https://dev.mysql.com/doc/refman/8.0/en/mysqlbinlog.html?spm=a2c4g.11186623.2.15.42ff3393kYTtDN" target="_blank" rel="noopener">mysqlbinlog</a></p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ mysqlbinlog -vv --base64-output=decode-rows mysql-bin.xxx | head -<span class="number">1000</span> | more</span><br><span class="line"></span><br><span class="line">--vv                          <span class="comment"># å°†äºŒè¿›åˆ¶è½¬æ¢ä¸ºå¯é˜…è¯»æ–‡æœ¬</span></span><br><span class="line">--base64-output=decode-rows   <span class="comment"># è§£æbinlogä¸ºsql</span></span><br><span class="line">--start-position              <span class="comment"># èµ·å§‹ä½ç½®</span></span><br><span class="line">--stop-position               <span class="comment"># ç»“æŸä½ç½®</span></span><br><span class="line">--start-datetime              <span class="comment"># èµ·å§‹æ—¶é—´</span></span><br><span class="line">--stop-datetime               <span class="comment"># ç»“æŸæ—¶é—´</span></span><br><span class="line">--no-defaults                 <span class="comment"># è§£å†³æŠ¥é”™ï¼šunknown variable 'default-character-set=utf8'</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· æ¡ˆä¾‹åˆ†æ Â· è¿æ¥çŠ¶æ€ init</title>
    <url>/blog/2019/11/07/mysql-case-state-init/</url>
    <content><![CDATA[<h2 id="é—®é¢˜ç°è±¡"><a href="#é—®é¢˜ç°è±¡" class="headerlink" title="é—®é¢˜ç°è±¡"></a>é—®é¢˜ç°è±¡</h2><p><strong>HDM ç›‘æ§å‘Šè­¦</strong></p>
<blockquote>
<p>æ‚¨çš„è‡ªå»ºDBå®ä¾‹</p>
<p>cosmo-aps|cosmo-aps-t@10.138.232.84:3306 ( åˆ«å: COSMOAPS_S, é›†ç¾¤: æ™ºèƒ½åˆ¶é€  )</p>
<p>MySQLæ´»è·ƒä¼šè¯æ•°è¾¾åˆ°551</p>
</blockquote>
<p>æŸ¥çœ‹å½“å‰ä¼šè¯æƒ…å†µï¼Œå‘ç°å‡ºç°å¤§é‡çš„ State is init.</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">+--------+-------------+---------------------+--------------------+---------+---------+----------------------------------------+------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Id     | User        | Host                | db                 | Command | Time    | State                                  | Info                                                                                                 |</span><br><span class="line">+--------+-------------+---------------------+--------------------+---------+---------+----------------------------------------+------------------------------------------------------------------------------------------------------+</span><br><span class="line">|     <span class="number">34</span> | system user |                     | NULL               | Connect | <span class="number">4814602</span> | Queueing master event to the relay log | NULL                                                                                                 |</span><br><span class="line">| <span class="number">312112</span> | sre         | <span class="number">10.138</span>.<span class="number">232.84</span>:<span class="number">39700</span> | information_schema | Query   |   <span class="number">36129</span> | checking query cache <span class="keyword">for</span> query         | /* rds internal mark */ /* hdm internal mark */ /* rds internal mark */ /* hdm internal mark */ SHOW |</span><br><span class="line">| <span class="number">312113</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43690</span>     | NULL               | Query   |   <span class="number">36131</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312117</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43698</span>     | NULL               | Query   |   <span class="number">36071</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312120</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43704</span>     | NULL               | Query   |   <span class="number">36011</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312123</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43710</span>     | NULL               | Query   |   <span class="number">35951</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312126</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43716</span>     | NULL               | Query   |   <span class="number">35891</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312128</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43720</span>     | NULL               | Query   |   <span class="number">35831</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312131</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43726</span>     | NULL               | Query   |   <span class="number">35771</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312135</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43734</span>     | NULL               | Query   |   <span class="number">35711</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312138</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43740</span>     | NULL               | Query   |   <span class="number">35651</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312141</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43746</span>     | NULL               | Query   |   <span class="number">35591</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312143</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43750</span>     | NULL               | Query   |   <span class="number">35531</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312146</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43756</span>     | NULL               | Query   |   <span class="number">35471</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312149</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43762</span>     | NULL               | Query   |   <span class="number">35411</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312152</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43768</span>     | NULL               | Query   |   <span class="number">35351</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312155</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43774</span>     | NULL               | Query   |   <span class="number">35291</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312157</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43778</span>     | NULL               | Query   |   <span class="number">35231</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312160</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43784</span>     | NULL               | Query   |   <span class="number">35171</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312164</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43792</span>     | NULL               | Query   |   <span class="number">35111</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312167</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43798</span>     | NULL               | Query   |   <span class="number">35051</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312170</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43804</span>     | NULL               | Query   |   <span class="number">34991</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312172</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43808</span>     | NULL               | Query   |   <span class="number">34931</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312175</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43814</span>     | NULL               | Query   |   <span class="number">34871</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312178</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43820</span>     | NULL               | Query   |   <span class="number">34811</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312181</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43826</span>     | NULL               | Query   |   <span class="number">34751</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312184</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43832</span>     | NULL               | Query   |   <span class="number">34691</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312186</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43836</span>     | NULL               | Query   |   <span class="number">34631</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312189</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43842</span>     | NULL               | Query   |   <span class="number">34571</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312193</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43850</span>     | NULL               | Query   |   <span class="number">34511</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312196</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43856</span>     | NULL               | Query   |   <span class="number">34451</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312199</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43862</span>     | NULL               | Query   |   <span class="number">34391</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312201</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43866</span>     | NULL               | Query   |   <span class="number">34331</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312204</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43872</span>     | NULL               | Query   |   <span class="number">34271</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312207</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43878</span>     | NULL               | Query   |   <span class="number">34211</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312210</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43884</span>     | NULL               | Query   |   <span class="number">34151</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312213</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43890</span>     | NULL               | Query   |   <span class="number">34091</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312215</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43894</span>     | NULL               | Query   |   <span class="number">34031</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312218</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43900</span>     | NULL               | Query   |   <span class="number">33971</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312222</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43908</span>     | NULL               | Query   |   <span class="number">33911</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312225</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43914</span>     | NULL               | Query   |   <span class="number">33851</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312228</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43920</span>     | NULL               | Query   |   <span class="number">33791</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312230</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43924</span>     | NULL               | Query   |   <span class="number">33731</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312233</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43930</span>     | NULL               | Query   |   <span class="number">33671</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312236</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43936</span>     | NULL               | Query   |   <span class="number">33611</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312238</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43940</span>     | NULL               | Query   |   <span class="number">33551</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312241</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43946</span>     | NULL               | Query   |   <span class="number">33491</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">312244</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">43952</span>     | NULL               | Query   |   <span class="number">33431</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">313865</span> | prom        | <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">47194</span>     | NULL               | Query   |      <span class="number">11</span> | init                                   | SHOW SLAVE STATUS                                                                                    |</span><br><span class="line">| <span class="number">313866</span> | sre         | localhost           | NULL               | Query   |       <span class="number">0</span> | init                                   | show processlist                                                                                     </span><br><span class="line">+--------+-------------+---------------------+--------------------+---------+---------+----------------------------------------+------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<h2 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h2><p>ä»é”™è¯¯æ—¥å¿—å‘ç°ï¼Œ<code>2019-11-06 22:53:40</code> å¼€å§‹æé†’ç£ç›˜ç©ºé—´ä¸è¶³</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">06</span> <span class="number">22</span>:<span class="number">53</span>:<span class="number">40</span> <span class="number">5752</span> [Warning] Disk is full writing <span class="string">'./relay-log.002275'</span> (Errcode: <span class="number">28</span> - No space left on device). Waiting <span class="keyword">for</span> someone to free space...</span><br><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">06</span> <span class="number">22</span>:<span class="number">53</span>:<span class="number">40</span> <span class="number">5752</span> [Warning] Retry <span class="keyword">in</span> <span class="number">60</span> secs. Message reprinted <span class="keyword">in</span> <span class="number">600</span> secs</span><br><span class="line"><span class="number">2019</span>-<span class="number">11</span>-<span class="number">06</span> <span class="number">22</span>:<span class="number">53</span>:<span class="number">42</span> <span class="number">5752</span> [ERROR] Slave SQL: Could not execute Update_rows event on table cosmo-aps.bns_aps_versiontolineinfo; Error writing file <span class="string">'/data/mysql/tmp/MLpTCcJu'</span> (Errcode: <span class="number">28</span> - No space left on device), Error_code: <span class="number">3</span>; Error writing file <span class="string">'mysql-bin'</span> (errno: <span class="number">28</span> - No space left on device), Error_code: <span class="number">1026</span>; handler error HA_ERR_RBR_LOGGING_FAILED; the event<span class="string">'s master log mysql-bin.000528, end_log_pos 674303230, Error_code: 3</span></span><br><span class="line"><span class="string">2019-11-06 22:53:42 5752 [Warning] Slave: Error writing file '</span>/<span class="keyword">data</span>/mysql/tmp/MLpTCcJu<span class="string">' (Errcode: 28 - No space left on device) Error_code: 3</span></span><br><span class="line"><span class="string">2019-11-06 22:53:42 5752 [Warning] Slave: Error writing file '</span>mysql-bin<span class="string">' (errno: 28 - No space left on device) Error_code: 1026</span></span><br><span class="line"><span class="string">2019-11-06 22:53:42 5752 [ERROR] Error running query, slave SQL thread aborted. Fix the problem, and restart the slave SQL thread with "SLAVE START". We stopped at log '</span>mysql-bin.<span class="number">000528</span><span class="string">' position 661219322</span></span><br><span class="line"><span class="string">2019-11-06 22:54:40 5752 [Warning] Disk is full writing '</span>./relay-log.<span class="number">002275</span><span class="string">' (Errcode: 28 - No space left on device). Waiting for someone to free space...</span></span><br></pre></td></tr></table></figure>

<p>æ£€æŸ¥ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µï¼Œå‘ç° <code>/data</code> ç›®å½•å·²å æ»¡</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[root@cosmoim-db04 log]<span class="comment"># df -h</span></span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos-root  <span class="number">100</span>G  <span class="number">7.1</span>G   <span class="number">93</span>G   <span class="number">8</span>% /</span><br><span class="line">devtmpfs                  <span class="number">63</span>G     <span class="number">0</span>   <span class="number">63</span>G   <span class="number">0</span>% /dev</span><br><span class="line">tmpfs                     <span class="number">63</span>G     <span class="number">0</span>   <span class="number">63</span>G   <span class="number">0</span>% /dev/shm</span><br><span class="line">tmpfs                     <span class="number">63</span>G  <span class="number">826</span>M   <span class="number">63</span>G   <span class="number">2</span>% /run</span><br><span class="line">tmpfs                     <span class="number">63</span>G     <span class="number">0</span>   <span class="number">63</span>G   <span class="number">0</span>% /sys/fs/cgroup</span><br><span class="line">/dev/sda1                <span class="number">497</span>M  <span class="number">172</span>M  <span class="number">326</span>M  <span class="number">35</span>% /boot</span><br><span class="line">/dev/mapper/centos-data  <span class="number">888</span>G  <span class="number">888</span>G   <span class="number">20</span>K <span class="number">100</span>% /<span class="keyword">data</span></span><br><span class="line">tmpfs                     <span class="number">13</span>G   <span class="number">12</span>K   <span class="number">13</span>G   <span class="number">1</span>% /run/user/<span class="number">42</span></span><br><span class="line">tmpfs                     <span class="number">13</span>G     <span class="number">0</span>   <span class="number">13</span>G   <span class="number">0</span>% /run/user/<span class="number">1002</span></span><br><span class="line">tmpfs                     <span class="number">13</span>G     <span class="number">0</span>   <span class="number">13</span>G   <span class="number">0</span>% /run/user/<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p><code>/data</code> ç›®å½•ä¸‹ç£ç›˜å æ»¡çš„ä¸»è¦åŸå›  <code>Nov  6 14:44</code> å‡ºç°ä¸»ä»å¤åˆ¶ä¸­æ–­å¯¼è‡´ <code>relay-log</code> ç–¯ç‹‚å¢é•¿</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[root@cosmoim-db04 data]<span class="comment"># ll -h</span></span><br><span class="line">total <span class="number">798</span>G</span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql    <span class="number">56</span> Sep <span class="number">12</span> <span class="number">15</span>:<span class="number">27</span> auto.cnf</span><br><span class="line">drwxr-x--- <span class="number">2</span> mysql mysql  <span class="number">8.0</span>K Oct <span class="number">31</span> <span class="number">18</span>:<span class="number">48</span> cosmo@<span class="number">002</span>daps</span><br><span class="line">drwxr-x--- <span class="number">2</span> mysql mysql  <span class="number">8.0</span>K Oct <span class="number">21</span> <span class="number">20</span>:<span class="number">27</span> cosmo@<span class="number">002</span>daps@<span class="number">002</span>dt</span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql   <span class="number">10</span>G Nov  <span class="number">6</span> <span class="number">22</span>:<span class="number">53</span> ibdata1</span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql   <span class="number">10</span>G Sep <span class="number">12</span> <span class="number">14</span>:<span class="number">13</span> ibdata2</span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql  <span class="number">512</span>M Nov  <span class="number">6</span> <span class="number">22</span>:<span class="number">53</span> ib_logfile0</span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql  <span class="number">512</span>M Oct <span class="number">28</span> <span class="number">15</span>:<span class="number">47</span> ib_logfile1</span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql  <span class="number">512</span>M Nov  <span class="number">6</span> <span class="number">22</span>:<span class="number">53</span> ib_logfile2</span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql   <span class="number">12</span>M Sep <span class="number">12</span> <span class="number">14</span>:<span class="number">13</span> ibtmp1</span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql   <span class="number">139</span> Nov  <span class="number">7</span> <span class="number">09</span>:<span class="number">23</span> master.info</span><br><span class="line">drwxr-x--- <span class="number">2</span> mysql mysql  <span class="number">4.0</span>K Sep <span class="number">12</span> <span class="number">14</span>:<span class="number">13</span> mysql</span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">1.1</span>G Oct <span class="number">28</span> <span class="number">14</span>:<span class="number">44</span> mysql-bin.<span class="number">000002</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">895</span>M Nov  <span class="number">6</span> <span class="number">22</span>:<span class="number">27</span> mysql-bin.<span class="number">000003</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql    <span class="number">38</span> Oct <span class="number">28</span> <span class="number">14</span>:<span class="number">44</span> mysql-bin.index</span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql     <span class="number">5</span> Sep <span class="number">12</span> <span class="number">15</span>:<span class="number">27</span> mysql.pid</span><br><span class="line">drwxr-x--- <span class="number">2</span> mysql mysql  <span class="number">4.0</span>K Sep <span class="number">12</span> <span class="number">14</span>:<span class="number">13</span> performance_schema</span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql   <span class="number">214</span> Oct <span class="number">28</span> <span class="number">15</span>:<span class="number">23</span> relay-log.<span class="number">000009</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">1.1</span>G Nov  <span class="number">6</span> <span class="number">14</span>:<span class="number">44</span> relay-log.<span class="number">000010</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">4.4</span>M Nov  <span class="number">6</span> <span class="number">14</span>:<span class="number">44</span> relay-log.<span class="number">000011</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql   <span class="number">214</span> Nov  <span class="number">6</span> <span class="number">14</span>:<span class="number">44</span> relay-log.<span class="number">000012</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">1.1</span>G Nov  <span class="number">6</span> <span class="number">14</span>:<span class="number">45</span> relay-log.<span class="number">000013</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql   <span class="number">17</span>M Nov  <span class="number">6</span> <span class="number">14</span>:<span class="number">45</span> relay-log.<span class="number">000014</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql   <span class="number">214</span> Nov  <span class="number">6</span> <span class="number">14</span>:<span class="number">45</span> relay-log.<span class="number">000015</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">1.1</span>G Nov  <span class="number">6</span> <span class="number">14</span>:<span class="number">45</span> relay-log.<span class="number">000016</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql   <span class="number">17</span>M Nov  <span class="number">6</span> <span class="number">14</span>:<span class="number">45</span> relay-log.<span class="number">000017</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql   <span class="number">214</span> Nov  <span class="number">6</span> <span class="number">14</span>:<span class="number">45</span> relay-log.<span class="number">000018</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql  <span class="number">1.1</span>G Nov  <span class="number">6</span> <span class="number">14</span>:<span class="number">46</span> relay-log.<span class="number">000019</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql   <span class="number">17</span>M Nov  <span class="number">6</span> <span class="number">14</span>:<span class="number">46</span> relay-log.<span class="number">000020</span></span><br><span class="line">-rw-rw---- <span class="number">1</span> mysql mysql   <span class="number">214</span> Nov  <span class="number">6</span> <span class="number">14</span>:<span class="number">46</span> relay-log.<span class="number">000021</span></span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<p>é‡Šæ”¾éƒ¨åˆ†ç£ç›˜ç©ºé—´åï¼Œè¿æ¥ä¼šè¯æ¢å¤æ­£å¸¸</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mysql&gt; show processlist;</span><br><span class="line">+--------+-------------+---------------------+--------------------+---------+---------+----------------------------------+------------------+</span><br><span class="line">| Id     | User        | Host                | db                 | Command | Time    | State                            | Info             |</span><br><span class="line">+--------+-------------+---------------------+--------------------+---------+---------+----------------------------------+------------------+</span><br><span class="line">|     <span class="number">34</span> | system user |                     | NULL               | Connect | <span class="number">4816502</span> | Waiting <span class="keyword">for</span> master to send event | NULL             |</span><br><span class="line">| <span class="number">313974</span> | sre         | <span class="number">10.138</span>.<span class="number">232.84</span>:<span class="number">43874</span> | information_schema | Sleep   |       <span class="number">7</span> |                                  | NULL             |</span><br><span class="line">| <span class="number">313976</span> | sre         | localhost           | NULL               | Query   |       <span class="number">0</span> | init                             | show processlist |</span><br><span class="line">+--------+-------------+---------------------+--------------------+---------+---------+----------------------------------+------------------+</span><br><span class="line"><span class="number">3</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>å·¥å…·</title>
    <url>/blog/2019/11/06/tools/</url>
    <content><![CDATA[<h2 id="htop"><a href="#htop" class="headerlink" title="htop"></a>htop</h2><p><strong>ç®€ä»‹</strong>ï¼š<a href="https://www.runoob.com/linux/linux-comm-top.html" target="_blank" rel="noopener"><strong>top</strong></a> æ˜¯ <code>Linux</code> ä¸‹å¸¸ç”¨çš„ç›‘æ§ç¨‹åºï¼Œ<a href="https://github.com/hishamhm/htop" target="_blank" rel="noopener"><strong>htop</strong></a> ç›¸å½“äºå…¶åŠ å¼ºç‰ˆï¼Œé¢œè‰²æ˜¾ç¤ºä¸åŒå‚æ•°ï¼Œä¸”æ”¯æŒé¼ æ ‡æ“ä½œï¼Œæ›´åŠ ç®€å•å’Œäººæ€§åŒ–ã€‚</p>
<p><strong>å®‰è£…</strong>ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ git clone https://github.com/hishamhm/htop.git</span><br><span class="line">$ ./autogen.sh &amp;&amp; ./configure &amp;&amp; make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨</strong>ï¼š</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-065843.png" alt></p>
<h2 id="mycli"><a href="#mycli" class="headerlink" title="mycli"></a>mycli</h2><p><strong>ç®€ä»‹</strong>ï¼š<a href="https://www.mycli.net/" target="_blank" rel="noopener"><strong>mycli</strong></a> æ˜¯ç”¨äº <code>MySQL</code>ã€<code>MariaDB</code> å’Œ <code>Percona</code> çš„å‘½ä»¤è¡Œç•Œé¢ï¼Œå…·æœ‰<strong>è‡ªåŠ¨è¡¥å…¨</strong>å’Œ<strong>è¯­æ³•é«˜äº®</strong>åŠŸèƒ½ã€‚</p>
<p><strong>å®‰è£…</strong>ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ yum install python-pip</span><br><span class="line">$ pip install mycli</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨</strong>ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ mycli --help</span><br><span class="line">Usage: mycli [OPTIONS] [DATABASE]</span><br><span class="line"></span><br><span class="line">  A MySQL terminal client with auto-completion and syntax highlighting.</span><br><span class="line"></span><br><span class="line">  Examples:</span><br><span class="line">    - mycli my_database</span><br><span class="line">    - mycli -u my_user -h my_host.com my_database</span><br><span class="line">    - mycli mysql://my_user@my_host.com:<span class="number">3306</span>/my_database</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -h, --host TEXT               Host address of the database.</span><br><span class="line">  -P, --port INTEGER            Port number to use <span class="keyword">for</span> connection. Honors</span><br><span class="line">                                <span class="variable">$MYSQL_TCP_PORT</span>.</span><br><span class="line">  -u, --user TEXT               User name to connect to the database.</span><br><span class="line">  -S, --socket TEXT             The socket file to use <span class="keyword">for</span> connection.</span><br><span class="line">  -p, --password TEXT           Password to connect to the database.</span><br><span class="line">  --pass TEXT                   Password to connect to the database.</span><br><span class="line">  --ssl-ca PATH                 CA file <span class="keyword">in</span> PEM format.</span><br><span class="line">  --ssl-capath TEXT             CA directory.</span><br><span class="line">  --ssl-cert PATH               X509 cert <span class="keyword">in</span> PEM format.</span><br><span class="line">  --ssl-key PATH                X509 key <span class="keyword">in</span> PEM format.</span><br><span class="line">  --ssl-cipher TEXT             SSL cipher to use.</span><br><span class="line">  --ssl-verify-server-cert      Verify server<span class="string">'s "Common Name" in its cert</span></span><br><span class="line"><span class="string">                                against hostname used when connecting. This</span></span><br><span class="line"><span class="string">                                option is disabled by default.</span></span><br><span class="line"><span class="string">  -V, --version                 Output mycli'</span>s version.</span><br><span class="line">  -v, --verbose                 Verbose output.</span><br><span class="line">  -D, --database TEXT           Database to use.</span><br><span class="line">  -d, --dsn TEXT                Use DSN configured into the [alias_dsn]</span><br><span class="line">                                section of myclirc file.</span><br><span class="line">  --list-dsn                    list of DSN configured into the [alias_dsn]</span><br><span class="line">                                section of myclirc file.</span><br><span class="line">  -R, --prompt TEXT             Prompt format (Default: <span class="string">"\t \u@\h:\d&gt; "</span>).</span><br><span class="line">  -l, --logfile FILENAME        Log every query and its results to a file.</span><br><span class="line">  --defaults-group-suffix TEXT  Read MySQL config groups with the specified</span><br><span class="line">                                suffix.</span><br><span class="line">  --defaults-file PATH          Only read MySQL options from the given file.</span><br><span class="line">  --myclirc PATH                Location of myclirc file.</span><br><span class="line">  --auto-vertical-output        Automatically <span class="keyword">switch</span> to vertical output mode</span><br><span class="line">                                <span class="keyword">if</span> the result is wider than the terminal</span><br><span class="line">                                width.</span><br><span class="line">  -t, --table                   Display batch output <span class="keyword">in</span> table format.</span><br><span class="line">  --csv                         Display batch output <span class="keyword">in</span> CSV format.</span><br><span class="line">  --warn / --no-warn            Warn before running a destructive query.</span><br><span class="line">  --local-infile BOOLEAN        Enable/disable LOAD <span class="keyword">DATA</span> LOCAL INFILE.</span><br><span class="line">  --login-path TEXT             Read this path from the login file.</span><br><span class="line">  -e, --execute TEXT            Execute command and quit.</span><br><span class="line">  --help                        Show this message and exit.</span><br></pre></td></tr></table></figure>

<h2 id="shortcut"><a href="#shortcut" class="headerlink" title="shortcut"></a>shortcut</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¿«æ·é”®</span></span><br><span class="line">å‘ä¸‹ç¿»é¡µï¼šCtrl + f</span><br><span class="line">å‘ä¸Šç¿»é¡µï¼šCtrl + b</span><br><span class="line">ç£ç›˜æ–‡ä»¶æ’åºï¼šdu -h * | sort -n</span><br><span class="line">åˆ é™¤å•è¡Œï¼šdd</span><br></pre></td></tr></table></figure>

<h2 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h2><p><strong>ç®€ä»‹</strong>ï¼šç”¨æ¥å®šæœŸæ‰§è¡Œç¨‹åºçš„å‘½ä»¤ã€‚</p>
<p><strong>ä½¿ç”¨</strong>ï¼š<a href="https://tool.lu/crontab/" target="_blank" rel="noopener">åœ¨çº¿å·¥å…·</a></p>
<h2 id="typora"><a href="#typora" class="headerlink" title="typora"></a>typora</h2><p><strong>ç®€ä»‹</strong>ï¼š<code>Markdown</code> æ˜¯ä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€ï¼Œäººä»¬ä½¿ç”¨æ˜“è¯»æ˜“å†™çš„çº¯æ–‡æœ¬æ ¼å¼ç¼–å†™æ–‡æ¡£ï¼Œç„¶åè½¬æ¢æˆæœ‰æ•ˆçš„ <code>html</code> æ–‡æ¡£ï¼Œ<code>Typora</code> å¯¹ <code>Markdown</code> çš„å®Œç¾æ”¯æŒã€ä¸°å¯Œçš„ä¸»é¢˜ã€é«˜æ•ˆçš„å¿«æ·é”®æ“ä½œï¼Œæ— ä¸€ä¸ä»¤äººçˆ±ä¸é‡Šæ‰‹ã€‚</p>
<p><strong>å®‰è£…</strong>ï¼š<a href="https://www.typora.io/#download" target="_blank" rel="noopener">ä¸‹è½½</a></p>
<p><strong>ä½¿ç”¨</strong>ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">åŠ ç²—ï¼š Ctrl/Cmd + B</span><br><span class="line">æ ‡é¢˜ï¼š Ctrl/Cmd + H</span><br><span class="line">æ’å…¥é“¾æ¥ï¼š Ctrl/Cmd + K</span><br><span class="line">æ’å…¥ä»£ç ï¼š Ctrl/Cmd + Shift + C</span><br><span class="line">è¡Œå†…ä»£ç ï¼š Ctrl/Cmd + Shift + K</span><br><span class="line">æ’å…¥å›¾ç‰‡ï¼š Ctrl/Cmd + Shift + I</span><br><span class="line">æ— åºåˆ—è¡¨ï¼š Ctrl/Cmd + Shift + L</span><br><span class="line">æ’¤é”€ï¼š Ctrl/Cmd + Z</span><br><span class="line">ä¸€çº§æ ‡é¢˜ï¼šCrtl + <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="zentao"><a href="#zentao" class="headerlink" title="zentao"></a>zentao</h2><p><strong>ç®€ä»‹</strong>ï¼š<a href="https://www.zentao.net/" target="_blank" rel="noopener">ç¦…é“</a>ï¼Œå›½äº§çš„å¼€æºé¡¹ç›®ç®¡ç†è½¯ä»¶ï¼Œä¸“æ³¨ç ”å‘é¡¹ç›®ç®¡ç†ï¼Œå†…ç½®éœ€æ±‚ç®¡ç†ã€ä»»åŠ¡ç®¡ç†ã€<code>bug</code> ç®¡ç†ã€ç¼ºé™·ç®¡ç†ã€ç”¨ä¾‹ç®¡ç†ã€è®¡åˆ’å‘å¸ƒç­‰åŠŸèƒ½ï¼Œå®ç°äº†è½¯ä»¶çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p>
<p><strong>ä½¿ç”¨</strong>ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line">$ wget http://dl.cnezsoft.com/zentao/<span class="number">11.5</span>.<span class="number">1</span>/ZenTaoPMS.<span class="number">11.5</span>.<span class="number">1</span>.zbox_64.tar.gz</span><br><span class="line">$ tar -zxvf ZenTaoPMS.<span class="number">11.5</span>.<span class="number">1</span>.zbox_64.tar.gz -C /opt</span><br><span class="line">$ /opt/zbox/zbox start</span><br><span class="line">$ /opt/zbox/zbox -ap <span class="number">8080</span> -mp <span class="number">3307</span> ï¼ˆ-apï¼šä¿®æ”¹Apacheç«¯å£ï¼Œ-mpï¼šä¿®æ”¹MySQLç«¯å£ï¼‰</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åœhttpd</span></span><br><span class="line">./httpd -k start</span><br><span class="line">./httpd -k stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ°å€</span></span><br><span class="line">http://<span class="number">10.133</span>.<span class="number">0.53</span>:<span class="number">8080</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment"># è´¦å·</span></span><br><span class="line">admin/Haier@<span class="number">123</span></span><br></pre></td></tr></table></figure>

<h2 id="mindoc"><a href="#mindoc" class="headerlink" title="mindoc"></a>mindoc</h2><p><a href="https://www.iminho.me/" target="_blank" rel="noopener">å®˜æ–¹ç½‘ç«™</a> | <a href="https://github.com/lifei6671/mindoc" target="_blank" rel="noopener">é¡¹ç›®åœ°å€</a> | <a href="https://www.xiaoz.me/archives/10007" target="_blank" rel="noopener">å®‰è£…å‚è€ƒ</a></p>
]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· è¿æ¥ä¸è¿æ¥æ•°</title>
    <url>/blog/2019/11/06/mysql-connection/</url>
    <content><![CDATA[<h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><ul>
<li><strong>TCP/IP æ–¹å¼</strong></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨åœºæ™¯ï¼šmysqlå®¢æˆ·ç«¯åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œmysqlå®ä¾‹åœ¨å¦å¤–ä¸€å°æœåŠ¡å™¨ä¸Š</span></span><br><span class="line">mysql [options] [database]</span><br><span class="line">$ mysql -h IP -u username -p password -P port</span><br><span class="line"></span><br><span class="line">[options]</span><br><span class="line">-u, --user=name          <span class="comment"># æŒ‡å®šç”¨æˆ·å</span></span><br><span class="line">-p, --password[=name]    <span class="comment"># æŒ‡å®šå¯†ç   </span></span><br><span class="line">-h, --host=name          <span class="comment"># æŒ‡å®šæœåŠ¡å™¨IP  </span></span><br><span class="line">-P, --port=<span class="comment">#             # æŒ‡å®šè¿æ¥ç«¯å£</span></span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">user=<span class="string">'xx'</span></span><br><span class="line">password=<span class="string">'xx'</span></span><br><span class="line">port = <span class="number">3306</span></span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line">default-character-set = utf8mb4</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Socket æ–¹å¼</strong></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨åœºæ™¯ï¼šmysqlå®¢æˆ·ç«¯å’Œå®ä¾‹åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Š</span></span><br><span class="line">$ mysql -S /<span class="keyword">data</span>/mysql/mysql.sock -u username -p password</span><br></pre></td></tr></table></figure>

<p><strong>Windows å®¢æˆ·ç«¯å·¥å…·</strong>ï¼š<a href="https://www.navicat.com.cn/products/navicat-for-mysql" target="_blank" rel="noopener">Navicate</a>ã€<a href="https://www.webyog.com/product/sqlyog" target="_blank" rel="noopener">SQLyog</a>ã€<a href="https://www.heidisql.com/" target="_blank" rel="noopener">HeidiSQL</a>ã€<a href="https://www.phpmyadmin.net/" target="_blank" rel="noopener">phpMyAdmin</a>ã€<a href="https://dev.mysql.com/downloads/workbench/" target="_blank" rel="noopener">MySQL Workbench</a> ç­‰ã€‚</p>
<p><strong>Mac å®¢æˆ·ç«¯å·¥å…·</strong>ï¼š<a href="http://www.sequelpro.com" target="_blank" rel="noopener">Selquel Pro</a>ã€<a href="https://dev.mysql.com/downloads/workbench/" target="_blank" rel="noopener">MySQL Workbench</a> ç­‰ã€‚</p>
<h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ•°æ®åº“æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">mysql&gt; show variables like â€˜%max_connections%â€™;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å·²ä½¿ç”¨æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">mysql&gt; show global status like â€˜Max_used_connectionsâ€™;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“å‰è¿æ¥çº¿ç¨‹æ•°</span></span><br><span class="line">mysql&gt; show status like â€˜Threads%â€™;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“å‰è¿æ¥è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">mysql&gt; show full processlist;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· æœ€ä½³å®è·µ Â· å¿«é€Ÿæ€æ‰å¤§é‡ä¼šè¯è¿æ¥</title>
    <url>/blog/2019/11/06/mysql-kill-processlist/</url>
    <content><![CDATA[<h2 id="kill-sh"><a href="#kill-sh" class="headerlink" title="kill.sh"></a>kill.sh</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#############################################################################</span></span><br><span class="line"><span class="comment"># Kill all processlist According to status.</span></span><br><span class="line"><span class="comment"># -h: ä¸»æœºIP</span></span><br><span class="line"><span class="comment"># -u: ç”¨æˆ·å</span></span><br><span class="line"><span class="comment"># -p: å¯†ç </span></span><br><span class="line"><span class="comment">#############################################################################</span></span><br><span class="line"></span><br><span class="line">host = <span class="string">''</span></span><br><span class="line">user = <span class="string">''</span></span><br><span class="line">pwd  = <span class="string">''</span></span><br><span class="line">status = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> :</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  n=`mysqladmin processlist -h<span class="variable">$host</span> -u<span class="variable">$user</span> -p<span class="variable">$pwd</span> | grep -i <span class="variable">$status</span> | wc -l`</span><br><span class="line">  date=`date +%Y%m%d\[%H:%M:%S]`</span><br><span class="line">  echo <span class="variable">$n</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$n</span>"</span> <span class="nomarkup">-gt</span> <span class="number">10</span> ]</span><br><span class="line">  then</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> `mysqladmin processlist -h<span class="variable">$host</span> -u<span class="variable">$user</span> -p<span class="variable">$pwd</span> | grep -i <span class="variable">$status</span> | awk <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  	mysqladmin processlist -h<span class="variable">$host</span> -u<span class="variable">$user</span> -p<span class="variable">$pwd</span> kill <span class="variable">$i</span></span><br><span class="line">  done</span><br><span class="line"></span><br><span class="line">  echo <span class="string">"<span class="variable">$status</span> is too many need killed it "</span> &gt;&gt; /tmp/kill.log</span><br><span class="line">  echo <span class="string">"<span class="variable">$date</span> : <span class="variable">$n</span>"</span> &gt;&gt; /tmp/kill.log</span><br><span class="line">  fi</span><br><span class="line">  sleep <span class="number">1</span></span><br><span class="line">done</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· æ¡ˆä¾‹åˆ†æ Â· å¤§é‡è¿æ¥çŠ¶æ€ Writing to net</title>
    <url>/blog/2019/11/05/mysql-case-writing-to-net/</url>
    <content><![CDATA[<h2 id="é—®é¢˜ç°è±¡"><a href="#é—®é¢˜ç°è±¡" class="headerlink" title="é—®é¢˜ç°è±¡"></a>é—®é¢˜ç°è±¡</h2><p><strong>HDM å‘Šè­¦</strong></p>
<blockquote>
<p>æ‚¨çš„è‡ªå»ºDBå®ä¾‹</p>
<p><a href="mailto:dbvipcenter@10.159.36.193" target="_blank" rel="noopener">dbvipcenter@10.159.36.193</a>:3307 ( åˆ«å: HMCENTER_M, é›†ç¾¤: äº’è”äº’é€š )</p>
<p>MySQLæ´»è·ƒä¼šè¯æ•°è¾¾åˆ°131</p>
</blockquote>
<p><code>Show processlist</code> æ£€æŸ¥å®æ—¶ä¼šè¯çŠ¶æ€ï¼Œå‘ç°å‡ºç°å¤§é‡çš„ <code>&quot;Writing to net&quot;</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">| <span class="number">41106</span> | canal  | <span class="number">10.138</span>.<span class="number">225.187</span>:<span class="number">36737</span> | NULL | Binlog Dump | <span class="number">14240</span> | Writing to net              | NULL |    <span class="number">0.000</span> |</span><br><span class="line">| <span class="number">41146</span> | canal  | <span class="number">10.138</span>.<span class="number">225.187</span>:<span class="number">44157</span> | NULL | Binlog Dump | <span class="number">14163</span> | Writing to net              | NULL |    <span class="number">0.000</span> |</span><br><span class="line">| <span class="number">41453</span> | canal  | <span class="number">10.138</span>.<span class="number">225.187</span>:<span class="number">43588</span> | NULL | Binlog Dump | <span class="number">13536</span> | Writing to net              | NULL |    <span class="number">0.000</span> |</span><br><span class="line">| <span class="number">41570</span> | canal  | <span class="number">10.138</span>.<span class="number">225.187</span>:<span class="number">35880</span> | NULL | Binlog Dump | <span class="number">13345</span> | Writing to net              | NULL |    <span class="number">0.000</span> |</span><br><span class="line">| <span class="number">41608</span> | canal  | <span class="number">10.138</span>.<span class="number">225.187</span>:<span class="number">39624</span> | NULL | Binlog Dump | <span class="number">13300</span> | Writing to net              | NULL |    <span class="number">0.000</span> |</span><br><span class="line">| <span class="number">41615</span> | canal  | <span class="number">10.138</span>.<span class="number">225.187</span>:<span class="number">39629</span> | NULL | Binlog Dump | <span class="number">13281</span> | Writing to net              | NULL |    <span class="number">0.000</span> |</span><br><span class="line">| <span class="number">41618</span> | canal  | <span class="number">10.138</span>.<span class="number">225.187</span>:<span class="number">39632</span> | NULL | Binlog Dump | <span class="number">13281</span> | Writing to net              | NULL |    <span class="number">0.000</span> |</span><br><span class="line">| <span class="number">41650</span> | canal  | <span class="number">10.138</span>.<span class="number">225.187</span>:<span class="number">43390</span> | NULL | Binlog Dump | <span class="number">13227</span> | Writing to net              | NULL |    <span class="number">0.000</span> |</span><br><span class="line">| <span class="number">41854</span> | canal  | <span class="number">10.138</span>.<span class="number">225.187</span>:<span class="number">47054</span> | NULL | Binlog Dump | <span class="number">12859</span> | Writing to net              | NULL |    <span class="number">0.000</span> |</span><br><span class="line">| <span class="number">41883</span> | canal  | <span class="number">10.138</span>.<span class="number">225.187</span>:<span class="number">50815</span> | NULL | Binlog Dump | <span class="number">12814</span> | Writing to net              | NULL |    <span class="number">0.000</span> |</span><br><span class="line">| <span class="number">42305</span> | canal  | <span class="number">10.138</span>.<span class="number">225.187</span>:<span class="number">42869</span> | NULL | Binlog Dump | <span class="number">12040</span> | Writing to net              | NULL |    <span class="number">0.000</span> |</span><br><span class="line">| <span class="number">42420</span> | canal  | <span class="number">10.138</span>.<span class="number">225.187</span>:<span class="number">35098</span> | NULL | Binlog Dump | <span class="number">11862</span> | Writing to net              | NULL |    <span class="number">0.000</span> |</span><br><span class="line">| <span class="number">42446</span> | canal  | <span class="number">10.138</span>.<span class="number">225.187</span>:<span class="number">38964</span> | NULL | Binlog Dump | <span class="number">11818</span> | Writing to net              | NULL |    <span class="number">0.000</span> |</span><br></pre></td></tr></table></figure>

<h2 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h2><p>Writing to netï¼šThe server is writing a packet to the network.</p>
<p>SQL è¯­å¥æŸ¥è¯¢æµç¨‹ï¼š</p>
<ul>
<li>æ‰«æä¸€è¡Œå†™åˆ° <code>net_buffer</code>ï¼Œè¿™é‡Œ <code>net_buffer</code> æ˜¯æŒ‰ç…§ <a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_net_buffer_length" target="_blank" rel="noopener">net_buffer_length</a> åˆå§‹åŒ–ï¼Œä½†å¯ä»¥åŠ¨æ€å¢é•¿åˆ° <a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_max_allowed_packet" target="_blank" rel="noopener">max_allowed_packet</a> é…ç½®å€¼</li>
<li>ç»§ç»­è·å–æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œç›´åˆ°å†™æ»¡ <code>net_buffer</code>ï¼Œç„¶åè°ƒç”¨ç½‘ç»œæ¥å£å‘é€å‡ºå»</li>
<li>å®¢æˆ·ç«¯æ¥æ”¶ç½‘ç»œåŒ…å®Œæˆï¼Œæ¸…ç©º <code>net_buffer</code></li>
<li>é‡å¤ä¸Šé¢ 1 åˆ° 3 çš„æ­¥éª¤</li>
<li>å¦‚æœå‘é€æœªå®Œæˆï¼Œè¡¨ç¤º <code>socket send buffer</code> å†™æ»¡ï¼Œè¿™æ—¶ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œæ˜¾ç¤º <code>Writing to net</code>ï¼Œç›´åˆ° <code>socket send buffer</code> é‡æ–°å¯å†™ï¼Œå†ç»§ç»­å‘é€</li>
</ul>
<p>ç”±äº MySQL æ˜¯è¾¹æ‰«æè¾¹å‘é€æ•°æ®çš„ï¼Œå½“å®¢æˆ·ç«¯æ¥æ”¶æ…¢æ—¶ï¼Œå°±ä¼šé˜»å¡æ•´ä¸ªæŸ¥è¯¢è¿›ç¨‹ï¼Œå¯¼è‡´æ‰§è¡Œå˜æ…¢ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show variables like 'net_buffer_length';</span><br><span class="line">+<span class="comment">-------------------+-------+</span></span><br><span class="line">| Variable_name     | Value |</span><br><span class="line">+<span class="comment">-------------------+-------+</span></span><br><span class="line">| net_buffer_length | 16384 |</span><br><span class="line">+<span class="comment">-------------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(<span class="keyword">none</span>)]&gt; <span class="keyword">select</span> @@max_allowed_packet/<span class="number">1024</span>/<span class="number">1024</span>;</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br><span class="line">| @@max_allowed_packet/1024/1024 |</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br><span class="line">| 20.00000000                    |</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.08</span> sec)</span><br></pre></td></tr></table></figure>

<h2 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h2><ul>
<li>è°ƒæ•´ <a href="https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_max_allowed_packet" target="_blank" rel="noopener">max_allowed_packet</a> å‚æ•°</li>
<li>æ’æŸ¥å®¢æˆ·ç«¯å¼‚å¸¸æƒ…å†µ</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; set global max_allowed_packet=67108864;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show global variables like "max_allowed_packet";</span><br><span class="line">+<span class="comment">--------------------+----------+</span></span><br><span class="line">| Variable_name      | Value    |</span><br><span class="line">+<span class="comment">--------------------+----------+</span></span><br><span class="line">| max_allowed_packet | 67108864 |</span><br><span class="line">+<span class="comment">--------------------+----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>é˜¿é‡Œäº‘ Â· HDR</title>
    <url>/blog/2019/11/04/aliyun-hdr/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>å¤‡ä»½åª’ä»‹çš„æŸåã€ç«ç¾ã€è‡ªç„¶ç¾å®³ç­‰æƒ…å†µå¯èƒ½å¯¼è‡´æ•°æ®çš„æ°¸ä¹…ä¸¢å¤±ï¼Œé€ æˆéš¾ä»¥æ‰¿å—çš„æŸå¤±ã€‚</p>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>æ··åˆäº‘å®¹ç¾æœåŠ¡ï¼ˆHybrid Disaster Recoveryï¼Œ ç®€ç§° HDRï¼‰æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ä¸šåŠ¡æŒç»­æ€§è§£å†³æ–¹æ¡ˆï¼Œä¸ºä¼ä¸šå…³é”®ä¸šåŠ¡æä¾›ä½è‡³ç§’çº§ <code>RPO</code>ï¼Œåˆ†é’Ÿçº§ <code>RTO</code> çš„å®¹ç¾æœåŠ¡ï¼Œæå¤§ç¼©çŸ­ä¸šåŠ¡å®•æœºæ—¶é—´ï¼Œå‡å°‘æ•°æ®ä¸¢å¤±ã€‚</p>
<p><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼š</p>
<ul>
<li><strong>åº”ç”¨çº§å®¹ç¾</strong>ï¼šåœ¨æ•°æ®ä¸­å¿ƒæ•…éšœæˆ–é•¿æ—¶é—´ç³»ç»Ÿç»´æŠ¤ä½œä¸šæ—¶ï¼Œåœ¨äº‘ä¸Šå¿«é€Ÿæ¢å¤åº”ç”¨è¿è¡Œï¼Œç¼©çŸ­ä¸šåŠ¡åœæœºæ—¶é—´ï¼Œæå¤§å‡å°‘æŸå¤±ï¼Œä¿éšœä¸šåŠ¡è¿ç»­æ€§ã€‚</li>
<li><strong>æ•°æ®çº§å®¹ç¾</strong>ï¼šåœ¨æ•°æ®ä¸­å¿ƒå¤‡ä»½æ•°æ®åº“ã€è™šæ‹Ÿæœºã€ç‰©ç†æœºæ•´æœºï¼Œå¤‡ä»½æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°å¹¶è‡ªåŠ¨ä¸Šäº‘ï¼Œå¯åœ¨è‡ªå»ºæ•°æ®ä¸­å¿ƒå‘ç”Ÿé‡å¤§ç¾å®³æ—¶ä¿éšœæ•°æ®å®‰å…¨ï¼ŒåŒæ—¶æä¾›é«˜æ•ˆçš„æœ¬åœ°å’Œäº‘ä¸Šçš„åŒé‡æ¢å¤ã€‚</li>
</ul>
<p><strong>ä¸šåŠ¡ç±»å‹</strong>ï¼š</p>
<ul>
<li><strong>CDR</strong>ï¼šContinuous Data Replicationï¼Œè¿ç»­å¤åˆ¶å‹å®¹ç¾ï¼Œè§£å†³ä¼ä¸šå…³é”®åº”ç”¨çš„é«˜æ ‡å‡†å®¹ç¾æ–¹æ¡ˆï¼Œæä¾›<strong>ç§’-åˆ†çº§</strong>çš„ <code>RPO</code> å’Œ <code>RTO</code> å®¹ç¾ã€‚</li>
<li><strong>SDR</strong>ï¼šSnapshot Data Replicationï¼Œå¿«ç…§å‹å®¹ç¾ï¼Œè§£å†³ä¼ä¸šæ ¸å¿ƒåº”ç”¨çš„æ•°æ®çº§å®¹ç¾ï¼Œå¯ä»¥å¯¹æ•°æ®åº“ã€è™šæœºã€æ–‡ä»¶ç­‰å®ç°å¤šç‰ˆæœ¬æœ¬åœ°å¤‡ä»½å’Œè‡ªåŠ¨å¤‡ä»½ä¸Šäº‘ï¼Œè¿˜å¯ä»¥å®ç°åº”ç”¨æœåŠ¡å™¨çš„<strong>å°æ—¶çº§åˆ«</strong> <code>RPO</code>ã€<code>RTO</code> çš„æ•´æœºå®¹ç¾ã€‚</li>
</ul>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>é«˜æ€§èƒ½ï¼šç§’çº§ <code>RPO</code>ï¼Œæ•°æ®å®æ—¶å¤åˆ¶ï¼Œåˆ†é’Ÿçº§ <code>RTO</code>ï¼Œäº‘ä¸Šå¿«é€Ÿæ•´æœºæ‹‰èµ·</li>
<li>ä½æˆæœ¬ï¼šå…æœºæˆ¿å»ºè®¾ï¼Œäº‘ä¸Šåªéœ€è¦æå°‘è®¡ç®—èµ„æºï¼Œä¸»è¦æ¶ˆè€—äº‘ç›˜</li>
<li>å¯éªŒè¯ï¼šä¸€é”®æ¼”ç»ƒï¼Œ<code>10åˆ†é’Ÿ</code> å®ŒæˆéªŒè¯</li>
<li>æ˜“è¿ç»´ï¼šå…¨é“¾è·¯ç›‘æ§ã€æ•…éšœè‡ªåŠ¨å‘Šè­¦</li>
</ul>
<p><strong>åè¯æ¦‚å¿µ</strong>ï¼š</p>
<table>
<thead>
<tr>
<th align="left">æ¦‚å¿µ</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æ•…éšœè½¬ç§»</td>
<td align="left">å³å®¹ç¾æ¢å¤ï¼ŒæŒ‡æ‚¨çš„ IDC åº”ç”¨å‡ºç°æ•…éšœæ—¶ï¼Œåœ¨é˜¿é‡Œäº‘ä¸Šæ¢å¤åº”ç”¨çš„è¿‡ç¨‹</td>
</tr>
<tr>
<td align="left">æ•…éšœæ¢å¤</td>
<td align="left">å½“æ‚¨çš„ IDC å†…çš„ç¯å¢ƒæ¢å¤ä»¥åï¼Œå°†åº”ç”¨æ•°æ®è¿å›è‡ªæœ‰ IDC æ¢å¤åº”ç”¨è¿è¡Œçš„è¿‡ç¨‹</td>
</tr>
<tr>
<td align="left">RPO</td>
<td align="left">Recovery Point Objectiveï¼ˆæ•°æ®æ¢å¤ç‚¹ç›®æ ‡ï¼‰ï¼ŒæŒ‡åº”ç”¨å‘ç”Ÿæ•…éšœæ—¶é¢„æœŸçš„æ•°æ®ä¸¢å¤±é‡</td>
</tr>
<tr>
<td align="left">RTO</td>
<td align="left">Recovery Time Objectiveï¼ˆæ¢å¤æ—¶é—´ç›®æ ‡ï¼‰ï¼ŒæŒ‡æ•…éšœå‘ç”Ÿæ—¶å°†åº”ç”¨æ¢å¤è¿è¡Œæ‰€éœ€è¦çš„æ—¶é—´</td>
</tr>
<tr>
<td align="left">æ··åˆäº‘ç¾å¤‡ä¸€ä½“æœº</td>
<td align="left">é˜¿é‡Œäº‘æ¨å‡ºå…·æœ‰å®¹ç¾å¤‡ä»½åŠŸèƒ½çš„ä¸€ä½“æœºï¼Œé€‚ç”¨äºå¿«ç…§å‹å®¹ç¾ï¼ˆSDRï¼‰ä¸è¿ç»­å¤åˆ¶å‹å®¹ç¾ï¼ˆCDRï¼‰</td>
</tr>
<tr>
<td align="left">å®¹ç¾æ¢å¤ç½‘å…³</td>
<td align="left">é€‚ç”¨äºå¿«ç…§å‹å®¹ç¾ï¼Œæ˜¯åœ¨é˜¿é‡Œäº‘ä¸ŠæŒ‰éœ€éƒ¨ç½²çš„å®¹ç¾æ¢å¤æœåŠ¡å™¨ï¼Œå®ƒå¯ä»¥æ ¹æ®äº‘ä¸Šå®¹ç¾å­˜å‚¨ä¸­çš„å¤‡ä»½æ•°æ®ï¼Œåœ¨ <code>ECS</code> ä¸Šæ¢å¤æ‚¨çš„äº‘ä¸‹æœåŠ¡å™¨æ•´æœºã€æ–‡ä»¶å’Œåº”ç”¨æ•°æ®ã€‚</td>
</tr>
</tbody></table>
<p><a href="http://www.djbh.net/webdev/file/webFiles/File/cpzg/20122616046.pdf?spm=a2c4g.11186623.2.11.6e15f679iwwn7e&file=20122616046.pdf" target="_blank" rel="noopener">GB/T 20988-2007æ ‡å‡†</a>ï¼šæ˜¯ä¸­å›½å›½å®¶æ ‡å‡†åŒ–ç®¡ç†å§”å‘˜ä¼šåˆ¶å®šçš„ä¿¡æ¯ç³»ç»Ÿç¾éš¾æ¢å¤è§„èŒƒå‚è€ƒ</p>
<p><img src="http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/64142/156775175432398_zh-CN.png" alt="img"></p>
<h2 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h2><h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>æ•°æ®ä¿æŠ¤å’Œä¸šåŠ¡è¿ç»­æ€§å¯¹æ•°æ®ä¸­å¿ƒçš„æ„ä¹‰é‡å¤§ï¼Œå…³é”®åº”ç”¨çš„æ•…éšœæˆ–æ•°æ®ä¸¢å¤±ä¼šå¯¹æ‚¨çš„ä¸šåŠ¡é€ æˆé‡å¤§æŸå¤±ã€‚æ··åˆäº‘å®¹ç¾æœåŠ¡æä¾›äº†ä¸‰ä¸ªå±‚æ¬¡çš„èƒ½åŠ›æ¥ä¿æŠ¤æ•°æ®ï¼Œå¹¶ç¡®ä¿ä¸šåŠ¡è¿ç»­æ€§ã€‚</p>
<ul>
<li><p><strong>æœ¬åœ°å¤‡ä»½</strong></p>
<p>æ··åˆäº‘ç¾å¤‡ä¸€ä½“æœºå¯ä»¥æŒ‰ç…§é¢„è®¾ç­–ç•¥å°†æœåŠ¡å™¨æ•´æœºé•œåƒå’Œæ–‡ä»¶å¤‡ä»½è‡³æœ¬åœ°ï¼Œå¹¶åœ¨éœ€è¦æ—¶æ¢å¤è‡³è™šæ‹ŸåŒ–å¹³å°å’Œç‰©ç†å¹³å°ï¼Œç‰©ç†å¹³å°ä»…æ”¯æŒæ–‡ä»¶çº§æ¢å¤ã€‚</p>
</li>
<li><p><strong>å¼‚åœ°å¤‡ä»½</strong></p>
<p>æœåŠ¡å™¨é•œåƒå’Œæ•°æ®å¤‡ä»½åä¼šç›´æ¥ä¸Šä¼ è‡³é˜¿é‡Œäº‘ç¾å¤‡åº“ï¼Œå®ç°é«˜å¯é çš„äº‘ä¸Šå¼‚åœ°å¤‡ä»½ã€‚ç¨³å®šçš„å¼‚åœ°å¤‡ä»½ç¡®ä¿å…³é”®æ•°æ®åœ¨æœ¬åœ°æ•°æ®ä¸­å¿ƒå‘ç”Ÿç«ç¾ç­‰æç«¯æƒ…å†µä¸‹ä¸ä¸¢å¤±ï¼Œåœ¨æœ¬åœ°è®¾æ–½ä¿®å¤åæ¢å¤è‡³æœ¬åœ°ã€‚</p>
</li>
<li><p><strong>äº‘ä¸Šå®¹ç¾</strong></p>
<p>ä¸ºå‡å°‘å› åº”ç”¨æ•…éšœå¯¼è‡´çš„ä¸šåŠ¡æŸå¤±ï¼Œå½“æ•°æ®ä¸­å¿ƒå‡ºç°ä¸¥é‡æ•…éšœæ— æ³•å¿«é€Ÿæ¢å¤æ—¶ï¼Œæ··åˆäº‘å®¹ç¾æœåŠ¡å¯ä»¥é«˜æ•ˆåœ°åœ¨ ECS ä¸Šå¿«é€Ÿæ¢å¤æ‚¨çš„åº”ç”¨ã€‚</p>
</li>
</ul>
<h3 id="é€‰å‹"><a href="#é€‰å‹" class="headerlink" title="é€‰å‹"></a>é€‰å‹</h3><p><img src="https://img.alicdn.com/tfs/TB1H.Kvg29TBuNjy1zbXXXpepXa-1530-1140.png" alt="img"></p>
<h4 id="CDR"><a href="#CDR" class="headerlink" title="CDR"></a>CDR</h4><p><strong>åŸç†</strong>ï¼šåŸºäºç£ç›˜çº§å®æ—¶æ•°æ®å¤åˆ¶æŠ€æœ¯ï¼Œå¯ä»¥æä¾›ç§’çº§-åˆ†é’Ÿçº§çš„ <code>RPO/RTO</code>ã€‚</p>
<p><strong>æ–¹æ¡ˆ</strong>ï¼š</p>
<p><img src="http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/6645052751/p33361.jpg" alt="img"></p>
<p><strong>ç±»å‹</strong>ï¼š</p>
<table>
<thead>
<tr>
<th align="left">å‹å·</th>
<th align="left">æ”¯æŒæœåŠ¡å™¨æ•°é‡</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Apsara DR100</td>
<td align="left">&lt; 20</td>
</tr>
<tr>
<td align="left">Apsara DR200</td>
<td align="left">&lt; 50</td>
</tr>
</tbody></table>
<h4 id="SDR"><a href="#SDR" class="headerlink" title="SDR"></a>SDR</h4><p><strong>åŸç†</strong>ï¼šåŸºäºæ•°æ®å®šæ—¶å¤‡ä»½èƒ½åŠ›ï¼Œæä¾›äº†å°æ—¶çº§-å¤©çº§çš„ <code>RPO/RTO</code>ï¼Œå¹¶ä¸”å¯ä»¥ä¸ä¸šåŠ¡ç½‘ç»œæµé‡é”™å³°ã€‚</p>
<table>
<thead>
<tr>
<th align="left">å‹å·</th>
<th align="left">æ”¯æŒæœåŠ¡å™¨æ•°é‡</th>
<th align="left">æ”¯æŒçš„æºæ•°æ®é‡</th>
<th align="left">å¤‡ä»½æ¢å¤åå</th>
</tr>
</thead>
<tbody><tr>
<td align="left">HDR1000</td>
<td align="left">&lt; 20</td>
<td align="left">&lt; 10 TB</td>
<td align="left">0.5 TB/å°æ—¶</td>
</tr>
<tr>
<td align="left">HDR2000</td>
<td align="left">20~100</td>
<td align="left">20 TB~100 TB</td>
<td align="left">1 TB/å°æ—¶</td>
</tr>
</tbody></table>
<p>å¯¹æ¯”ï¼š</p>
<table>
<thead>
<tr>
<th align="left">æŒ‡æ ‡</th>
<th align="left">CDR</th>
<th align="left">SDR</th>
</tr>
</thead>
<tbody><tr>
<td align="left">RPO</td>
<td align="left">ç§’ - åˆ†é’Ÿçº§</td>
<td align="left">å°æ—¶ - å¤©çº§</td>
</tr>
<tr>
<td align="left">RTO</td>
<td align="left">åˆ†é’Ÿçº§</td>
<td align="left">å°æ—¶çº§</td>
</tr>
<tr>
<td align="left">å¤šæ¢å¤ç‚¹æ—¶é™</td>
<td align="left">30å¤©</td>
<td align="left">ä¸é™æ—¶é•¿</td>
</tr>
<tr>
<td align="left">ç½‘ç»œè¦æ±‚</td>
<td align="left">è¾ƒé«˜</td>
<td align="left">è¾ƒä½</td>
</tr>
<tr>
<td align="left">ç¾å¤‡ä¸€ä½“æœºç¡¬ä»¶</td>
<td align="left">å¯é€‰</td>
<td align="left">å¿…é€‰</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">åœºæ™¯</th>
<th align="left">æ¡ˆä¾‹</th>
<th align="left">CDR</th>
<th align="left">SDR</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å…³é”®åº”ç”¨ç§’çº§ - åˆ†é’Ÿçº§ RPOã€RTO å®¹ç¾</td>
<td align="left">ä¼ä¸šå…³é”®ä¸šåŠ¡å…è®¸ 5 åˆ†é’Ÿ RPOï¼Œå®•æœºåè¦æ±‚ 15 åˆ†é’Ÿå†…åœ¨äº‘ä¸Šæ‹‰èµ·ï¼Œæ¢å¤ä¸šåŠ¡è¿è¡Œã€‚</td>
<td align="left">âˆš</td>
<td align="left">Ã—</td>
</tr>
<tr>
<td align="left">é‡è¦åº”ç”¨å°æ—¶çº§ RPOã€ RTO äº‘å®¹ç¾</td>
<td align="left">ä¼ä¸šå†…é‡è¦åº”ç”¨éœ€è¦å®ç° 24 å°æ—¶ RPOã€6 å°æ—¶ RTO çš„åº”ç”¨çº§å®¹ç¾ã€‚</td>
<td align="left">Ã—</td>
<td align="left">âˆš</td>
</tr>
<tr>
<td align="left">å…³é”®åº”ç”¨æ•°æ®çº§å®¹ç¾ ï¼ˆæœ¬åœ°+äº‘åŒå¤‡ä»½ï¼‰</td>
<td align="left">æœ¬åœ° Oracleã€SQL Server æ•°æ®åº“ï¼Œä»¥åŠä¸€ç³»åˆ—é‡è¦æ–‡ä»¶éœ€è¦å®ç°å¤šç‰ˆæœ¬çš„æœ¬åœ°å¤‡ä»½ï¼ŒåŒæ—¶å¤‡ä»½æ•°æ®ä¸Šäº‘ï¼Œå®ç°æ•°æ®çº§å®¹ç¾ã€‚</td>
<td align="left">Ã—</td>
<td align="left">âˆš</td>
</tr>
<tr>
<td align="left">è·¨åœ°åŸŸå®¹ç¾</td>
<td align="left">å®¹ç¾ç³»ç»Ÿéƒ¨ç½²åœ¨é˜¿é‡Œäº‘çš„ä¸¤ä¸ªåœ°åŸŸä¸­ï¼Œå½“ä¸»ç³»ç»Ÿå‘ç”Ÿæ•…éšœæ—¶ï¼Œä¸šåŠ¡ç³»ç»Ÿåˆ‡æ¢åˆ°å®¹ç¾ç³»ç»Ÿã€‚ä¸»ç³»ç»Ÿå’Œå®¹ç¾ç³»ç»Ÿéƒ¨ç½²åœ¨ä¸åŒçš„åœ°åŸŸï¼Œå¯é æ€§æ›´é«˜ï¼Œæœ‰æ•ˆé¿å…äº†åœ°åŸŸæ€§ç¾å®³å¯¼è‡´çš„ç³»ç»Ÿæ•…éšœã€‚</td>
<td align="left">âˆš</td>
<td align="left">Ã—</td>
</tr>
<tr>
<td align="left">è·¨å¯ç”¨åŒºå®¹ç¾</td>
<td align="left">æ”¯æŒä¸šåŠ¡çš„è·¨å¯ç”¨åŒºï¼ˆZoneï¼‰å®¹ç¾èƒ½åŠ›ï¼Œå¯¹æ•´ä½“çš„åº”ç”¨åšå®¹ç¾å¤‡ä»½æ¥åº”å¯¹å•åœ°åŒºçš„æ•…éšœï¼Œæ»¡è¶³ä¸šåŠ¡çš„ RTO/RPO æ ¸å¿ƒæŒ‡æ ‡ã€‚</td>
<td align="left">âˆš</td>
<td align="left">Ã—</td>
</tr>
</tbody></table>
<h3 id="ç½‘ç»œç¯å¢ƒ"><a href="#ç½‘ç»œç¯å¢ƒ" class="headerlink" title="ç½‘ç»œç¯å¢ƒ"></a>ç½‘ç»œç¯å¢ƒ</h3><ul>
<li>æ•°æ®ä¸­å¿ƒåˆ°é˜¿é‡Œäº‘ä¹‹é—´çš„ç½‘ç»œï¼šä¸“çº¿ / VPN / å…¬ç½‘</li>
<li>æ··åˆäº‘ç¾å¤‡ä¸€ä½“æœºåˆ°è¢«ä¿æŠ¤æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œï¼šå¤‡ä»½ä¸€ä½“æœºæä¾›äº†åŒåƒå…†ã€åŒä¸‡å…†ç½‘å¡ä¾›é€‰æ‹©ï¼Œå¯ä»¥æ ¹æ®å¤‡ä»½æ¢å¤ååè¦æ±‚æŒ‰éœ€é…ç½®ã€‚</li>
</ul>
<h3 id="æƒé™è¦æ±‚"><a href="#æƒé™è¦æ±‚" class="headerlink" title="æƒé™è¦æ±‚"></a>æƒé™è¦æ±‚</h3><ul>
<li>OSS æƒé™</li>
<li>äº‘ç›˜æƒé™</li>
<li>VPC æƒé™</li>
</ul>
<blockquote>
<p>è¯´æ˜ï¼šå¦‚æœç”¨æˆ·å·²ç›´æ¥æˆäºˆ <code>AliyunHDRFullAccess</code> æƒé™ï¼Œåˆ™ä¸éœ€è¦å†å•ç‹¬å¼€é€š <code>OSS</code>ã€ <code>ECS</code>ã€ <code>VPC</code> ç­‰æƒé™ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>é˜¿é‡Œäº‘</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· äº‹ä»¶</title>
    <url>/blog/2019/10/31/mysql-event/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>MySQL ä½¿ç”¨ <a href="https://dev.mysql.com/doc/refman/5.7/en/events-table.html" target="_blank" rel="noopener">EVENTS</a> æ¥å¤„ç†è®¡åˆ’ä»»åŠ¡ï¼Œç±»ä¼¼äº Linux ä¸Šçš„ <a href="http://cron.qqe2.com/" target="_blank" rel="noopener">cron</a>ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹ä»¶æœªå¯ç”¨ã€‚</p>
<p><strong>æƒé™</strong>ï¼š<a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_event" target="_blank" rel="noopener"><code>EVENT</code></a></p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span></span><br><span class="line">    [DEFINER = <span class="keyword">user</span>]</span><br><span class="line">    <span class="keyword">EVENT</span></span><br><span class="line">    [<span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>]</span><br><span class="line">    event_name</span><br><span class="line">    <span class="keyword">ON</span> SCHEDULE schedule</span><br><span class="line">    [<span class="keyword">ON</span> COMPLETION [<span class="keyword">NOT</span>] <span class="keyword">PRESERVE</span>]</span><br><span class="line">    [<span class="keyword">ENABLE</span> | <span class="keyword">DISABLE</span> | <span class="keyword">DISABLE</span> <span class="keyword">ON</span> <span class="keyword">SLAVE</span>]</span><br><span class="line">    [<span class="keyword">COMMENT</span> <span class="string">'string'</span>]</span><br><span class="line">    <span class="keyword">DO</span> event_body;</span><br><span class="line"></span><br><span class="line">schedule:</span><br><span class="line">    AT timestamp [+ INTERVAL interval] ...</span><br><span class="line">  | EVERY interval</span><br><span class="line">    [STARTS timestamp [+ INTERVAL interval] ...]</span><br><span class="line">    [ENDS timestamp [+ INTERVAL interval] ...]</span><br><span class="line"></span><br><span class="line">interval:</span><br><span class="line">    quantity &#123;YEAR | QUARTER | MONTH | DAY | HOUR | MINUTE |</span><br><span class="line">              WEEK | SECOND | YEAR_MONTH | DAY_HOUR | DAY_MINUTE |</span><br><span class="line">              DAY_SECOND | HOUR_MINUTE | HOUR_SECOND | MINUTE_SECOND&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h2><table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Command-Line Format</strong></td>
<td><code>--event-scheduler[=value]</code></td>
</tr>
<tr>
<td><strong>System Variable</strong></td>
<td><code>event_scheduler</code></td>
</tr>
<tr>
<td><strong>Scope</strong></td>
<td>Global</td>
</tr>
<tr>
<td><strong>Dynamic</strong></td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Type</strong></td>
<td>Enumeration</td>
</tr>
<tr>
<td><strong>Default Value</strong></td>
<td><code>OFF</code></td>
</tr>
<tr>
<td><strong>Valid Values</strong></td>
<td><code>ONã€OFFã€DISABLED</code></td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å‚æ•° event_scheduler</span></span><br><span class="line">mysql&gt; set global event_scheduler = on;</span><br><span class="line">mysql&gt; show variables like 'event_scheduler';</span><br><span class="line">+<span class="comment">-----------------+-------+</span></span><br><span class="line">| Variable_name   | Value |</span><br><span class="line">+<span class="comment">-----------------+-------+</span></span><br><span class="line">| event_scheduler | ON    |</span><br><span class="line">+<span class="comment">-----------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºäº‹ä»¶</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EVENT</span> Event_Archive_Daily</span><br><span class="line"><span class="keyword">ON</span> SCHEDULE EVERY <span class="number">1</span> <span class="keyword">DAY</span> STARTS <span class="string">'2019-11-01 02:00:00'</span></span><br><span class="line"><span class="keyword">ON</span> COMPLETION <span class="keyword">PRESERVE</span></span><br><span class="line"><span class="keyword">ENABLE</span></span><br><span class="line"><span class="keyword">DO</span> <span class="keyword">call</span> sp_archive();</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢äº‹ä»¶</span></span><br><span class="line">mysql&gt; show create event Event_Archive_Daily\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Event: Event_Archive_Daily</span><br><span class="line">            sql_mode: STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER</span><br><span class="line">           time_zone: SYSTEM</span><br><span class="line">        <span class="keyword">Create</span> <span class="keyword">Event</span>: <span class="keyword">CREATE</span> DEFINER=<span class="string">`root`</span>@<span class="string">`localhost`</span> <span class="keyword">EVENT</span> <span class="string">`Event_Archive_Daily`</span> <span class="keyword">ON</span> SCHEDULE EVERY <span class="number">1</span> <span class="keyword">DAY</span> STARTS <span class="string">'2019-11-01 02:00:00'</span> <span class="keyword">ON</span> COMPLETION <span class="keyword">PRESERVE</span> <span class="keyword">ENABLE</span> <span class="keyword">DO</span> <span class="keyword">call</span> sp_archive()</span><br><span class="line">character_set_client: utf8</span><br><span class="line">collation_connection: utf8_general_ci</span><br><span class="line">  <span class="keyword">Database</span> <span class="keyword">Collation</span>: utf8_general_ci</span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· è°ƒä¼˜æ¡ˆä¾‹ Â· MES</title>
    <url>/blog/2019/10/31/mysql-tuning-mes/</url>
    <content><![CDATA[<h2 id="æ•°æ®å½’æ¡£"><a href="#æ•°æ®å½’æ¡£" class="headerlink" title="æ•°æ®å½’æ¡£"></a>æ•°æ®å½’æ¡£</h2><h3 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><table>
<thead>
<tr>
<th>å·¥å‚å·</th>
<th>å·¥å‚å</th>
<th>æœˆç»“ç»“æŸæ—¶é—´</th>
<th>æ•°æ®åº“åœ°å€</th>
<th>ç«¯å£</th>
</tr>
</thead>
<tbody><tr>
<td>1026</td>
<td>åˆè‚¥æ³¢è½®</td>
<td>2019/10/31 11:00</td>
<td>192.168.175.11</td>
<td>3306</td>
</tr>
<tr>
<td>1022</td>
<td>åˆè‚¥ç©ºè°ƒ</td>
<td>2019/10/31 12:00</td>
<td>10.142.201.254</td>
<td>3306</td>
</tr>
</tbody></table>
<h3 id="ç­–ç•¥"><a href="#ç­–ç•¥" class="headerlink" title="ç­–ç•¥"></a>ç­–ç•¥</h3><p>è®¢å•æ—¥æœŸæ˜¯ 3 ä¸ªæœˆä»¥å‰ï¼Œä¸”è®¢å•çŠ¶æ€æ˜¯å·²å®Œæˆ</p>
<table>
<thead>
<tr>
<th>è¡¨</th>
<th>è¯´æ˜</th>
<th>å…³è”å­—æ®µ</th>
<th>æ€»æ•°æ®é‡</th>
<th>å½’æ¡£æ•°æ®é‡</th>
</tr>
</thead>
<tbody><tr>
<td>base_production_order_t</td>
<td>è®¢å•è¡¨</td>
<td>Code</td>
<td>17627</td>
<td>5174</td>
</tr>
<tr>
<td>bns_pm_operation</td>
<td>æ¡ç è¡¨</td>
<td>WorkUser_MOrderCode</td>
<td>2656496</td>
<td>1530802</td>
</tr>
<tr>
<td>bns_pm_scanhistory_month</td>
<td>æ‰«æè®°å½•è¡¨</td>
<td>Code</td>
<td>7392827</td>
<td>4370623</td>
</tr>
<tr>
<td>bns_qm_processtest</td>
<td>è¿‡ç¨‹æ£€éªŒè¡¨</td>
<td>Code</td>
<td>7562577</td>
<td>4508488</td>
</tr>
<tr>
<td>bns_pm_prodprocess</td>
<td>å·¥ä½è¿‡ç«™è®°å½•è¡¨</td>
<td>Order_Code</td>
<td>â€¦.</td>
<td>â€¦.</td>
</tr>
<tr>
<td>bns_pm_barcodecode</td>
<td>ç‰©æ–™ç»‘å®šè¡¨</td>
<td>â€¦.</td>
<td>6614117</td>
<td>3967682</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> base_production_order_t <span class="keyword">where</span> EST &lt; <span class="keyword">now</span>()-<span class="built_in">interval</span> <span class="number">3</span> <span class="keyword">month</span> <span class="keyword">and</span> OrderStatus = <span class="string">'2'</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> bns_pm_barcodecode <span class="keyword">where</span> scan_time &lt; <span class="keyword">now</span>()-<span class="built_in">interval</span> <span class="number">3</span> <span class="keyword">month</span>;</span><br></pre></td></tr></table></figure>

<h3 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><h4 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h4><ul>
<li><a href="https://huiraoo.github.io/blog/2019/07/05/mysql-toolkit/">å®‰è£… Percona Toolkit</a></li>
<li>åˆ›å»ºå½’æ¡£è¡¨</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å½’æ¡£è¡¨çš„è¡¨ç»“æ„ä¸åŸè¡¨ä¸€è‡´ï¼Œå‘½åç»Ÿä¸€é‡‡ç”¨åŸè¡¨å_archiveçš„æ ¼å¼</span></span><br><span class="line">bns_pm_operation_archive</span><br><span class="line">bns_pm_scanhistory_month_archive</span><br><span class="line">bns_qm_processtest_archive</span><br><span class="line">bns_pm_prodprocess_archive</span><br><span class="line">bns_pm_barcodecode_archive</span><br></pre></td></tr></table></figure>

<ul>
<li>å¼€å§‹å½’æ¡£</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å½’æ¡£å‘½ä»¤</span></span><br><span class="line">nohup pt-archiver --source h=xx,P=<span class="number">3306</span>,u=sre,p=<span class="string">'xx'</span>,D=<span class="string">'xx'</span>,t=bns_pm_barcodecode --charset=utf8 --dest  h=xx,P=<span class="number">3306</span>,u=sre,p=<span class="string">'xx'</span>,D=<span class="string">'xx'</span>,t=bns_pm_barcodecode_archive --where <span class="string">"scan_time &lt; now()-interval 3 month"</span> --limit <span class="number">1000</span> --commit-each --bulk-insert --no-version-check &gt; myout.file <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br></pre></td></tr></table></figure>

<ul>
<li>å®æ—¶æŸ¥çœ‹è¿›åº¦</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> information_schema;</span><br><span class="line"><span class="keyword">select</span> table_name,table_rows <span class="keyword">from</span> <span class="keyword">tables</span> <span class="keyword">where</span> TABLE_SCHEMA = <span class="string">'xx'</span> <span class="keyword">and</span> table_name=<span class="string">'xx'</span>;</span><br></pre></td></tr></table></figure>

<h4 id="bns-pm-barcodecode"><a href="#bns-pm-barcodecode" class="headerlink" title="bns_pm_barcodecode"></a>bns_pm_barcodecode</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¼€å§‹å½’æ¡£</span></span><br><span class="line">nohup pt-archiver --source h=<span class="number">192.168</span>.<span class="number">175.11</span>,P=<span class="number">3306</span>,u=sre,p=<span class="string">'sre@@p$i'</span>,D=<span class="string">'cosmo_im_1026'</span>,t=bns_pm_barcodecode --charset=utf8 --dest  h=<span class="number">192.168</span>.<span class="number">175.11</span>,P=<span class="number">3306</span>,u=sre,p=<span class="string">'sre@@p$i'</span>,D=<span class="string">'cosmo_im_1026'</span>,t=bns_pm_barcodecode_archive --where <span class="string">"scan_time &lt; now()-interval 3 month"</span> --limit <span class="number">1000</span> --commit-each --bulk-insert --no-version-check &gt; myout.file <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½’æ¡£è¿›åº¦</span></span><br><span class="line">use information_schema;</span><br><span class="line">select table_name,table_rows from tables where TABLE_SCHEMA = <span class="string">'cosmo_im_1026'</span> and table_name=<span class="string">'bns_pm_barcodecode_archive'</span>;</span><br></pre></td></tr></table></figure>

<h4 id="bns-pm-operation"><a href="#bns-pm-operation" class="headerlink" title="bns_pm_operation"></a>bns_pm_operation</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¼€å§‹å½’æ¡£</span></span><br><span class="line">nohup pt-archiver --source h=<span class="number">192.168</span>.<span class="number">175.11</span>,P=<span class="number">3306</span>,u=sre,p=<span class="string">'sre@@p$i'</span>,D=<span class="string">'cosmo_im_1026'</span>,t=bns_pm_operation --charset=utf8 --dest  h=<span class="number">192.168</span>.<span class="number">175.11</span>,P=<span class="number">3306</span>,u=sre,p=<span class="string">'sre@@p$i'</span>,D=<span class="string">'cosmo_im_1026'</span>,t=bns_pm_operation_archive --where <span class="string">"WorkUser_MOrderCode IN (select Code from base_production_order_t where EST &lt; now()-interval 3 month and OrderStatus = '2')"</span> --limit <span class="number">1000</span> --commit-each --bulk-insert --no-version-check &gt; myout1.file <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½’æ¡£è¿›åº¦</span></span><br><span class="line">use information_schema;</span><br><span class="line">select table_name,table_rows from tables where TABLE_SCHEMA = <span class="string">'cosmo_im_1026'</span> and table_name=<span class="string">'bns_pm_operation_archive'</span>;</span><br></pre></td></tr></table></figure>

<h4 id="bns-pm-scanhistory-month"><a href="#bns-pm-scanhistory-month" class="headerlink" title="bns_pm_scanhistory_month"></a>bns_pm_scanhistory_month</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¼€å§‹å½’æ¡£</span></span><br><span class="line">nohup pt-archiver --source h=<span class="number">192.168</span>.<span class="number">175.11</span>,P=<span class="number">3306</span>,u=sre,p=<span class="string">'sre@@p$i'</span>,D=<span class="string">'cosmo_im_1026'</span>,t=bns_pm_scanhistory_month --charset=utf8 --dest  h=<span class="number">192.168</span>.<span class="number">175.11</span>,P=<span class="number">3306</span>,u=sre,p=<span class="string">'sre@@p$i'</span>,D=<span class="string">'cosmo_im_1026'</span>,t=bns_pm_scanhistory_month_archive --where <span class="string">"Code IN (select Code from base_production_order_t where EST &lt; now()-interval 3 month and OrderStatus = '2')"</span> --limit <span class="number">1000</span> --commit-each --bulk-insert --no-version-check &gt; myout2.file <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½’æ¡£è¿›åº¦</span></span><br><span class="line">use information_schema;</span><br><span class="line">select table_name,table_rows from tables where TABLE_SCHEMA = <span class="string">'cosmo_im_1026'</span> and table_name=<span class="string">'bns_pm_scanhistory_month_archive'</span>;</span><br></pre></td></tr></table></figure>

<h4 id="bns-qm-processtest"><a href="#bns-qm-processtest" class="headerlink" title="bns_qm_processtest"></a>bns_qm_processtest</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¼€å§‹å½’æ¡£</span></span><br><span class="line">nohup pt-archiver --source h=<span class="number">192.168</span>.<span class="number">175.11</span>,P=<span class="number">3306</span>,u=sre,p=<span class="string">'sre@@p$i'</span>,D=<span class="string">'cosmo_im_1026'</span>,t=bns_qm_processtest --charset=utf8 --dest  h=<span class="number">192.168</span>.<span class="number">175.11</span>,P=<span class="number">3306</span>,u=sre,p=<span class="string">'sre@@p$i'</span>,D=<span class="string">'cosmo_im_1026'</span>,t=bns_qm_processtest_archive --where <span class="string">"Code IN (select Code from base_production_order_t where EST &lt; now()-interval 3 month and OrderStatus = '2')"</span> --limit <span class="number">1000</span> --commit-each --bulk-insert --no-version-check &gt; myout3.file <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½’æ¡£è¿›åº¦</span></span><br><span class="line">use information_schema;</span><br><span class="line">select table_name,table_rows from tables where TABLE_SCHEMA = <span class="string">'cosmo_im_1026'</span> and table_name=<span class="string">'bns_qm_processtest_archive'</span>;</span><br></pre></td></tr></table></figure>

<h4 id="bns-pm-prodprocess"><a href="#bns-pm-prodprocess" class="headerlink" title="bns_pm_prodprocess"></a>bns_pm_prodprocess</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¼€å§‹å½’æ¡£</span></span><br><span class="line">nohup pt-archiver --source h=<span class="number">192.168</span>.<span class="number">175.11</span>,P=<span class="number">3306</span>,u=sre,p=<span class="string">'sre@@p$i'</span>,D=<span class="string">'cosmo_im_1026'</span>,t=bns_pm_prodprocess --charset=utf8 --dest  h=<span class="number">192.168</span>.<span class="number">175.11</span>,P=<span class="number">3306</span>,u=sre,p=<span class="string">'sre@@p$i'</span>,D=<span class="string">'cosmo_im_1026'</span>,t=bns_pm_prodprocess_archive --where <span class="string">"Order_Code IN (select Code from base_production_order_t where EST &lt; now()-interval 3 month and OrderStatus = '2')"</span> --limit <span class="number">1000</span> --commit-each --bulk-insert --no-version-check &gt; myout4.file <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½’æ¡£è¿›åº¦</span></span><br><span class="line">use information_schema;</span><br><span class="line">select table_name,table_rows from tables where TABLE_SCHEMA = <span class="string">'cosmo_im_1026'</span> and table_name=<span class="string">'bns_pm_prodprocess_archive'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="è®¾ç½®è‡ªåŠ¨å½’æ¡£"><a href="#è®¾ç½®è‡ªåŠ¨å½’æ¡£" class="headerlink" title="è®¾ç½®è‡ªåŠ¨å½’æ¡£"></a>è®¾ç½®è‡ªåŠ¨å½’æ¡£</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å­˜å‚¨è¿‡ç¨‹</span></span><br><span class="line">DELIMITER $$ </span><br><span class="line"></span><br><span class="line">DROP PROCEDURE <span class="keyword">IF</span> EXISTS sp_archive$$ </span><br><span class="line">CREATE PROCEDURE sp_archive()</span><br><span class="line"><span class="keyword">BEGIN</span> 	</span><br><span class="line">	INSERT INTO bns_pm_barcodecode_archive SELECT * FROM bns_pm_barcodecode WHERE </span><br><span class="line">	scan_time &lt; now() - interval <span class="number">3</span> month;</span><br><span class="line">	DELETE FROM bns_pm_barcodecode WHERE scan_time &lt; now() - interval <span class="number">3</span> month;</span><br><span class="line"><span class="keyword">END</span> $$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment"># äº‹ä»¶</span></span><br><span class="line">CREATE EVENT Event_Archive_Daily</span><br><span class="line">ON SCHEDULE EVERY <span class="number">1</span> DAY STARTS <span class="string">'2019-11-01 02:00:00'</span></span><br><span class="line">ON COMPLETION PRESERVE</span><br><span class="line">ENABLE</span><br><span class="line"><span class="keyword">DO</span> call sp_archive();</span><br></pre></td></tr></table></figure>

<h2 id="æ…¢-SQL-ä¼˜åŒ–"><a href="#æ…¢-SQL-ä¼˜åŒ–" class="headerlink" title="æ…¢ SQL ä¼˜åŒ–"></a>æ…¢ SQL ä¼˜åŒ–</h2><p><strong>å·¥å‚</strong>ï¼šé»„å²›æ»šç­’</p>
<p><strong>æ•°æ®åº“</strong>ï¼š10.180.129.24:3306</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ…¢SQL1</span></span><br><span class="line"><span class="keyword">UPDATE</span> bns_pm_operation a</span><br><span class="line"><span class="keyword">SET</span> a.T_WMS_1 = <span class="string">'1'</span></span><br><span class="line"><span class="keyword">WHERE</span> a.Create_Date &lt; <span class="string">'2019-04-01'</span></span><br><span class="line"><span class="keyword">AND</span> a.T_WMS_1 = <span class="string">'0'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ…¢SQL2</span></span><br><span class="line"><span class="keyword">SELECT</span> ZYH</span><br><span class="line"><span class="keyword">FROM</span> t_mes_scan</span><br><span class="line"><span class="keyword">WHERE</span> PPLACE = <span class="string">'ä¸€çº¿æ€»è£…ç®±ä½“ä¸Šçº¿'</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> REALDATE <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">0</span>, <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§†å›¾</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	t.ID <span class="keyword">AS</span> N_ID,</span><br><span class="line">	<span class="keyword">ifnull</span>( t.WorkUser_RandomBarCode, t.WorkUser_BarCode ) <span class="keyword">AS</span> SERN,</span><br><span class="line">	t.WorkUser_MOrderCode <span class="keyword">AS</span> ORDER_ID,</span><br><span class="line">	t.Work_OperationOutMainItemCode <span class="keyword">AS</span> ZYH,</span><br><span class="line">	t.WorkUser_RightMostItemName <span class="keyword">AS</span> XH_ID,</span><br><span class="line">	t.WorkUser_LineName <span class="keyword">AS</span> LINENAME,</span><br><span class="line">	t3.Work_Cell_Desc <span class="keyword">AS</span> PPLACE,</span><br><span class="line">	t2.ScanTime <span class="keyword">AS</span> REALDATE,</span><br><span class="line">	t2.User_Code <span class="keyword">AS</span> YG_ID,</span><br><span class="line">	t2.Create_Date <span class="keyword">AS</span> CREATEDATE,</span><br><span class="line">	t4.Team_Code <span class="keyword">AS</span> Team_Code,</span><br><span class="line">	t4.Team_Desc <span class="keyword">AS</span> Team_Desc,</span><br><span class="line">	t5.Shift_Code <span class="keyword">AS</span> Shift_Code,</span><br><span class="line">	t5.Shift_Desc <span class="keyword">AS</span> Shift_Desc </span><br><span class="line"><span class="keyword">FROM</span> bns_pm_operation t </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> bns_pm_scanhistory_month t2 <span class="keyword">ON</span> t.WorkUser_BarCode = t2.WorkUser_BarCode</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> pm_work_cells_t t3 <span class="keyword">ON</span> t2.Work_Cell_Code = t3.Work_Cell_Code </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> base_team_t t4 <span class="keyword">ON</span> t2.Team_Code = t4.Team_Code</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> base_shifts_t t5 <span class="keyword">ON</span> t2.Shift_Code = t5.Shift_Code </span><br><span class="line"><span class="keyword">WHERE</span> t2.Type = <span class="number">0</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> t2.ScanTime</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· å­˜å‚¨è¿‡ç¨‹</title>
    <url>/blog/2019/10/31/mysql-procedure/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><a href="https://dev.mysql.com/doc/refman/5.7/en/stored-routines.html" target="_blank" rel="noopener">å­˜å‚¨è¿‡ç¨‹</a>å¤„ç†çš„æ˜¯ä¸€ç»„ SQL è¯­å¥ï¼Œä¸”æ²¡æœ‰è¿”å›å€¼ã€‚</p>
<p><strong>ä¼˜ç‚¹</strong></p>
<ul>
<li>ç®€å•ï¼šæŠŠå•æ¡ SQL å°è£…èµ·æ¥ï¼Œç®€åŒ–å¤æ‚çš„æ“ä½œã€‚</li>
<li>å®‰å…¨</li>
<li>é«˜æ€§èƒ½</li>
</ul>
<p><strong>ç¼ºç‚¹</strong></p>
<ul>
<li>ç§»æ¤å›°éš¾ï¼Œä¸åŒæ•°æ®åº“çš„è¯­æ³•å·®åˆ«å¾ˆå¤§</li>
<li>ä¸æ˜“æ‰©å±•ï¼ŒæŠŠè¿‡å¤šä¸šåŠ¡é€»è¾‘å†™åœ¨å­˜å‚¨è¿‡ç¨‹ä¸å¥½ç»´æŠ¤ï¼Œä¸åˆ©äºåˆ†å±‚ç®¡ç†ï¼Œå®¹æ˜“æ··ä¹±</li>
</ul>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º</span></span><br><span class="line"><span class="keyword">CREATE</span></span><br><span class="line">    [DEFINER = <span class="keyword">user</span>]</span><br><span class="line">    <span class="keyword">PROCEDURE</span> sp_name ([proc_parameter[,...]])</span><br><span class="line">    [characteristic ...] routine_body</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span></span><br><span class="line">    [DEFINER = <span class="keyword">user</span>]</span><br><span class="line">    <span class="keyword">FUNCTION</span> sp_name ([func_parameter[,...]])</span><br><span class="line">    <span class="keyword">RETURNS</span> <span class="keyword">type</span></span><br><span class="line">    [characteristic ...] routine_body</span><br><span class="line"></span><br><span class="line">proc_parameter:</span><br><span class="line">    [ <span class="keyword">IN</span> | <span class="keyword">OUT</span> | INOUT ] param_name <span class="keyword">type</span></span><br><span class="line"></span><br><span class="line">func_parameter:</span><br><span class="line">    param_name <span class="keyword">type</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span>:</span><br><span class="line">    <span class="keyword">Any</span> valid MySQL <span class="keyword">data</span> <span class="keyword">type</span></span><br><span class="line"></span><br><span class="line">characteristic:</span><br><span class="line">    <span class="keyword">COMMENT</span> <span class="string">'string'</span></span><br><span class="line">  | <span class="keyword">LANGUAGE</span> <span class="keyword">SQL</span></span><br><span class="line">  | [<span class="keyword">NOT</span>] <span class="keyword">DETERMINISTIC</span></span><br><span class="line">  | &#123; CONTAINS <span class="keyword">SQL</span> | <span class="keyword">NO</span> <span class="keyword">SQL</span> | <span class="keyword">READS</span> <span class="keyword">SQL</span> <span class="keyword">DATA</span> | MODIFIES <span class="keyword">SQL</span> <span class="keyword">DATA</span> &#125;</span><br><span class="line">  | <span class="keyword">SQL</span> <span class="keyword">SECURITY</span> &#123; DEFINER | INVOKER &#125;</span><br><span class="line"></span><br><span class="line">routine_body:</span><br><span class="line">    Valid <span class="keyword">SQL</span> routine <span class="keyword">statement</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">PROCEDURE</span> proc_name [characteristic ...]</span><br><span class="line"></span><br><span class="line">characteristic:</span><br><span class="line">    <span class="keyword">COMMENT</span> <span class="string">'string'</span></span><br><span class="line">  | <span class="keyword">LANGUAGE</span> <span class="keyword">SQL</span></span><br><span class="line">  | &#123; CONTAINS <span class="keyword">SQL</span> | <span class="keyword">NO</span> <span class="keyword">SQL</span> | <span class="keyword">READS</span> <span class="keyword">SQL</span> <span class="keyword">DATA</span> | MODIFIES <span class="keyword">SQL</span> <span class="keyword">DATA</span> &#125;</span><br><span class="line">  | <span class="keyword">SQL</span> <span class="keyword">SECURITY</span> &#123; DEFINER | INVOKER &#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment"># åˆ é™¤</span></span><br><span class="line"><span class="keyword">DROP</span> &#123;<span class="keyword">PROCEDURE</span> | <span class="keyword">FUNCTION</span>&#125; [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] sp_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨</span></span><br><span class="line"><span class="keyword">CALL</span> sp_name([parameter[,...]])</span><br><span class="line"><span class="keyword">CALL</span> sp_name[()]</span><br></pre></td></tr></table></figure>

<p><strong>æƒé™</strong>ï¼š<a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_create-routine" target="_blank" rel="noopener"><code>CREATE ROUTINE</code></a> ã€<a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_alter-routine" target="_blank" rel="noopener"><code>ALTER ROUTINE</code></a> ã€<a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_execute" target="_blank" rel="noopener"><code>EXECUTE</code></a></p>
<h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mysql&gt; delimiter //</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE PROCEDURE simpleproc (OUT <span class="keyword">param</span>1 INT)</span><br><span class="line">    -&gt; <span class="keyword">BEGIN</span></span><br><span class="line">    -&gt;   SELECT COUNT(*) INTO <span class="keyword">param</span>1 FROM t;</span><br><span class="line">    -&gt; <span class="keyword">END</span>//</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; delimiter ;</span><br><span class="line"></span><br><span class="line">mysql&gt; CALL simpleproc(@a);</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT @a;</span><br><span class="line">+------+</span><br><span class="line">| @a   |</span><br><span class="line">+------+</span><br><span class="line">| <span class="number">3</span>    |</span><br><span class="line">+------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· è§†å›¾</title>
    <url>/blog/2019/10/30/mysql-view/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><strong>è§†å›¾</strong>æ˜¯è™šæ‹Ÿçš„è¡¨ï¼Œä¸åŒ…å«æ•°æ®çš„è¡¨ä¸ä¸€æ ·ï¼Œè§†å›¾åªåŒ…å«ä½¿ç”¨æ—¶åŠ¨æ€æ£€ç´¢æ•°æ®çš„æŸ¥è¯¢ <code>SQL</code>ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåº”è¯¥å°†è§†å›¾ç”¨äºæ£€ç´¢ï¼ˆ<code>SELETE</code>ï¼‰ï¼Œè€Œä¸ç”¨äºæ›´æ–°ï¼ˆ<code>INSRTE</code>ã€<code>UPDATE</code>ã€<code>DELETE</code>ï¼‰ã€‚</p>
<p><strong>ä¼˜ç‚¹</strong></p>
<ul>
<li>ç®€åŒ–ï¼Œéšè—å¤æ‚çš„ <code>SQL</code> ï¼Œç®€åŒ–å¤æ‚ <code>SQL</code> çš„æ•°æ®å¤„ç†ï¼Œè¿˜å¯ä»¥é‡æ–°æ ¼å¼åŒ–æ•°æ®</li>
<li>å®‰å…¨ï¼Œä¿æŠ¤æ•°æ®ï¼Œå¯ä»¥ç»™ç”¨æˆ·æˆäºˆè¡¨çš„ç‰¹å®šéƒ¨åˆ†çš„è®¿é—®æƒé™è€Œä¸æ˜¯æ•´ä¸ªè¡¨çš„è®¿é—®æƒé™</li>
</ul>
<p><strong>ç¼ºç‚¹</strong></p>
<ul>
<li>æ€§èƒ½ç›¸å¯¹è¾ƒå·®</li>
</ul>
<blockquote>
<p>æ€§èƒ½é—®é¢˜ï¼šå› ä¸ºè§†å›¾ä¸åŒ…å«æ•°æ®ï¼Œæ‰€ä»¥æ¯æ¬¡ä½¿ç”¨è§†å›¾æ—¶ï¼Œéƒ½å¿…é¡»å¤„ç†æŸ¥è¯¢æ‰§è¡Œæ—¶æ‰€éœ€çš„ä»»ä½•ä¸€ä¸ªæ£€ç´¢ã€‚å¦‚æœä½ ç”¨å¤šä¸ªè”ç»“å’Œè¿‡æ»¤åˆ›å»ºäº†å¤æ‚çš„è§†å›¾æˆ–è€…åµŒå¥—äº†è§†å›¾ï¼Œå°±ä¼šå‘ç°æ€§èƒ½ä¸‹é™å¾—å¾ˆå‰å®³ï¼Œä¸»è¦åŸå› æ˜¯<strong>ä¸èƒ½å»ºç«‹ç´¢å¼•</strong>ã€‚</p>
</blockquote>
<h2 id="æƒé™"><a href="#æƒé™" class="headerlink" title="æƒé™"></a>æƒé™</h2><ul>
<li><code>CREATE VIEW</code>ï¼šåˆ›å»ºè§†å›¾</li>
<li><code>SHOW VIEW</code>ï¼šæŸ¥çœ‹è§†å›¾</li>
</ul>
<h2 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h2><h3 id="åˆ›å»ºè§†å›¾"><a href="#åˆ›å»ºè§†å›¾" class="headerlink" title="åˆ›å»ºè§†å›¾"></a>åˆ›å»ºè§†å›¾</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [ALGORITHM = &#123;<span class="keyword">MERGE</span> | TEMPTABLE | UNDEFINED&#125;]</span><br><span class="line"><span class="keyword">VIEW</span> [database_name].[view_name] </span><br><span class="line"><span class="keyword">AS</span> [<span class="keyword">SELECT</span> <span class="keyword">statement</span>]</span><br></pre></td></tr></table></figure>

<p>MySQL æœ‰ä¸‰ç§è§†å›¾ç­–ç•¥, åˆ†åˆ«æ˜¯ <code>MERGE</code>ï¼Œ <code>TEMPTABLE</code>ï¼Œ <code>UNDEFINED</code></p>
<ul>
<li><code>MERGE</code>ï¼Œå…ˆå°†è¾“å…¥çš„æŸ¥è¯¢è¯­å¥å’Œè§†å›¾çš„å£°æ˜è¯­å¥è¿›è¡Œåˆå¹¶ï¼Œç„¶åæ‰§è¡Œåˆå¹¶åçš„è¯­å¥å¹¶è¿”å›ã€‚</li>
<li><code>TEMPTABLE</code>ï¼Œå…ˆåŸºäºè§†å›¾çš„å£°æ˜åˆ›å»ºä¸€å¼  <code>temporary table</code>ï¼Œå½“è¾“å…¥æŸ¥è¯¢è¯­å¥æ—¶ä¼šç›´æ¥æŸ¥è¯¢è¿™å¼  <code>temporary table</code>ï¼Œ<code>TEMPTABLE</code> çš„æ•ˆç‡è¦æ¯” <code>MERGE</code> ä½ã€‚</li>
<li><code>UNDEFINED</code>ï¼Œå¦‚æœåˆ›å»ºè§†å›¾çš„æ—¶å€™ä¸æŒ‡å®šç­–ç•¥ï¼Œé»˜è®¤ä½¿ç”¨æ­¤ç­–ç•¥ã€‚<code>UNDEFINED</code> ä¼šè‡ªåŠ¨é€‰æ‹©ä½¿ç”¨ä¸Šè¿°ä¸¤ç§ç­–ç•¥ä¸­çš„ä¸€ä¸ªï¼Œä¼˜å…ˆé€‰æ‹© <code>MERGE</code> ç­–ç•¥ï¼Œæ— æ³•ä½¿ç”¨åˆ™è½¬ä¸º <code>TEMPTABLE</code> ç­–ç•¥ã€‚</li>
</ul>
<h3 id="æ˜¾ç¤ºè§†å›¾"><a href="#æ˜¾ç¤ºè§†å›¾" class="headerlink" title="æ˜¾ç¤ºè§†å›¾"></a>æ˜¾ç¤ºè§†å›¾</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢å•ä¸ªè§†å›¾</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">view</span> view_name;</span><br><span class="line"></span><br><span class="line">mysql&gt; show create view cosmo_zzwk_2048.yangjisaomiao_view\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                View: yangjisaomiao_view</span><br><span class="line">         <span class="keyword">Create</span> <span class="keyword">View</span>: <span class="keyword">CREATE</span> ALGORITHM=UNDEFINED DEFINER=<span class="string">`wms`</span>@<span class="string">`%`</span> <span class="keyword">SQL</span> <span class="keyword">SECURITY</span> DEFINER <span class="keyword">VIEW</span> <span class="string">`cosmo_zzwk_2048`</span>.<span class="string">`yangjisaomiao_view`</span> <span class="keyword">AS</span> <span class="keyword">select</span> <span class="keyword">distinct</span> <span class="string">`a`</span>.<span class="string">`ORDER_NO`</span> <span class="keyword">AS</span> <span class="string">`order_id`</span>,<span class="string">`a`</span>.<span class="string">`OUT_CODE`</span> <span class="keyword">AS</span> <span class="string">`sm_id`</span>,<span class="string">`a`</span>.<span class="string">`BARCODE`</span> <span class="keyword">AS</span> <span class="string">`sern`</span>,<span class="string">`a`</span>.<span class="string">`SCAN_TIME`</span> <span class="keyword">AS</span> <span class="string">`scandate`</span>,<span class="string">`a`</span>.<span class="string">`SCANED_BY`</span> <span class="keyword">AS</span> <span class="string">`scanuser`</span>,<span class="string">'10.138.228.165'</span> <span class="keyword">AS</span> <span class="string">`database_ip`</span>,<span class="string">'90J0'</span> <span class="keyword">AS</span> <span class="string">`SAP_Plant`</span>,<span class="string">'é»„å²›æ™ºæ…§å¨ç”µ'</span> <span class="keyword">AS</span> <span class="string">`sap_description`</span> <span class="keyword">from</span> <span class="string">`cosmo_zzwk_2048`</span>.<span class="string">`ods_pro_yj_sn`</span> <span class="string">`a`</span> <span class="keyword">where</span> (<span class="string">`a`</span>.<span class="string">`SCAN_TIME`</span> &gt;= (<span class="keyword">curdate</span>() - <span class="built_in">interval</span> <span class="number">30</span> <span class="keyword">day</span>))</span><br><span class="line">character_set_client: utf8</span><br><span class="line">collation_connection: utf8_general_ci</span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢æ‰€æœ‰è§†å›¾</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> information_schema.views;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤è§†å›¾"><a href="#åˆ é™¤è§†å›¾" class="headerlink" title="åˆ é™¤è§†å›¾"></a>åˆ é™¤è§†å›¾</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> view_name;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· è°ƒä¼˜æ¡ˆä¾‹ Â· WMS</title>
    <url>/blog/2019/10/30/mysql-tuning-wms/</url>
    <content><![CDATA[<h2 id="å®ä¾‹ä¿¡æ¯"><a href="#å®ä¾‹ä¿¡æ¯" class="headerlink" title="å®ä¾‹ä¿¡æ¯"></a>å®ä¾‹ä¿¡æ¯</h2><table>
<thead>
<tr>
<th>å®ä¾‹</th>
<th>è§’è‰²</th>
<th>ç‰ˆæœ¬</th>
<th>ä¸šåŠ¡åº“</th>
<th>æ•°æ®é‡</th>
</tr>
</thead>
<tbody><tr>
<td>10.138.98.20:3306</td>
<td>Master</td>
<td>5.7.23</td>
<td>cosmo_base  (5)</td>
<td>82.68G</td>
</tr>
<tr>
<td>10.138.98.21:3306</td>
<td>Slave</td>
<td>5.7.23</td>
<td>â€¦.</td>
<td>â€¦.</td>
</tr>
<tr>
<td><strong>10.138.228.40:3306</strong></td>
<td>Master</td>
<td>5.6.39</td>
<td>cosmo_wms_xx  (23)</td>
<td>139.5G</td>
</tr>
<tr>
<td>10.138.228.41:3306</td>
<td>Slave</td>
<td>5.6.39</td>
<td>â€¦.</td>
<td>â€¦.</td>
</tr>
<tr>
<td>10.138.228.43:3306</td>
<td>Master</td>
<td>5.6.39</td>
<td>cosmo_wms_xx  (23)</td>
<td>â€¦.</td>
</tr>
<tr>
<td>10.138.42.94:3306</td>
<td>Master</td>
<td>10.1.21</td>
<td>cosmo_wms_xx  (9)</td>
<td>â€¦.</td>
</tr>
<tr>
<td><strong>10.138.232.165:3306</strong></td>
<td>Master</td>
<td>5.6.39</td>
<td>cosmo_xx_xx  (30)</td>
<td>155.9G</td>
</tr>
<tr>
<td>10.138.232.164:3306</td>
<td>Slave</td>
<td>5.6.39</td>
<td>â€¦.</td>
<td>â€¦.</td>
</tr>
<tr>
<td>10.138.232.166:3306</td>
<td>Slave</td>
<td>5.6.39</td>
<td>â€¦.</td>
<td>â€¦.</td>
</tr>
<tr>
<td><strong>10.133.7.31:3306</strong></td>
<td>Master</td>
<td>5.7.23</td>
<td>epg_xx  (19)</td>
<td>66.6G</td>
</tr>
</tbody></table>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 10.138.98.20:3306æŒ‰åº“å¤§å°æ’åº</span></span><br><span class="line">+--------------------+-----------+------------+</span><br><span class="line">| table_schema       | data_size | index_size |</span><br><span class="line">+--------------------+-----------+------------+</span><br><span class="line">| cosmo_base         | <span class="number">45.28</span>GB   | <span class="number">37.38</span>GB    |</span><br><span class="line">| cosmo_wms          | <span class="number">0.17</span>GB    | <span class="number">0.03</span>GB     |</span><br><span class="line">| xwsy               | <span class="number">0.09</span>GB    | <span class="number">0.03</span>GB     |</span><br><span class="line">| cosmo_epg_5001     | <span class="number">0.02</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">| xwsytest           | <span class="number">0.01</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">+--------------------+-----------+------------+</span><br><span class="line"><span class="number">9</span> rows <span class="keyword">in</span> set, <span class="number">28</span> warnings (<span class="number">0.30</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.138.228.40:3306æŒ‰åº“å¤§å°æ’åº</span></span><br><span class="line">+--------------------+-----------+------------+</span><br><span class="line">| table_schema       | data_size | index_size |</span><br><span class="line">+--------------------+-----------+------------+</span><br><span class="line">| cosmo_wms_1006     | <span class="number">17.48</span>GB   | <span class="number">4.73</span>GB     |</span><br><span class="line">| cosmo_wms_1011     | <span class="number">17.00</span>GB   | <span class="number">6.16</span>GB     |</span><br><span class="line">| cosmo_wms_1007     | <span class="number">11.75</span>GB   | <span class="number">7.36</span>GB     |</span><br><span class="line">| cosmo_wms_1013     | <span class="number">9.78</span>GB    | <span class="number">4.60</span>GB     |</span><br><span class="line">| cosmo_wms_1009     | <span class="number">7.82</span>GB    | <span class="number">4.17</span>GB     |</span><br><span class="line">| cosmo_wms_1010     | <span class="number">6.52</span>GB    | <span class="number">3.48</span>GB     |</span><br><span class="line">| cosmo_wms_1012     | <span class="number">5.24</span>GB    | <span class="number">4.32</span>GB     |</span><br><span class="line">| cosmo_wms_1018     | <span class="number">3.39</span>GB    | <span class="number">0.88</span>GB     |</span><br><span class="line">| cosmo_wms_1019     | <span class="number">3.31</span>GB    | <span class="number">0.66</span>GB     |</span><br><span class="line">| cosmo_wms_2012     | <span class="number">2.77</span>GB    | <span class="number">0.61</span>GB     |</span><br><span class="line">| cosmo_wms_2015     | <span class="number">2.45</span>GB    | <span class="number">0.46</span>GB     |</span><br><span class="line">| cosmo_wms_1008     | <span class="number">1.68</span>GB    | <span class="number">1.46</span>GB     |</span><br><span class="line">| cosmo_wms_1015     | <span class="number">1.48</span>GB    | <span class="number">0.68</span>GB     |</span><br><span class="line">| cosmo_wms_2008     | <span class="number">1.31</span>GB    | <span class="number">0.29</span>GB     |</span><br><span class="line">| cosmo_wms_2009     | <span class="number">1.23</span>GB    | <span class="number">0.21</span>GB     |</span><br><span class="line">| cosmo_wms_2005     | <span class="number">1.12</span>GB    | <span class="number">0.23</span>GB     |</span><br><span class="line">| cosmo_wms_2007     | <span class="number">1.04</span>GB    | <span class="number">0.22</span>GB     |</span><br><span class="line">| cosmo_wms_2010     | <span class="number">0.87</span>GB    | <span class="number">0.18</span>GB     |</span><br><span class="line">| cosmo_wms_2065     | <span class="number">0.76</span>GB    | <span class="number">0.30</span>GB     |</span><br><span class="line">| SPC_COM            | <span class="number">0.48</span>GB    | <span class="number">0.29</span>GB     |</span><br><span class="line">| cosmo_wms_2006     | <span class="number">0.27</span>GB    | <span class="number">0.05</span>GB     |</span><br><span class="line">| cosmo_wms_2066     | <span class="number">0.04</span>GB    | <span class="number">0.05</span>GB     |</span><br><span class="line">| cosmo_wms_3001     | <span class="number">0.02</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">+--------------------+-----------+------------+</span><br><span class="line"><span class="number">27</span> rows <span class="keyword">in</span> set (<span class="number">3.19</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.138.228.43:3306æŒ‰åº“å¤§å°æ’åº</span></span><br><span class="line">+--------------------+-----------+------------+</span><br><span class="line">| table_schema       | data_size | index_size |</span><br><span class="line">+--------------------+-----------+------------+</span><br><span class="line">| cosmo_wms_1031     | <span class="number">13.06</span>GB   | <span class="number">4.44</span>GB     |</span><br><span class="line">| cosmo_wms_1026     | <span class="number">9.78</span>GB    | <span class="number">4.22</span>GB     |</span><br><span class="line">| cosmo_wms_1022     | <span class="number">5.39</span>GB    | <span class="number">3.57</span>GB     |</span><br><span class="line">| cosmo_wms_2019     | <span class="number">5.34</span>GB    | <span class="number">1.68</span>GB     |</span><br><span class="line">| cosmo_wms_1028     | <span class="number">4.92</span>GB    | <span class="number">2.38</span>GB     |</span><br><span class="line">| cosmo_wms_1029     | <span class="number">4.20</span>GB    | <span class="number">2.09</span>GB     |</span><br><span class="line">| cosmo_wms_1025     | <span class="number">3.83</span>GB    | <span class="number">2.95</span>GB     |</span><br><span class="line">| cosmo_wms_1032     | <span class="number">3.67</span>GB    | <span class="number">1.95</span>GB     |</span><br><span class="line">| cosmo_wms_1030     | <span class="number">2.96</span>GB    | <span class="number">2.00</span>GB     |</span><br><span class="line">| cosmo_wms_2025     | <span class="number">2.79</span>GB    | <span class="number">0.49</span>GB     |</span><br><span class="line">| cosmo_wms_2026     | <span class="number">2.52</span>GB    | <span class="number">0.36</span>GB     |</span><br><span class="line">| cosmo_wms_1027     | <span class="number">2.47</span>GB    | <span class="number">1.01</span>GB     |</span><br><span class="line">| cosmo_wms_2018     | <span class="number">1.96</span>GB    | <span class="number">0.52</span>GB     |</span><br><span class="line">| cosmo_wms_1024     | <span class="number">1.57</span>GB    | <span class="number">1.30</span>GB     |</span><br><span class="line">| cosmo_wms_2023     | <span class="number">1.02</span>GB    | <span class="number">0.26</span>GB     |</span><br><span class="line">| cosmo_wms_2020     | <span class="number">0.78</span>GB    | <span class="number">0.19</span>GB     |</span><br><span class="line">| cosmo_wms_2022     | <span class="number">0.77</span>GB    | <span class="number">0.18</span>GB     |</span><br><span class="line">| cosmo_wms_2021     | <span class="number">0.44</span>GB    | <span class="number">0.17</span>GB     |</span><br><span class="line">| cosmo_wms_1023     | <span class="number">0.27</span>GB    | <span class="number">0.09</span>GB     |</span><br><span class="line">| cosmo_wms_2024     | <span class="number">0.26</span>GB    | <span class="number">0.12</span>GB     |</span><br><span class="line">| cosmo_wms_2027     | <span class="number">0.14</span>GB    | <span class="number">0.08</span>GB     |</span><br><span class="line">| cosmo_wms          | <span class="number">0.12</span>GB    | <span class="number">0.07</span>GB     |</span><br><span class="line">| cosmo_wms_2028     | <span class="number">0.02</span>GB    | <span class="number">0.03</span>GB     |</span><br><span class="line">+--------------------+-----------+------------+</span><br><span class="line"><span class="number">27</span> rows <span class="keyword">in</span> set (<span class="number">3.19</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.138.42.94:3306æŒ‰åº“å¤§å°æ’åº</span></span><br><span class="line">+--------------------+-----------+------------+</span><br><span class="line">| table_schema       | data_size | index_size |</span><br><span class="line">+--------------------+-----------+------------+</span><br><span class="line">| cosmo_wms_uniall   | <span class="number">8.21</span>GB    | <span class="number">1.36</span>GB     |</span><br><span class="line">| cosmo_wms          | <span class="number">6.10</span>GB    | <span class="number">4.27</span>GB     |</span><br><span class="line">| cosmo_wms_1002     | <span class="number">4.12</span>GB    | <span class="number">3.46</span>GB     |</span><br><span class="line">| cosmo_base         | <span class="number">3.20</span>GB    | <span class="number">1.57</span>GB     |</span><br><span class="line">| cosmo_wms_1005     | <span class="number">1.51</span>GB    | <span class="number">1.03</span>GB     |</span><br><span class="line">| cosmo_wms_test     | <span class="number">0.75</span>GB    | <span class="number">1.00</span>GB     |</span><br><span class="line">| cosmo_wms_testn    | <span class="number">0.48</span>GB    | <span class="number">0.31</span>GB     |</span><br><span class="line">| cosmo_wms_2001     | <span class="number">0.39</span>GB    | <span class="number">0.10</span>GB     |</span><br><span class="line">| cosmo_wms_2002     | <span class="number">0.14</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">+--------------------+-----------+------------+</span><br><span class="line"><span class="number">13</span> rows <span class="keyword">in</span> set, <span class="number">1</span> warning (<span class="number">0.63</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.138.232.165:3306æŒ‰åº“å¤§å°æ’åº</span></span><br><span class="line">+------------------------+-----------+------------+</span><br><span class="line">| table_schema           | data_size | index_size |</span><br><span class="line">+------------------------+-----------+------------+</span><br><span class="line">| cosmo_zzkt_1046        | <span class="number">30.88</span>GB   | <span class="number">1.80</span>GB     |</span><br><span class="line">| cosmo_hdgt_1003        | <span class="number">25.19</span>GB   | <span class="number">3.87</span>GB     |</span><br><span class="line">| cosmo_fsgt_1045        | <span class="number">23.05</span>GB   | <span class="number">0.87</span>GB     |</span><br><span class="line">| cosmo_hdzk             | <span class="number">20.03</span>GB   | <span class="number">0.69</span>GB     |</span><br><span class="line">| cosmo_xyyj             | <span class="number">18.18</span>GB   | <span class="number">3.63</span>GB     |</span><br><span class="line">| cosmo_jndr_1017        | <span class="number">5.58</span>GB    | <span class="number">3.21</span>GB     |</span><br><span class="line">| cosmo_zysj             | <span class="number">2.39</span>GB    | <span class="number">1.73</span>GB     |</span><br><span class="line">| cosmo_szjsj_1049       | <span class="number">1.87</span>GB    | <span class="number">0.85</span>GB     |</span><br><span class="line">| cosmo_tjbl_1021        | <span class="number">1.45</span>GB    | <span class="number">0.81</span>GB     |</span><br><span class="line">| cosmo_szjsj_1048       | <span class="number">1.35</span>GB    | <span class="number">0.61</span>GB     |</span><br><span class="line">| cosmo_jzzjc_2064       | <span class="number">1.01</span>GB    | <span class="number">0.28</span>GB     |</span><br><span class="line">| cosmo_zddr_1057        | <span class="number">1.00</span>GB    | <span class="number">0.12</span>GB     |</span><br><span class="line">| cosmo_lycd_1014        | <span class="number">0.92</span>GB    | <span class="number">0.05</span>GB     |</span><br><span class="line">| cosmo_wms              | <span class="number">0.78</span>GB    | <span class="number">0.52</span>GB     |</span><br><span class="line">| cosmo_wms_penghai      | <span class="number">0.52</span>GB    | <span class="number">0.47</span>GB     |</span><br><span class="line">| cosmo_zzktwk_ruig_2053 | <span class="number">0.49</span>GB    | <span class="number">0.17</span>GB     |</span><br><span class="line">| cosmo_zzktwk_2054      | <span class="number">0.16</span>GB    | <span class="number">0.07</span>GB     |</span><br><span class="line">| cosmo_fsgtwk_2047      | <span class="number">0.14</span>GB    | <span class="number">0.05</span>GB     |</span><br><span class="line">| cosmo_zzwk_2048        | <span class="number">0.12</span>GB    | <span class="number">0.05</span>GB     |</span><br><span class="line">| cosmo_plat             | <span class="number">0.12</span>GB    | <span class="number">0.06</span>GB     |</span><br><span class="line">| cosmo_jzkg_2056        | <span class="number">0.11</span>GB    | <span class="number">0.05</span>GB     |</span><br><span class="line">| cosmo_zysjwk_jad       | <span class="number">0.09</span>GB    | <span class="number">0.05</span>GB     |</span><br><span class="line">| cosmo_zysjwk_2085      | <span class="number">0.04</span>GB    | <span class="number">0.01</span>GB     |</span><br><span class="line">| cosmo_qddz_1055        | <span class="number">0.03</span>GB    | <span class="number">0.02</span>GB     |</span><br><span class="line">| cosmo_zysjwk_bw        | <span class="number">0.02</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">| cosmo_xyyjwk           | <span class="number">0.02</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">| cosmo_eng_1414         | <span class="number">0.01</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">| cosmo_penghai_1215     | <span class="number">0.01</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">| cosmo_zdbx_1058        | <span class="number">0.00</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">| cosmo_plat_penghai     | <span class="number">0.00</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">+------------------------+-----------+------------+</span><br><span class="line"><span class="number">33</span> rows <span class="keyword">in</span> set, <span class="number">20</span> warnings (<span class="number">6.91</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.133.7.31:3306æŒ‰åº“å¤§å°æ’åº</span></span><br><span class="line">+--------------------+-----------+------------+</span><br><span class="line">| table_schema       | data_size | index_size |</span><br><span class="line">+--------------------+-----------+------------+</span><br><span class="line">| cosmo_epg_5001     | <span class="number">9.37</span>GB    | <span class="number">4.27</span>GB     |</span><br><span class="line">| cosmo_cqjm_5006    | <span class="number">7.32</span>GB    | <span class="number">3.72</span>GB     |</span><br><span class="line">| epg_hdme_5004      | <span class="number">6.64</span>GB    | <span class="number">3.31</span>GB     |</span><br><span class="line">| epg_hdzn_5015      | <span class="number">5.85</span>GB    | <span class="number">3.56</span>GB     |</span><br><span class="line">| epg_hfsj_5007      | <span class="number">5.44</span>GB    | <span class="number">2.64</span>GB     |</span><br><span class="line">| epg_jzbp_5002      | <span class="number">4.44</span>GB    | <span class="number">1.65</span>GB     |</span><br><span class="line">| cosmo_dljm_5005    | <span class="number">3.24</span>GB    | <span class="number">1.08</span>GB     |</span><br><span class="line">| epg_jnjm_5003      | <span class="number">2.63</span>GB    | <span class="number">0.64</span>GB     |</span><br><span class="line">| cosmo_wms          | <span class="number">0.30</span>GB    | <span class="number">0.13</span>GB     |</span><br><span class="line">| cosmo_plat         | <span class="number">0.16</span>GB    | <span class="number">0.07</span>GB     |</span><br><span class="line">| epg_tjwk_2095      | <span class="number">0.01</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">| epg_whzn_5012      | <span class="number">0.00</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">| epg_cqzn_5009      | <span class="number">0.00</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">| epg_hfzn_5013      | <span class="number">0.00</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">| epg_qdzn_5016      | <span class="number">0.00</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">| epg_sdbp_5011      | <span class="number">0.00</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">| epg_whdk_5014      | <span class="number">0.00</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">| epg_zzzn_5010      | <span class="number">0.00</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">| epg_sddz_5008      | <span class="number">0.00</span>GB    | <span class="number">0.00</span>GB     |</span><br><span class="line">+--------------------+-----------+------------+</span><br><span class="line"><span class="number">23</span> rows <span class="keyword">in</span> set (<span class="number">0.90</span> sec)</span><br></pre></td></tr></table></figure>

<h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">wms:</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    initialSize:</span> <span class="number">50</span></span><br><span class="line"><span class="attr">    maxActive:</span> <span class="number">400</span></span><br><span class="line"><span class="attr">    maxIdle:</span> <span class="number">50</span></span><br><span class="line"><span class="attr">    minIdle:</span> <span class="number">50</span></span><br><span class="line"><span class="attr">    maxWait:</span> <span class="number">10000</span></span><br><span class="line"><span class="attr">    ds1:</span></span><br><span class="line"><span class="attr">      driver:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">      url:</span> <span class="attr">jdbc:mysql://10.138.228.165:3306?juseUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">wms</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">xx</span></span><br><span class="line"><span class="attr">    ds2:</span></span><br><span class="line"><span class="attr">      driver:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">      url:</span> <span class="attr">jdbc:mysql://10.133.7.31:3306?useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">cosmowms_epg</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">xx</span></span><br><span class="line"><span class="attr">    ds3:</span></span><br><span class="line"><span class="attr">      driver:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">      url:</span> <span class="attr">jdbc:mysql://10.138.228.165:3306/cosmo_hdzk?useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">wms</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">xx</span></span><br><span class="line"><span class="attr">    ds4:</span></span><br><span class="line"><span class="attr">      driver:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">      url:</span> <span class="attr">jdbc:mysql://10.138.228.165:3306/cosmo_hdzkwk?useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">wms</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">xx</span></span><br></pre></td></tr></table></figure>

<h2 id="å­˜åœ¨çš„é—®é¢˜"><a href="#å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜"></a>å­˜åœ¨çš„é—®é¢˜</h2><ul>
<li>å¤§é‡ä½¿ç”¨è§†å›¾</li>
</ul>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-30-161930.png" alt></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>Java ç¬”è®°</title>
    <url>/blog/2019/10/29/java/</url>
    <content><![CDATA[<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-11-20-173000.jpg" alt></p>
<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ul>
<li><a href="https://huiraoo.github.io/blog/2019/11/18/java-ide/">Java Â· å¼€å‘ç¯å¢ƒ</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/11/18/java-basic-programming-structure/">Java Â· åŸºæœ¬ç¨‹åºè®¾è®¡</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/11/20/java-object-and-class/">Java Â· é«˜çº§ç‰¹æ€§</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/11/25/java-frame-mybatis/">Java Â· æ¡†æ¶ Â· MyBatis</a></li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://www.jianshu.com/p/2d6206e77cdd" target="_blank" rel="noopener">æ¨èä¹¦</a></li>
<li><a href="https://gitee.com/explore/all?lang=Java" target="_blank" rel="noopener">ä»£ç </a></li>
</ul>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· é…ç½®å‚æ•° Â· sql_mode</title>
    <url>/blog/2019/10/29/mysql-config-sql-mode/</url>
    <content><![CDATA[<h2 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h2><p><strong><a href="https://dev.mysql.com/doc/refman/5.6/en/sql-mode.html#sql-mode-strict" target="_blank" rel="noopener">sql_mode</a></strong>ï¼šå®ƒå®šä¹‰äº† MySQL åº”è¯¥æ”¯æŒçš„ <code>SQL</code> æ¨¡å¼ï¼Œå¯¹æ•°æ®çš„æ ¡éªŒç­‰ã€‚</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Command-Line Format</strong></td>
<td><code>--sql-mode=name</code></td>
</tr>
<tr>
<td><strong>System Variable</strong></td>
<td><code>sql_mode</code></td>
</tr>
<tr>
<td><strong>Scope</strong></td>
<td>Global, Session</td>
</tr>
<tr>
<td><strong>Dynamic</strong></td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Type</strong></td>
<td>Set</td>
</tr>
<tr>
<td><strong>Default Value</strong> (&gt;= 5.7.8)</td>
<td><code>ONLY_FULL_GROUP_BY STRICT_TRANS_TABLES NO_ZERO_IN_DATE NO_ZERO_DATE ERROR_FOR_DIVISION_BY_ZERO NO_AUTO_CREATE_USER NO_ENGINE_SUBSTITUTION</code></td>
</tr>
<tr>
<td><strong>Default Value</strong> (5.7.7)</td>
<td><code>ONLY_FULL_GROUP_BY STRICT_TRANS_TABLES NO_AUTO_CREATE_USER NO_ENGINE_SUBSTITUTION</code></td>
</tr>
<tr>
<td><strong>Default Value</strong> (&gt;= 5.7.5, &lt;= 5.7.6)</td>
<td><code>ONLY_FULL_GROUP_BY STRICT_TRANS_TABLES NO_ENGINE_SUBSTITUTION</code></td>
</tr>
<tr>
<td><strong>Default Value</strong> (&lt;= 5.7.4)</td>
<td><code>NO_ENGINE_SUBSTITUTION</code></td>
</tr>
<tr>
<td><strong>Valid Values</strong></td>
<td>â€¦.</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; select @@global.sql_mode;</span><br><span class="line">+<span class="comment">-------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| @@global.sql_mode                                                                                                                         |</span><br><span class="line">+<span class="comment">-------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION |</span><br><span class="line">+<span class="comment">-------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>ONLY_FULL_GROUP_BY</code>ï¼š<code>SELECT</code> å†…æŒ‡å®šå­—æ®µå¿…é¡»å‡ºç°åœ¨ <code>ORDER BY</code> ä¸­ï¼Œå¦åˆ™é”™è¯¯ã€‚</li>
<li><code>STRICT_TRANS_TABLES</code>ï¼šä¸ºäº‹åŠ¡å­˜å‚¨å¼•æ“å¯ç”¨ä¸¥æ ¼çš„ <code>SQL</code> æ¨¡å¼ã€‚</li>
<li><code>NO_ZERO_IN_DATE</code>ï¼šä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä¸æ¥å—æœˆæˆ–æ—¥éƒ¨åˆ†ä¸º <code>0</code> çš„æ—¥æœŸã€‚</li>
<li><code>NO_ZERO_DATE</code>ï¼šä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œè®¤ä¸ºæ—¥æœŸ <code>&#39;0000-00-00&#39;</code> éæ³•ã€‚</li>
<li><code>ERROR_FOR_DIVISION_BY_ZERO</code>ï¼šä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œé™¤ <code>0</code> é”™è¯¯ã€‚</li>
<li><code>NO_AUTO_CREATE_USER</code>ï¼šæˆæƒä¹‹å‰å¿…é¡»å…ˆåˆ›å»ºç”¨æˆ·ã€‚</li>
<li><code>NO_ENGINE_SUBSTITUTION</code>ï¼šå¦‚æœéœ€è¦çš„å­˜å‚¨å¼•æ“è¢«ç¦ç”¨æˆ–æœªç¼–è¯‘ï¼Œé‚£ä¹ˆæŠ›å‡ºé”™è¯¯ã€‚</li>
<li><code>STRICT_ALL_TABLES</code>ï¼šä¸ºæ‰€æœ‰å­˜å‚¨å¼•æ“å¯ç”¨ä¸¥æ ¼ <code>SQL</code> æ¨¡å¼ï¼Œæ— æ•ˆçš„æ•°æ®å€¼æŠ¥é”™ã€‚</li>
</ul>
<h2 id="è®¾ç½®"><a href="#è®¾ç½®" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h2><ul>
<li><strong>åŠ¨æ€è®¾ç½®</strong></li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; set global sql_mode='NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES';</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>é™æ€è®¾ç½®</strong></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">sql_mode = NO_ENGINE_SUBSTITUTION</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>é˜¿é‡Œäº‘ RDS è®¾ç½®</strong></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">sql_mode=REAL_AS_FLOAT,PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,NO_UNSIGNED_SUBTRACTION,NO_DIR_</span><br><span class="line">IN_CREATE,POSTGRESQL,ORACLE,MSSQL,DB2,MAXDB,NO_KEY_OPTIONS,NO_TABLE_OPTIONS,NO_FIELD_OPTIONS,MYSQL</span><br><span class="line"><span class="number">323</span>,MYSQL40,ANSI,NO_AUTO_VALUE_ON_ZERO,NO_BACKSLASH_ESCAPES,STRICT_TRANS_TABLES,STRICT_ALL_TABLES,</span><br><span class="line">NO_ZERO_IN_DATE,NO_ZERO_DATE,ALLOW_INVALID_DATES,ERROR_FOR_DIVISION_BY_ZERO,TRADITIONAL,HIGH_NOT</span><br><span class="line">_PRECEDENCE,NO_ENGINE_SUBSTITUTION,PAD_CHAR_TO_FULL_LENGTH</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· é…ç½®å‚æ•° Â· skip_name_resolve</title>
    <url>/blog/2019/10/29/mysql-config-skip-name-resolve/</url>
    <content><![CDATA[<h2 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h2><p><a href="https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_skip_name_resolve" target="_blank" rel="noopener"><strong>skip_name_resolve</strong></a>ï¼šæ£€æŸ¥å®¢æˆ·ç«¯è¿æ¥æ—¶æ˜¯å¦è§£æä¸»æœºåã€‚</p>
<ul>
<li><strong>OFF</strong>ï¼šé»˜è®¤çŠ¶æ€ï¼Œä»…åœ¨ç¬¬ä¸€æ¬¡å»ºç«‹è¿æ¥æ—¶ç¼“å­˜ <code>IP</code> å’Œ <code>Host Name</code> çš„æ˜ å°„å…³ç³»ï¼ŒåŒä¸€ä¸»æœºçš„åç»­è¿æ¥å°†ç›´æ¥æŸ¥çœ‹ <code>Host Cache</code>ï¼Œè€Œä¸ç”¨å†æ¬¡è¿›è¡Œ <code>DNS</code> è§£æã€‚</li>
<li><strong>ON</strong>ï¼šç¦æ­¢ <code>DNS</code> è§£æï¼Œå¯ç”¨å MySQL æˆæƒè¡¨ä¸­å°±ä¸èƒ½ä½¿ç”¨ä¸»æœºåäº†ï¼Œåªèƒ½ä½¿ç”¨ <code>IP</code>ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Command-Line Format</strong></td>
<td><code>--skip-name-resolve=#</code></td>
</tr>
<tr>
<td><strong>System Variable</strong></td>
<td><code>skip_name_resolve</code></td>
</tr>
<tr>
<td><strong>Scope</strong></td>
<td>Global</td>
</tr>
<tr>
<td><strong>Dynamic</strong></td>
<td>No</td>
</tr>
<tr>
<td><strong>Type</strong></td>
<td>Boolean</td>
</tr>
<tr>
<td><strong>Default Value</strong></td>
<td><code>OFF</code></td>
</tr>
</tbody></table>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show variables like <span class="string">'skip_name_resolve'</span>;</span><br><span class="line">+-------------------+-------+</span><br><span class="line">| Variable_name     | Value |</span><br><span class="line">+-------------------+-------+</span><br><span class="line">| skip_name_resolve | OFF   |</span><br><span class="line">+-------------------+-------+</span><br><span class="line"></span><br><span class="line">MariaDB [mysql]&gt; select user,host,password from user;</span><br><span class="line">+-------------+---------------+-------------------------------------------+</span><br><span class="line">| user        | host          | password                                  |</span><br><span class="line">+-------------+---------------+-------------------------------------------+</span><br><span class="line">| root        | localhost     | *C655557AE3BD4264288BB5C1ED8126A364A6F7ED |</span><br><span class="line">| root        | hlht\_db3     | *C655557AE3BD4264288BB5C1ED8126A364A6F7ED |</span><br><span class="line">| root        | <span class="number">127.0</span>.<span class="number">0.1</span>     | *C655557AE3BD4264288BB5C1ED8126A364A6F7ED |</span><br><span class="line">| root        | ::<span class="number">1</span>           | *C655557AE3BD4264288BB5C1ED8126A364A6F7ED |</span><br><span class="line">| read_only   | %             | *<span class="number">47646</span>ED664BFD993442F175266B6F4367E8CA123 |</span><br><span class="line">| retl        | %             | *<span class="number">44</span>AB89E92CDF5A148EC5A8BCE2BBEF1E51AAC48D |</span><br><span class="line">| sre         | %             | *<span class="number">66</span>CC8D8F94978869E17ABDA6FD2E1A5D817E619E |</span><br><span class="line">| hdm         | %             | *<span class="number">14533888</span>C6CA3952B3957903FF7E69469C7E3A2B |</span><br><span class="line">+-------------+---------------+-------------------------------------------+</span><br></pre></td></tr></table></figure>

<h2 id="è®¾ç½®"><a href="#è®¾ç½®" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h2><ul>
<li><strong>é…ç½®æ–‡ä»¶ <code>my.cnf</code></strong> </li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">skip-name-resolve</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>æ—¥å¿—è­¦å‘Š</strong></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># skip_name_resolve = OFF</span></span><br><span class="line">[Warning] IP address <span class="string">'10.163.25.68'</span> could not be resolved: Name or service not known</span><br><span class="line"></span><br><span class="line"><span class="comment"># skip_name_resolve = ON</span></span><br><span class="line">[Warning] <span class="string">'user'</span> entry <span class="string">'mysql.session@localhost'</span> ignored <span class="keyword">in</span> --skip-name-resolve mode</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>Linux ç£ç›˜ç›¸å…³çŸ¥è¯†</title>
    <url>/blog/2019/10/25/linux-disk/</url>
    <content><![CDATA[<h2 id="ç£ç›˜ç±»å‹"><a href="#ç£ç›˜ç±»å‹" class="headerlink" title="ç£ç›˜ç±»å‹"></a>ç£ç›˜ç±»å‹</h2><p><strong>æŒ‰ç…§æè´¨åˆ†ç±»</strong>ï¼š</p>
<ul>
<li><strong>HDDï¼ˆHard Disk Driverï¼‰</strong>ï¼šä¼ ç»Ÿç¡¬ç›˜ï¼Œå³æœºæ¢°ç¡¬ç›˜</li>
<li><strong>SSDï¼ˆSolid State Diskï¼‰</strong>ï¼šå›ºæ€ç¡¬ç›˜ï¼Œæ˜¯ä¸€ç§ä¸»è¦ä»¥é—ªå­˜ä½œä¸ºæ°¸ä¹…æ€§å­˜å‚¨å™¨çš„è®¡ç®—æœºå­˜å‚¨è®¾å¤‡ã€‚</li>
</ul>
<p><strong>æŒ‰ç…§ç¡¬ç›˜æ¥å£åˆ†ç±»</strong>ï¼šç¡¬ç›˜æ¥å£æ˜¯æŒ‡ç¡¬ç›˜ä¸ä¸»æ¿ä¹‹é—´çš„è¿æ¥æ–¹å¼</p>
<ul>
<li><strong>SATA</strong>ï¼šä¸²å½¢é«˜æŠ€æœ¯é…ç½®æ¥å£</li>
<li><strong>SAS</strong>ï¼šä¸²å½¢å°å‹è®¡ç®—æœºç³»ç»Ÿæ¥å£</li>
<li><strong>SAS</strong> æ¥å£çš„ç¡¬ç›˜æ¯” <strong>SATA</strong> æ¥å£çš„ç¡¬ç›˜ä¼ è¾“é€Ÿåº¦è¦å¿«å¾ˆå¤šï¼Œå¹¶ä¸”æ€§èƒ½ä¹Ÿé«˜å¾ˆå¤š</li>
</ul>
<p><strong>ç£ç›˜ç±»å‹</strong>ï¼šä½¿ç”¨ <code>lsblk</code> å‘½ä»¤è¿›è¡Œåˆ¤æ–­</p>
<ul>
<li><code>-d</code> ï¼Œè¡¨ç¤ºæ˜¾ç¤ºè®¾å¤‡åç§°</li>
<li><code>-o</code> ï¼Œè¡¨ç¤ºä»…æ˜¾ç¤ºç‰¹å®šçš„åˆ—</li>
<li><code>ROTA</code> æ˜¯ <code>1</code> çš„è¡¨ç¤ºå¯ä»¥æ—‹è½¬ï¼Œç£ç›˜ç±»å‹æ˜¯ <code>HDD</code>ã€‚</li>
<li><code>ROTA</code> æ˜¯ <code>0</code> çš„è¡¨ç¤ºä¸å¯ä»¥æ—‹è½¬ï¼Œå°±æœ‰å¯èƒ½æ˜¯ <code>SSD</code>ã€‚</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ lsblk -d -o name,rota</span><br><span class="line">NAME ROTA</span><br><span class="line">fd0     <span class="number">1</span></span><br><span class="line">sda     <span class="number">1</span></span><br><span class="line">sdb     <span class="number">1</span></span><br><span class="line">sr0     <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="ç£ç›˜æ€§èƒ½"><a href="#ç£ç›˜æ€§èƒ½" class="headerlink" title="ç£ç›˜æ€§èƒ½"></a>ç£ç›˜æ€§èƒ½</h2><p><strong>ç¡¬ç›˜æ€§èƒ½æŒ‡æ ‡</strong>ï¼šIOPS (Input / Output Per Second) å³æ¯ç§’çš„è¾“å…¥è¾“å‡ºé‡ï¼ˆè¯»å†™æ¬¡æ•°ï¼‰ï¼Œæ˜¯è¡¡é‡ç£ç›˜æ€§èƒ½çš„ä¸»è¦æŒ‡æ ‡ä¹‹ä¸€ã€‚</p>
<p>ä½¿ç”¨ <code>dd</code> æµ‹è¯•ç¡¬ç›˜ååé‡ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ dd <span class="keyword">if</span>=/dev/zero of=/dev/sda bs=<span class="number">4</span>k count=<span class="number">3000</span> oflag=direct</span><br><span class="line">è®°å½•äº†<span class="number">3000</span>+<span class="number">0</span> çš„è¯»å…¥</span><br><span class="line">è®°å½•äº†<span class="number">3000</span>+<span class="number">0</span> çš„å†™å‡º</span><br><span class="line"><span class="number">12288000</span>å­—èŠ‚(<span class="number">12</span> MB)å·²å¤åˆ¶ï¼Œ<span class="number">0.0791091</span> ç§’ï¼Œ<span class="number">155</span> MB/ç§’</span><br></pre></td></tr></table></figure>

<p><strong>æ€»ç»“</strong>ï¼š<code>SSD</code> çš„éšæœº <code>IO</code> è¯»å†™èƒ½åŠ›æ˜¯ <code>SATA</code> å’Œ <code>SAS</code> æœºæ¢°ç¡¬ç›˜çš„ä¸€åƒå¤šå€ï¼Œé¡ºåºè¯»å†™èƒ½åŠ›åŸºæœ¬å’Œ <code>SSD</code> ä¿æŒåŒæ ·çš„æ•°é‡çº§ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· é…ç½®å‚æ•° Â· expire_logs_days</title>
    <url>/blog/2019/10/25/mysql-config-expire-logs-days/</url>
    <content><![CDATA[<h2 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h2><p><a href="https://dev.mysql.com/doc/refman/5.7/en/replication-options-binary-log.html#sysvar_expire_logs_days" target="_blank" rel="noopener"><strong>expire_logs_days</strong></a>ï¼šæ§åˆ¶ <code>binlog</code> æ—¥å¿—çš„è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æ˜¯ <code>0</code> è¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼Œå•ä½æ˜¯å¤©ã€‚</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Command-Line Format</strong></td>
<td><code>--expire-logs-days=#</code></td>
</tr>
<tr>
<td><strong>System Variable</strong></td>
<td><code>expire_logs_days</code></td>
</tr>
<tr>
<td><strong>Scope</strong></td>
<td>Global</td>
</tr>
<tr>
<td><strong>Dynamic</strong></td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Type</strong></td>
<td>Integer</td>
</tr>
<tr>
<td><strong>Default Value</strong></td>
<td><code>0</code></td>
</tr>
<tr>
<td><strong>Minimum Value</strong></td>
<td><code>0</code></td>
</tr>
<tr>
<td><strong>Maximum Value</strong></td>
<td><code>99</code></td>
</tr>
</tbody></table>
<h2 id="è®¾ç½®"><a href="#è®¾ç½®" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h2><ul>
<li><strong>æ°¸ä¹…ç”Ÿæ•ˆ</strong></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /etc/my.cnf</span></span><br><span class="line">expire_logs_days = <span class="number">7</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like "expire_logs%";</span><br><span class="line">+<span class="comment">------------------+-------+</span></span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+<span class="comment">------------------+-------+</span></span><br><span class="line">| expire_logs_days | 7     |</span><br><span class="line">+<span class="comment">------------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>ä¸´æ—¶ç”Ÿæ•ˆ</strong></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®ä¿ç•™7å¤©</span></span><br><span class="line">set global expire_logs_days = <span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ·æ–°æ—¥å¿—</span></span><br><span class="line">flush logs;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Warning</strong>ï¼šä»¥ä¸Šå‘½ä»¤åœ¨æ•°æ®åº“æ‰§è¡Œä¼šç«‹å³ç”Ÿæ•ˆï¼Œè¯·ç¡®å®šè®¾ç½®æ•°æ®çš„ä¿ç•™æ—¥æœŸï¼Œä»¥å…è¯¯åˆ ï¼</p>
</blockquote>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· é…ç½®å‚æ•° Â· sync_binlog</title>
    <url>/blog/2019/10/25/mysql-config-sync-binlog/</url>
    <content><![CDATA[<h2 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h2><p><a href="https://dev.mysql.com/doc/refman/5.7/en/replication-options-binary-log.html#sysvar_sync_binlog" target="_blank" rel="noopener"><strong>sync_binlog</strong></a>ï¼šæ§åˆ¶ MySQL äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆ<code>binlog</code>ï¼‰åŒæ­¥åˆ°ç£ç›˜çš„é¢‘ç‡ã€‚</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Command-Line Format</strong></td>
<td><code>--sync-binlog=#</code></td>
</tr>
<tr>
<td><strong>System Variable</strong></td>
<td><code>sync_binlog</code></td>
</tr>
<tr>
<td><strong>Scope</strong></td>
<td>Global</td>
</tr>
<tr>
<td><strong>Dynamic</strong></td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Type</strong></td>
<td>Integer</td>
</tr>
<tr>
<td><strong>Default Value</strong> (&gt;= 5.7.7)</td>
<td><code>1</code></td>
</tr>
<tr>
<td><strong>Default Value</strong> (&lt;= 5.7.6)</td>
<td><code>0</code></td>
</tr>
<tr>
<td><strong>Minimum Value</strong></td>
<td><code>0</code></td>
</tr>
<tr>
<td><strong>Maximum Value</strong></td>
<td><code>4294967295</code></td>
</tr>
</tbody></table>
<ul>
<li><strong>sync_binlog = 0</strong>ï¼Œæ¯è¿›è¡Œäº‹åŠ¡æäº¤åï¼ŒMySQL ä¸åš <code>fsync</code> ä¹‹ç±»çš„ç£ç›˜åŒæ­¥æŒ‡ä»¤åˆ·æ–° <code>binlog_cache</code> ä¸­çš„ä¿¡æ¯åˆ°ç£ç›˜ï¼Œè€Œè®©æ–‡ä»¶ç³»ç»Ÿè‡ªè¡Œå†³å®šä»€ä¹ˆæ—¶å€™æ¥åšåŒæ­¥ï¼Œæˆ–è€… <code>cache</code> æ»¡äº†ä¹‹åæ‰åŒæ­¥åˆ°ç£ç›˜ã€‚</li>
<li><strong>sync_binlog = 1</strong>ï¼Œæ¯è¿›è¡Œ <code>1</code> æ¬¡äº‹åŠ¡æäº¤ï¼ŒMySQL å°†è¿›è¡Œä¸€æ¬¡ <code>fsync</code> ä¹‹ç±»çš„ç£ç›˜åŒæ­¥æŒ‡ä»¤æ¥å°† <code>binlog_cache</code> ä¸­çš„æ•°æ®å¼ºåˆ¶å†™å…¥ç£ç›˜ã€‚</li>
<li><strong>sync_binlog = N</strong>ï¼Œæ¯è¿›è¡Œ <code>N</code> æ¬¡äº‹åŠ¡æäº¤ï¼ŒMySQL å°†è¿›è¡Œä¸€æ¬¡ <code>fsync</code> ä¹‹ç±»çš„ç£ç›˜åŒæ­¥æŒ‡ä»¤æ¥å°† <code>binlog_cache</code> ä¸­çš„æ•°æ®å¼ºåˆ¶å†™å…¥ç£ç›˜ã€‚</li>
</ul>
<h2 id="è®¾ç½®"><a href="#è®¾ç½®" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h2><ul>
<li><strong>æ€§èƒ½</strong>ï¼š0 &gt; N &gt; 1</li>
<li><strong>å®‰å…¨</strong>ï¼š1 &gt; N &gt; 0</li>
<li><strong>å»ºè®®</strong>ï¼šåŒºåˆ†ä¸šåŠ¡åœºæ™¯è¿›è¡Œè®¾ç½® </li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ”¯ä»˜åœºæ™¯ï¼šsync_binlog = 1</span></span><br><span class="line"><span class="comment"># å…¶ä»–åœºæ™¯ï¼šsync_binlog = 0</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· é…ç½®å‚æ•° Â· innodb_flush_log_at_trx_commit</title>
    <url>/blog/2019/10/25/mysql-config-innodb-flush-log-at-trx-commit/</url>
    <content><![CDATA[<h2 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h2><p><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_flush_log_at_trx_commit" target="_blank" rel="noopener"><strong>innodb_flush_log_at_trx_commit</strong></a>ï¼šæ§åˆ¶ <code>ib_logfile</code> æ—¥å¿—ï¼ˆè®°å½• <code>redo log</code>  <code>undo log</code> ä¿¡æ¯ï¼‰çš„åˆ·æ–°æ–¹å¼ã€‚</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Command-Line Format</strong></td>
<td><code>--innodb-flush-log-at-trx-commit=#</code></td>
</tr>
<tr>
<td><strong>System Variable</strong></td>
<td><code>innodb_flush_log_at_trx_commit</code></td>
</tr>
<tr>
<td><strong>Scope</strong></td>
<td>Global</td>
</tr>
<tr>
<td><strong>Dynamic</strong></td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Type</strong></td>
<td>Enumeration</td>
</tr>
<tr>
<td><strong>Default Value</strong></td>
<td><code>1</code></td>
</tr>
<tr>
<td><strong>Valid Values</strong></td>
<td><code>0</code> <code>1</code> <code>2</code></td>
</tr>
</tbody></table>
<ul>
<li><strong>innodb_flush_log_at_trx_commit = 0</strong>ï¼Œè¡¨ç¤ºæ¯éš” 1 ç§’æŠŠ <code>log buffer</code> åˆ·åˆ° <code>log file</code> ä¸­å»ï¼Œå¹¶ä¸”åŒæ—¶è°ƒç”¨æ–‡ä»¶ç³»ç»Ÿçš„ <code>flush</code> æ“ä½œå°†ç¼“å­˜åˆ·æ–°åˆ°ç£ç›˜ä¸Šå»ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ç§’ä¹‹å‰çš„æ—¥å¿—éƒ½ä¿å­˜åœ¨æ—¥å¿—ç¼“å†²åŒºï¼Œä¹Ÿå°±æ˜¯å†…å­˜ä¸Šï¼Œåœ¨<strong>mysqld è¿›ç¨‹å´©æºƒ</strong>çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¸¢å¤± 1 ç§’çš„äº‹åŠ¡æ•°æ®ã€‚</li>
<li><strong>innodb_flush_log_at_trx_commit = 1</strong>ï¼Œè¡¨ç¤ºåœ¨æ¯æ¬¡äº‹åŠ¡æäº¤åï¼Œä¼šæŠŠ <code>log buffer</code> åˆ·åˆ° <code>log file</code> ä¸­å»ï¼Œå¹¶ä¸”è°ƒç”¨æ–‡ä»¶ç³»ç»Ÿçš„ <code>flush</code> æ“ä½œå°†ç¼“å­˜åˆ·æ–°åˆ°ç£ç›˜ä¸Šå»ã€‚</li>
<li><strong>innodb_flush_log_at_trx_commit = 2</strong>ï¼Œè¡¨ç¤ºåœ¨æ¯æ¬¡äº‹åŠ¡æäº¤åï¼Œä¼šæŠŠ <code>log buffer</code> åˆ·åˆ° <code>log file</code> ä¸­å»ï¼Œä½†å¹¶ä¸ä¼šç«‹å³åˆ·å†™åˆ°ç£ç›˜ã€‚åªæœ‰åœ¨<strong>æ•°æ®åº“æ‰€åœ¨çš„ä¸»æœºæ“ä½œç³»ç»ŸæŸåæˆ–è€…çªç„¶æ‰ç”µ</strong>çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¸¢å¤± 1 ç§’çš„äº‹åŠ¡æ•°æ®ã€‚</li>
</ul>
<h2 id="è®¾ç½®"><a href="#è®¾ç½®" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h2><ul>
<li><strong>æ€§èƒ½</strong>ï¼š0 &gt; 2 &gt; 1</li>
<li><strong>å®‰å…¨</strong>ï¼š1 &gt; 2 &gt;0</li>
<li><strong>æ¨è</strong>ï¼šåŒºåˆ†ä¸šåŠ¡åœºæ™¯è¿›è¡Œè®¾ç½®</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ”¯ä»˜åœºæ™¯ï¼šinnodb_flush_log_at_trx_commit = 1</span></span><br><span class="line"><span class="comment"># å…¶ä»–åœºæ™¯ï¼šinnodb_flush_log_at_trx_commit = 2</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· é…ç½®å‚æ•° Â· max_connections</title>
    <url>/blog/2019/10/24/mysql-config-max-connections/</url>
    <content><![CDATA[<h2 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h2><ul>
<li><strong><a href="https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_max_connections" target="_blank" rel="noopener">max_connections</a></strong>ï¼šMySQL å®ä¾‹æœ€å¤§è¿æ¥æ•°ã€‚</li>
<li><strong>Max_used_connections</strong>ï¼šæ˜¯æŒ‡ä»æœ¬æ¬¡ MySQL æœåŠ¡å¯åŠ¨åˆ°ç°åœ¨ï¼ŒåŒä¸€æ—¶åˆ»å¹¶è¡Œè¿æ¥æ•°çš„æœ€å¤§å€¼ï¼Œä¸æ˜¯æŒ‡å½“å‰çš„è¿æ¥æƒ…å†µï¼Œè€Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå€¼ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Command-Line Format</strong></td>
<td><code>--max-connections=#</code></td>
</tr>
<tr>
<td><strong>System Variable</strong></td>
<td><code>max_connections</code></td>
</tr>
<tr>
<td><strong>Scope</strong></td>
<td>Global</td>
</tr>
<tr>
<td><strong>Dynamic</strong></td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Type</strong></td>
<td>Integer</td>
</tr>
<tr>
<td><strong>Default Value</strong></td>
<td><code>151</code></td>
</tr>
<tr>
<td><strong>Minimum Value</strong></td>
<td><code>1</code></td>
</tr>
<tr>
<td><strong>Maximum Value</strong></td>
<td><code>100000</code></td>
</tr>
</tbody></table>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">"max_connections"</span>;</span><br><span class="line">+-----------------+-------+</span><br><span class="line">| Variable_name   | Value |</span><br><span class="line">+-----------------+-------+</span><br><span class="line">| max_connections | <span class="number">1000</span>  |</span><br><span class="line">+-----------------+-------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show status like <span class="string">"max_used%"</span>;</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| Variable_name        | Value |</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| Max_used_connections | <span class="number">391</span>   |</span><br><span class="line">+----------------------+-------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h2 id="è®¾ç½®"><a href="#è®¾ç½®" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h2><p><strong>æ¨è</strong>ï¼šå¦‚æœè®¾ç½®å¤ªé«˜ç¡¬ä»¶åƒä¸æ¶ˆï¼Œå¤ªä½åˆä¸èƒ½å……åˆ†åˆ©ç”¨ç¡¬ä»¶ï¼Œä¸€èˆ¬è¦æ±‚ä¸¤è€…æ¯”å€¼è¶…è¿‡ <code>10%</code>ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">Max_used_connections / max_connections * <span class="number">100</span>%  &gt; <span class="number">10</span>%</span><br></pre></td></tr></table></figure>

<p><strong>æ–¹æ³•</strong>ï¼š<code>/etc/my.cnf</code> æ·»åŠ å‚æ•° <code>max_connections = 1000</code>ï¼Œè¿™ä¸ªå€¼çš„å¤§å°å–å†³äºæœåŠ¡å™¨çš„é…ç½®ã€‚</p>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>å¦‚æœä½ çœ‹åˆ°æ•°æ®åº“æŠ¥ <code>&quot;Too many connections&quot;</code> é”™è¯¯ï¼Œæ˜¯å› ä¸ºå½“å‰è¿æ¥æ•°è¶…è¿‡ <code>max_connections</code> è®¾ç½®çš„å€¼ï¼Œå¸¸è§çš„åŸå› æ˜¯åº”ç”¨ç¨‹åºæ²¡æœ‰æ­£ç¡®çš„å…³é—­æ•°æ®åº“è¿æ¥ï¼Œåº”ç”¨ç¨‹åºä½¿ç”¨è¿æ¥æ± æœ‰åŠ©äºè§£å†³è¿™ä¸€é—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· è°ƒä¼˜æ¡ˆä¾‹ Â· JOIN</title>
    <url>/blog/2019/10/24/mysql-tuning-join/</url>
    <content><![CDATA[<h2 id="JOIN"><a href="#JOIN" class="headerlink" title="JOIN"></a>JOIN</h2><p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-11-13-175000.jpg" alt></p>
<h3 id="INNER-JOINï¼ˆå†…è¿æ¥ï¼‰"><a href="#INNER-JOINï¼ˆå†…è¿æ¥ï¼‰" class="headerlink" title="INNER JOINï¼ˆå†…è¿æ¥ï¼‰"></a>INNER JOINï¼ˆå†…è¿æ¥ï¼‰</h3><p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-11-13-175100.gif" alt></p>
<h3 id="LEFT-JOINï¼ˆå·¦è¿æ¥ï¼‰"><a href="#LEFT-JOINï¼ˆå·¦è¿æ¥ï¼‰" class="headerlink" title="LEFT JOINï¼ˆå·¦è¿æ¥ï¼‰"></a>LEFT JOINï¼ˆå·¦è¿æ¥ï¼‰</h3><p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-11-13-175200.gif" alt></p>
<h3 id="RIGHT-JOINï¼ˆå³è¿æ¥ï¼‰"><a href="#RIGHT-JOINï¼ˆå³è¿æ¥ï¼‰" class="headerlink" title="RIGHT JOINï¼ˆå³è¿æ¥ï¼‰"></a>RIGHT JOINï¼ˆå³è¿æ¥ï¼‰</h3><p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-11-13-175300.gif" alt></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· è‡ªå¢ä¸»é”®</title>
    <url>/blog/2019/10/24/mysql-primarykey/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p><strong>é—®é¢˜ï¼š</strong></p>
<p>æœ‰ä¸€å¼ è¡¨ï¼Œé‡Œé¢æœ‰ <code>id</code> è‡ªå¢ä¸»é”®ï¼Œå½“ <code>insert</code> äº† 17 æ¡è®°å½•ä¹‹åï¼Œåˆ é™¤äº†ç¬¬ 15 16 17 æ¡è®°å½•ï¼Œå†æŠŠ MySQL é‡å¯ï¼Œå† <code>insert</code> ä¸€æ¡è®°å½•ï¼Œè¿™æ¡è®°å½•çš„ <code>id</code> æ˜¯ 18 è¿˜æ˜¯ 15 ï¼Ÿ</p>
<p><strong>ç­”æ¡ˆï¼š</strong></p>
<p><strong>MySQL 8.0 ä¹‹å‰</strong></p>
<ul>
<li>å¦‚æœæ˜¯ <code>MyISAM</code> è¡¨ï¼Œæ•°æ®åº“é‡å¯åï¼Œ<code>id</code> å€¼ä¸º 18</li>
<li>å¦‚æœæ˜¯ <code>InnoDB</code> è¡¨ï¼Œæ•°æ®åº“é‡å¯åï¼Œ<code>id</code> å€¼ä¸º 15</li>
</ul>
<p><strong>MySQL 8.0 å¼€å§‹</strong></p>
<ul>
<li>å¦‚æœæ˜¯ <code>MyISAM</code> è¡¨ï¼Œæ•°æ®åº“é‡å¯åï¼Œ<code>id</code> å€¼ä¸º 18</li>
<li>å¦‚æœæ˜¯ <code>InnoDB</code> è¡¨ï¼Œæ•°æ®åº“é‡å¯åï¼Œ<code>id</code> å€¼ä¸º 18</li>
</ul>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>ä¸åŒå­˜å‚¨å¼•æ“è‡ªå¢ä¸»é”®å®ç°æœºåˆ¶ä¸åŒï¼ŒåŒä¸€å­˜å‚¨å¼•æ“ä¸é€šç‰ˆæœ¬å®ç°æœºåˆ¶ä¸åŒã€‚</p>
<p><strong>MyISAM</strong>ï¼šè‡ªå¢ä¸»é”®çš„æœ€å¤§ <code>id</code> è®°å½•åœ¨æ•°æ®æ–‡ä»¶é‡Œï¼Œé‡å¯åä¸ä¼šæ¶ˆå¤±ã€‚</p>
<p><strong>InnoDB</strong></p>
<ul>
<li><code>MySQL 5.7 åŠä¹‹å‰ç‰ˆæœ¬</code>ï¼Œè‡ªå¢ä¸»é”®æœ€å¤§ <code>id</code> ä¿å­˜åœ¨å†…å­˜é‡Œï¼Œé‡å¯æ•°æ®åº“æˆ–è€…æ˜¯å¯¹è¡¨è¿›è¡Œ <code>optimize</code> æ“ä½œï¼Œéƒ½ä¼šå¯¼è‡´æœ€å¤§ <code>id</code> ä¸¢å¤±ï¼Œé‡å¯åå°† <code>max(id)+1</code> ä½œä¸ºè¿™ä¸ªè¡¨å½“å‰çš„è‡ªå¢å€¼ã€‚</li>
<li><code>MySQL 8.0 ç‰ˆæœ¬</code>ï¼Œè‡ªå¢ä¸»é”®æœ€å¤§ <code>id</code> è®°å½•åœ¨äº† <code>redo log</code> ä¸­ï¼Œé‡å¯åä¾é  <code>redo log</code> æ¢å¤é‡å¯ä¹‹å‰çš„å€¼ã€‚</li>
</ul>
<p><strong>æµ‹è¯•</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from employees_innodb;</span><br><span class="line">+<span class="comment">----+------------+--------------------+-----+---------------------+---------------------+</span></span><br><span class="line">| id | name       | address            | age | gmt_create          | gmt_modified        |</span><br><span class="line">+<span class="comment">----+------------+--------------------+-----+---------------------+---------------------+</span></span><br><span class="line">|  1 | xujinliang | å±±ä¸œçœé’å²›å¸‚       |  32 | 2019-09-24 17:13:00 | 2019-09-24 17:13:00 |</span><br><span class="line">|  2 | maofang    | å±±ä¸œçœé’å²›å¸‚       |  32 | 2019-09-24 17:32:00 | 2019-09-24 17:40:49 |</span><br><span class="line">|  3 | raohui     | é™•è¥¿çœè¥¿å®‰å¸‚       |  29 | 2019-09-24 17:39:28 | 2019-09-24 17:39:28 |</span><br><span class="line">|  4 | yangnan    | NULL               |  22 | 2019-09-24 17:39:52 | 2019-09-24 17:39:52 |</span><br><span class="line">|  5 | yuzhiqiang | å±±ä¸œçœé’å²›å¸‚       |  29 | 2019-10-24 10:39:53 | 2019-10-24 10:39:53 |</span><br><span class="line">+<span class="comment">----+------------+--------------------+-----+---------------------+---------------------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤idä¸º5çš„è®°å½•ï¼Œé‡å¯MySQLæœåŠ¡ï¼Œå†æ¬¡æ’å…¥idå˜æˆ5ï¼ˆmax(id)+1ï¼‰</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> employees;</span><br><span class="line">+<span class="comment">----+------------+--------------------+-----+---------------------+---------------------+</span></span><br><span class="line">| id | name       | address            | age | gmt_create          | gmt_modified        |</span><br><span class="line">+<span class="comment">----+------------+--------------------+-----+---------------------+---------------------+</span></span><br><span class="line">|  1 | xujinliang | å±±ä¸œçœé’å²›å¸‚       |  32 | 2019-09-24 17:13:00 | 2019-09-24 17:13:00 |</span><br><span class="line">|  2 | maofang    | å±±ä¸œçœé’å²›å¸‚       |  32 | 2019-09-24 17:32:00 | 2019-09-24 17:40:49 |</span><br><span class="line">|  3 | raohui     | é™•è¥¿çœè¥¿å®‰å¸‚       |  29 | 2019-09-24 17:39:28 | 2019-09-24 17:39:28 |</span><br><span class="line">|  4 | yangnan    | NULL               |  22 | 2019-09-24 17:39:52 | 2019-09-24 17:39:52 |</span><br><span class="line">|  5 | liu        | å±±ä¸œçœçƒŸå°å¸‚       |  22 | 2019-10-24 11:03:14 | 2019-10-24 11:03:14 |</span><br><span class="line">+<span class="comment">----+------------+--------------------+-----+---------------------+---------------------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> employees_myisam;</span><br><span class="line">+<span class="comment">----+------------+--------------------+-----+---------------------+---------------------+</span></span><br><span class="line">| id | name       | address            | age | gmt_create          | gmt_modified        |</span><br><span class="line">+<span class="comment">----+------------+--------------------+-----+---------------------+---------------------+</span></span><br><span class="line">|  1 | xujinliang | å±±ä¸œçœé’å²›å¸‚       |  32 | 2019-09-24 17:13:00 | 2019-09-24 17:13:00 |</span><br><span class="line">|  2 | maofang    | å±±ä¸œçœé’å²›å¸‚       |  32 | 2019-09-24 17:32:00 | 2019-09-24 17:40:49 |</span><br><span class="line">|  3 | raohui     | é™•è¥¿çœè¥¿å®‰å¸‚       |  29 | 2019-09-24 17:39:28 | 2019-09-24 17:39:28 |</span><br><span class="line">|  4 | yangnan    | NULL               |  22 | 2019-09-24 17:39:52 | 2019-09-24 17:39:52 |</span><br><span class="line">|  5 | yuzhiqiang | å±±ä¸œçœé’å²›å¸‚       |  29 | 2019-10-24 10:39:53 | 2019-10-24 10:39:53 |</span><br><span class="line">+<span class="comment">----+------------+--------------------+-----+---------------------+---------------------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤idä¸º5çš„è®°å½•ï¼Œé‡å¯MySQLæœåŠ¡ï¼Œå†æ¬¡æ’å…¥idå˜æˆ6</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> employees_myisam;</span><br><span class="line">+<span class="comment">----+------------+--------------------+-----+---------------------+---------------------+</span></span><br><span class="line">| id | name       | address            | age | gmt_create          | gmt_modified        |</span><br><span class="line">+<span class="comment">----+------------+--------------------+-----+---------------------+---------------------+</span></span><br><span class="line">|  1 | xujinliang | å±±ä¸œçœé’å²›å¸‚       |  32 | 2019-09-24 17:13:00 | 2019-09-24 17:13:00 |</span><br><span class="line">|  2 | maofang    | å±±ä¸œçœé’å²›å¸‚       |  32 | 2019-09-24 17:32:00 | 2019-09-24 17:40:49 |</span><br><span class="line">|  3 | raohui     | é™•è¥¿çœè¥¿å®‰å¸‚       |  29 | 2019-09-24 17:39:28 | 2019-09-24 17:39:28 |</span><br><span class="line">|  4 | yangnan    | NULL               |  22 | 2019-09-24 17:39:52 | 2019-09-24 17:39:52 |</span><br><span class="line">|  6 | yuzhiqiang | å±±ä¸œçœé’å²›å¸‚       |  29 | 2019-10-24 10:58:32 | 2019-10-24 10:58:32 |</span><br><span class="line">+<span class="comment">----+------------+--------------------+-----+---------------------+---------------------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h2 id="ä¸»é”®çš„é€‰æ‹©"><a href="#ä¸»é”®çš„é€‰æ‹©" class="headerlink" title="ä¸»é”®çš„é€‰æ‹©"></a>ä¸»é”®çš„é€‰æ‹©</h2><p>â‘   ä»æ€§èƒ½å’Œå­˜å‚¨ç©ºé—´æ–¹é¢è€ƒé‡ï¼Œè‡ªå¢ä¸»é”®å¾€å¾€æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼š</p>
<ul>
<li><strong>å­˜å‚¨ç©ºé—´å°‘</strong>ï¼Œè‡ªå¢ä¸»é”®ä¸€èˆ¬ç”¨æ•´å‹åšä¸»é”®ï¼Œåˆ™äºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹åªè¦ 4 ä¸ªå­—èŠ‚ï¼›è€Œå¦‚æœä½¿ç”¨ä¸šåŠ¡å­—æ®µåšä¸»é”®ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²ç±»å‹çš„èº«ä»½è¯å·ï¼Œæ¯ä¸ªäºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å¾—å ç”¨çº¦ 20 ä¸ªå­—èŠ‚ã€‚</li>
<li><strong>æ€§èƒ½å¥½</strong>ï¼Œæ’å…¥æ•°æ®æ—¶ï¼Œè‡ªå¢ä¸»é”®èƒ½ä¿è¯æœ‰åºæ’å…¥ï¼Œé¿å…äº†é¡µåˆ†è£‚ã€‚</li>
</ul>
<p>â‘¡  è‡ªå¢ <code>id</code> æ˜¯æ•´å‹å­—æ®µï¼Œæ¨èä½¿ç”¨ <code>unsigned int</code> ç±»å‹æ¥å®šä¹‰å¢é•¿ä¸»é”®ï¼Œå¯ä»¥å­˜å‚¨ 42 äº¿æ•°æ®ã€‚</p>
<table>
<thead>
<tr>
<th align="left">ç±»å‹</th>
<th align="left">å¤§å°</th>
<th align="left">èŒƒå›´ï¼ˆæœ‰ç¬¦å·ï¼‰</th>
<th align="left">èŒƒå›´ï¼ˆæ— ç¬¦å·ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">int</td>
<td align="left">4 byte</td>
<td align="left">(-2147483648, 2147483647)</td>
<td align="left">(0, 4294967295)</td>
</tr>
<tr>
<td align="left">bigint</td>
<td align="left">8 byte</td>
<td align="left">(-9223372036854775808, 9223372036854775807)</td>
<td align="left">(0, 18446744073709551615)</td>
</tr>
</tbody></table>
<p>â‘¢  è‡ªå¢ <code>id</code> æ˜¯å¢é•¿çš„ï¼Œä½†ä¸ä¸€å®šè¿ç»­ï¼Œé€ æˆè‡ªå¢ <code>id</code> ä¸è¿ç»­çš„æƒ…å†µå¯èƒ½æœ‰ï¼š</p>
<ul>
<li>å”¯ä¸€é”®å†²çª</li>
<li>äº‹åŠ¡å›æ»š</li>
<li><code>insert ... select</code> è¯­å¥æ‰¹é‡ç”³è¯·è‡ªå¢ <code>id</code></li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>Python Â· ç½‘ç»œç¼–ç¨‹</title>
    <url>/blog/2019/10/24/python-socket/</url>
    <content><![CDATA[<h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>ç”¨ TCP åè®®è¿›è¡Œ Socket ç¼–ç¨‹åœ¨ Python ä¸­ååˆ†ç®€å•ï¼Œå¯¹äºå®¢æˆ·ç«¯ï¼Œè¦ä¸»åŠ¨è¿æ¥æœåŠ¡å™¨çš„ IP å’ŒæŒ‡å®šç«¯å£ï¼Œå¯¹äºæœåŠ¡å™¨ï¼Œè¦é¦–å…ˆç›‘å¬æŒ‡å®šç«¯å£ï¼Œç„¶åï¼Œå¯¹æ¯ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹æ¥å¤„ç†ã€‚é€šå¸¸ï¼ŒæœåŠ¡å™¨ç¨‹åºä¼šæ— é™è¿è¡Œä¸‹å»ã€‚åŒä¸€ä¸ªç«¯å£ï¼Œè¢«ä¸€ä¸ª Socket ç»‘å®šäº†ä»¥åï¼Œå°±ä¸èƒ½è¢«åˆ«çš„ Socket ç»‘å®šäº†ã€‚</p>
<h4 id="TCPç¼–ç¨‹"><a href="#TCPç¼–ç¨‹" class="headerlink" title="TCPç¼–ç¨‹"></a>TCPç¼–ç¨‹</h4><p><strong>å®¢æˆ·ç«¯</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"><span class="comment"># å»ºç«‹è¿æ¥:</span></span><br><span class="line">s.connect((<span class="string">'127.0.0.1'</span>, <span class="number">9999</span>))</span><br><span class="line"><span class="comment"># æ¥æ”¶æ¬¢è¿æ¶ˆæ¯:</span></span><br><span class="line">print(s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> [<span class="string">b'Michael'</span>, <span class="string">b'Tracy'</span>, <span class="string">b'Sarah'</span>]:</span><br><span class="line">    <span class="comment"># å‘é€æ•°æ®:</span></span><br><span class="line">    s.send(data)</span><br><span class="line">    print(s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">s.send(<span class="string">b'exit'</span>)</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<p><strong>æœåŠ¡ç«¯</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›‘å¬ç«¯å£:</span></span><br><span class="line">s.bind((<span class="string">'127.0.0.1'</span>, <span class="number">9999</span>))</span><br><span class="line">s.listen(<span class="number">5</span>)</span><br><span class="line">print(<span class="string">'Waiting for connection...'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tcplink</span><span class="params">(sock, addr)</span>:</span></span><br><span class="line">    print(<span class="string">'Accept new connection from %s:%s...'</span> % addr)</span><br><span class="line">    sock.send(<span class="string">b'Welcome!'</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = sock.recv(<span class="number">1024</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data <span class="keyword">or</span> data.decode(<span class="string">'utf-8'</span>) == <span class="string">'exit'</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        sock.send((<span class="string">'Hello, %s!'</span> % data.decode(<span class="string">'utf-8'</span>)).encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    sock.close()</span><br><span class="line">    print(<span class="string">'Connection from %s:%s closed.'</span> % addr)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># æ¥å—ä¸€ä¸ªæ–°è¿æ¥:</span></span><br><span class="line">    sock, addr = s.accept()</span><br><span class="line">    <span class="comment"># åˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†TCPè¿æ¥:</span></span><br><span class="line">    t = threading.Thread(target=tcplink, args=(sock, addr))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œç»“æœ</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Waiting <span class="keyword">for</span> connection...</span><br><span class="line">Accept new connection <span class="keyword">from</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">52501.</span>..</span><br><span class="line">Connection <span class="keyword">from</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">52501</span> closed.</span><br><span class="line"></span><br><span class="line">Welcome!</span><br><span class="line">Hello, Michael!</span><br><span class="line">Hello, Tracy!</span><br><span class="line">Hello, Sarah!</span><br></pre></td></tr></table></figure>

<h4 id="UDPç¼–ç¨‹"><a href="#UDPç¼–ç¨‹" class="headerlink" title="UDPç¼–ç¨‹"></a>UDPç¼–ç¨‹</h4><p>TCPï¼šæ˜¯å»ºç«‹å¯é è¿æ¥ï¼Œå¹¶ä¸”é€šä¿¡åŒæ–¹éƒ½å¯ä»¥ä»¥æµçš„å½¢å¼å‘é€æ•°æ®ã€‚</p>
<p>UDPï¼šæ˜¯é¢å‘æ— è¿æ¥çš„åè®®ï¼Œä½¿ç”¨ <code>UDP</code> åè®®æ—¶ï¼Œä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œåªéœ€è¦çŸ¥é“å¯¹æ–¹çš„ <code>IP</code> åœ°å€å’Œç«¯å£å·ï¼Œå°±å¯ä»¥ç›´æ¥å‘æ•°æ®åŒ…ã€‚è™½ç„¶ç”¨ <code>UDP</code> ä¼ è¾“æ•°æ®ä¸å¯é ï¼Œä½†å®ƒçš„ä¼˜ç‚¹æ˜¯å’Œ <code>TCP</code> æ¯”é€Ÿåº¦å¿«ï¼Œå¯¹äºä¸è¦æ±‚å¯é åˆ°è¾¾çš„æ•°æ®ï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>UDP</code> åè®®ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> [<span class="string">b'Michael'</span>, <span class="string">b'Tracy'</span>, <span class="string">b'Sarah'</span>]:</span><br><span class="line">    <span class="comment"># å‘é€æ•°æ®:</span></span><br><span class="line">    s.sendto(data, (<span class="string">'127.0.0.1'</span>, <span class="number">9999</span>))</span><br><span class="line">    <span class="comment"># æ¥æ”¶æ•°æ®:</span></span><br><span class="line">    print(s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">s.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line"><span class="comment"># ç»‘å®šç«¯å£:</span></span><br><span class="line">s.bind((<span class="string">'127.0.0.1'</span>, <span class="number">9999</span>))</span><br><span class="line">print(<span class="string">'Bind UDP on 9999...'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># æ¥æ”¶æ•°æ®:</span></span><br><span class="line">    data, addr = s.recvfrom(<span class="number">1024</span>)</span><br><span class="line">    print(<span class="string">'Received from %s:%s.'</span> % addr)</span><br><span class="line">    s.sendto(<span class="string">b'Hello, %s! '</span> % data, addr)</span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œç»“æœ</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Bind UDP on <span class="number">9999.</span>..</span><br><span class="line">Received <span class="keyword">from</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">58248.</span></span><br><span class="line">Received <span class="keyword">from</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">58248.</span></span><br><span class="line">Received <span class="keyword">from</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">58248.</span></span><br><span class="line"></span><br><span class="line">Hello, Michael! </span><br><span class="line">Hello, Tracy! </span><br><span class="line">Hello, Sarah!</span><br></pre></td></tr></table></figure>

<p><strong>å°ç»“</strong>ï¼š</p>
<p><code>UDP</code> çš„ä½¿ç”¨ä¸ <code>TCP</code> ç±»ä¼¼ï¼Œä½†æ˜¯ä¸éœ€è¦å»ºç«‹è¿æ¥ã€‚æ­¤å¤–ï¼ŒæœåŠ¡å™¨ç»‘å®š <code>UDP</code> ç«¯å£å’Œ <code>TCP</code> ç«¯å£äº’ä¸å†²çªï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>UDP</code> çš„ <code>9999</code> ç«¯å£ä¸ <code>TCP</code> çš„ <code>9999</code> ç«¯å£å¯ä»¥å„è‡ªç»‘å®šã€‚ </p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Python Â· æ­£åˆ™è¡¨è¾¾å¼</title>
    <url>/blog/2019/10/24/python-regular/</url>
    <content><![CDATA[<p><strong>æ­£åˆ™è¡¨è¾¾å¼</strong>æ˜¯ä¸€ç§ç”¨æ¥åŒ¹é…å­—ç¬¦ä¸²çš„å¼ºæœ‰åŠ›çš„æ­¦å™¨ï¼Œå®ƒçš„è®¾è®¡æ€æƒ³æ˜¯ç”¨ä¸€ç§æè¿°æ€§çš„è¯­è¨€æ¥ç»™å­—ç¬¦ä¸²å®šä¹‰ä¸€ä¸ªè§„åˆ™ï¼Œå‡¡æ˜¯ç¬¦åˆè§„åˆ™çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºå®ƒâ€œåŒ¹é…â€äº†ï¼Œå¦åˆ™è¯¥å­—ç¬¦ä¸²å°±æ˜¯ä¸åˆæ³•çš„ã€‚</p>
<p><strong>åŠŸèƒ½</strong>ï¼š</p>
<ul>
<li>æ ¡éªŒå­—ç¬¦ä¸²ï¼Œåˆ¤æ–­æ˜¯å¦åŒ¹é…</li>
<li>æå–å­å­—ç¬¦ä¸²</li>
</ul>
<p><strong>å­—ç¬¦</strong></p>
<p><code>\d</code>ï¼šè¡¨ç¤ºå¯ä»¥åŒ¹é…ä¸€ä¸ªæ•°å­—</p>
<p><code>\w</code>ï¼šè¡¨ç¤ºå¯ä»¥åŒ¹é…ä¸€ä¸ªå­—æ¯æˆ–æ•°å­—</p>
<p><code>.</code>ï¼šè¡¨ç¤ºå¯ä»¥åŒ¹é…ä»»æ„å­—ç¬¦</p>
<p><code>*</code>ï¼šè¡¨ç¤ºä»»æ„ä¸ªå­—ç¬¦ï¼ˆåŒ…æ‹¬0ä¸ªï¼‰</p>
<p><code>+</code>ï¼šè¡¨ç¤ºè‡³å°‘ä¸€ä¸ªå­—ç¬¦</p>
<p><code>?</code>ï¼šè¡¨ç¤º0ä¸ªæˆ–1ä¸ªå­—ç¬¦</p>
<p><code>{n}</code>ï¼šè¡¨ç¤ºnä¸ªå­—ç¬¦</p>
<p><code>{n,m}</code>ï¼šè¡¨ç¤ºn-mä¸ªå­—ç¬¦</p>
<p><code>\s</code>ï¼šè¡¨ç¤ºå¯ä»¥åŒ¹é…ä¸€ä¸ªç©ºæ ¼ï¼ˆä¹ŸåŒ…æ‹¬Tabç­‰ç©ºç™½ç¬¦ï¼‰ï¼Œæ‰€ä»¥<code>\s+</code>è¡¨ç¤ºè‡³å°‘æœ‰ä¸€ä¸ªç©ºæ ¼</p>
<p><code>[]</code>ï¼šè¡¨ç¤ºæ›´ç²¾ç¡®åœ°èŒƒå›´åŒ¹é…</p>
<p><code>^</code>ï¼šè¡¨ç¤ºè¡Œçš„å¼€å¤´ï¼Œ<code>^\d</code>è¡¨ç¤ºå¿…é¡»ä»¥æ•°å­—å¼€å¤´</p>
<p><code>$</code>ï¼šè¡¨ç¤ºè¡Œçš„ç»“æŸï¼Œ<code>\d$</code>è¡¨ç¤ºå¿…é¡»ä»¥æ•°å­—ç»“æŸ</p>
<p><code>A|B</code>ï¼šå¯ä»¥åŒ¹é…Aæˆ–Bï¼Œæ‰€ä»¥<code>(P|p)ython</code>å¯ä»¥åŒ¹é…<code>&#39;Python&#39;</code>æˆ–è€…<code>&#39;python&#39;</code>ã€‚</p>
<p><code>[0-9a-zA-Z\_]</code>ï¼šå¯ä»¥åŒ¹é…ä¸€ä¸ªæ•°å­—ã€å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿</p>
<p><code>[0-9a-zA-Z\_]+</code>ï¼šå¯ä»¥åŒ¹é…è‡³å°‘ç”±ä¸€ä¸ªæ•°å­—ã€å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œå¦‚<code>&#39;a100&#39;</code>ï¼Œ<code>&#39;0_Z&#39;</code>ï¼Œ<code>&#39;Py3000&#39;</code>ç­‰ç­‰</p>
<p><code>[a-zA-Z\_][0-9a-zA-Z\_]*</code>ï¼šå¯ä»¥åŒ¹é…ç”±å­—æ¯æˆ–ä¸‹åˆ’çº¿å¼€å¤´ï¼Œåæ¥ä»»æ„ä¸ªç”±ä¸€ä¸ªæ•°å­—ã€å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯ Python åˆæ³•çš„å˜é‡</p>
<p><code>[a-zA-Z\_][0-9a-zA-Z\_]{0, 19}</code>ï¼šæ›´ç²¾ç¡®åœ°é™åˆ¶äº†å˜é‡çš„é•¿åº¦æ˜¯1-20ä¸ªå­—ç¬¦ï¼ˆå‰é¢1ä¸ªå­—ç¬¦+åé¢æœ€å¤š19ä¸ªå­—ç¬¦ï¼‰</p>
<p><code>re</code> <strong>æ¨¡å—</strong>ï¼šPython æä¾› <code>re</code>æ¨¡å—ï¼ŒåŒ…å«æ‰€æœ‰æ­£åˆ™è¡¨è¾¾å¼çš„åŠŸèƒ½ï¼Œå»ºè®®ä½¿ç”¨ <code>r</code> å‰ç¼€ï¼Œå°±ä¸ç”¨è€ƒè™‘è½¬ä¹‰çš„é—®é¢˜ã€‚</p>
<p><code>match()</code> <strong>æ–¹æ³•</strong>ï¼šåˆ¤æ–­æ˜¯å¦åŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œè¿”å›ä¸€ä¸ª<code>Match</code>å¯¹è±¡ï¼Œå¦åˆ™è¿”å›<code>None</code>ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">test = <span class="string">'ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²'</span></span><br><span class="line"><span class="keyword">if</span> re.match(<span class="string">r'æ­£åˆ™è¡¨è¾¾å¼'</span>, test):</span><br><span class="line">    print(<span class="string">'ok'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'failed'</span>)</span><br></pre></td></tr></table></figure>

<p><strong>åˆ‡åˆ†å­—ç¬¦ä¸²</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.split(<span class="string">r'\s+'</span>, <span class="string">'a b   c'</span>)</span><br><span class="line">[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br></pre></td></tr></table></figure>

<p><strong>åˆ†ç»„</strong>ï¼šå¯ä»¥åœ¨<code>Match</code>å¯¹è±¡ä¸Šç”¨<code>group()</code>æ–¹æ³•æå–å‡ºå­ä¸²æ¥ï¼Œ<code>group(0)</code>æ°¸è¿œæ˜¯åŸå§‹å­—ç¬¦ä¸²ï¼Œ<code>group(1)</code>ã€<code>group(2)</code>â€¦â€¦è¡¨ç¤ºç¬¬1ã€2ã€â€¦â€¦ä¸ªå­ä¸²ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>m = re.match(<span class="string">r'^(\d&#123;3&#125;)-(\d&#123;3,8&#125;)$'</span>, <span class="string">'010-12345'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m</span><br><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">0</span>, <span class="number">9</span>), match=<span class="string">'010-12345'</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.group(<span class="number">0</span>)</span><br><span class="line"><span class="string">'010-12345'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.group(<span class="number">1</span>)</span><br><span class="line"><span class="string">'010'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.group(<span class="number">2</span>)</span><br><span class="line"><span class="string">'12345'</span></span><br></pre></td></tr></table></figure>

<p><strong>è´ªå©ªåŒ¹é…</strong>ï¼šæ­£åˆ™åŒ¹é…é»˜è®¤æ˜¯è´ªå©ªåŒ¹é…ï¼Œä¹Ÿå°±æ˜¯åŒ¹é…å°½å¯èƒ½å¤šçš„å­—ç¬¦ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.match(<span class="string">r'^(\d+)(0*)$'</span>, <span class="string">'102300'</span>).groups()</span><br><span class="line">(<span class="string">'102300'</span>, <span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">ç”±äº\d+é‡‡ç”¨è´ªå©ªåŒ¹é…ï¼Œç›´æ¥æŠŠåé¢çš„0å…¨éƒ¨åŒ¹é…äº†ï¼Œç»“æœ0*åªèƒ½åŒ¹é…ç©ºå­—ç¬¦ä¸²äº†ã€‚å¿…é¡»è®©\d+é‡‡ç”¨éè´ªå©ªåŒ¹é…ï¼ˆä¹Ÿå°±æ˜¯å°½å¯èƒ½å°‘åŒ¹é…ï¼‰ï¼Œæ‰èƒ½æŠŠåé¢çš„0åŒ¹é…å‡ºæ¥ï¼ŒåŠ ä¸ª?å°±å¯ä»¥è®©\d+é‡‡ç”¨éè´ªå©ªåŒ¹é…:</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.match(<span class="string">r'^(\d+?)(0*)$'</span>, <span class="string">'102300'</span>).groups()</span><br><span class="line">(<span class="string">'1023'</span>, <span class="string">'00'</span>)</span><br></pre></td></tr></table></figure>

<p><strong>ç¼–è¯‘</strong>ï¼šå½“æˆ‘ä»¬åœ¨ Python ä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œ<code>re</code>æ¨¡å—å†…éƒ¨ä¼šå¹²ä¸¤ä»¶äº‹æƒ…ï¼š</p>
<p>1ï¼‰ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦‚æœæ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²æœ¬èº«ä¸åˆæ³•ï¼Œä¼šæŠ¥é”™ã€‚</p>
<p>2ï¼‰ç”¨ç¼–è¯‘åçš„æ­£åˆ™è¡¨è¾¾å¼å»åŒ¹é…å­—ç¬¦ä¸²ã€‚</p>
<p>å¦‚æœä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼è¦é‡å¤ä½¿ç”¨å‡ åƒæ¬¡ï¼Œå‡ºäºæ•ˆç‡çš„è€ƒè™‘ï¼Œæˆ‘ä»¬å¯ä»¥é¢„ç¼–è¯‘è¯¥æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¥ä¸‹æ¥é‡å¤ä½¿ç”¨æ—¶å°±ä¸éœ€è¦ç¼–è¯‘è¿™ä¸ªæ­¥éª¤äº†ï¼Œç›´æ¥è¿›è¡ŒåŒ¹é…ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> re</span><br><span class="line"><span class="comment"># ç¼–è¯‘:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>re_telephone = re.compile(<span class="string">r'^(\d&#123;3&#125;)-(\d&#123;3,8&#125;)$'</span>)</span><br><span class="line"><span class="comment"># ä½¿ç”¨ï¼š</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>re_telephone.match(<span class="string">'010-12345'</span>).groups()</span><br><span class="line">(<span class="string">'010'</span>, <span class="string">'12345'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>re_telephone.match(<span class="string">'010-8086'</span>).groups()</span><br><span class="line">(<span class="string">'010'</span>, <span class="string">'8086'</span>)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Python Â· è¿›ç¨‹ä¸çº¿ç¨‹</title>
    <url>/blog/2019/10/24/python-threads/</url>
    <content><![CDATA[<h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p><strong>ç›®çš„</strong>ï¼šå¤šæ ¸ <code>CPU</code> æ—¶ä»£ï¼Œä¸ºäº†å……åˆ†åˆ©ç”¨èµ„æºï¼Œä¾èµ–å¤šä»»åŠ¡å¹¶å‘ç¼–ç¨‹æŠ€æœ¯<strong>æå‡ç¨‹åºæ€§èƒ½</strong>å’Œ<strong>æ”¹å–„ç”¨æˆ·ä½“éªŒ</strong>ã€‚</p>
<p><strong>å¤šä»»åŠ¡å¹¶å‘ç¼–ç¨‹æ–¹å¼</strong>ï¼š</p>
<ul>
<li>å¤šè¿›ç¨‹</li>
<li>å¤šçº¿ç¨‹</li>
<li>å¤šè¿›ç¨‹ + å¤šçº¿ç¨‹</li>
</ul>
<p><strong>è¿›ç¨‹</strong>ï¼šæ“ä½œç³»ç»Ÿä¸­æ‰§è¡Œçš„ä¸€ä¸ªç¨‹åºï¼Œä¸€ä¸ªä»»åŠ¡å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚</p>
<p><strong>çº¿ç¨‹</strong>ï¼šçº¿ç¨‹æ˜¯æœ€å°çš„æ‰§è¡Œå•å…ƒï¼Œä¸€ä¸ªçº¿ç¨‹ç›¸å½“äºè¿›ç¨‹çš„å­ä»»åŠ¡ã€‚</p>
<p><strong>è¿›ç¨‹é—´é€šä¿¡æ–¹å¼</strong>ï¼šç®¡é“ã€ä¿¡å·ã€å¥—æ¥å­—ã€å…±äº«å†…å­˜åŒºç­‰ã€‚</p>
<h2 id="å¤šè¿›ç¨‹"><a href="#å¤šè¿›ç¨‹" class="headerlink" title="å¤šè¿›ç¨‹"></a>å¤šè¿›ç¨‹</h2><ul>
<li><strong><code>os</code> æ¨¡å—</strong>ï¼šä½¿ç”¨ <code>fork()</code> è°ƒç”¨å®ç°å¤šè¿›ç¨‹ã€‚</li>
<li><strong><code>multiprocessing</code> æ¨¡å—</strong>ï¼šå®ç°è·¨å¹³å°å¤šè¿›ç¨‹ã€‚</li>
<li><strong><code>Process</code> å¯¹è±¡</strong>ï¼šå®ç°å¤šè¿›ç¨‹ã€‚</li>
<li><strong><code>Pool</code> å¯¹è±¡</strong>ï¼šå¯ä»¥ç”¨è¿›ç¨‹æ± çš„æ–¹å¼æ‰¹é‡åˆ›å»ºå­è¿›ç¨‹ï¼Œ<code>Pool</code> çš„é»˜è®¤å¤§å°æ˜¯ <code>CPU</code> çš„æ ¸æ•°ã€‚</li>
<li><strong><code>Queue</code> å¯¹è±¡</strong>ï¼šé€šè¿‡é˜Ÿåˆ—å®ç°è¿›ç¨‹é—´é€šä¿¡ã€‚</li>
<li><strong><code>Pipes</code> å¯¹è±¡</strong>ï¼šé€šè¿‡ç®¡é“å®ç°è¿›ç¨‹é—´é€šä¿¡ã€‚</li>
<li><strong><code>start</code> æ–¹æ³•</strong>ï¼šè¡¨ç¤ºå¯åŠ¨è¿›ç¨‹ã€‚</li>
<li><strong><code>join</code> æ–¹æ³•</strong>ï¼šè¡¨ç¤ºç­‰å¾…è¿›ç¨‹æ‰§è¡Œç»“æŸã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time, sleep</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_task</span><span class="params">(filename)</span>:</span></span><br><span class="line">    print(<span class="string">'å¼€å§‹ä¸‹è½½%s...'</span> % filename)</span><br><span class="line">    time_to_download = randint(<span class="number">5</span>, <span class="number">10</span>)</span><br><span class="line">    sleep(time_to_download)</span><br><span class="line">    print(<span class="string">'%sä¸‹è½½å®Œæˆ! è€—è´¹äº†%dç§’'</span> % (filename, time_to_download))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    start = time()</span><br><span class="line">    download_task(<span class="string">'Pythonä»å…¥é—¨åˆ°è¿›å‘.pdf'</span>)</span><br><span class="line">    download_task(<span class="string">'Peking Hot.avi'</span>)</span><br><span class="line">    end = time()</span><br><span class="line">    print(<span class="string">'æ€»å…±è€—è´¹äº†%.2fç§’.'</span> % (end - start))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">å¼€å§‹ä¸‹è½½ Pythonä»å…¥é—¨åˆ°è¿›å‘.pdf...</span><br><span class="line">Pythonä»å…¥é—¨åˆ°ä½é™¢.pdfä¸‹è½½å®Œæˆ! è€—è´¹äº†<span class="number">6</span>ç§’</span><br><span class="line">å¼€å§‹ä¸‹è½½ Peking Hot.avi...</span><br><span class="line">Peking Hot.aviä¸‹è½½å®Œæˆ! è€—è´¹äº†<span class="number">7</span>ç§’</span><br><span class="line">æ€»å…±è€—è´¹äº†<span class="number">13.01</span>ç§’.</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> getpid</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time, sleep</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_task</span><span class="params">(filename)</span>:</span></span><br><span class="line">    print(<span class="string">'å¯åŠ¨ä¸‹è½½è¿›ç¨‹ï¼Œè¿›ç¨‹å·[%d].'</span> % getpid())</span><br><span class="line">    print(<span class="string">'å¼€å§‹ä¸‹è½½%s...'</span> % filename)</span><br><span class="line">    time_to_download = randint(<span class="number">5</span>, <span class="number">10</span>)</span><br><span class="line">    sleep(time_to_download)</span><br><span class="line">    print(<span class="string">'%sä¸‹è½½å®Œæˆ! è€—è´¹äº†%dç§’'</span> % (filename, time_to_download))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    start = time()</span><br><span class="line">    p1 = Process(target=download_task, args=(<span class="string">'Pythonä»å…¥é—¨åˆ°ä½é™¢.pdf'</span>, ))</span><br><span class="line">    p1.start()</span><br><span class="line">    p2 = Process(target=download_task, args=(<span class="string">'Peking Hot.avi'</span>, ))</span><br><span class="line">    p2.start()</span><br><span class="line">    p1.join()</span><br><span class="line">    p2.join()</span><br><span class="line">    end = time()</span><br><span class="line">    print(<span class="string">'æ€»å…±è€—è´¹äº†%.2fç§’.'</span> % (end - start))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">å¯åŠ¨ä¸‹è½½è¿›ç¨‹ï¼Œè¿›ç¨‹å·[<span class="number">1530</span>].</span><br><span class="line">å¼€å§‹ä¸‹è½½ Pythonä»å…¥é—¨åˆ°ä½é™¢.pdf...</span><br><span class="line">å¯åŠ¨ä¸‹è½½è¿›ç¨‹ï¼Œè¿›ç¨‹å·[<span class="number">1531</span>].</span><br><span class="line">å¼€å§‹ä¸‹è½½ Peking Hot.avi...</span><br><span class="line">Peking Hot.aviä¸‹è½½å®Œæˆ! è€—è´¹äº†<span class="number">7</span>ç§’</span><br><span class="line">Pythonä»å…¥é—¨åˆ°ä½é™¢.pdfä¸‹è½½å®Œæˆ! è€—è´¹äº†<span class="number">10</span>ç§’</span><br><span class="line">æ€»å…±è€—è´¹äº†<span class="number">10.01</span>ç§’.</span><br></pre></td></tr></table></figure>

<h2 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h2><ul>
<li><strong><code>thread</code> æ¨¡å—</strong>ï¼šå®ç°å¤šçº¿ç¨‹</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Process (%s) start...'</span> % os.getpid())</span><br><span class="line"><span class="comment"># Only works on Unix/Linux/Mac</span></span><br><span class="line">pid = os.fork()</span><br><span class="line"><span class="keyword">if</span> pid == <span class="number">0</span>:</span><br><span class="line">    print(<span class="string">'I am child process (%s) and my parent is %s.'</span> % (os.getpid(), os.getppid()))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'I (%s) just created a child process (%s).'</span> % (os.getpid(), pid))</span><br><span class="line">    </span><br><span class="line">Process (<span class="number">876</span>) start...</span><br><span class="line">I (<span class="number">876</span>) just created a child process (<span class="number">877</span>).</span><br><span class="line">I am child process (<span class="number">877</span>) <span class="keyword">and</span> my parent <span class="keyword">is</span> <span class="number">876.</span></span><br></pre></td></tr></table></figure>

<p>Python çš„ <code>multiprocessing</code>æ¨¡å—å°±æ˜¯è·¨å¹³å°ç‰ˆæœ¬çš„å¤šè¿›ç¨‹æ¨¡å—ã€‚<code>multiprocessing</code>æ¨¡å—æä¾›äº†ä¸€ä¸ª<code>Process</code>ç±»æ¥ä»£è¡¨ä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ï¼Œä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹å¹¶ç­‰å¾…å…¶ç»“æŸã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­è¿›ç¨‹è¦æ‰§è¡Œçš„ä»£ç </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_proc</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">'Run child process %s (%s)...'</span> % (name, os.getpid()))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">    print(<span class="string">'Parent process %s.'</span> % os.getpid())</span><br><span class="line">    p = Process(target=run_proc, args=(<span class="string">'test'</span>,))</span><br><span class="line">    print(<span class="string">'Child process will start.'</span>)</span><br><span class="line">    p.start()</span><br><span class="line">    p.join()</span><br><span class="line">    print(<span class="string">'Child process end.'</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</span><br><span class="line">Parent process <span class="number">928.</span></span><br><span class="line">Child process will start.</span><br><span class="line">Run child process test (<span class="number">929</span>)...</span><br><span class="line">Child process end.</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œåªéœ€è¦ä¼ å…¥ä¸€ä¸ªæ‰§è¡Œå‡½æ•°å’Œå‡½æ•°çš„å‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ª<code>Process</code>å®ä¾‹ï¼Œç”¨<code>start()</code>æ–¹æ³•å¯åŠ¨ï¼Œè¿™æ ·åˆ›å»ºè¿›ç¨‹æ¯”<code>fork()</code>è¿˜è¦ç®€å•ã€‚<code>join()</code>æ–¹æ³•å¯ä»¥ç­‰å¾…å­è¿›ç¨‹ç»“æŸåå†ç»§ç»­å¾€ä¸‹è¿è¡Œï¼Œé€šå¸¸ç”¨äºè¿›ç¨‹é—´çš„åŒæ­¥ã€‚</p>
<p><strong>Pool</strong>ï¼šå¦‚æœè¦å¯åŠ¨å¤§é‡çš„å­è¿›ç¨‹ï¼Œå¯ä»¥ç”¨è¿›ç¨‹æ± çš„æ–¹å¼æ‰¹é‡åˆ›å»ºå­è¿›ç¨‹ï¼Œ<code>Pool</code>çš„é»˜è®¤å¤§å°æ˜¯ CPU çš„æ ¸æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> os, time, random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">long_time_task</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">'Run task %s (%s)...'</span> % (name, os.getpid()))</span><br><span class="line">    start = time.time()</span><br><span class="line">    time.sleep(random.random() * <span class="number">3</span>)</span><br><span class="line">    end = time.time()</span><br><span class="line">    print(<span class="string">'Task %s runs %0.2f seconds.'</span> % (name, (end - start)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">    print(<span class="string">'Parent process %s.'</span> % os.getpid())</span><br><span class="line">    p = Pool(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        p.apply_async(long_time_task, args=(i,))</span><br><span class="line">    print(<span class="string">'Waiting for all subprocesses done...'</span>)</span><br><span class="line">    p.close()</span><br><span class="line">    p.join()</span><br><span class="line">    print(<span class="string">'All subprocesses done.'</span>)</span><br><span class="line">    </span><br><span class="line">æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</span><br><span class="line">Parent process <span class="number">669.</span></span><br><span class="line">Waiting <span class="keyword">for</span> all subprocesses done...</span><br><span class="line">Run task <span class="number">0</span> (<span class="number">671</span>)...</span><br><span class="line">Run task <span class="number">1</span> (<span class="number">672</span>)...</span><br><span class="line">Run task <span class="number">2</span> (<span class="number">673</span>)...</span><br><span class="line">Run task <span class="number">3</span> (<span class="number">674</span>)...</span><br><span class="line">Task <span class="number">2</span> runs <span class="number">0.14</span> seconds.</span><br><span class="line">Run task <span class="number">4</span> (<span class="number">673</span>)...</span><br><span class="line">Task <span class="number">1</span> runs <span class="number">0.27</span> seconds.</span><br><span class="line">Task <span class="number">3</span> runs <span class="number">0.86</span> seconds.</span><br><span class="line">Task <span class="number">0</span> runs <span class="number">1.41</span> seconds.</span><br><span class="line">Task <span class="number">4</span> runs <span class="number">1.91</span> seconds.</span><br><span class="line">All subprocesses done.</span><br></pre></td></tr></table></figure>

<p><strong>è¿›ç¨‹é—´é€šä¿¡</strong>ï¼š<code>Process</code>ä¹‹é—´è‚¯å®šæ˜¯éœ€è¦é€šä¿¡çš„ï¼Œæ“ä½œç³»ç»Ÿæä¾›äº†å¾ˆå¤šæœºåˆ¶æ¥å®ç°è¿›ç¨‹é—´çš„é€šä¿¡ã€‚<code>Python</code> çš„<code>multiprocessing</code> æ¨¡å—åŒ…è£…äº†åº•å±‚çš„æœºåˆ¶ï¼Œæä¾›äº†<code>Queue</code>ã€<code>Pipes</code>ç­‰å¤šç§æ–¹å¼æ¥äº¤æ¢æ•°æ®ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Queue</span><br><span class="line"><span class="keyword">import</span> os, time, random</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™æ•°æ®è¿›ç¨‹æ‰§è¡Œçš„ä»£ç :</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(q)</span>:</span></span><br><span class="line">    print(<span class="string">'Process to write: %s'</span> % os.getpid())</span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>]:</span><br><span class="line">        print(<span class="string">'Put %s to queue...'</span> % value)</span><br><span class="line">        q.put(value)</span><br><span class="line">        time.sleep(random.random())</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»æ•°æ®è¿›ç¨‹æ‰§è¡Œçš„ä»£ç :</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">(q)</span>:</span></span><br><span class="line">    print(<span class="string">'Process to read: %s'</span> % os.getpid())</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        value = q.get(<span class="literal">True</span>)</span><br><span class="line">        print(<span class="string">'Get %s from queue.'</span> % value)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># çˆ¶è¿›ç¨‹åˆ›å»ºQueueï¼Œå¹¶ä¼ ç»™å„ä¸ªå­è¿›ç¨‹ï¼š</span></span><br><span class="line">    q = Queue()</span><br><span class="line">    pw = Process(target=write, args=(q,))</span><br><span class="line">    pr = Process(target=read, args=(q,))</span><br><span class="line">    <span class="comment"># å¯åŠ¨å­è¿›ç¨‹pwï¼Œå†™å…¥:</span></span><br><span class="line">    pw.start()</span><br><span class="line">    <span class="comment"># å¯åŠ¨å­è¿›ç¨‹prï¼Œè¯»å–:</span></span><br><span class="line">    pr.start()</span><br><span class="line">    <span class="comment"># ç­‰å¾…pwç»“æŸ:</span></span><br><span class="line">    pw.join()</span><br><span class="line">    <span class="comment"># prè¿›ç¨‹é‡Œæ˜¯æ­»å¾ªç¯ï¼Œæ— æ³•ç­‰å¾…å…¶ç»“æŸï¼Œåªèƒ½å¼ºè¡Œç»ˆæ­¢:</span></span><br><span class="line">    pr.terminate()</span><br><span class="line">    </span><br><span class="line">æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</span><br><span class="line">Process to write: <span class="number">50563</span></span><br><span class="line">Put A to queue...</span><br><span class="line">Process to read: <span class="number">50564</span></span><br><span class="line">Get A <span class="keyword">from</span> queue.</span><br><span class="line">Put B to queue...</span><br><span class="line">Get B <span class="keyword">from</span> queue.</span><br><span class="line">Put C to queue...</span><br><span class="line">Get C <span class="keyword">from</span> queue.</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Python Â· è¾“å…¥ä¸è¾“å‡º</title>
    <url>/blog/2019/10/24/python-io/</url>
    <content><![CDATA[<h2 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h2><p>å®é™…å¼€å‘ä¸­ç»å¸¸é‡åˆ°å¯¹æ•°æ®è¿›è¡ŒæŒä¹…åŒ–æ“ä½œçš„åœºæ™¯ï¼Œè€Œå®ç°æ•°æ®æŒä¹…åŒ–æœ€ç›´æ¥ç®€å•çš„æ–¹å¼å°±æ˜¯å°†æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚Python å®ç°æ–‡ä»¶çš„è¯»å†™æ“ä½œå…¶å®éå¸¸ç®€å•ï¼Œé€šè¿‡å†…ç½®çš„ <code>open</code> å‡½æ•°ï¼Œå¯ä»¥æŒ‡å®šæ–‡ä»¶åã€æ“ä½œæ¨¡å¼ã€ç¼–ç ä¿¡æ¯ç­‰æ¥è·å¾—æ“ä½œæ–‡ä»¶çš„å¯¹è±¡ï¼Œç„¶åå°±å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œäº†ã€‚</p>
<table>
<thead>
<tr>
<th>å¯¹è±¡æ–¹æ³•</th>
<th>å…·ä½“å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>read</code></td>
<td>è¯»å–</td>
</tr>
<tr>
<td><code>readline</code></td>
<td>è¯»å–æ–‡ä»¶æ¯ä¸€è¡Œ</td>
</tr>
<tr>
<td><code>write</code></td>
<td>å†™å…¥</td>
</tr>
<tr>
<td><code>close</code></td>
<td>å…³é—­æ–‡ä»¶</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>æ“ä½œæ¨¡å¼</th>
<th>å…·ä½“å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>&#39;r&#39;</code></td>
<td>è¯»å– ï¼ˆé»˜è®¤ï¼‰</td>
</tr>
<tr>
<td><code>&#39;w&#39;</code></td>
<td>å†™å…¥ï¼ˆä¼šå…ˆæˆªæ–­ä¹‹å‰çš„å†…å®¹ï¼‰</td>
</tr>
<tr>
<td><code>&#39;x&#39;</code></td>
<td>å†™å…¥ï¼Œå¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ä¼šäº§ç”Ÿå¼‚å¸¸</td>
</tr>
<tr>
<td><code>&#39;a&#39;</code></td>
<td>è¿½åŠ ï¼Œå°†å†…å®¹å†™å…¥åˆ°å·²æœ‰æ–‡ä»¶çš„æœ«å°¾</td>
</tr>
<tr>
<td><code>&#39;b&#39;</code></td>
<td>äºŒè¿›åˆ¶æ¨¡å¼</td>
</tr>
<tr>
<td><code>&#39;t&#39;</code></td>
<td>æ–‡æœ¬æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰</td>
</tr>
<tr>
<td><code>&#39;+&#39;</code></td>
<td>æ›´æ–°ï¼ˆæ—¢å¯ä»¥è¯»åˆå¯ä»¥å†™ï¼‰</td>
</tr>
</tbody></table>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-26-101106.png" alt></p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>io_using_file.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">poem = <span class="string">'''\</span></span><br><span class="line"><span class="string">Programming is fun</span></span><br><span class="line"><span class="string">When the work is done</span></span><br><span class="line"><span class="string">if you wanna make your work also fun:</span></span><br><span class="line"><span class="string">    use Python!</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€æ–‡ä»¶ä»¥ç¼–è¾‘ï¼ˆwritingï¼‰</span></span><br><span class="line">f = open(<span class="string">'poem.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line"><span class="comment"># å‘æ–‡ä»¶ä¸­ç¼–å†™æ–‡æœ¬</span></span><br><span class="line">f.write(poem)</span><br><span class="line"><span class="comment"># å…³é—­æ–‡ä»¶</span></span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡å®šï¼Œå°†å‡å®šå¯ç”¨é»˜è®¤çš„é˜…è¯»ï¼ˆreadï¼‰æ¨¡å¼</span></span><br><span class="line">f = open(<span class="string">'poem.txt'</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    line = f.readline()</span><br><span class="line">    <span class="comment"># é›¶é•¿åº¦æŒ‡ç¤º EOF</span></span><br><span class="line">    <span class="keyword">if</span> len(line) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># æ¯è¡Œçš„æœ«å°¾éƒ½å·²ç»æœ‰äº†æ¢è¡Œç¬¦ï¼Œå› ä¸ºå®ƒæ˜¯ä»ä¸€ä¸ªæ–‡ä»¶ä¸­è¿›è¡Œè¯»å–çš„</span></span><br><span class="line">    print(line, end=<span class="string">''</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># å…³é—­æ–‡ä»¶</span></span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python3 io_using_file.py</span><br><span class="line">Programming <span class="keyword">is</span> fun</span><br><span class="line">When the work <span class="keyword">is</span> done</span><br><span class="line"><span class="keyword">if</span> you wanna make your work also fun:</span><br><span class="line">    use Python!</span><br></pre></td></tr></table></figure>

<h3 id="è¯»å†™æ–‡æœ¬æ–‡ä»¶"><a href="#è¯»å†™æ–‡æœ¬æ–‡ä»¶" class="headerlink" title="è¯»å†™æ–‡æœ¬æ–‡ä»¶"></a>è¯»å†™æ–‡æœ¬æ–‡ä»¶</h3><ul>
<li>ä½¿ç”¨ <code>open</code> å‡½æ•°æ‰“å¼€æ–‡ä»¶</li>
<li>ä½¿ç”¨ <code>encoding</code> å‚æ•°æŒ‡å®šç¼–ç </li>
<li>ä½¿ç”¨ <code>with</code> è¯­å¥æ¥è‡ªåŠ¨è°ƒç”¨ <code>close()</code> æ–¹æ³•</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># ä¸€æ¬¡æ€§è¯»å–æ•´ä¸ªæ–‡ä»¶å†…å®¹</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'è‡´æ©¡æ ‘.txt'</span>, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        print(f.read())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é€šè¿‡for-inå¾ªç¯é€è¡Œè¯»å–</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'è‡´æ©¡æ ‘.txt'</span>, mode=<span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            print(line, end=<span class="string">''</span>)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¯»å–æ–‡ä»¶æŒ‰è¡Œè¯»å–åˆ°åˆ—è¡¨ä¸­</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'è‡´æ©¡æ ‘.txt'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        lines = f.readlines()</span><br><span class="line">    print(lines)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h3 id="è¯»å†™äºŒè¿›åˆ¶æ–‡ä»¶"><a href="#è¯»å†™äºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="è¯»å†™äºŒè¿›åˆ¶æ–‡ä»¶"></a>è¯»å†™äºŒè¿›åˆ¶æ–‡ä»¶</h3><ul>
<li>ä½¿ç”¨ <code>rb</code> è¯»å–äºŒè¿›åˆ¶å›¾ç‰‡</li>
<li>ä½¿ç”¨ <code>wb</code> å†™å…¥äºŒè¿›åˆ¶å›¾ç‰‡</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'python.jpg'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> fs1:</span><br><span class="line">            data = fs1.read()</span><br><span class="line">            print(type(data))  <span class="comment"># &lt;class 'bytes'&gt;</span></span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'python_bak.jpg'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> fs2:</span><br><span class="line">            fs2.write(data)</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">'æŒ‡å®šçš„æ–‡ä»¶æ— æ³•æ‰“å¼€.'</span>)</span><br><span class="line">    <span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">'è¯»å†™æ–‡ä»¶æ—¶å‡ºç°é”™è¯¯.'</span>)</span><br><span class="line">    print(<span class="string">'ç¨‹åºæ‰§è¡Œç»“æŸ.'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h3 id="è¯»å†™-JSON-æ–‡ä»¶"><a href="#è¯»å†™-JSON-æ–‡ä»¶" class="headerlink" title="è¯»å†™ JSON æ–‡ä»¶"></a>è¯»å†™ JSON æ–‡ä»¶</h3><ul>
<li><strong>åºåˆ—åŒ–</strong>ï¼šæŠŠå˜é‡ä»å†…å­˜ä¸­å˜æˆå¯å­˜å‚¨æˆ–ä¼ è¾“çš„è¿‡ç¨‹ç§°ä¹‹ä¸ºåºåˆ—åŒ–ã€‚</li>
<li><strong>ååºåˆ—åŒ–</strong>ï¼šæŠŠå˜é‡ä»åºåˆ—åŒ–çš„å¯¹è±¡é‡æ–°è¯»åˆ°å†…å­˜é‡Œç§°ä¹‹ä¸ºååºåˆ—åŒ–ã€‚</li>
<li><strong><code>json</code> åº“</strong>ï¼šå¯ä»¥å®ç° Python å¯¹è±¡å’Œ <code>JSON</code> æ ¼å¼çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</li>
<li><strong><code>pickle</code> åº“</strong>ï¼šä½¿ç”¨ç‰¹æœ‰çš„åºåˆ—åŒ–åè®®æ¥åºåˆ—åŒ–æ•°æ®ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th>json åº“æ–¹æ³•</th>
<th>å…·ä½“å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>dump</code></td>
<td>å°† Python å¯¹è±¡æŒ‰ç…§ <code>JSON</code> æ ¼å¼åºåˆ—åŒ–åˆ°æ–‡ä»¶ä¸­</td>
</tr>
<tr>
<td><code>dumps</code></td>
<td>å°† Python å¯¹è±¡å¤„ç†æˆ <code>JSON</code> æ ¼å¼çš„å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td><code>load</code></td>
<td>å°†æ–‡ä»¶ä¸­çš„ <code>JSON</code> æ•°æ®ååºåˆ—åŒ–æˆå¯¹è±¡</td>
</tr>
<tr>
<td><code>loads</code></td>
<td>å°†å­—ç¬¦ä¸²çš„å†…å®¹ååºåˆ—åŒ–æˆ Python å¯¹è±¡</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    mydict = &#123;</span><br><span class="line">        <span class="string">'name'</span>: <span class="string">'ç‹„ä»æ°'</span>,</span><br><span class="line">        <span class="string">'age'</span>: <span class="number">38</span>,</span><br><span class="line">        <span class="string">'qq'</span>: <span class="number">957658</span>,</span><br><span class="line">        <span class="string">'friends'</span>: [<span class="string">'ç‹å¤§é”¤'</span>, <span class="string">'æå…ƒèŠ³'</span>],</span><br><span class="line">        <span class="string">'cars'</span>: [</span><br><span class="line">            &#123;<span class="string">'brand'</span>: <span class="string">'BYD'</span>, <span class="string">'max_speed'</span>: <span class="number">180</span>&#125;,</span><br><span class="line">            &#123;<span class="string">'brand'</span>: <span class="string">'Audi'</span>, <span class="string">'max_speed'</span>: <span class="number">280</span>&#125;,</span><br><span class="line">            &#123;<span class="string">'brand'</span>: <span class="string">'Benz'</span>, <span class="string">'max_speed'</span>: <span class="number">320</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'data.json'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> fs:</span><br><span class="line">            json.dump(mydict, fs)</span><br><span class="line">    <span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line">        print(e)</span><br><span class="line">    print(<span class="string">'ä¿å­˜æ•°æ®å®Œæˆ!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">JSON ç±»å‹</th>
<th align="left">Python ç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">{}</td>
<td align="left"><code>dict</code></td>
</tr>
<tr>
<td align="left">[]</td>
<td align="left"><code>list</code></td>
</tr>
<tr>
<td align="left">â€œstringâ€</td>
<td align="left"><code>str</code></td>
</tr>
<tr>
<td align="left">1234.56</td>
<td align="left"><code>int</code> æˆ– <code>float</code></td>
</tr>
<tr>
<td align="left">true/false</td>
<td align="left"><code>True</code> / <code>False</code></td>
</tr>
<tr>
<td align="left">null</td>
<td align="left"><code>None</code></td>
</tr>
</tbody></table>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>io_pickle.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬å­˜å‚¨ç›¸å…³å¯¹è±¡çš„æ–‡ä»¶çš„åç§°</span></span><br><span class="line">shoplistfile = <span class="string">'shoplist.data'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éœ€è¦è´­ä¹°çš„ç‰©å“æ¸…å•</span></span><br><span class="line">shoplist = [<span class="string">'apple'</span>, <span class="string">'mango'</span>, <span class="string">'carrot'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡†å¤‡å†™å…¥æ–‡ä»¶</span></span><br><span class="line">f = open(shoplistfile, <span class="string">'wb'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬å‚¨å¯¹è±¡è‡³æ–‡ä»¶</span></span><br><span class="line">pickle.dump(shoplist, f)</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…é™¤ shoplist å˜é‡</span></span><br><span class="line"><span class="keyword">del</span> shoplist</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°æ‰“å¼€å­˜å‚¨æ–‡ä»¶</span></span><br><span class="line">f = open(shoplistfile, <span class="string">'rb'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»æ–‡ä»¶ä¸­è½½å…¥å¯¹è±¡</span></span><br><span class="line">storedlist = pickle.load(f)</span><br><span class="line">print(storedlist)</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python io_pickle.py</span><br><span class="line">[<span class="string">'apple'</span>, <span class="string">'mango'</span>, <span class="string">'carrot'</span>]</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Python Â· ä»£ç è§„èŒƒ</title>
    <url>/blog/2019/10/24/python-rules/</url>
    <content><![CDATA[<h2 id="æ ¼å¼è§„èŒƒ"><a href="#æ ¼å¼è§„èŒƒ" class="headerlink" title="æ ¼å¼è§„èŒƒ"></a>æ ¼å¼è§„èŒƒ</h2><ul>
<li><p><strong>ç¼©è¿›</strong>ï¼šç»Ÿä¸€ä½¿ç”¨ <code>4</code> ä¸ªç©ºæ ¼è¿›è¡Œç¼©è¿›</p>
</li>
<li><p><strong>è¡Œå®½</strong>ï¼šæ¯è¡Œä»£ç å°½é‡ä¸è¶…è¿‡ <code>80</code> ä¸ªå­—ç¬¦</p>
</li>
<li><p><strong>å¼•å·</strong>ï¼šè‡ªç„¶è¯­è¨€ä½¿ç”¨åŒå¼•å·ï¼Œæœºå™¨æ ‡è¯†ä½¿ç”¨å•å¼•å·</p>
</li>
<li><p><strong>ç©ºè¡Œ</strong>ï¼šæ¨¡å—çº§å‡½æ•°å’Œç±»å®šä¹‰ä¹‹é—´ç©ºä¸¤è¡Œï¼Œç±»æˆå‘˜å‡½æ•°ä¹‹é—´ç©ºä¸€è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ç¼–ç </strong>ï¼šæ–‡ä»¶ä½¿ç”¨ <code>UTF-8</code> ç¼–ç ï¼Œæ–‡ä»¶å¤´éƒ¨åŠ å…¥ <code>#-*-conding:utf-8-*-</code> æ ‡è¯†</p>
</li>
<li><p><strong>import</strong>ï¼š<code>import è¯­å¥</code> åº”è¯¥åˆ†è¡Œä¹¦å†™</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ­£ç¡®çš„å†™æ³•</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸æ¨èçš„å†™æ³•</span></span><br><span class="line"><span class="keyword">import</span> sys,os</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£ç¡®çš„å†™æ³•</span></span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> Popen, PIPE</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ç©ºæ ¼</strong>ï¼š</p>
<ul>
<li>åœ¨äºŒå…ƒè¿ç®—ç¬¦ä¸¤è¾¹å„ç©ºä¸€æ ¼ <code>[=, -, +=, ==, &gt;, in, is not, and]</code></li>
<li>å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­ï¼Œ<code>,</code> ä¹‹åè¦æœ‰ç©ºæ ¼</li>
<li>å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­ï¼Œé»˜è®¤å€¼ç­‰å·ä¸¤è¾¹ä¸è¦æ·»åŠ ç©ºæ ¼</li>
<li>å·¦æ‹¬å·ä¹‹åï¼Œå³æ‹¬å·ä¹‹å‰ä¸è¦åŠ å¤šä½™çš„ç©ºæ ¼</li>
<li>å­—å…¸å¯¹è±¡çš„å·¦æ‹¬å·ä¹‹å‰ä¸è¦å¤šä½™çš„ç©ºæ ¼</li>
<li>ä¸è¦ä¸ºå¯¹é½èµ‹å€¼è¯­å¥è€Œä½¿ç”¨çš„é¢å¤–ç©ºæ ¼</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ­£ç¡®çš„å†™æ³•</span></span><br><span class="line">i = i + <span class="number">1</span></span><br><span class="line">submitted += <span class="number">1</span></span><br><span class="line">x = x * <span class="number">2</span> - <span class="number">1</span></span><br><span class="line">hypot2 = x * x + y * y</span><br><span class="line">c = (a + b) * (a - b)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸æ¨èçš„å†™æ³•</span></span><br><span class="line">i=i+<span class="number">1</span></span><br><span class="line">submitted +=<span class="number">1</span></span><br><span class="line">x = x*<span class="number">2</span> - <span class="number">1</span></span><br><span class="line">hypot2 = x*x + y*y</span><br><span class="line">c = (a+b) * (a-b)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£ç¡®çš„å†™æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">complex</span><span class="params">(real, imag)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸æ¨èçš„å†™æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">complex</span><span class="params">(real,imag)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£ç¡®çš„å†™æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">complex</span><span class="params">(real, imag=<span class="number">0.0</span>)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸æ¨èçš„å†™æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">complex</span><span class="params">(real, imag = <span class="number">0.0</span>)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># æ­£ç¡®çš„å†™æ³•</span></span><br><span class="line">spam(ham[<span class="number">1</span>], &#123;eggs: <span class="number">2</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸æ¨èçš„å†™æ³•</span></span><br><span class="line">spam( ham[<span class="number">1</span>], &#123; eggs : <span class="number">2</span> &#125; )</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£ç¡®çš„å†™æ³•</span></span><br><span class="line">dict[<span class="string">'key'</span>] = list[index]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸æ¨èçš„å†™æ³•</span></span><br><span class="line">dict [<span class="string">'key'</span>] = list [index]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£ç¡®çš„å†™æ³•</span></span><br><span class="line">x = <span class="number">1</span></span><br><span class="line">y = <span class="number">2</span></span><br><span class="line">long_variable = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸æ¨èçš„å†™æ³•</span></span><br><span class="line">x             = <span class="number">1</span></span><br><span class="line">y             = <span class="number">2</span></span><br><span class="line">long_variable = <span class="number">3</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æ¢è¡Œ</strong>ï¼š</p>
<ul>
<li>ç¬¬äºŒè¡Œç¼©è¿›åˆ°æ‹¬å·çš„èµ·å§‹å¤„</li>
<li>ç¦æ­¢å¤åˆè¯­å¥ï¼Œå³ä¸€è¡Œä¸­åŒ…å«å¤šä¸ªè¯­å¥</li>
<li><code>if/for/while</code> ä¸€å®šè¦æ¢è¡Œ</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">foo = long_function_name(var_one, var_two,</span><br><span class="line">                         var_three, var_four)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£ç¡®çš„å†™æ³•</span></span><br><span class="line">do_first()</span><br><span class="line">do_second()</span><br><span class="line">do_third()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸æ¨èçš„å†™æ³•</span></span><br><span class="line">do_first();do_second();do_third();</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£ç¡®çš„å†™æ³•</span></span><br><span class="line"><span class="keyword">if</span> foo == <span class="string">'blah'</span>:</span><br><span class="line">    do_blah_thing()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸æ¨èçš„å†™æ³•</span></span><br><span class="line"><span class="keyword">if</span> foo == <span class="string">'blah'</span>: do_blash_thing()</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>docstring</strong>ï¼šæ‰€æœ‰çš„å…¬å…±æ¨¡å—ã€å‡½æ•°ã€ç±»ã€æ–¹æ³•ï¼Œéƒ½åº”è¯¥å†™ <code>docstring</code></p>
</li>
</ul>
<h2 id="æ³¨é‡Šè§„èŒƒ"><a href="#æ³¨é‡Šè§„èŒƒ" class="headerlink" title="æ³¨é‡Šè§„èŒƒ"></a>æ³¨é‡Šè§„èŒƒ</h2><ul>
<li>åœ¨ä»£ç çš„å…³é”®éƒ¨åˆ†ï¼Œèƒ½å†™æ³¨é‡Šçš„è¦å°½é‡å†™æ³¨é‡Š</li>
<li>æ¯”è¾ƒé‡è¦çš„æ³¨é‡Šæ®µï¼Œä½¿ç”¨å¤šä¸ªç­‰å·éš”å¼€ï¼Œå¯ä»¥æ›´åŠ é†’ç›®ï¼Œçªå‡ºé‡è¦æ€§</li>
<li>æ–‡æ¡£æ³¨é‡Šä»¥ â€œâ€â€ å¼€å¤´å’Œç»“å°¾ï¼Œé¦–è¡Œä¸æ¢è¡Œï¼Œå¦‚æœ‰å¤šè¡Œï¼Œæœ«è¡Œå¿…éœ€æ¢è¡Œ</li>
<li>è¦åœ¨æ–‡æ¡£æ³¨é‡Šå¤åˆ¶å‡½æ•°å®šä¹‰åŸå‹ï¼Œè€Œæ˜¯å…·ä½“æè¿°å…¶å…·ä½“å†…å®¹ï¼Œè§£é‡Šå…·ä½“å‚æ•°å’Œè¿”å›å€¼ç­‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">app = create_app(name, options)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =====================================</span></span><br><span class="line"><span class="comment"># è¯·å‹¿åœ¨æ­¤å¤„æ·»åŠ  get postç­‰appè·¯ç”±è¡Œä¸º !!!</span></span><br><span class="line"><span class="comment"># =====================================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">#  ä¸æ¨èçš„å†™æ³•(ä¸è¦å†™å‡½æ•°åŸå‹ç­‰åºŸè¯)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="string">"""function(a, b) -&gt; list"""</span></span><br><span class="line">    ... ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#  æ­£ç¡®çš„å†™æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="string">"""è®¡ç®—å¹¶è¿”å›aåˆ°bèŒƒå›´å†…æ•°æ®çš„å¹³å‡å€¼"""</span></span><br><span class="line">    ... ...</span><br></pre></td></tr></table></figure>

<h2 id="å‘½åè§„èŒƒ"><a href="#å‘½åè§„èŒƒ" class="headerlink" title="å‘½åè§„èŒƒ"></a>å‘½åè§„èŒƒ</h2><ul>
<li><strong>æ¨¡å—</strong>ï¼šæ¨¡å—åå°½é‡ä½¿ç”¨å°å†™å‘½åï¼Œé¦–å­—æ¯ä¿æŒå°å†™ï¼Œå°½é‡ä¸è¦ç”¨ä¸‹åˆ’çº¿</li>
<li><strong>ç±»</strong>ï¼šç±»åä½¿ç”¨é©¼å³° (CamelCase) å‘½åé£æ ¼ï¼Œé¦–å­—æ¯å¤§å†™ï¼Œç§æœ‰ç±»å¯ç”¨ä¸€ä¸ªä¸‹åˆ’çº¿å¼€å¤´</li>
<li><strong>å‡½æ•°</strong>ï¼šå‡½æ•°åä¸€å¾‹å°å†™ï¼Œå¦‚æœ‰å¤šä¸ªå•è¯ï¼Œç”¨ä¸‹åˆ’çº¿éš”å¼€ï¼Œç§æœ‰å‡½æ•°å¯ç”¨ä¸€ä¸ªä¸‹åˆ’çº¿å¼€å¤´</li>
<li><strong>å˜é‡</strong>ï¼šå˜é‡åå°½é‡å°å†™ï¼Œå¦‚æœ‰å¤šä¸ªå•è¯ï¼Œç”¨ä¸‹åˆ’çº¿éš”å¼€</li>
<li><strong>å¸¸é‡</strong>ï¼šå¸¸é‡åé‡‡ç”¨å…¨å¤§å†™ï¼Œå¦‚æœ‰å¤šä¸ªå•è¯ï¼Œä½¿ç”¨ä¸‹åˆ’çº¿éš”å¼€</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¨¡å—å‘½å</span></span><br><span class="line"><span class="keyword">import</span> decoder</span><br><span class="line"><span class="keyword">import</span> html_parser</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç±»å‘½å</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Farm</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnimalFarm</span><span class="params">(Farm)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="comment"># ç§æœ‰ç±»å‘½å</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_PrivateFarm</span><span class="params">(Farm)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="comment"># å‡½æ•°å‘½å</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_with_env</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment"># ç§æœ‰å‡½æ•°å‘½å</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_private_func</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line"><span class="comment"># å˜é‡å‘½å</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    school_name = <span class="string">''</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸¸é‡å‘½å</span></span><br><span class="line">MAX_CLIENT = <span class="number">100</span></span><br><span class="line">MAX_CONNECTION = <span class="number">1000</span></span><br><span class="line">CONNECTION_TIMEOUT = <span class="number">600</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Python Â· æµ‹è¯•</title>
    <url>/blog/2019/10/24/python-testing/</url>
    <content><![CDATA[<p><strong>å•å…ƒæµ‹è¯•</strong>ï¼š<code>unittest</code>ã€<code>setUp()</code>ã€<code>tearDown()</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> mydict <span class="keyword">import</span> Dict</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestDict</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_init</span><span class="params">(self)</span>:</span></span><br><span class="line">        d = Dict(a=<span class="number">1</span>, b=<span class="string">'test'</span>)</span><br><span class="line">        self.assertEqual(d.a, <span class="number">1</span>)</span><br><span class="line">        self.assertEqual(d.b, <span class="string">'test'</span>)</span><br><span class="line">        self.assertTrue(isinstance(d, dict))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_key</span><span class="params">(self)</span>:</span></span><br><span class="line">        d = Dict()</span><br><span class="line">        d[<span class="string">'key'</span>] = <span class="string">'value'</span></span><br><span class="line">        self.assertEqual(d.key, <span class="string">'value'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_attr</span><span class="params">(self)</span>:</span></span><br><span class="line">        d = Dict()</span><br><span class="line">        d.key = <span class="string">'value'</span></span><br><span class="line">        self.assertTrue(<span class="string">'key'</span> <span class="keyword">in</span> d)</span><br><span class="line">        self.assertEqual(d[<span class="string">'key'</span>], <span class="string">'value'</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_keyerror</span><span class="params">(self)</span>:</span></span><br><span class="line">        d = Dict()</span><br><span class="line">        <span class="keyword">with</span> self.assertRaises(KeyError):</span><br><span class="line">            value = d[<span class="string">'empty'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_attrerror</span><span class="params">(self)</span>:</span></span><br><span class="line">        d = Dict()</span><br><span class="line">        <span class="keyword">with</span> self.assertRaises(AttributeError):</span><br><span class="line">            value = d.empty</span><br><span class="line">            </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>

<p><strong>virtualenv</strong>ï¼šä¸ºåº”ç”¨æä¾›äº†éš”ç¦»çš„ <code>Python</code> è¿è¡Œç¯å¢ƒï¼Œè§£å†³äº†ä¸åŒåº”ç”¨é—´å¤šç‰ˆæœ¬çš„å†²çªé—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Python Â· é”™è¯¯ä¸å¼‚å¸¸</title>
    <url>/blog/2019/10/24/python-exception/</url>
    <content><![CDATA[<h2 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h2><ul>
<li><code>try..except</code>ï¼šä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä¼šå°†æ‰€æœ‰å¯èƒ½å¼•å‘å¼‚å¸¸æˆ–é”™è¯¯çš„è¯­å¥æ”¾åœ¨ <code>try</code> ä»£ç å—ä¸­ï¼Œå°†é”™è¯¯å¤„ç†ä»£ç æ”¾ç½®åœ¨ <code>except</code> ä»£ç å—ä¸­ã€‚</li>
<li><code>finally</code>ï¼šæ€»æ˜¯ä¼šæ‰§è¡Œä»£ç å—ï¼Œä¸è®ºç¨‹åºæ­£å¸¸è¿˜æ˜¯å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œåˆ°ã€‚</li>
<li><code>raise</code>ï¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½ èƒ½å¤Ÿå¼•å‘çš„é”™è¯¯æˆ–å¼‚å¸¸å¿…é¡»æ˜¯ç›´æ¥æˆ–é—´æ¥ä»å±äº <code>Exception</code>ï¼ˆå¼‚å¸¸ï¼‰ ç±»çš„æ´¾ç”Ÿç±»ã€‚</li>
<li><code>as</code>ï¼šå¼‚å¸¸ç±»åˆ«åã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>exceptions_finally.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">f = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f = open(<span class="string">"poem.txt"</span>)</span><br><span class="line">    <span class="comment"># æˆ‘ä»¬å¸¸ç”¨çš„æ–‡ä»¶é˜…è¯»é£æ ¼</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        line = f.readline()</span><br><span class="line">        <span class="keyword">if</span> len(line) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        print(line, end=<span class="string">''</span>)</span><br><span class="line">        sys.stdout.flush()</span><br><span class="line">        print(<span class="string">"Press ctrl+c now"</span>)</span><br><span class="line">        <span class="comment"># ä¸ºäº†ç¡®ä¿å®ƒèƒ½è¿è¡Œä¸€æ®µæ—¶é—´</span></span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">except</span> IOError:</span><br><span class="line">    print(<span class="string">"Could not find file poem.txt"</span>)</span><br><span class="line"><span class="keyword">except</span> KeyboardInterrupt <span class="keyword">as</span> ki:</span><br><span class="line">    print(<span class="string">"!! You cancelled the reading from the file."</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="keyword">if</span> f:</span><br><span class="line">        f.close()</span><br><span class="line">    print(<span class="string">"(Cleaning up: Closed the file)"</span>)</span><br><span class="line">    </span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python exceptions_finally.py</span><br><span class="line">Programming <span class="keyword">is</span> fun</span><br><span class="line">Press ctrl+c now</span><br><span class="line">^C!! You cancelled the reading <span class="keyword">from</span> the file.</span><br><span class="line">(Cleaning up: Closed the file)</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Python Â· é¢å‘å¯¹è±¡</title>
    <url>/blog/2019/10/24/python-oop/</url>
    <content><![CDATA[<h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>ä¸€ä¸ª<strong>ç±»ï¼ˆClassï¼‰</strong>èƒ½å¤Ÿåˆ›å»ºä¸€ç§æ–°çš„ç±»å‹ï¼ˆTypeï¼‰ï¼Œå…¶ä¸­<strong>å¯¹è±¡ï¼ˆObjectï¼‰</strong>å°±æ˜¯ç±»çš„<strong>å®ä¾‹ï¼ˆInstanceï¼‰</strong>ï¼Œè¿™ç§ä»å±äºå¯¹è±¡æˆ–ç±»çš„å˜é‡å«ä½œ<strong>å­—æ®µï¼ˆFieldï¼‰</strong>ï¼Œå¯¹è±¡è¿˜å¯ä»¥ä½¿ç”¨å±äºç±»çš„å‡½æ•°æ¥å®ç°æŸäº›åŠŸèƒ½ï¼Œè¿™ç§å‡½æ•°å«ä½œç±»çš„<strong>æ–¹æ³•ï¼ˆMethodï¼‰</strong>ï¼Œå­—æ®µä¸æ–¹æ³•é€šç§°ç±»çš„<strong>å±æ€§ï¼ˆAttributeï¼‰</strong>ã€‚</p>
<p><strong><code>self</code></strong>ï¼šç±»æ–¹æ³•ä¸æ™®é€šå‡½æ•°åªæœ‰ä¸€ç§ç‰¹å®šçš„åŒºåˆ«ï¼Œå‰è€…å¿…é¡»å¤šåŠ ä¸€ä¸ª <code>self</code> å‚æ•°åœ¨å‚æ•°åˆ—è¡¨å¼€å¤´ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>oop_method.py</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say_hi</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'Hello, how are you?'</span>)</span><br><span class="line"></span><br><span class="line">p = Person()</span><br><span class="line">p.say_hi()</span><br><span class="line"><span class="comment"># å‰é¢ä¸¤è¡ŒåŒæ ·å¯ä»¥å†™ä½œ</span></span><br><span class="line"><span class="comment"># Person().say_hi()</span></span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python oop_method.py</span><br><span class="line">Hello, how are you?</span><br></pre></td></tr></table></figure>

<p><strong><code>__init__</code></strong> ï¼šæ­¤æ–¹æ³•ä¼šåœ¨ç±»çš„å¯¹è±¡è¢«å®ä¾‹åŒ–ï¼ˆInstantiatedï¼‰æ—¶ç«‹å³è¿è¡Œï¼Œå¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–æ“ä½œã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>oop_init.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say_hi</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'Hello, my name is'</span>, self.name)</span><br><span class="line"></span><br><span class="line">p = Person(<span class="string">'Swaroop'</span>)</span><br><span class="line">p.say_hi()</span><br><span class="line"><span class="comment"># å‰é¢ä¸¤è¡ŒåŒæ—¶ä¹Ÿèƒ½å†™ä½œ</span></span><br><span class="line"><span class="comment"># Person('Swaroop').say_hi()</span></span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python oop_init.py</span><br><span class="line">Hello, my name <span class="keyword">is</span> Swaroop</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>ç±»å˜é‡ï¼ˆClass Variableï¼‰</strong>ï¼šå…±äº«çš„ï¼Œå¯ä»¥è¢«å±äºè¯¥ç±»çš„æ‰€æœ‰å®ä¾‹è®¿é—®ã€‚</li>
<li><strong>å¯¹è±¡å˜é‡ï¼ˆObject variableï¼‰</strong>ï¼šç”±ç±»çš„æ¯ä¸€ä¸ªç‹¬ç«‹çš„å¯¹è±¡æˆ–å®ä¾‹æ‰€æ‹¥æœ‰ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>oop_objvar.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Robot</span>:</span></span><br><span class="line">    <span class="string">"""è¡¨ç¤ºæœ‰ä¸€ä¸ªå¸¦æœ‰åå­—çš„æœºå™¨äºº"""</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¸€ä¸ªç±»å˜é‡ï¼Œç”¨æ¥è®¡æ•°æœºå™¨äººçš„æ•°é‡</span></span><br><span class="line">    population = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="string">"""åˆå§‹åŒ–æ•°æ®"""</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ä¸€ä¸ªå¯¹è±¡å˜é‡</span></span><br><span class="line">        self.name = name</span><br><span class="line">        print(<span class="string">"(Initializing &#123;&#125;)"</span>.format(self.name))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å½“æœ‰äººè¢«åˆ›å»ºæ—¶ï¼Œæœºå™¨äººå°†ä¼šå¢åŠ äººå£æ•°é‡</span></span><br><span class="line">        Robot.population += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">die</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""æˆ‘æŒ‚äº†"""</span></span><br><span class="line">        print(<span class="string">"&#123;&#125; is being destroyed!"</span>.format(self.name))</span><br><span class="line"></span><br><span class="line">        Robot.population -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> Robot.population == <span class="number">0</span>:</span><br><span class="line">            print(<span class="string">"&#123;&#125; was the last one."</span>.format(self.name))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"There are still &#123;:d&#125; robots working."</span>.format(</span><br><span class="line">                Robot.population))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say_hi</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""æ¥è‡ªæœºå™¨äººçš„è¯šæŒšé—®å€™ï¼šæ²¡é—®é¢˜ï¼Œä½ åšå¾—åˆ°ï¼"""</span></span><br><span class="line">        print(<span class="string">"Greetings, my masters call me &#123;&#125;."</span>.format(self.name))</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># ç±»æ–¹æ³•</span></span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">how_many</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="string">"""æ‰“å°å‡ºå½“å‰çš„äººå£æ•°é‡"""</span></span><br><span class="line">        print(<span class="string">"We have &#123;:d&#125; robots."</span>.format(cls.population))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">droid1 = Robot(<span class="string">"R2-D2"</span>)</span><br><span class="line">droid1.say_hi()</span><br><span class="line">Robot.how_many()</span><br><span class="line"></span><br><span class="line">droid2 = Robot(<span class="string">"C-3PO"</span>)</span><br><span class="line">droid2.say_hi()</span><br><span class="line">Robot.how_many()</span><br><span class="line"></span><br><span class="line">print(<span class="string">"\nRobots can do some work here.\n"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"Robots have finished their work. So let's destroy them."</span>)</span><br><span class="line">droid1.die()</span><br><span class="line">droid2.die()</span><br><span class="line"></span><br><span class="line">Robot.how_many()</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python oop_objvar.py</span><br><span class="line">(Initializing R2-D2)</span><br><span class="line">Greetings, my masters call me R2-D2.</span><br><span class="line">We have <span class="number">1</span> robots.</span><br><span class="line">(Initializing C<span class="number">-3</span>PO)</span><br><span class="line">Greetings, my masters call me C<span class="number">-3</span>PO.</span><br><span class="line">We have <span class="number">2</span> robots.</span><br><span class="line"></span><br><span class="line">Robots can do some work here.</span><br><span class="line"></span><br><span class="line">Robots have finished their work. So let<span class="string">'s destroy them.</span></span><br><span class="line"><span class="string">R2-D2 is being destroyed!</span></span><br><span class="line"><span class="string">There are still 1 robots working.</span></span><br><span class="line"><span class="string">C-3PO is being destroyed!</span></span><br><span class="line"><span class="string">C-3PO was the last one.</span></span><br><span class="line"><span class="string">We have 0 robots.</span></span><br></pre></td></tr></table></figure>

<h2 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h2><p>é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€å¤§ä¼˜ç‚¹æ˜¯å¯¹ä»£ç çš„<strong>é‡ç”¨ï¼ˆReuseï¼‰</strong>ï¼Œé‡ç”¨çš„ä¸€ç§å®ç°æ–¹æ³•å°±æ˜¯é€šè¿‡<strong>ç»§æ‰¿ï¼ˆInheritanceï¼‰</strong>æœºåˆ¶ï¼Œç»§æ‰¿æœ€å¥½æ˜¯æƒ³è±¡æˆåœ¨ç±»ä¹‹é—´å®ç°<strong>ç±»å‹ä¸å­ç±»å‹ï¼ˆType and Subtypeï¼‰</strong>å…³ç³»çš„å·¥å…·ã€‚</p>
<ul>
<li><strong>å¤šæ€æ€§ï¼ˆPolymorphismï¼‰</strong>ï¼šå­ç±»å’Œçˆ¶ç±»å­˜åœ¨ç›¸åŒçš„æ–¹æ³•æ—¶ï¼Œå­ç±»è¦†ç›–äº†çˆ¶ç±»çš„æ–¹æ³•ã€‚</li>
<li><strong>åŸºç±»ï¼ˆBase Classï¼‰</strong>/ <strong>è¶…ç±»ï¼ˆSuperclassï¼‰</strong>ï¼š<code>SchoolMember</code> ç±»</li>
<li><strong>æ´¾ç”Ÿç±»ï¼ˆDerived Classesï¼‰</strong>/ <strong>å­ç±»ï¼ˆSubclassï¼‰</strong>ï¼š<code>Teacher</code> å’Œ <code>Student</code> ç±»</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">            â”‚ SchoolMember  â”‚</span><br><span class="line">            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                    â”‚</span><br><span class="line">       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">       â”‚                         â”‚</span><br><span class="line">       â–¼                         â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚   Teacher   â”‚           â”‚   Student   â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<p><strong>ç¤ºä¾‹</strong>ï¼š<code>oop_subclass.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SchoolMember</span>:</span></span><br><span class="line">    <span class="string">'''ä»£è¡¨ä»»ä½•å­¦æ ¡é‡Œçš„æˆå‘˜ã€‚'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        print(<span class="string">'(Initialized SchoolMember: &#123;&#125;)'</span>.format(self.name))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tell</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''å‘Šè¯‰æˆ‘æœ‰å…³æˆ‘çš„ç»†èŠ‚ã€‚'''</span></span><br><span class="line">        print(<span class="string">'Name:"&#123;&#125;" Age:"&#123;&#125;"'</span>.format(self.name, self.age), end=<span class="string">" "</span>)</span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span><span class="params">(SchoolMember)</span>:</span></span><br><span class="line">    <span class="string">'''ä»£è¡¨ä¸€ä½è€å¸ˆã€‚'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age, salary)</span>:</span></span><br><span class="line">        SchoolMember.__init__(self, name, age)</span><br><span class="line">        self.salary = salary</span><br><span class="line">        print(<span class="string">'(Initialized Teacher: &#123;&#125;)'</span>.format(self.name))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tell</span><span class="params">(self)</span>:</span></span><br><span class="line">        SchoolMember.tell(self)</span><br><span class="line">        print(<span class="string">'Salary: "&#123;:d&#125;"'</span>.format(self.salary))</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(SchoolMember)</span>:</span></span><br><span class="line">    <span class="string">'''ä»£è¡¨ä¸€ä½å­¦ç”Ÿã€‚'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age, marks)</span>:</span></span><br><span class="line">        SchoolMember.__init__(self, name, age)</span><br><span class="line">        self.marks = marks</span><br><span class="line">        print(<span class="string">'(Initialized Student: &#123;&#125;)'</span>.format(self.name))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tell</span><span class="params">(self)</span>:</span></span><br><span class="line">        SchoolMember.tell(self)</span><br><span class="line">        print(<span class="string">'Marks: "&#123;:d&#125;"'</span>.format(self.marks))</span><br><span class="line">        </span><br><span class="line">t = Teacher(<span class="string">'Mrs. Shrividya'</span>, <span class="number">40</span>, <span class="number">30000</span>)</span><br><span class="line">s = Student(<span class="string">'Swaroop'</span>, <span class="number">25</span>, <span class="number">75</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°ä¸€è¡Œç©ºç™½è¡Œ</span></span><br><span class="line">print()</span><br><span class="line"></span><br><span class="line">members = [t, s]</span><br><span class="line"><span class="keyword">for</span> member <span class="keyword">in</span> members:</span><br><span class="line">    <span class="comment"># å¯¹å…¨ä½“å¸ˆç”Ÿå·¥ä½œ</span></span><br><span class="line">    member.tell()</span><br><span class="line">    </span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python oop_subclass.py</span><br><span class="line">(Initialized SchoolMember: Mrs. Shrividya)</span><br><span class="line">(Initialized Teacher: Mrs. Shrividya)</span><br><span class="line">(Initialized SchoolMember: Swaroop)</span><br><span class="line">(Initialized Student: Swaroop)</span><br><span class="line"></span><br><span class="line">Name:<span class="string">"Mrs. Shrividya"</span> Age:<span class="string">"40"</span> Salary: <span class="string">"30000"</span></span><br><span class="line">Name:<span class="string">"Swaroop"</span> Age:<span class="string">"25"</span> Marks: <span class="string">"75"</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Python Â· æ¨¡å—å’ŒåŒ…</title>
    <url>/blog/2019/10/24/python-module/</url>
    <content><![CDATA[<h2 id="æ¨¡å—"><a href="#æ¨¡å—" class="headerlink" title="æ¨¡å—"></a>æ¨¡å—</h2><p><strong>æ¨¡å—ï¼ˆModulesï¼‰</strong>ï¼šé‡ç”¨ä»£ç æ˜¯å‡½æ•°ï¼Œé‡ç”¨å‡½æ•°æ˜¯æ¨¡å—ï¼Œä»¥ <code>.py</code> ä¸ºæ‰©å±•åå°±å¯ä»¥æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œå¯ä»¥é¿å…å‡½æ•°å‘½åå†²çªã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># module1.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'hello, world!'</span>)</span><br><span class="line">   </span><br><span class="line"><span class="comment"># module2.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'goodbye, world!'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># test.py</span></span><br><span class="line"><span class="keyword">import</span> module1 <span class="keyword">as</span> m1</span><br><span class="line"><span class="keyword">import</span> module2 <span class="keyword">as</span> m2</span><br><span class="line"></span><br><span class="line">m1.foo()  <span class="comment"># è¾“å‡ºhello, world!</span></span><br><span class="line">m2.foo()  <span class="comment"># è¾“å‡ºgoodbye, world!</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Warningï¼š</strong>ä¸€èˆ¬æ¥è¯´ï¼Œä½ åº”è¯¥å°½é‡é¿å…ä½¿ç”¨ <code>from...import</code> è¯­å¥ï¼Œè€Œå»ä½¿ç”¨ <code>import</code> è¯­å¥ã€‚è¿™æ˜¯ä¸ºäº†é¿å…åœ¨ä½ çš„ç¨‹åºä¸­å‡ºç°åç§°å†²çªï¼ŒåŒæ—¶ä¹Ÿä¸ºäº†ä½¿ç¨‹åºæ›´åŠ æ˜“è¯»ã€‚</p>
</blockquote>
<p> <code>__name__</code> ï¼šæ˜¯ Python ä¸­ä¸€ä¸ªéšå«çš„å˜é‡ï¼Œå®ƒä»£è¡¨äº†æ¨¡å—çš„åå­—ï¼Œåªæœ‰è¢« Python è§£é‡Šå™¨ç›´æ¥æ‰§è¡Œçš„æ¨¡å—çš„åå­—æ‰æ˜¯ <code>__main__</code>ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>module_using_name.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(<span class="string">'This program is being run by itself'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'I am being imported from another module'</span>)</span><br><span class="line">    </span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python module_using_name.py</span><br><span class="line">This program <span class="keyword">is</span> being run by itself</span><br><span class="line"></span><br><span class="line">$ python</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> module_using_name</span><br><span class="line">I am being imported <span class="keyword">from</span> another module</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h2 id="åŒ…"><a href="#åŒ…" class="headerlink" title="åŒ…"></a>åŒ…</h2><p><strong>åŒ…ï¼ˆPackagesï¼‰</strong>ï¼šæ˜¯æŒ‡ä¸€ä¸ªåŒ…å«æ¨¡å—ä¸ä¸€ä¸ªç‰¹æ®Šçš„ <code>__init__.py</code> æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œèƒ½å¤Ÿæ–¹ä¾¿åœ°ç»„ç»‡æ¨¡å—çš„å±‚æ¬¡ç»“æ„ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mycompany</span><br><span class="line"> â”œâ”€ web</span><br><span class="line"> â”‚  â”œâ”€ __init__.py</span><br><span class="line"> â”‚  â”œâ”€ utils.py</span><br><span class="line"> â”‚  â””â”€ www.py</span><br><span class="line"> â”œâ”€ __init__.py</span><br><span class="line"> â”œâ”€ emploees.py</span><br><span class="line"> â””â”€ utils.py</span><br></pre></td></tr></table></figure>

<p><strong>æ€»ç»“</strong>ï¼šå¦‚åŒå‡½æ•°æ˜¯ç¨‹åºä¸­çš„å¯é‡ç”¨éƒ¨åˆ†é‚£èˆ¬ï¼Œæ¨¡å—æ˜¯ä¸€ç§å¯é‡ç”¨çš„ç¨‹åºï¼ŒåŒ…æ˜¯ç”¨ä»¥ç»„ç»‡æ¨¡å—çš„å¦ä¸€ç§å±‚æ¬¡ç»“æ„ã€‚Python æ‰€é™„å¸¦çš„æ ‡å‡†åº“å°±æ˜¯è¿™æ ·ä¸€ç»„æœ‰å…³åŒ…ä¸æ¨¡å—çš„ä¾‹å­ã€‚</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Python Â· å‡½æ•°</title>
    <url>/blog/2019/10/24/python-function/</url>
    <content><![CDATA[<h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p><strong>å‡½æ•°</strong>ï¼ˆ<code>Functions</code>ï¼‰ï¼šæ˜¯æŒ‡å¯é‡å¤ä½¿ç”¨çš„ç¨‹åºç‰‡æ®µã€‚</p>
<p><strong>å®šä¹‰å‡½æ•°</strong>ï¼šå¯ä»¥é€šè¿‡å…³é”®å­— <code>def</code> æ¥å®šä¹‰ï¼Œå…³é”®å­— <code>return</code> æ¥è¿”å›ä¸€ä¸ªå€¼ï¼Œå…³é”®å­— <code>pass</code> æŒ‡ç¤ºæ²¡æœ‰å†…å®¹çš„è¯­å¥å—ã€‚</p>
<p><strong>è°ƒç”¨å‡½æ•°</strong>ï¼šå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œä»£ç å—ï¼Œç§°ä¸ºè°ƒç”¨ï¼ˆ<code>Calling</code>ï¼‰å‡½æ•°ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>function1.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># è¯¥å—å±äºè¿™ä¸€å‡½æ•°</span></span><br><span class="line">    print(<span class="string">'hello world'</span>)</span><br><span class="line"><span class="comment"># å‡½æ•°ç»“æŸ</span></span><br><span class="line"></span><br><span class="line">say_hello()  <span class="comment"># è°ƒç”¨å‡½æ•°</span></span><br><span class="line">say_hello()  <span class="comment"># å†æ¬¡è°ƒç”¨å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python function1.py</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure>

<h2 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h2><p><strong>å½¢å‚</strong>ï¼šåœ¨å®šä¹‰å‡½æ•°æ—¶ç»™å®šçš„åç§°ç§°ä½œå½¢å‚ï¼ˆ<code>Parameters</code>ï¼‰ã€‚</p>
<p><strong>å®å‚</strong>ï¼šåœ¨è°ƒç”¨å‡½æ•°æ—¶ä½ æ‰€æä¾›ç»™å‡½æ•°çš„å€¼ç§°ä½œå®å‚ï¼ˆ<code>Arguments</code>ï¼‰ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>function_param.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_max</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> a &gt; b:</span><br><span class="line">        print(a, <span class="string">'is maximum'</span>)</span><br><span class="line">    <span class="keyword">elif</span> a == b:</span><br><span class="line">        print(a, <span class="string">'is equal to'</span>, b)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(b, <span class="string">'is maximum'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥ä¼ é€’å­—é¢å€¼</span></span><br><span class="line">print_max(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">x = <span class="number">5</span></span><br><span class="line">y = <span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥å‚æ•°çš„å½¢å¼ä¼ é€’å˜é‡</span></span><br><span class="line">print_max(x, y)</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python function_param.py</span><br><span class="line"><span class="number">4</span> <span class="keyword">is</span> maximum</span><br><span class="line"><span class="number">7</span> <span class="keyword">is</span> maximum</span><br></pre></td></tr></table></figure>

<p><strong>é»˜è®¤å‚æ•°</strong>ï¼šå¯ä»¥é€šè¿‡åœ¨å‡½æ•°å®šä¹‰æ—¶é™„åŠ ä¸€ä¸ªèµ‹å€¼è¿ç®—ç¬¦ï¼ˆ<code>=</code>ï¼‰æ¥ä¸ºå‚æ•°æŒ‡å®šé»˜è®¤å‚æ•°å€¼ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>function_default.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say</span><span class="params">(message, times=<span class="number">1</span>)</span>:</span></span><br><span class="line">    print(message * times)</span><br><span class="line"></span><br><span class="line">say(<span class="string">'Hello'</span>)</span><br><span class="line">say(<span class="string">'World'</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python function_default.py</span><br><span class="line">Hello</span><br><span class="line">WorldWorldWorldWorldWorld</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Warning</strong>ï¼šåªæœ‰é‚£äº›ä½äºå‚æ•°åˆ—è¡¨æœ«å°¾çš„å‚æ•°æ‰èƒ½è¢«èµ‹äºˆé»˜è®¤å‚æ•°å€¼ï¼Œå³åœ¨å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­æ‹¥æœ‰é»˜è®¤å‚æ•°å€¼çš„å‚æ•°ä¸èƒ½ä½äºæ²¡æœ‰é»˜è®¤å‚æ•°å€¼çš„å‚æ•°ä¹‹å‰ï¼</p>
</blockquote>
<p><strong>å…³é”®å­—å‚æ•°</strong>ï¼šä½¿ç”¨å‘½åï¼ˆå…³é”®å­—ï¼‰è€Œéä½ç½®æ¥æŒ‡å®šå‡½æ•°ä¸­çš„å‚æ•°ï¼Œä¸è€ƒè™‘å‚æ•°çš„é¡ºåºï¼Œå‡½æ•°ä½¿ç”¨æ›´åŠ å®¹æ˜“ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>function_keyword.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a, b=<span class="number">5</span>, c=<span class="number">10</span>)</span>:</span></span><br><span class="line">    print(<span class="string">'a is'</span>, a, <span class="string">'and b is'</span>, b, <span class="string">'and c is'</span>, c)</span><br><span class="line"></span><br><span class="line">func(<span class="number">3</span>, <span class="number">7</span>)</span><br><span class="line">func(<span class="number">25</span>, c=<span class="number">24</span>)</span><br><span class="line">func(c=<span class="number">50</span>, a=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python function_keyword.py</span><br><span class="line">a <span class="keyword">is</span> <span class="number">3</span> <span class="keyword">and</span> b <span class="keyword">is</span> <span class="number">7</span> <span class="keyword">and</span> c <span class="keyword">is</span> <span class="number">10</span></span><br><span class="line">a <span class="keyword">is</span> <span class="number">25</span> <span class="keyword">and</span> b <span class="keyword">is</span> <span class="number">5</span> <span class="keyword">and</span> c <span class="keyword">is</span> <span class="number">24</span></span><br><span class="line">a <span class="keyword">is</span> <span class="number">100</span> <span class="keyword">and</span> b <span class="keyword">is</span> <span class="number">5</span> <span class="keyword">and</span> c <span class="keyword">is</span> <span class="number">50</span></span><br></pre></td></tr></table></figure>

<p><strong>å¯å˜å‚æ•°</strong>ï¼šå¯ä»¥é€šè¿‡ä½¿ç”¨æ˜Ÿå· <code>*</code> æ¥å®ç°åœ¨å‡½æ•°é‡Œé¢èƒ½å¤Ÿæœ‰ä»»æ„æ•°é‡çš„å˜é‡ï¼Œè¯¸å¦‚ <code>*param</code> çš„æ˜Ÿå·å‚æ•°æ—¶æ±‡é›†æˆå…ƒç¥–ï¼Œè¯¸å¦‚ <code>**param</code> çš„åŒæ˜Ÿå·å‚æ•°æ—¶æ±‡é›†æˆå­—å…¸ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>function_varargs.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">total</span><span class="params">(a=<span class="number">5</span>, *numbers, **phonebook)</span>:</span></span><br><span class="line">    print(<span class="string">'a'</span>, a)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># éå†å…ƒç»„ä¸­çš„æ‰€æœ‰é¡¹ç›®</span></span><br><span class="line">    <span class="keyword">for</span> single_item <span class="keyword">in</span> numbers:</span><br><span class="line">        print(<span class="string">'single_item'</span>, single_item)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># éå†å­—å…¸ä¸­çš„æ‰€æœ‰é¡¹ç›®</span></span><br><span class="line">    <span class="keyword">for</span> first_part, second_part <span class="keyword">in</span> phonebook.items():</span><br><span class="line">        print(first_part,second_part)</span><br><span class="line"></span><br><span class="line">print(total(<span class="number">10</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,Jack=<span class="number">1123</span>,John=<span class="number">2231</span>,Inge=<span class="number">1560</span>))</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python function_varargs.py</span><br><span class="line">a <span class="number">10</span></span><br><span class="line">single_item <span class="number">1</span></span><br><span class="line">single_item <span class="number">2</span></span><br><span class="line">single_item <span class="number">3</span></span><br><span class="line">Inge <span class="number">1560</span></span><br><span class="line">John <span class="number">2231</span></span><br><span class="line">Jack <span class="number">1123</span></span><br><span class="line"><span class="literal">None</span></span><br></pre></td></tr></table></figure>

<h2 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h2><p><strong>å±€éƒ¨å˜é‡</strong>ï¼šå½“åœ¨ä¸€ä¸ªå‡½æ•°çš„å®šä¹‰ä¸­å£°æ˜å˜é‡æ—¶ï¼Œå®ƒä»¬ä¸ä¼šä»¥ä»»ä½•æ–¹å¼ä¸èº«å¤„å‡½æ•°ä¹‹å¤–ä½†å…·æœ‰ç›¸åŒåç§°çš„å˜é‡äº§ç”Ÿå…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›å˜é‡ååªå­˜åœ¨äºå‡½æ•°è¿™ä¸€å±€éƒ¨ï¼ˆ<code>Local</code>ï¼‰ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>function_local.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(x)</span>:</span></span><br><span class="line">    print(<span class="string">'x is'</span>, x)</span><br><span class="line">    x = <span class="number">2</span></span><br><span class="line">    print(<span class="string">'Changed local x to'</span>, x)</span><br><span class="line"></span><br><span class="line">func(x)</span><br><span class="line">print(<span class="string">'x is still'</span>, x)</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python function_local.py</span><br><span class="line">x <span class="keyword">is</span> <span class="number">50</span></span><br><span class="line">Changed local x to <span class="number">2</span></span><br><span class="line">x <span class="keyword">is</span> still <span class="number">50</span></span><br></pre></td></tr></table></figure>

<p><strong>å…¨å±€å˜é‡</strong>ï¼šå¯ä»¥ä½¿ç”¨å…³é”®å­— <code>global</code> å®šä¹‰äºå‡½æ•°ä¹‹å¤–çš„å˜é‡çš„å€¼ï¼Œå®ƒçš„ä½œç”¨åŸŸæ˜¯å…¨å±€ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>function_global.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> x</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'x is'</span>, x)</span><br><span class="line">    x = <span class="number">2</span></span><br><span class="line">    print(<span class="string">'Changed global x to'</span>, x)</span><br><span class="line"></span><br><span class="line">func()</span><br><span class="line">print(<span class="string">'Value of x is'</span>, x)</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python function_global.py</span><br><span class="line">x <span class="keyword">is</span> <span class="number">50</span></span><br><span class="line">Changed <span class="keyword">global</span> x to <span class="number">2</span></span><br><span class="line">Value of x <span class="keyword">is</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p><strong>å…¬æœ‰</strong>ï¼šæœ‰çš„å‡½æ•°å’Œå˜é‡æˆ‘ä»¬å¸Œæœ›ç»™åˆ«äººä½¿ç”¨ï¼Œæ­£å¸¸çš„å‡½æ•°å’Œå˜é‡åæ˜¯å…¬å¼€çš„ï¼Œå¯ä»¥è¢«å¼•ç”¨ã€‚</p>
<p><strong>ç§æœ‰</strong>ï¼šæœ‰çš„å‡½æ•°å’Œå˜é‡æˆ‘ä»¬å¸Œæœ›ä»…ä»…åœ¨æ¨¡å—å†…éƒ¨ä½¿ç”¨ï¼Œä»¥ <code>__</code> å¼€å¤´çš„å‡½æ•°æˆ–å˜é‡æ˜¯ç§æœ‰çš„ã€‚</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Python Â· æµç¨‹æ§åˆ¶</title>
    <url>/blog/2019/10/24/python-control/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Python æœ‰ä¸‰ç§æ§åˆ¶æµè¯­å¥ï¼š <code>if</code>ã€<code>for</code> ã€<code>while</code>ï¼Œä¸¤ç§ç›¸å…³è¯­å¥ï¼š<code>break</code>ã€<code>continue</code>ã€‚</p>
<ul>
<li><code>if</code></li>
<li><code>while</code></li>
<li><code>for</code></li>
<li><code>break</code></li>
<li><code>continue</code></li>
</ul>
<h2 id="æµç¨‹æ§åˆ¶"><a href="#æµç¨‹æ§åˆ¶" class="headerlink" title="æµç¨‹æ§åˆ¶"></a>æµç¨‹æ§åˆ¶</h2><h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><p><code>if</code> è¯­å¥ç”¨ä»¥æ¡ä»¶æ£€æŸ¥ï¼šå¦‚æœæ¡ä»¶ä¸º <code>true</code>ï¼Œå°†è¿è¡Œä¸€å—è¯­å¥ï¼Œå¦åˆ™è¿è¡Œå¦ä¸€å—è¯­å¥ï¼Œå…¶ä¸­ <code>else</code> ä»å¥æ˜¯å¯é€‰çš„ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>if.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">number = <span class="number">23</span></span><br><span class="line">guess = int(input(<span class="string">'Enter an integer : '</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> guess == number:</span><br><span class="line">    <span class="comment"># æ–°å—ä»è¿™é‡Œå¼€å§‹</span></span><br><span class="line">    print(<span class="string">'Congratulations, you guessed it.'</span>)</span><br><span class="line">    print(<span class="string">'(but you do not win any prizes!)'</span>)</span><br><span class="line">    <span class="comment"># æ–°å—åœ¨è¿™é‡Œç»“æŸ</span></span><br><span class="line"><span class="keyword">elif</span> guess &lt; number:</span><br><span class="line">    <span class="comment"># å¦ä¸€ä»£ç å—</span></span><br><span class="line">    print(<span class="string">'No, it is a little higher than that'</span>)</span><br><span class="line">    <span class="comment"># ä½ å¯ä»¥åœ¨æ­¤åšä»»ä½•ä½ å¸Œæœ›åœ¨è¯¥ä»£ç å—å†…è¿›è¡Œçš„äº‹æƒ…</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'No, it is a little lower than that'</span>)</span><br><span class="line">    <span class="comment"># ä½ å¿…é¡»é€šè¿‡çŒœæµ‹ä¸€ä¸ªå¤§äºï¼ˆ&gt;ï¼‰è®¾ç½®æ•°çš„æ•°å­—æ¥åˆ°è¾¾è¿™é‡Œã€‚</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'Done'</span>)</span><br><span class="line"><span class="comment"># è¿™æœ€åä¸€å¥è¯­å¥å°†åœ¨ if è¯­å¥æ‰§è¡Œå®Œæ¯•åæ‰§è¡Œã€‚</span></span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python <span class="keyword">if</span>.py</span><br><span class="line">Enter an integer : <span class="number">50</span></span><br><span class="line">No, it <span class="keyword">is</span> a little lower than that</span><br><span class="line">Done</span><br><span class="line"></span><br><span class="line">$ python <span class="keyword">if</span>.py</span><br><span class="line">Enter an integer : <span class="number">22</span></span><br><span class="line">No, it <span class="keyword">is</span> a little higher than that</span><br><span class="line">Done</span><br><span class="line"></span><br><span class="line">$ python <span class="keyword">if</span>.py</span><br><span class="line">Enter an integer : <span class="number">23</span></span><br><span class="line">Congratulations, you guessed it.</span><br><span class="line">(but you do <span class="keyword">not</span> win any prizes!)</span><br><span class="line">Done</span><br></pre></td></tr></table></figure>

<h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><p><code>while</code> è¯­å¥èƒ½å¤Ÿè®©ä½ åœ¨æ¡ä»¶ä¸ºçœŸçš„å‰æä¸‹é‡å¤æ‰§è¡ŒæŸå—è¯­å¥ï¼Œ<code>while</code> è¯­å¥æ˜¯å¾ªç¯ï¼ˆLoopingï¼‰è¯­å¥çš„ä¸€ç§ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>while.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">number = <span class="number">23</span></span><br><span class="line">running = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> running:</span><br><span class="line">    guess = int(input(<span class="string">'Enter an integer : '</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> guess == number:</span><br><span class="line">        print(<span class="string">'Congratulations, you guessed it.'</span>)</span><br><span class="line">        <span class="comment"># è¿™å°†å¯¼è‡´ while å¾ªç¯ä¸­æ­¢</span></span><br><span class="line">        running = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">elif</span> guess &lt; number:</span><br><span class="line">        print(<span class="string">'No, it is a little higher than that.'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'No, it is a little lower than that.'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'The while loop is over.'</span>)</span><br><span class="line">    <span class="comment"># åœ¨è¿™é‡Œä½ å¯ä»¥åšä½ æƒ³åšçš„ä»»ä½•äº‹</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'Done'</span>)</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python <span class="keyword">while</span>.py</span><br><span class="line">Enter an integer : <span class="number">50</span></span><br><span class="line">No, it <span class="keyword">is</span> a little lower than that.</span><br><span class="line">Enter an integer : <span class="number">22</span></span><br><span class="line">No, it <span class="keyword">is</span> a little higher than that.</span><br><span class="line">Enter an integer : <span class="number">23</span></span><br><span class="line">Congratulations, you guessed it.</span><br><span class="line">The <span class="keyword">while</span> loop <span class="keyword">is</span> over.</span><br><span class="line">Done</span><br></pre></td></tr></table></figure>

<h3 id="for"><a href="#for" class="headerlink" title="for"></a>for</h3><p><code>for...in</code> è¯­å¥æ˜¯å¦ä¸€ç§å¾ªç¯è¯­å¥ï¼Œå…¶ç‰¹ç‚¹æ˜¯ä¼šåœ¨ä¸€ç³»åˆ—å¯¹è±¡ä¸Šè¿›è¡Œéå†ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>for.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">    print(i)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'The for loop is over'</span>)</span><br><span class="line">    </span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python <span class="keyword">for</span>.py</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">The <span class="keyword">for</span> loop <span class="keyword">is</span> over</span><br></pre></td></tr></table></figure>

<h3 id="break"><a href="#break" class="headerlink" title="break"></a>break</h3><p><code>break</code> è¯­å¥ç”¨ä»¥ä¸­æ–­å¾ªç¯è¯­å¥ï¼Œä¹Ÿå°±æ˜¯ä¸­æ­¢å¾ªç¯è¯­å¥çš„æ‰§è¡Œã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>break.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    s = input(<span class="string">'Enter something : '</span>)</span><br><span class="line">    <span class="keyword">if</span> s == <span class="string">'quit'</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(<span class="string">'Length of the string is'</span>, len(s))</span><br><span class="line">print(<span class="string">'Done'</span>)</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python <span class="keyword">break</span>.py</span><br><span class="line">Enter something : Programming <span class="keyword">is</span> fun</span><br><span class="line">Length of the string <span class="keyword">is</span> <span class="number">18</span></span><br><span class="line">Enter something : When the work <span class="keyword">is</span> done</span><br><span class="line">Length of the string <span class="keyword">is</span> <span class="number">21</span></span><br><span class="line">Enter something : <span class="keyword">if</span> you wanna make your work also fun:</span><br><span class="line">Length of the string <span class="keyword">is</span> <span class="number">37</span></span><br><span class="line">Enter something : use Python!</span><br><span class="line">Length of the string <span class="keyword">is</span> <span class="number">11</span></span><br><span class="line">Enter something : quit</span><br><span class="line">Done</span><br></pre></td></tr></table></figure>

<h3 id="continue"><a href="#continue" class="headerlink" title="continue"></a>continue</h3><p><code>continue</code> è¯­å¥ç”¨ä»¥è·³è¿‡å½“å‰å¾ªç¯å—ä¸­çš„å‰©ä½™è¯­å¥ï¼Œå¹¶ç»§ç»­è¯¥å¾ªç¯çš„ä¸‹ä¸€æ¬¡è¿­ä»£ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>continue.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    s = input(<span class="string">'Enter something : '</span>)</span><br><span class="line">    <span class="keyword">if</span> s == <span class="string">'quit'</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> len(s) &lt; <span class="number">3</span>:</span><br><span class="line">        print(<span class="string">'Too small'</span>)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    print(<span class="string">'Input is of sufficient length'</span>)</span><br><span class="line">    <span class="comment"># è‡ªæ­¤å¤„èµ·ç»§ç»­è¿›è¡Œå…¶å®ƒä»»ä½•å¤„ç†</span></span><br><span class="line">    </span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">$ python <span class="keyword">continue</span>.py</span><br><span class="line">Enter something : a</span><br><span class="line">Too small</span><br><span class="line">Enter something : <span class="number">12</span></span><br><span class="line">Too small</span><br><span class="line">Enter something : abc</span><br><span class="line">Input <span class="keyword">is</span> of sufficient length</span><br><span class="line">Enter something : quit</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Python Â· åŸºæœ¬æ•°æ®ç±»å‹</title>
    <url>/blog/2019/10/24/python-datatype/</url>
    <content><![CDATA[<h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><h3 id="æ•´å‹ï¼ˆIntegersï¼‰"><a href="#æ•´å‹ï¼ˆIntegersï¼‰" class="headerlink" title="æ•´å‹ï¼ˆIntegersï¼‰"></a>æ•´å‹ï¼ˆIntegersï¼‰</h3><p>Python å¯ä»¥å¤„ç†ä»»æ„å¤§å°çš„æ•´æ•°ï¼š</p>
<ul>
<li><code>Python 2.x</code> ä¸­æœ‰ <code>int</code> å’Œ <code>long</code> ä¸¤ç§ç±»å‹</li>
<li><code>Python 3.x</code> ä¸­åªæœ‰ <code>int</code> ç±»å‹</li>
</ul>
<h3 id="æµ®ç‚¹å‹ï¼ˆFloatsï¼‰"><a href="#æµ®ç‚¹å‹ï¼ˆFloatsï¼‰" class="headerlink" title="æµ®ç‚¹å‹ï¼ˆFloatsï¼‰"></a>æµ®ç‚¹å‹ï¼ˆFloatsï¼‰</h3><p>æµ®ç‚¹æ•°ä¹Ÿå°±æ˜¯å°æ•°ï¼Œä¹‹æ‰€ä»¥ç§°ä¸ºæµ®ç‚¹æ•°ï¼Œæ˜¯å› ä¸ºæŒ‰ç…§ç§‘å­¦è®°æ•°æ³•è¡¨ç¤ºæ—¶ï¼Œä¸€ä¸ªæµ®ç‚¹æ•°çš„å°æ•°ç‚¹ä½ç½®æ˜¯å¯å˜çš„ï¼Œæµ®ç‚¹æ•°é™¤äº†æ•°å­¦å†™æ³•ï¼ˆå¦‚ <code>123.456</code>ï¼‰ä¹‹å¤–è¿˜æ”¯æŒç§‘å­¦è®¡æ•°æ³•ï¼ˆå¦‚ <code>1.23456e2</code>ï¼‰ã€‚</p>
<h3 id="å­—ç¬¦ä¸²ï¼ˆStringï¼‰"><a href="#å­—ç¬¦ä¸²ï¼ˆStringï¼‰" class="headerlink" title="å­—ç¬¦ä¸²ï¼ˆStringï¼‰"></a>å­—ç¬¦ä¸²ï¼ˆStringï¼‰</h3><ul>
<li><strong>å•å¼•å·</strong>ï¼šæ‰€æœ‰å¼•å·å†…çš„ç©ºé—´ï¼Œè¯¸å¦‚ç©ºæ ¼ä¸åˆ¶è¡¨ç¬¦ï¼Œéƒ½å°†æŒ‰åŸæ ·ä¿ç•™</li>
<li><strong>åŒå¼•å·</strong>ï¼šè¢«åŒå¼•å·åŒ…æ‹¬çš„å­—ç¬¦ä¸²å’Œè¢«å•å¼•å·æ‹¬èµ·çš„å­—ç¬¦ä¸²å…¶å·¥ä½œæœºåˆ¶å®Œå…¨ç›¸åŒ</li>
<li><strong>ä¸‰å¼•å·</strong>ï¼šå¯ä»¥ä¹¦å†™æˆå¤šè¡Œçš„å½¢å¼</li>
</ul>
<h3 id="å¸ƒå°”å€¼ï¼ˆBooleanï¼‰"><a href="#å¸ƒå°”å€¼ï¼ˆBooleanï¼‰" class="headerlink" title="å¸ƒå°”å€¼ï¼ˆBooleanï¼‰"></a>å¸ƒå°”å€¼ï¼ˆBooleanï¼‰</h3><p>å¸ƒå°”å€¼åªæœ‰ <code>True</code>ã€<code>False</code> ä¸¤ç§å€¼ï¼Œå¯ä»¥å°†å®ƒä»¬åˆ†åˆ«ç­‰ä»·åœ°è§†ä¸º <code>1</code> ä¸ <code>0</code>ã€‚</p>
<h3 id="åˆ—è¡¨ï¼ˆListï¼‰"><a href="#åˆ—è¡¨ï¼ˆListï¼‰" class="headerlink" title="åˆ—è¡¨ï¼ˆListï¼‰"></a>åˆ—è¡¨ï¼ˆListï¼‰</h3><p><code>list</code> æ˜¯ä¸€ç§å¯å˜çš„æœ‰åºçš„é›†åˆï¼Œå¯ä»¥éšæ—¶æ·»åŠ å’Œåˆ é™¤å…¶ä¸­çš„å…ƒç´ ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">classmates = [<span class="string">'Michael'</span>, <span class="string">'Bob'</span>, <span class="string">'Tracy'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¢åŠ </span></span><br><span class="line">classmates.append(<span class="string">'Adam'</span>)     <span class="comment"># å¢åŠ å…ƒç´ åˆ°æœ«å°¾</span></span><br><span class="line">classmates.insert(<span class="number">1</span>, <span class="string">'Jack'</span>)  <span class="comment"># å¢åŠ å…ƒç´ åˆ°æŒ‡å®šä½ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤</span></span><br><span class="line">classmates.pop(i)             <span class="comment"># åˆ é™¤æŒ‡å®šiä½ç½®çš„å…ƒç´ </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹</span></span><br><span class="line">classmates[i] = <span class="string">'Sarah'</span>       <span class="comment"># æ›¿æ¢æŒ‡å®šiä½ç½®çš„å…ƒç´ </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢</span></span><br><span class="line">len(classmates)               <span class="comment"># æŸ¥è¯¢åˆ—è¡¨å…ƒç´ çš„ä¸ªæ•°</span></span><br><span class="line">classmates[i]                 <span class="comment"># æŸ¥è¯¢ç¬¬iä¸ªå…ƒç´ </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆªå–</span></span><br><span class="line">classmates[i:j]               <span class="comment"># iæ˜¯å¤´ä¸Šæ ‡ï¼Œjæ˜¯å°¾ä¸‹æ ‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿ç®—ç¬¦</span></span><br><span class="line">åŠ å· + : åˆ—è¡¨è¿æ¥è¿ç®—ç¬¦</span><br><span class="line">æ˜Ÿå· * : é‡å¤æ“ä½œ</span><br></pre></td></tr></table></figure>

<h3 id="å…ƒç¥–ï¼ˆTupleï¼‰"><a href="#å…ƒç¥–ï¼ˆTupleï¼‰" class="headerlink" title="å…ƒç¥–ï¼ˆTupleï¼‰"></a>å…ƒç¥–ï¼ˆTupleï¼‰</h3><p><code>tuple</code> æ˜¯ä¸€ç§ä¸å¯å˜çš„æœ‰åºçš„åˆ—è¡¨ï¼Œä¸€æ—¦åˆå§‹åŒ–å°±ä¸èƒ½ä¿®æ”¹ï¼Œå› ä¸ºä¸å¯å˜ï¼Œæ‰€ä»¥ä»£ç æ›´å®‰å…¨ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">classmates = (<span class="string">'Michael'</span>, <span class="string">'Bob'</span>, <span class="string">'Tracy'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢</span></span><br><span class="line">classmates[<span class="number">0</span>]t = ()</span><br><span class="line">classmates[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç©ºtuple</span></span><br><span class="line">t = ()</span><br></pre></td></tr></table></figure>

<p><strong>å°ç»“</strong>ï¼š<code>list</code> å’Œ <code>tuple</code> æ˜¯ Python å†…ç½®çš„æœ‰åºé›†åˆï¼Œä¸€ä¸ªå¯å˜ï¼Œä¸€ä¸ªä¸å¯å˜ã€‚</p>
<h3 id="å­—å…¸ï¼ˆDictï¼‰"><a href="#å­—å…¸ï¼ˆDictï¼‰" class="headerlink" title="å­—å…¸ï¼ˆDictï¼‰"></a>å­—å…¸ï¼ˆDictï¼‰</h3><p>Python å†…ç½®äº†å­—å…¸ <code>dict</code>ï¼Œå…¨ç§° <code>dictionary</code>ï¼Œç±»ä¼¼äºå…¶ä»–è¯­è¨€çš„ <code>map</code>ï¼Œä½¿ç”¨é”®-å€¼ï¼ˆ<code>key-value</code>ï¼‰å­˜å‚¨ï¼Œå…·æœ‰æå¿«çš„æŸ¥æ‰¾é€Ÿåº¦ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">d = &#123;<span class="string">'Michael'</span>: <span class="number">95</span>, <span class="string">'Bob'</span>: <span class="number">75</span>, <span class="string">'Tracy'</span>: <span class="number">85</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ’å…¥</span></span><br><span class="line">d[<span class="string">'Adam'</span>] = <span class="number">67</span></span><br><span class="line">d[<span class="string">'Jack'</span>] = <span class="number">90</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°</span></span><br><span class="line">d[<span class="string">'Jack'</span>] = <span class="number">88</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤</span></span><br><span class="line">d.pop(<span class="string">'Bob'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢</span></span><br><span class="line"><span class="string">'Thomas'</span> <span class="keyword">in</span> d      <span class="comment"># inåˆ¤æ–­keyæ˜¯å¦å­˜åœ¨</span></span><br><span class="line">d.get(<span class="string">'Thomas'</span>)    <span class="comment"># getæ–¹æ³•å–æ•°æ®</span></span><br></pre></td></tr></table></figure>

<p>å†…éƒ¨å­˜æ”¾çš„é¡ºåºå’Œ <code>key</code> æ”¾å…¥é¡ºåºæ²¡æœ‰å…³ç³»ï¼Œéœ€è¦ç‰¢è®°çš„ç¬¬ä¸€æ¡å°±æ˜¯ <code>dict</code> çš„ <code>key</code> å¿…é¡»æ˜¯<strong>ä¸å¯å˜å¯¹è±¡</strong>ï¼Œå’Œ <code>list</code> æ¯”è¾ƒï¼Œ<code>dict</code> æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p>
<ul>
<li>æŸ¥æ‰¾å’Œæ’å…¥çš„é€Ÿåº¦æå¿«ï¼Œä¸ä¼šéšç€ <code>key</code> çš„å¢åŠ è€Œå˜æ…¢ã€‚</li>
<li>éœ€è¦å ç”¨å¤§é‡çš„å†…å­˜ï¼Œå†…å­˜æµªè´¹å¤šã€‚</li>
</ul>
<h3 id="é›†åˆï¼ˆSetï¼‰"><a href="#é›†åˆï¼ˆSetï¼‰" class="headerlink" title="é›†åˆï¼ˆSetï¼‰"></a>é›†åˆï¼ˆSetï¼‰</h3><p><code>set</code> å’Œ <code>dict</code> ç±»ä¼¼ï¼Œæ˜¯ä¸€ç»„ä¸é‡å¤ <code>key</code> çš„é›†åˆï¼Œä½†ä¸å­˜å‚¨ <code>value</code>ï¼Œå¯ä»¥çœ‹æˆæ— åºå’Œæ— é‡å¤å…ƒç´ çš„é›†åˆã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">s = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å…ƒç´ </span></span><br><span class="line">s.add(key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤å…ƒç´ </span></span><br><span class="line">s.remove(key)</span><br></pre></td></tr></table></figure>

<h3 id="ç©ºå€¼ï¼ˆNoneï¼‰"><a href="#ç©ºå€¼ï¼ˆNoneï¼‰" class="headerlink" title="ç©ºå€¼ï¼ˆNoneï¼‰"></a>ç©ºå€¼ï¼ˆNoneï¼‰</h3><ul>
<li><code>None</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç©ºå€¼</li>
<li><code>None</code> ä¸èƒ½ç†è§£ä¸º <code>0</code>ï¼Œå› ä¸º <code>0</code> æ˜¯æœ‰æ„ä¹‰çš„</li>
</ul>
<h2 id="å˜é‡ä¸å¸¸é‡"><a href="#å˜é‡ä¸å¸¸é‡" class="headerlink" title="å˜é‡ä¸å¸¸é‡"></a>å˜é‡ä¸å¸¸é‡</h2><p><strong>å¸¸é‡</strong>ï¼šé€šå¸¸ç”¨å…¨éƒ¨å¤§å†™çš„å˜é‡åè¡¨ç¤ºå¸¸é‡ã€‚</p>
<p><strong>å˜é‡</strong>ï¼šå˜é‡åå¿…é¡»æ˜¯å¤§å°å†™è‹±æ–‡ã€æ•°å­—å’Œ <code>_</code> çš„ç»„åˆï¼Œä¸”ä¸èƒ½ç”¨æ•°å­—å¼€å¤´ã€‚</p>
<p><strong>å ä½ç¬¦</strong>ï¼š</p>
<ul>
<li><code>%d</code> ï¼šæ•´æ•°çš„å ä½ç¬¦</li>
<li><code>%f</code> ï¼šå°æ•°çš„å ä½ç¬¦</li>
<li><code>%s</code> ï¼šå­—ç¬¦ä¸²çš„å ä½ç¬¦</li>
<li><code>%x</code> ï¼šåå…­è¿›åˆ¶æ•´æ•°å ä½ç¬¦</li>
<li><code>%%</code> ï¼šç™¾åˆ†å·å ä½ç¬¦</li>
</ul>
<p><strong>ç±»å‹è½¬æ¢</strong>ï¼š</p>
<ul>
<li><code>int()</code>ï¼šå°†ä¸€ä¸ªæ•°å€¼æˆ–å­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°ï¼Œå¯ä»¥æŒ‡å®šè¿›åˆ¶</li>
<li><code>float()</code>ï¼šå°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢æˆæµ®ç‚¹æ•°</li>
<li><code>str()</code>ï¼šå°†æŒ‡å®šçš„å¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²å½¢å¼ï¼Œå¯ä»¥æŒ‡å®šç¼–ç </li>
<li><code>chr()</code>ï¼šå°†æ•´æ•°è½¬æ¢æˆè¯¥ç¼–ç å¯¹åº”çš„å­—ç¬¦ä¸²ï¼ˆä¸€ä¸ªå­—ç¬¦ï¼‰</li>
<li><code>ord()</code>ï¼šå°†å­—ç¬¦ä¸²ï¼ˆä¸€ä¸ªå­—ç¬¦ï¼‰è½¬æ¢æˆå¯¹åº”çš„ç¼–ç ï¼ˆæ•´æ•°ï¼‰</li>
</ul>
<h2 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h2><table>
<thead>
<tr>
<th>è¿ç®—ç¬¦</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td><code>[]</code> <code>[:]</code></td>
<td>ä¸‹æ ‡ï¼Œåˆ‡ç‰‡</td>
</tr>
<tr>
<td><code>**</code></td>
<td>æŒ‡æ•°</td>
</tr>
<tr>
<td><code>~</code> <code>+</code> <code>-</code></td>
<td>æŒ‰ä½å–å, æ­£è´Ÿå·</td>
</tr>
<tr>
<td><code>*</code> <code>/</code> <code>%</code> <code>//</code></td>
<td>ä¹˜ï¼Œé™¤ï¼Œæ¨¡ï¼Œæ•´é™¤</td>
</tr>
<tr>
<td><code>+</code> <code>-</code></td>
<td>åŠ ï¼Œå‡</td>
</tr>
<tr>
<td><code>&gt;&gt;</code> <code>&lt;&lt;</code></td>
<td>å³ç§»ï¼Œå·¦ç§»</td>
</tr>
<tr>
<td><code>&amp;</code></td>
<td>æŒ‰ä½ä¸</td>
</tr>
<tr>
<td><code>^</code> `</td>
<td>`</td>
</tr>
<tr>
<td><code>&lt;=</code> <code>&lt;</code> <code>&gt;</code> <code>&gt;=</code></td>
<td>å°äºç­‰äºï¼Œå°äºï¼Œå¤§äºï¼Œå¤§äºç­‰äº</td>
</tr>
<tr>
<td><code>==</code> <code>!=</code></td>
<td>ç­‰äºï¼Œä¸ç­‰äº</td>
</tr>
<tr>
<td><code>is</code> <code>is not</code></td>
<td>èº«ä»½è¿ç®—ç¬¦</td>
</tr>
<tr>
<td><code>in</code> <code>not in</code></td>
<td>æˆå‘˜è¿ç®—ç¬¦</td>
</tr>
<tr>
<td><code>not</code> <code>or</code> <code>and</code></td>
<td>é€»è¾‘è¿ç®—ç¬¦</td>
</tr>
<tr>
<td><code>=</code> <code>+=</code> <code>-=</code> <code>*=</code> <code>/=</code> <code>%=</code> <code>//=</code> <code>**=</code> <code>&amp;=</code> `</td>
<td>=<code></code>^=<code></code>&gt;&gt;=<code></code>&lt;&lt;=`</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Python Â· ç®€ä»‹å®‰è£…</title>
    <url>/blog/2019/10/24/python-introduction/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><a href="https://www.python.org/" target="_blank" rel="noopener">Python</a> æ˜¯ä¸€ç§æå°‘æ•°èƒ½å…¼å…· <strong>ç®€å•</strong> ä¸ <strong>åŠŸèƒ½å¼ºå¤§</strong> çš„ç¼–ç¨‹è¯­è¨€ã€‚</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šä¼˜é›…ã€æ˜ç¡®ã€ç®€å•</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šæ‰§è¡Œæ•ˆç‡ç¨ä½ã€ä»£ç æ— æ³•åŠ å¯†</li>
</ul>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Macä¸Šå®‰è£…</span></span><br><span class="line">$ brew install python3</span><br><span class="line"></span><br><span class="line">$ python -V</span><br><span class="line">Python <span class="number">2.7</span>.<span class="number">10</span></span><br><span class="line"></span><br><span class="line">$ python3 -V</span><br><span class="line">Python <span class="number">3.7</span>.<span class="number">4</span></span><br></pre></td></tr></table></figure>

<h2 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h2><p><strong>IDE</strong></p>
<ul>
<li><strong><a href="http://www.sublimetext.com/" target="_blank" rel="noopener">Sublime Text</a></strong>ï¼šé«˜çº§æ–‡æœ¬ç¼–è¾‘å™¨</li>
<li><strong><a href="http://www.jetbrains.com/pycharm/" target="_blank" rel="noopener">PyCharm</a></strong>ï¼šPython å¼€å‘ç¥å™¨</li>
</ul>
<p><strong>æ³¨é‡Š</strong></p>
<ul>
<li><strong>å•è¡Œæ³¨é‡Š</strong>ï¼šä»¥ <code>#</code> å¼€å¤´çš„è¯­å¥</li>
<li><strong>å¤šè¡Œæ³¨é‡Š</strong>ï¼šä»¥ <code>&quot;&quot;&quot;</code> å¼€å¤´ï¼Œ<code>&quot;&quot;&quot;</code> ç»“å°¾çš„è¯­å¥</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">ç¬¬ä¸€ä¸ª Python ç¨‹åº - hello, world!</span></span><br><span class="line"><span class="string">å‘ä¼Ÿå¤§çš„ Guido van Rossum å…ˆç”Ÿè‡´æ•¬</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Version: 0.1</span></span><br><span class="line"><span class="string">Author: Hui Rao</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'hello, world!'</span>)</span><br><span class="line">print(<span class="string">'ä½ å¥½'</span>, <span class="string">'ä¸–ç•Œ'</span>)  <span class="comment"># print("ä½ å¥½,ä¸–ç•Œï¼")</span></span><br><span class="line">print(<span class="string">'hello'</span>, <span class="string">'world'</span>, sep=<span class="string">', '</span>, <span class="keyword">end</span>=<span class="string">'!'</span>)</span><br><span class="line">print(<span class="string">'goodbye, world'</span>, <span class="keyword">end</span>=<span class="string">'!\n'</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šPython ç¨‹åºæ˜¯ <strong>å¤§å°å†™æ•æ„Ÿ</strong> çš„ã€‚</p>
</blockquote>
<p><strong>ç¼©è¿›</strong></p>
<p>Python è¯­è¨€å®˜æ–¹å»ºè®®ä½¿ç”¨ <strong>å››ä¸ªç©ºæ ¼</strong> æ¥ç¼©è¿›ï¼Œæ”¾ç½®åœ¨ä¸€èµ·çš„è¯­å¥å¿…é¡»æ‹¥æœ‰ç›¸åŒçš„ç¼©è¿›ï¼Œæ¯ä¸€ç»„è¿™æ ·çš„è¯­å¥è¢«ç§°ä¸ºå—ã€‚</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· è°ƒä¼˜æ¡ˆä¾‹ Â· HMQM</title>
    <url>/blog/2019/10/23/mysql-tuning-hmqm/</url>
    <content><![CDATA[<h2 id="é—®é¢˜ç°è±¡"><a href="#é—®é¢˜ç°è±¡" class="headerlink" title="é—®é¢˜ç°è±¡"></a>é—®é¢˜ç°è±¡</h2><p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-23-174720.png" alt></p>
<h2 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; select table_name,table_rows,CONCAT(TRUNCATE(SUM(data_length)/1024/1024,2),'MB') AS data_size, CONCAT(TRUNCATE(SUM(index_length)/1024/1024,2),'MB') AS index_size from information_schema.tables where TABLE_SCHEMA = 'mqm' and table_name='t_batch';</span><br><span class="line">+<span class="comment">------------+------------+-----------+------------+</span></span><br><span class="line">| table_name | table_rows | data_size | index_size |</span><br><span class="line">+<span class="comment">------------+------------+-----------+------------+</span></span><br><span class="line">| t_batch    |   10289197 | 4895.00MB | 7578.23MB  |</span><br><span class="line">+<span class="comment">------------+------------+-----------+------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.03</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> idx_group</span><br><span class="line"><span class="keyword">Analyze</span> <span class="keyword">table</span> t_batch;</span><br><span class="line"></span><br><span class="line">+<span class="comment">------------+------------+-----------+------------+</span></span><br><span class="line">| table_name | table_rows | data_size | index_size |</span><br><span class="line">+<span class="comment">------------+------------+-----------+------------+</span></span><br><span class="line">| t_batch    |   10657643 | 4895.00MB | 1230.93MB  |</span><br><span class="line">+<span class="comment">------------+------------+-----------+------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">+<span class="comment">------------+------------+-----------+------------+</span></span><br><span class="line">| table_name | table_rows | data_size | index_size |</span><br><span class="line">+<span class="comment">------------+------------+-----------+------------+</span></span><br><span class="line">| t_batch    |    <span class="number">9852520</span> | <span class="number">4895.00</span>MB | <span class="number">2863.00</span>MB  |</span><br><span class="line">+<span class="comment">------------+------------+-----------+------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.04</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t_batch <span class="keyword">ADD</span> <span class="keyword">INDEX</span> idx_check_style_id(check_style_id);</span><br><span class="line">Query OK, 0 rows affected (2 min 27.34 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; ALTER TABLE t_batch ADD INDEX idx_check_status_id(check_status_id);</span><br><span class="line">Query OK, 0 rows affected (1 min 0.12 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; ALTER TABLE t_batch ADD INDEX idx_iqc_leader_id(iqc_leader_id);</span><br><span class="line">Query OK, 0 rows affected (1 min 14.52 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; ALTER TABLE t_batch ADD INDEX idx_create_date(create_date);</span><br><span class="line">Query OK, 0 rows affected (53.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; ALTER TABLE t_batch ADD INDEX idx_IQC_manager_id(IQC_manager_id);</span><br><span class="line">Query OK, 0 rows affected (1 min 11.37 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; ALTER TABLE t_batch ADD INDEX idx_syb_id(syb_id);</span><br><span class="line">Query OK, 0 rows affected (1 min 3.97 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; ALTER TABLE t_batch ADD INDEX idx_group(check_style_id, check_status_id, delete_status);</span><br><span class="line">Query OK, 0 rows affected (2 min 3.08 sec)</span><br></pre></td></tr></table></figure>

<p><strong>æµ‹è¯•æ•°æ®åº“</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">å®ä¾‹ï¼š<span class="number">10.138</span>.<span class="number">22.192</span>:<span class="number">3306</span>/mqm</span><br><span class="line">è´¦å·ï¼šhmqm/hmqm</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">+----+-------------+---------+-------------+----------------------------------------------------------+---------------------------------------+---------+------+------+---------------------------------------------------------------------+</span><br><span class="line">| id | select_type | table   | type        | possible_keys                                            | key                                   | key_len | ref  | rows | Extra                                                               |</span><br><span class="line">+----+-------------+---------+-------------+----------------------------------------------------------+---------------------------------------+---------+------+------+---------------------------------------------------------------------+</span><br><span class="line">|  <span class="number">1</span> | SIMPLE      | t_batch | index_merge | idx_check_style_id,idx_check_status_id,idx_iqc_leader_id | idx_check_status_id,idx_iqc_leader_id | <span class="number">5</span>,<span class="number">63</span>    | NULL | <span class="number">4955</span> | Using intersect(idx_check_status_id,idx_iqc_leader_id); Using where |</span><br><span class="line">+----+-------------+---------+-------------+----------------------------------------------------------+---------------------------------------+---------+------+------+---------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">type: index_merge: è¡¨ç¤ºæŸ¥è¯¢ä½¿ç”¨äº†ä¸¤ä¸ªä»¥ä¸Šçš„ç´¢å¼•ï¼Œæœ€åå–äº¤é›†æˆ–è€…å¹¶é›†ï¼Œå¸¸è§and ï¼Œorçš„æ¡ä»¶ä½¿ç”¨äº†ä¸åŒçš„ç´¢å¼•ï¼Œå®˜æ–¹æ’åºè¿™ä¸ªåœ¨ref_or_nullä¹‹åï¼Œä½†æ˜¯å®é™…ä¸Šç”±äºè¦è¯»å–æ‰€ä¸ªç´¢å¼•ï¼Œæ€§èƒ½å¯èƒ½å¤§éƒ¨åˆ†æ—¶é—´éƒ½ä¸å¦‚range</span><br><span class="line">extra: using intersectï¼Œè¡¨ç¤ºä½¿ç”¨andçš„å„ä¸ªç´¢å¼•çš„æ¡ä»¶æ—¶ï¼Œè¯¥ä¿¡æ¯è¡¨ç¤ºæ˜¯ä»å¤„ç†ç»“æœè·å–äº¤é›†</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> <span class="string">''</span> batch_fail_id,<span class="string">''</span> uuid_Fail,b.send_goods_No,b.test_type,b.order_no,b.row_no,b.bu,b.mtl_no,b.mtl_name,b.mtl_group,b.mtl_group_name,b.materiel_category_id,b.materiel_category_name,b.pattern_amount,b.plan_pattern_amount,b.goods_unit,b.plan_send_day,b.fact_send_Day,b.stock_Day,b.supply_code,b.supply_name,b.supply_check_level,b.sap_mark_id,b.sap_mark_name,b.syb_id,b.syb_name,b.check_style_id,b.check_style_name,b.check_type_id,b.check_type_name,b.QC_STATUS,b.QC_STATUS_INSTR_DATE,b.QC_NO,b.factory_code,b.goods_sort,b.price_unit,b.stock_price,b.LICHA,b.BSART,b.LGORT,b.plan_Date,b.TEST_CONCLUSION,b.IQC_manager_id,b.IQC_manager_name,b.iqc_leader_id,b.iqc_leader_name,b.test_complete_day,b.test_start_day,b.new_or_old,b.check_status_id,b.is_appeal,b.is_start_check,b.standard_type,b.check_reason,b.is_stop,b.check_time,b.instance_id,b.create_date createDate,b.delete_status</span><br><span class="line"><span class="keyword">from</span> t_batch b</span><br><span class="line"><span class="keyword">where</span> b.mtl_no <span class="keyword">like</span> <span class="keyword">CONCAT</span>(<span class="string">'%470A%'</span>) </span><br><span class="line"><span class="keyword">and</span> b.syb_id <span class="keyword">in</span> (<span class="number">18</span>,<span class="number">306</span>,<span class="number">323</span>,<span class="number">17</span>,<span class="number">483</span>,<span class="number">15</span>,<span class="number">519</span>)</span><br><span class="line"><span class="keyword">and</span> b.lgort <span class="keyword">like</span> <span class="keyword">CONCAT</span>(<span class="string">'%J191023878681%'</span>)</span><br><span class="line"><span class="keyword">and</span> b.delete_status = <span class="string">'N'</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">select</span> f.batch_fail_id,f.uuid,f.send_goods_No,f.test_type,f.order_no,f.row_no,f.bu,f.mtl_no,f.mtl_name,f.mtl_group,f.mtl_group_name,f.materiel_category_id,f.materiel_category_name,f.pattern_amount,f.plan_pattern_amount,f.goods_unit,f.plan_send_day,f.fact_send_Day,f.stock_Day,f.supply_code,f.supply_name,f.supply_check_level,f.sap_mark_id,f.sap_mark_name,f.syb_id,f.syb_name,f.check_style_id,f.check_style_name,f.check_type_id,f.check_type_name,f.QC_STATUS,f.QC_STATUS_INSTR_DATE,f.QC_NO,f.factory_code,f.goods_sort,f.price_unit,f.stock_price,f.LICHA,f.BSART,f.LGORT,f.plan_Date,f.TEST_CONCLUSION,f.IQC_manager_id,f.IQC_manager_name,f.iqc_leader_id,f.iqc_leader_name,f.test_complete_day,f.test_start_day,f.new_or_old,f.check_status_id,f.is_appeal,f.is_start_check,f.standard_type,f.check_reason,f.is_stop,f.check_time,f.instance_id,f.create_date createDate,f.delete_status</span><br><span class="line"><span class="keyword">from</span> t_batch_fail f</span><br><span class="line"><span class="keyword">where</span> f.mtl_no <span class="keyword">like</span> <span class="keyword">CONCAT</span>(<span class="string">'%470A%'</span>)</span><br><span class="line"><span class="keyword">and</span> f.syb_id <span class="keyword">in</span> (<span class="number">18</span>,<span class="number">306</span>,<span class="number">323</span>,<span class="number">17</span>,<span class="number">483</span>,<span class="number">15</span>,<span class="number">519</span>)</span><br><span class="line"><span class="keyword">and</span> f.lgort <span class="keyword">like</span> <span class="keyword">CONCAT</span>(<span class="string">'%J191023878681%'</span>) </span><br><span class="line"><span class="keyword">and</span> f.delete_status = <span class="string">'N'</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> createDate <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">limit</span> <span class="number">0</span>,<span class="number">10</span></span><br><span class="line"></span><br><span class="line">// æŸ¥è¯¢æ—¶ <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">10</span></span><br><span class="line">// å¯¼å‡ºæ—¶ <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">5000</span></span><br><span class="line">// å¤–æ£€æŸ¥è¯¢å…¥åœºæ•°æ®ï¼Œå¸¸ç”¨çš„å‚æ•°ï¼šç‰©æ–™å·mtl_noæˆªå–åå‡ ä½ï¼Œçœ‹å•å·lgortï¼Œç³»ç»Ÿè‡ªåŠ¨è·å–å¤–æ£€çš„äº‹ä¸šéƒ¨ä¿¡æ¯syb_id,æœ‰æ—¶å€™æ˜¯ä¸€ä¸ªäº‹ä¸šéƒ¨ï¼Œæœ‰æ—¶å€™æ˜¯å¤šä¸ªäº‹ä¸šéƒ¨éå†ã€‚</span><br><span class="line"><span class="keyword">and</span> b.syb_id = <span class="number">18</span>    </span><br><span class="line"><span class="keyword">and</span> b.syb_id <span class="keyword">in</span> (<span class="number">18</span>,<span class="number">306</span>,<span class="number">323</span>,<span class="number">17</span>,<span class="number">483</span>,<span class="number">15</span>,<span class="number">519</span>) è¿™ä¸¤ä¸ªæ¡ä»¶åªä¼šå­˜åœ¨ä¸€ä¸ªã€‚</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>MySQL Â· ä½¿ç”¨ XtraBackup è¿ç§»æ•°æ®åº“</title>
    <url>/blog/2019/10/22/mysql-migration/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p><strong>éœ€æ±‚</strong>ï¼šxx é¡¹ç›®ï¼Œå°†ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“è¿ç§»è‡³æµ‹è¯•ç¯å¢ƒï¼Œè¿ç§»æ•°æ®é‡çº¦ <code>185GB</code></p>
<p><strong>ç¯å¢ƒ</strong>ï¼š</p>
<ul>
<li>ç”Ÿäº§åº“ï¼š<code>10.138.22.218:3100</code>ï¼Œ<code>MySQL 5.6.27</code> ç‰ˆæœ¬</li>
<li>æµ‹è¯•åº“ï¼š<code>10.138.22.192:3306</code>ï¼Œ<code>MySQL 5.6.27</code> ç‰ˆæœ¬</li>
</ul>
<blockquote>
<p><strong>Tips</strong>ï¼šæ•°æ®åº“ç‰ˆæœ¬ä¸€è‡´ï¼Œä¸”é…ç½®æ–‡ä»¶ <code>my.cnf</code> ä¸€è‡´ï¼Œæ‰èƒ½ä½¿ç”¨ <code>XtraBackup</code></p>
</blockquote>
<h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><p><strong>å‡†å¤‡æ¡ä»¶</strong>ï¼š</p>
<ul>
<li>ç”Ÿäº§åº“å’Œæµ‹è¯•åº“æœåŠ¡å™¨éƒ½å·²<a href="https://huiraoo.github.io/blog/2019/06/18/mysql-xtrabackup/">å®‰è£… XtraBackup</a></li>
<li>å·²é…ç½®äº’ä¿¡</li>
</ul>
<p><strong>1. å¤‡ä»½ä¸»åº“ï¼ˆçº¦è€—æ—¶ 30minï¼‰</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ innobackupex --defaults-file=/etc/my.cnf --user=root --password=<span class="string">'xx'</span> --no-timestamp /<span class="keyword">data</span>/backup</span><br></pre></td></tr></table></figure>

<p><strong>2. ä¼ è¾“å¤‡ä»½æ•°æ®åˆ°æµ‹è¯•æœåŠ¡å™¨ ï¼ˆçº¦è€—æ—¶ 30minï¼‰</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ scp -r /<span class="keyword">data</span>/backup/* root@<span class="number">10.138</span>.<span class="number">22.192</span>:/<span class="keyword">data</span>/backup</span><br></pre></td></tr></table></figure>

<p><strong>3. æ¢å¤å…¨å¤‡æ•°æ®ï¼ˆçº¦è€—æ—¶ 60minï¼‰</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ mysqladmin -S /<span class="keyword">data</span>/mysql/mysql.sock -uroot -p<span class="string">'xx'</span> shutdown</span><br><span class="line">$ innobackupex --defaults-file=/etc/my.cnf --apply-log /<span class="keyword">data</span>/backup</span><br><span class="line">$ mv mysql mysql_bak</span><br><span class="line">$ mkdir mysql</span><br><span class="line">$ innobackupex --defaults-file=/etc/my.cnf --copy-back /<span class="keyword">data</span>/backup</span><br><span class="line">$ chown -R mysql:mysql mysql</span><br><span class="line">$ /usr/local/mysql/bin/mysqld_safe --defaults-file=/etc/my.cnf --user=mysql &gt;/dev/null &amp;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· æ¡ˆä¾‹åˆ†æ Â· information_schema.tables ä¸ count(*) æŸ¥è¯¢æ•°ä¸ä¸€è‡´</title>
    <url>/blog/2019/10/22/mysql-case-rows/</url>
    <content><![CDATA[<h2 id="é—®é¢˜ç°è±¡"><a href="#é—®é¢˜ç°è±¡" class="headerlink" title="é—®é¢˜ç°è±¡"></a>é—®é¢˜ç°è±¡</h2><p>æŸ¥è¯¢è¡¨ <code>mqm.t_batch</code> æ€»è¡Œæ•°ï¼Œå‘ç°ä¸¤ç§æ–¹å¼æŸ¥è¯¢çš„ç»“æœä¸ä¸€è‡´ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># information_schema.tables</span></span><br><span class="line">mysql&gt; select table_name,table_rows from information_schema.tables where TABLE_SCHEMA = 'mqm' and table_name='t_batch';</span><br><span class="line">+<span class="comment">------------+------------+</span></span><br><span class="line">| table_name | table_rows |</span><br><span class="line">+<span class="comment">------------+------------+</span></span><br><span class="line">| t_batch    |    9527271 |</span><br><span class="line">+<span class="comment">------------+------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># count(*)</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> t_batch;</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| count(*) |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| 10474287 |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">21.52</span> sec)</span><br></pre></td></tr></table></figure>

<h2 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQL å¯¹è¡¨è¿›è¡Œå¢åˆ æ“ä½œæ—¶ï¼Œæ˜¯ä¸ä¼šè‡ªåŠ¨æ›´æ–° <code>information_schema.tables</code> è¡¨ <code>table_rows</code> å­—æ®µï¼Œåªæœ‰ <code>10%</code> çš„è¡Œæ•°å‘ç”Ÿå˜åŒ–æ‰ä¼šè‡ªåŠ¨æ”¶é›†ï¼Œæ‰§è¡Œ <code>ANALYZE TABLE &#39;table_name&#39;</code> åä¼šç»Ÿè®¡æ‰€æœ‰è¡¨æ•°æ®ï¼Œç»“æœå’Œ <code>count(*)</code> ä¸€è‡´ã€‚</p>
<blockquote>
<p><strong>Tips</strong>ï¼šç”Ÿäº§ç¯å¢ƒä¸­ä¸å»ºè®®ä½¿ç”¨ï¼Œå› ä¸ºä¼šé”è¡¨ï¼</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; ANALYZE TABLE t_batch;</span><br><span class="line">+<span class="comment">-------------+---------+----------+----------+</span></span><br><span class="line">| Table       | Op      | Msg_type | Msg_text |</span><br><span class="line">+<span class="comment">-------------+---------+----------+----------+</span></span><br><span class="line">| mqm.t_batch | <span class="keyword">analyze</span> | <span class="keyword">status</span>   | OK       |</span><br><span class="line">+<span class="comment">-------------+---------+----------+----------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">3.85</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> table_name,table_rows <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> TABLE_SCHEMA = <span class="string">'mqm'</span> <span class="keyword">and</span> table_name=<span class="string">'t_batch'</span>;</span><br><span class="line">+<span class="comment">------------+------------+</span></span><br><span class="line">| table_name | table_rows |</span><br><span class="line">+<span class="comment">------------+------------+</span></span><br><span class="line">| t_batch    |   10261904 |</span><br><span class="line">+<span class="comment">------------+------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.07</span> sec)</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· è°ƒä¼˜æ¡ˆä¾‹ Â· åƒä¸‡çº§å¤§è¡¨æ¨¡ç³ŠæŸ¥è¯¢</title>
    <url>/blog/2019/10/22/mysql-tuning-like/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p><strong>æ¨¡ç³ŠæŸ¥è¯¢</strong>ï¼šä½¿ç”¨ <code>like %%</code> ç±» <code>SQL</code></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œçš„SQL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">''</span> <span class="keyword">AS</span> batch_fail_id, <span class="string">''</span> <span class="keyword">AS</span> uuid_Fail, b.send_goods_No, b.test_type, b.order_no</span><br><span class="line">	, b.row_no, b.bu, b.mtl_no, b.mtl_name, b.mtl_group, b.mtl_group_name</span><br><span class="line">	, b.materiel_category_id, b.materiel_category_name, b.pattern_amount</span><br><span class="line">	, b.plan_pattern_amount, b.goods_unit, b.plan_send_day, b.fact_send_Day, b.stock_Day</span><br><span class="line">	, b.supply_code, b.supply_name, b.supply_check_level, b.sap_mark_id, b.sap_mark_name</span><br><span class="line">	, b.syb_id, b.syb_name, b.check_style_id, b.check_style_name, b.check_type_id</span><br><span class="line">	, b.check_type_name, b.QC_STATUS, b.QC_STATUS_INSTR_DATE, b.QC_NO, b.factory_code</span><br><span class="line">	, b.goods_sort, b.price_unit, b.stock_price, b.LICHA, b.BSART, b.LGORT</span><br><span class="line">	, b.plan_Date, b.TEST_CONCLUSION, b.IQC_manager_id, b.IQC_manager_name, b.iqc_leader_id</span><br><span class="line">	, b.iqc_leader_name, b.test_complete_day, b.test_start_day, b.new_or_old,b.check_status_id</span><br><span class="line">	, b.is_appeal, b.is_start_check, b.standard_type, b.check_reason, b.is_stop</span><br><span class="line">	, b.check_time, b.instance_id, b.create_date <span class="keyword">AS</span> createDate, b.delete_status</span><br><span class="line"><span class="keyword">FROM</span> t_batch b</span><br><span class="line"><span class="keyword">WHERE</span> b.mtl_no <span class="keyword">LIKE</span> <span class="string">'%0594A%'</span> <span class="keyword">AND</span> b.delete_status = <span class="string">'N'</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> f.batch_fail_id, f.uuid, f.send_goods_No, f.test_type, f.order_no, f.row_no</span><br><span class="line">        , f.bu, f.mtl_no, f.mtl_name, f.mtl_group, f.mtl_group_name</span><br><span class="line">        , f.materiel_category_id,f.materiel_category_name, f.pattern_amount</span><br><span class="line">        , f.plan_pattern_amount</span><br><span class="line">	, f.goods_unit, f.plan_send_day, f.fact_send_Day, f.stock_Day, f.supply_code</span><br><span class="line">	, f.supply_name, f.supply_check_level, f.sap_mark_id, f.sap_mark_name, f.syb_id</span><br><span class="line">	, f.syb_name, f.check_style_id, f.check_style_name, f.check_type_id, f.check_type_name</span><br><span class="line">	, f.QC_STATUS, f.QC_STATUS_INSTR_DATE, f.QC_NO, f.factory_code, f.goods_sort</span><br><span class="line">	, f.price_unit, f.stock_price, f.LICHA, f.BSART, f.LGORT</span><br><span class="line">	, f.plan_Date, f.TEST_CONCLUSION, f.IQC_manager_id, f.IQC_manager_name, f.iqc_leader_id</span><br><span class="line">	, f.iqc_leader_name, f.test_complete_day, f.test_start_day, f.new_or_old</span><br><span class="line">	, f.check_status_id, f.is_appeal, f.is_start_check, f.standard_type, f.check_reason</span><br><span class="line">	, f.is_stop, f.check_time, f.instance_id, f.create_date <span class="keyword">AS</span> createDate, f.delete_status</span><br><span class="line"><span class="keyword">FROM</span> t_batch_fail f</span><br><span class="line"><span class="keyword">WHERE</span> f.mtl_no <span class="keyword">LIKE</span> <span class="string">'%0594A%'</span> <span class="keyword">AND</span> f.delete_status = <span class="string">'N'</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> createDate <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">0</span>, <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¡¨æ•°æ®é‡</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> table_name,table_rows,<span class="keyword">CONCAT</span>(<span class="keyword">TRUNCATE</span>(<span class="keyword">SUM</span>(data_length)/<span class="number">1024</span>/<span class="number">1024</span>,<span class="number">2</span>),<span class="string">'MB'</span>) <span class="keyword">AS</span> data_size, <span class="keyword">CONCAT</span>(<span class="keyword">TRUNCATE</span>(<span class="keyword">SUM</span>(index_length)/<span class="number">1024</span>/<span class="number">1024</span>,<span class="number">2</span>),<span class="string">'MB'</span>) <span class="keyword">AS</span> index_size <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> TABLE_SCHEMA = <span class="string">'mqm'</span> <span class="keyword">and</span> table_name=<span class="string">'t_batch'</span>;</span><br><span class="line">+<span class="comment">------------+------------+-----------+------------+</span></span><br><span class="line">| table_name | table_rows | data_size | index_size |</span><br><span class="line">+<span class="comment">------------+------------+-----------+------------+</span></span><br><span class="line">| t_batch    |   10261904 | 4895.00MB | 8643.23MB  |</span><br><span class="line">+<span class="comment">------------+------------+-----------+------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">+<span class="comment">--------------+------------+-----------+------------+</span></span><br><span class="line">| table_name   | table_rows | data_size | index_size |</span><br><span class="line">+<span class="comment">--------------+------------+-----------+------------+</span></span><br><span class="line">| t_batch_fail |      <span class="number">43683</span> | <span class="number">19.56</span>MB   | <span class="number">14.57</span>MB    |</span><br><span class="line">+<span class="comment">--------------+------------+-----------+------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œæ—¶é—´</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">1</span> <span class="keyword">min</span> <span class="number">26.92</span> sec)</span><br></pre></td></tr></table></figure>

<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p><strong>Union All</strong>ï¼šå¯¹ä¸¤ä¸ªç»“æœé›†è¿›è¡Œå¹¶é›†æ“ä½œï¼ŒåŒ…æ‹¬é‡å¤è¡Œã€‚</p>
<p><strong>æ‰§è¡Œè®¡åˆ’</strong>ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">+<span class="comment">----+--------------+------------+------+-------------------+-------------------+---------+-------+---------+------------------------------------+</span></span><br><span class="line">| id | select_type  | table      | type | possible_keys     | key               | key_len | ref   | rows    | Extra                              |</span><br><span class="line">+<span class="comment">----+--------------+------------+------+-------------------+-------------------+---------+-------+---------+------------------------------------+</span></span><br><span class="line">|  1 | PRIMARY      | b          | ALL  | NULL              | NULL              | NULL    | NULL  | 9527271 | Using where                        |</span><br><span class="line">|  2 | UNION        | f          | ref  | idx_delete_status | idx_delete_status | 9       | const |   20469 | Using index condition; Using where |</span><br><span class="line">| NULL | UNION RESULT | &lt;union1,2&gt; | ALL  | NULL              | NULL              | NULL    | NULL  |    NULL | Using temporary; Using filesort    |</span><br><span class="line">+<span class="comment">----+--------------+------------+------+-------------------+-------------------+---------+-------+---------+------------------------------------+</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ ç´¢å¼•</span></span><br><span class="line">mysql&gt; ALTER TABLE t_batch ADD INDEX idx_delete_status (delete_status);</span><br><span class="line">Query OK, 0 rows affected (2 min 47.24 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œè®¡åˆ’</span></span><br><span class="line">+<span class="comment">----+--------------+------------+------+-------------------+-------------------+---------+-------+---------+------------------------------------+</span></span><br><span class="line">| id | select_type  | table      | type | possible_keys     | key               | key_len | ref   | rows    | Extra                              |</span><br><span class="line">+<span class="comment">----+--------------+------------+------+-------------------+-------------------+---------+-------+---------+------------------------------------+</span></span><br><span class="line">|  1 | PRIMARY      | b          | ref  | idx_delete_status | idx_delete_status | 9       | const | 5130952 | Using index condition; Using where |</span><br><span class="line">|  2 | UNION        | f          | ref  | idx_delete_status | idx_delete_status | 9       | const |   20469 | Using index condition; Using where |</span><br><span class="line">| NULL | UNION RESULT | &lt;union1,2&gt; | ALL  | NULL              | NULL              | NULL    | NULL  |    NULL | Using temporary; Using filesort    |</span><br><span class="line">+<span class="comment">----+--------------+------------+------+-------------------+-------------------+---------+-------+---------+------------------------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.07</span> sec)</span><br></pre></td></tr></table></figure>

<p><strong>æ¨¡ç³ŠæŸ¥è¯¢æ–¹æ³•å¯¹æ¯”</strong>ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">â‘  mtl_no like <span class="string">'%0594A%'</span></span><br><span class="line"><span class="number">10</span> rows <span class="keyword">in</span> set (<span class="number">1</span> min <span class="number">26.92</span> sec)</span><br><span class="line"></span><br><span class="line">â‘¡ locate(<span class="string">'0594A'</span>, mtl_no) &gt; <span class="number">0</span></span><br><span class="line"><span class="number">10</span> rows <span class="keyword">in</span> set (<span class="number">32.71</span> sec)</span><br><span class="line"></span><br><span class="line">â‘¢ instr(mtl_no,<span class="string">'0594A'</span>) &gt; <span class="number">0</span></span><br><span class="line"><span class="number">10</span> rows <span class="keyword">in</span> set (<span class="number">32.72</span> sec)</span><br></pre></td></tr></table></figure>

<p><strong>ç»“è®ºï¼š</strong></p>
<ul>
<li>è¿™ä¸‰ç§æ–¹æ³•éƒ½åªèƒ½ç”¨å…¨è¡¨æ‰«æçš„æ–¹å¼è¿›è¡ŒæŸ¥è¯¢ï¼Œä½† <code>locate</code> å’Œ <code>instr</code> æ–¹æ³•é€Ÿåº¦æ¯” <code>like</code> ç¨å¿«ã€‚</li>
<li><code>like %%</code> æ­¤ç±»æ¨¡ç³ŠæŸ¥è¯¢ï¼Œæ¨èä½¿ç”¨æœç´¢å¼•æ“ï¼Œæ¯”å¦‚ <code>Elasticsearch</code>ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>Confluence</title>
    <url>/blog/2019/10/22/confluence/</url>
    <content><![CDATA[<h2 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h2><p><strong>ç©ºé—´ï¼ˆSpaceï¼‰</strong></p>
<ul>
<li>å›¢é˜Ÿç©ºé—´ï¼šå­˜æ”¾ä¸è¯¥é¡¹ç›®ç›¸å…³çš„æ–‡æ¡£ä¿¡æ¯æ”¾ç½®åˆ°è¯¥ç©ºé—´ä¸­ï¼Œå¯¹é¡¹ç›®æˆå‘˜å¼€è®¾è®¿é—®/ç¼–è¾‘æƒé™</li>
<li>ä¸ªäººç©ºé—´ï¼šå­˜æ”¾å·¥ä½œæ€»ç»“æˆ–ç¬”è®°ç­‰æ–‡æ¡£æ”¾ç½®åˆ°è‡ªå·±çš„ç©ºé—´ä¸­</li>
</ul>
<p><strong>é¡µé¢ï¼ˆPageï¼‰</strong></p>
<ul>
<li>é¡µé¢æ˜¯å­˜å‚¨å’Œå…±äº«ä¿¡æ¯çš„ä¸»è¦æ–¹å¼ï¼Œä»¥æ ‘çŠ¶ç»“æ„è¿›è¡Œç»„ç»‡ï¼Œæ”¾ç½®äºç©ºé—´ä¹‹ä¸­ã€‚</li>
<li>é¡µé¢æ”¯æŒå¤§é‡çš„å†…å®¹å±•ç°å½¢å¼ï¼Œé™¤äº†å¯Œæ–‡æœ¬æ–‡æ¡£å¤–ï¼Œè¿˜åŒ…æ‹¬å›¾è¡¨ã€è§†é¢‘ã€é™„ä»¶ï¼ˆå¯é¢„è§ˆï¼‰ã€æµç¨‹å›¾ã€å…¬å¼ç­‰ç­‰ï¼Œå¦‚æœè¿˜ä¸å¤Ÿï¼Œè¿˜å¯ä»¥é€šè¿‡æµ·é‡çš„ç¬¬ä¸‰æ–¹æ’ä»¶è¿›è¡Œæ‰©å±•ã€‚</li>
</ul>
<p><strong>æƒé™ï¼ˆPermissionï¼‰</strong></p>
<p>æƒé™æ§åˆ¶åˆ† 3 ä¸ªç»´åº¦ï¼Œåˆ†åˆ«æ˜¯å›¢é˜Ÿï¼ˆGroupï¼‰ï¼Œä¸ªäººï¼ˆIndividual Usersï¼‰ï¼ŒåŒ¿åç”¨æˆ·ï¼ˆAnonymousï¼‰ã€‚</p>
<h2 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ™®é€šåœ°å€</span></span><br><span class="line">http://wiki.qd-aliyun-internal.haier.net</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç®¡ç†å‘˜åœ°å€</span></span><br><span class="line">http://wiki.qd-aliyun-internal.haier.net/login.action?oauth_sso=false</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>é¡¹ç›®</category>
      </categories>
  </entry>
  <entry>
    <title>Jira</title>
    <url>/blog/2019/10/22/jira/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>JIRA æ˜¯ Atlassian å…¬å¸çš„äº§å“ï¼ŒAtlassian æœ€æ ¸å¿ƒçš„äº§å“ä»ç„¶æ˜¯ <strong>JIRA</strong> å’Œ <strong>Confluence</strong>ï¼ŒJIRA è¢«ä¸šç•Œå…¬è®¤ä¸ºæœ€å¥½çš„é¡¹ç›®ç®¡ç†å’Œå¼€å‘ç®¡ç†å·¥å…·ï¼ŒConfluence è¢«è®¤ä¸ºæ˜¯æœ€å¥½ç”¨çš„ä¼ä¸šçº§çŸ¥è¯†ç®¡ç†å·¥å…·ã€‚</p>
<h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><h3 id="Project"><a href="#Project" class="headerlink" title="Project"></a>Project</h3><p><strong>åˆ›å»ºé¡¹ç›®</strong>ï¼šé¡¹ç›®åç§°ã€ç®€ç§°ã€URL</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-22-100515.png" alt></p>
<ul>
<li><p>Storyï¼šæ•…äº‹</p>
</li>
<li><p>Sprintï¼šè¿­ä»£</p>
</li>
<li><p>Backlogï¼šéœ€æ±‚åˆ—è¡¨</p>
</li>
<li><p>é¡¹ç›®åˆ›å»º</p>
</li>
<li><p>é¡¹ç›®ç»„ä»¶å’Œç‰ˆæœ¬</p>
</li>
<li><p>é¡¹ç›®è§’è‰²</p>
</li>
</ul>
<h3 id="Issue"><a href="#Issue" class="headerlink" title="Issue"></a>Issue</h3><ul>
<li><p>åˆ›å»ºã€ç¼–è¾‘ä¸åˆ é™¤é—®é¢˜</p>
</li>
<li><p>é—®é¢˜è·Ÿè¸ª</p>
</li>
<li><p>å­ä»»åŠ¡</p>
</li>
</ul>
<h4 id="Issue-Typeï¼ˆé—®é¢˜å•ç±»å‹ï¼‰"><a href="#Issue-Typeï¼ˆé—®é¢˜å•ç±»å‹ï¼‰" class="headerlink" title="Issue Typeï¼ˆé—®é¢˜å•ç±»å‹ï¼‰"></a>Issue Typeï¼ˆé—®é¢˜å•ç±»å‹ï¼‰</h4><ul>
<li><strong>Bug</strong> - æ•…éšœï¼ŒåŠŸèƒ½å¤±æ•ˆ</li>
<li><strong>Improvement</strong> - æå‡ï¼Œæ—¢æœ‰åŠŸèƒ½å¢å¼º</li>
<li><strong>New Feature</strong> - æ–°åŠŸèƒ½</li>
<li><strong>Task</strong> - ä»»åŠ¡</li>
<li><strong>Custom Issue</strong> - æ ¹æ®éœ€è¦å®¢æˆ·åŒ–å®šåˆ¶</li>
</ul>
<h4 id="Priorityï¼ˆä¼˜å…ˆçº§ï¼‰"><a href="#Priorityï¼ˆä¼˜å…ˆçº§ï¼‰" class="headerlink" title="Priorityï¼ˆä¼˜å…ˆçº§ï¼‰"></a>Priorityï¼ˆä¼˜å…ˆçº§ï¼‰</h4><ul>
<li><strong>Highest</strong> - æœ€é«˜çº§åˆ«ï¼Œè¡¨æ˜é—®é¢˜é˜»å¡äº†ä¸šåŠ¡æµç¨‹æ­£å¸¸è¿›è¡Œ</li>
<li><strong>High</strong> - é«˜çº§ï¼Œè¡¨æ˜é—®é¢˜å¼•å‘æ˜æ˜¾æ•…éšœï¼Œéœ€è¦ç´§æ€¥å…³æ³¨</li>
<li><strong>Medium</strong> - ä¸­çº§ï¼Œè¡¨æ˜é—®é¢˜æœ‰ä¸€ä¸ªæ˜æ˜¾çš„å½±å“</li>
<li><strong>Low</strong> - ä½çº§ï¼Œè¡¨æ˜é—®é¢˜æœ‰ä¸€ä¸ªè½»å¾®çš„å½±å“</li>
<li><strong>Lowest</strong> - æœ€ä½çº§</li>
</ul>
<h4 id="Statusï¼ˆçŠ¶æ€ï¼‰"><a href="#Statusï¼ˆçŠ¶æ€ï¼‰" class="headerlink" title="Statusï¼ˆçŠ¶æ€ï¼‰"></a>Statusï¼ˆçŠ¶æ€ï¼‰</h4><ul>
<li><strong>Open</strong> - æ‰“å¼€çŠ¶æ€ï¼Œè¡¨æ˜é—®é¢˜å•å·²ç»è¢«åˆ›å»ºï¼Œç­‰å¾…è¢«åˆ†é…åˆ°å¼€å§‹å¤„ç†çŠ¶æ€</li>
<li><strong>In Progress</strong> - å¤„ç†ä¸­çŠ¶æ€ï¼Œè¡¨æ˜é—®é¢˜å•å·²ç»è¢«åˆ†é…äººæ¿€æ´»ï¼Œå¹¶å¤„äºè¢«å¤„ç†çŠ¶æ€ä¸­</li>
<li><strong>Resolved</strong> - å·²è§£å†³çŠ¶æ€ï¼Œè¡¨æ˜é—®é¢˜å·²ç»è¢«å¤„ç†å®Œæˆï¼Œç­‰å¾…é—®é¢˜æŠ¥å‘Šäººçš„éªŒè¯ã€‚ä»è¿™ä¸ªçŠ¶æ€ï¼Œé—®é¢˜å•ä¸€èˆ¬å¯ä»¥è¿›ä¸€æ­¥å˜æ›´ä¸ºé‡æ–°æ‰“å¼€çŠ¶æ€ï¼ˆReopenedï¼‰æˆ–å…³é—­çŠ¶æ€ï¼ˆClosedï¼‰</li>
<li><strong>Reopened</strong> - é‡æ–°æ‰“å¼€çŠ¶æ€ï¼Œé—®é¢˜ç»è¿‡éªŒè¯å‘ç°æ²¡æœ‰è¢«è§£å†³ï¼Œå°±å¯ä»¥å˜æ›´åˆ°è¿™ä¸ªçŠ¶æ€</li>
<li><strong>Closed</strong> - å…³é—­çŠ¶æ€ï¼Œé—®é¢˜è¢«å½»åº•è§£å†³å°±å¯ä»¥è½¬ä¸ºè¿™ä¸ªçŠ¶æ€</li>
</ul>
<h4 id="Resolutionï¼ˆè§£å†³ç»“æœï¼‰"><a href="#Resolutionï¼ˆè§£å†³ç»“æœï¼‰" class="headerlink" title="Resolutionï¼ˆè§£å†³ç»“æœï¼‰"></a>Resolutionï¼ˆè§£å†³ç»“æœï¼‰</h4><ul>
<li><strong>Fixed</strong> - ä¿®å¤</li>
<li><strong>Wonâ€™t Fix</strong> - ä¸ç”¨ä¿®å¤ï¼Œä¾‹å¦‚è¿™ä¸ªé—®é¢˜æ‰€æè¿°çš„ç°è±¡å·²ä¸å†æœ‰å½±å“äº†</li>
<li><strong>Duplicate</strong> - é‡å¤ï¼ŒåŒå…¶å®ƒå·²ç»å­˜åœ¨çš„é—®é¢˜é‡å¤äº†ï¼Œæ¨èæŠŠç›¸å…³çš„å•å­é“¾æ¥èµ·æ¥</li>
<li><strong>Incomplete</strong> - æœªå®Œæˆï¼Œæ²¡æœ‰è¶³å¤Ÿçš„ä¿¡æ¯ç»§ç»­å®Œæˆè¿™ä¸ªé—®é¢˜</li>
<li><strong>Cannot Reproduce</strong> - ä¸èƒ½é‡ç°ï¼Œå¦‚æœä»¥åæœ‰æ›´å¤šä¿¡æ¯å¯ä»¥ç»§ç»­å¯ä»¥é‡æ–°æ‰“å¼€è¿™å¼ å•å­ÃŸ</li>
<li><strong>Wonâ€™t Do</strong> - ä¸åšï¼Œç±»ä¼¼äºä¸ç”¨ä¿®å¤çš„æ–¹æ¡ˆï¼Œè¯•ç”¨äºè½¯ä»¶é¡¹ç›®çš„é»˜è®¤çŠ¶æ€</li>
</ul>
<h3 id="å·¥ä½œæµ"><a href="#å·¥ä½œæµ" class="headerlink" title="å·¥ä½œæµ"></a>å·¥ä½œæµ</h3><h2 id="Jira-ç®¡ç†å‘˜"><a href="#Jira-ç®¡ç†å‘˜" class="headerlink" title="Jira ç®¡ç†å‘˜"></a>Jira ç®¡ç†å‘˜</h2><h3 id="é…ç½®æ–¹æ¡ˆ"><a href="#é…ç½®æ–¹æ¡ˆ" class="headerlink" title="é…ç½®æ–¹æ¡ˆ"></a>é…ç½®æ–¹æ¡ˆ</h3><p>é¡¹ç›®æŠ¥è¡¨</p>
<p>æ•æ·ç®¡ç†</p>
<p>ç”¨æˆ·ã€ç”¨æˆ·ç»„ã€é¡¹ç›®è§’è‰²é…ç½®</p>
<ul>
<li><p>é—®é¢˜ç±»å‹</p>
</li>
<li><p>æƒé™</p>
</li>
<li><p>å·¥ä½œæµ</p>
</li>
</ul>
<h3 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ™®é€šç”¨æˆ·ç™»å½•</span></span><br><span class="line">http://jira.qd-aliyun-internal.haier.net</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç®¡ç†å‘˜ç™»å½•</span></span><br><span class="line">http://jira.qd-aliyun-internal.haier.net/login.jsp?oauth_sso=false</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç‰ˆæœ¬</span></span><br><span class="line">Jira v8.<span class="number">3.0</span></span><br></pre></td></tr></table></figure>

<h3 id="æœ€ä½³ä½¿ç”¨å®è·µ"><a href="#æœ€ä½³ä½¿ç”¨å®è·µ" class="headerlink" title="æœ€ä½³ä½¿ç”¨å®è·µ"></a>æœ€ä½³ä½¿ç”¨å®è·µ</h3><ul>
<li><p>Bug è·Ÿè¸ªç®¡ç†</p>
</li>
<li><p>ä»»åŠ¡æµç¨‹ç®¡ç†</p>
</li>
</ul>
<p><strong>åˆ é™¤ä»»åŠ¡</strong></p>
<ul>
<li>æƒé™è¯´æ˜ï¼šåˆ é™¤ä»»åŠ¡éœ€è¦å…·å¤‡é¡¹ç›®ç®¡ç†å‘˜æƒé™</li>
<li>é¡¹ç›®è®¾ç½®  -&gt;  ç”¨æˆ·å’Œè§’è‰²  -&gt;  æ·»åŠ ç”¨æˆ·åˆ° <code>Administrators</code> ç»„</li>
</ul>
]]></content>
      <categories>
        <category>é¡¹ç›®</category>
      </categories>
  </entry>
  <entry>
    <title>é›…æ€</title>
    <url>/blog/2019/10/22/ielts/</url>
    <content><![CDATA[<h2 id="æŠ¥å"><a href="#æŠ¥å" class="headerlink" title="æŠ¥å"></a>æŠ¥å</h2><ul>
<li><p><a href="https://ielts.etest.net.cn" target="_blank" rel="noopener">æŠ¥åå…¥å£</a></p>
</li>
<li><p>è€ƒè¯•è´¹ç”¨ï¼šï¿¥2020</p>
</li>
<li><p>è½¬è€ƒè´¹ç”¨ï¼šï¿¥420</p>
</li>
</ul>
<h2 id="èµ„æ–™"><a href="#èµ„æ–™" class="headerlink" title="èµ„æ–™"></a>èµ„æ–™</h2><ul>
<li>ã€Šå‰‘æ¡¥é›…æ€å®˜æ–¹çœŸé¢˜ã€‹</li>
<li>ã€Šå‰‘æ¡¥é›…æ€çœŸé¢˜ç²¾è®²ã€‹</li>
<li>ã€Š7å¤©æå®šé›…æ€é«˜é¢‘æ ¸å¿ƒè¯ã€‹</li>
<li>ã€Šé›…æ€è¯æ±‡çœŸç»ã€‹</li>
<li>ã€Šé¡¾å®¶åŒ—æ‰‹æŠŠæ‰‹æ•™ä½ é›…æ€å†™ä½œã€‹</li>
<li>ã€Šé›…æ€ç‹å¬åŠ›çœŸé¢˜è¯­æ–™åº“ã€‹</li>
</ul>
]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
  </entry>
  <entry>
    <title>TiDB</title>
    <url>/blog/2019/10/22/tidb/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><a href="https://pingcap.com/" target="_blank" rel="noopener"><strong>TiDB</strong></a> æ˜¯ä¸€æ¬¾å®šä½äºåœ¨çº¿äº‹åŠ¡å¤„ç†/åœ¨çº¿åˆ†æå¤„ç†ï¼ˆ HTAP: Hybrid Transactional/Analytical Processingï¼‰çš„èåˆå‹æ•°æ®åº“äº§å“ï¼Œå®ç°äº†ä¸€é”®æ°´å¹³ä¼¸ç¼©ã€å¼ºä¸€è‡´æ€§çš„å¤šå‰¯æœ¬æ•°æ®å®‰å…¨ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€å®æ—¶ <code>OLAP</code> ç­‰é‡è¦ç‰¹æ€§ï¼ŒåŒæ—¶å…¼å®¹ MySQL åè®®å’Œç”Ÿæ€ï¼Œè¿ç§»ä¾¿æ·ï¼Œè¿ç»´æˆæœ¬æä½ã€‚</p>
<p>[ <a href="https://pingcap.com/docs-cn/v3.0/" target="_blank" rel="noopener"><strong>æ–‡æ¡£</strong></a> | <a href="https://github.com/pingcap/tidb" target="_blank" rel="noopener"><strong>ä»£ç </strong></a> | <a href="https://pingcap.com/community-cn/" target="_blank" rel="noopener"><strong>ç¤¾åŒº</strong></a>]</p>
<h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p><strong>1. å®‰è£…ä¾èµ–åŒ…</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ yum -y install libtool zlib-devel autoconf readline-devel readline libuuid-devel zlib-devel automake libuuid readline-devel readline ncurses-devel.x86_64 ncurses.x86_64 gcc-c++ vim wget net-tools svn libstdc++.so.<span class="number">6</span> glibc.i686 unzip make lrzsz libtool zlib-devel autoconf readline-devel readline libuuid-devel zlib-devel automake libuuid readline-devel readline ncurses-devel.x86_64 ncurses.x86_64 gcc-c++ vim wget net-tools svn libstdc++.so.<span class="number">6</span> libcurl-dev libcurl-devel expat-devel perl-ExtUtils-CBuilder perl-ExtUtils-MakeMaker zip git gcc openssl-devel libnl3-devel net-snmp-devel libnfnetlink-devel zlib zlib-devel openssl openssl-devel tree lrzsz tree net-tools nmap vim bash-completion lsof dos2unix nc telnet ntp wget rng-tools psmisc screen pcre pcre-devel</span><br></pre></td></tr></table></figure>

<p><strong>2. å®‰è£… TiDB</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ cd /usr/local/</span><br><span class="line">$ wget http://download.pingcap.org/tidb-latest-linux-amd64.tar.gz</span><br><span class="line">$ tar -xzf tidb-latest-linux-amd64.tar.gz  /usr/local</span><br><span class="line">$ mkdir -p /<span class="keyword">data</span>/tidb</span><br><span class="line">$ cd /usr/local/tidb-latest-linux-amd64</span><br><span class="line">$ ln -s /usr/local/tidb-latest-linux-amd64/bin/pd-tso-bench /usr/bin</span><br><span class="line">$ ln -s /usr/local/tidb-latest-linux-amd64/bin/tikv-server /usr/bin/</span><br><span class="line">$ ln -s /usr/local/tidb-latest-linux-amd64/bin/tidb-server /usr/bin/</span><br><span class="line">$ ln -s /usr/local/tidb-latest-linux-amd64/bin/pd-server /usr/bin/</span><br><span class="line">$ ln -s /usr/local/tidb-latest-linux-amd64/bin/pd-ctl /usr/bin/</span><br></pre></td></tr></table></figure>

<p><strong>3. å¯åŠ¨ PD</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ cd bin</span><br><span class="line">$ ./pd-server -data-dir=/<span class="keyword">data</span>/tidb/pd -log-file=/<span class="keyword">data</span>/tidb/log/pd.log -name=pd1 &amp;</span><br></pre></td></tr></table></figure>

<p><strong>4. å¯åŠ¨ TiKV</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ ./tikv-server --pd=<span class="string">"127.0.0.1:2379"</span> --data-dir=/<span class="keyword">data</span>/tidb/tikv --log-file=/<span class="keyword">data</span>/tidb/log/tikv.log &amp;</span><br></pre></td></tr></table></figure>

<p><strong>5. è¿æ¥ TiDB</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$ mysql -h 127.0.0.1 -P 4000 -u root</span><br><span class="line"></span><br><span class="line">Welcome to the MySQL monitor.  Commands <span class="keyword">end</span> <span class="keyword">with</span> ; or \g.</span><br><span class="line">Your MySQL connection id is 12</span><br><span class="line">Server version: 5.7.25-TiDB-v3.0.0-rc.1-290-g21d2590ac MySQL Community Server (Apache License 2.0)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type '<span class="keyword">help</span>;' or '\h' for help. <span class="keyword">Type</span> <span class="string">'\c'</span> <span class="keyword">to</span> <span class="keyword">clear</span> the <span class="keyword">current</span> <span class="keyword">input</span> statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">databases</span>;</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| INFORMATION_SCHEMA |</span><br><span class="line">| PERFORMANCE_SCHEMA |</span><br><span class="line">| mysql              |</span><br><span class="line">| test               |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p><strong>6. ä¿®æ”¹å¯†ç </strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; use mysql; </span><br><span class="line">mysql&gt; update user set password=PASSWORD("Changeme_123") where User='root';</span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure>

<p><strong>7. è®¾ç½®è¿œç¨‹å¯è®¿é—®</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; grant all privileges on *.* to 'root'@'%' identified by 'Changeme_123';</span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
  </entry>
  <entry>
    <title>Prometheus</title>
    <url>/blog/2019/10/22/prometheus/</url>
    <content><![CDATA[<h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><p><a href="https://prometheus.io/" target="_blank" rel="noopener"><strong>Prometheus</strong></a> æ˜¯ä¸€ä¸ªå¼€æºçš„å®Œæ•´ç›‘æ§è§£å†³æ–¹æ¡ˆï¼Œå…¶å¯¹ä¼ ç»Ÿç›‘æ§ç³»ç»Ÿçš„æµ‹è¯•å’Œå‘Šè­¦æ¨¡å‹è¿›è¡Œäº†å½»åº•çš„é¢ è¦†ï¼Œå½¢æˆäº†åŸºäºä¸­å¤®åŒ–çš„è§„åˆ™è®¡ç®—ã€ç»Ÿä¸€åˆ†æå’Œå‘Šè­¦çš„æ–°æ¨¡å‹ï¼ŒåŸºäº <code>Golang</code> ç¼–å†™ã€‚</p>
<h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><p><strong>æ˜“äºç®¡ç†</strong></p>
<p><code>Prometheus</code> åŸºäº <code>Pull</code> æ¨¡å‹çš„æ¶æ„æ–¹å¼ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ï¼ˆæœ¬åœ°ç”µè„‘ï¼Œå¼€å‘ç¯å¢ƒï¼Œæµ‹è¯•ç¯å¢ƒï¼‰æ­å»ºæˆ‘ä»¬çš„ç›‘æ§ç³»ç»Ÿã€‚å¯¹äºä¸€äº›å¤æ‚çš„æƒ…å†µï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>Prometheus</code> æœåŠ¡å‘ç° (<code>Service Discovery</code>) èƒ½åŠ›åŠ¨æ€ç®¡ç†ç›‘æ§ç›®æ ‡ã€‚</p>
<p><strong>å¼ºå¤§çš„æ•°æ®æ¨¡å‹</strong></p>
<p>æ‰€æœ‰é‡‡é›†çš„ç›‘æ§æ•°æ®å‡ä»¥æŒ‡æ ‡ <code>metric</code> çš„å½¢å¼ä¿å­˜åœ¨å†…ç½®çš„æ—¶é—´åºåˆ—æ•°æ®åº“å½“ä¸­ <code>TSDB</code>ã€‚æ‰€æœ‰çš„æ ·æœ¬é™¤äº†åŸºæœ¬çš„æŒ‡æ ‡åç§°ä»¥å¤–ï¼Œè¿˜åŒ…å«ä¸€ç»„ç”¨äºæè¿°è¯¥æ ·æœ¬ç‰¹å¾çš„æ ‡ç­¾ã€‚</p>
<p>å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">http_request_status&#123;code='200',content_path='/api/path',</span> <span class="string">environment='produment'&#125;</span> <span class="string">=&gt;</span> <span class="string">[value1@timestamp1,value2@timestamp2...]</span></span><br><span class="line"><span class="string">http_request_status&#123;code='200',content_path='/api/path2',</span> <span class="string">environment='produment'&#125;</span> <span class="string">=&gt;</span> <span class="string">[value1@timestamp1,value2@timestamp2...]</span></span><br></pre></td></tr></table></figure>

<p>æ¯ä¸€æ¡æ—¶é—´åºåˆ—ç”±æŒ‡æ ‡åç§° <code>Metrics Name</code> ä»¥åŠä¸€ç»„æ ‡ç­¾ <code>Labels</code> å”¯ä¸€æ ‡è¯†ã€‚æ¯æ¡æ—¶é—´åºåˆ—æŒ‰ç…§æ—¶é—´çš„å…ˆåé¡ºåºå­˜å‚¨ä¸€ç³»åˆ—çš„æ ·æœ¬å€¼ã€‚è¡¨ç¤ºç»´åº¦çš„æ ‡ç­¾å¯èƒ½æ¥æºäºä½ çš„ç›‘æ§å¯¹è±¡çš„çŠ¶æ€ï¼Œæ¯”å¦‚ <code>code=404</code> æˆ–è€… <code>content_path=/api/path</code>ã€‚åŸºäºè¿™äº› <code>Labels</code> ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°å¯¹ç›‘æ§æ•°æ®è¿›è¡Œèšåˆã€è¿‡æ»¤ã€è£å‰ªã€‚</p>
<p><strong>å¼ºå¤§çš„æŸ¥è¯¢è¯­è¨€ PromSQL</strong></p>
<p><code>Prometheus</code> å†…ç½®äº†ä¸€ä¸ªå¼ºå¤§çš„æ•°æ®æŸ¥è¯¢è¯­è¨€ <code>PromQL</code>ã€‚ é€šè¿‡ <code>PromQL</code> å¯ä»¥å®ç°å¯¹ç›‘æ§æ•°æ®çš„æŸ¥è¯¢ã€èšåˆã€‚åŒæ—¶ <code>PromQL</code> ä¹Ÿè¢«åº”ç”¨äºæ•°æ®å¯è§†åŒ–(å¦‚ <code>Grafana</code> )ä»¥åŠå‘Šè­¦å½“ä¸­ã€‚</p>
<p><strong>é«˜æ•ˆ</strong></p>
<p>å¯¹äºç›‘æ§ç³»ç»Ÿè€Œè¨€ï¼Œå¤§é‡çš„ç›‘æ§ä»»åŠ¡å¿…ç„¶å¯¼è‡´æœ‰å¤§é‡çš„æ•°æ®äº§ç”Ÿã€‚è€Œ<code>Prometheus</code> å¯ä»¥é«˜æ•ˆåœ°å¤„ç†è¿™äº›æ•°æ®ï¼Œå¯¹äºå•ä¸€ <code>Prometheus Server</code> å®ä¾‹è€Œè¨€å®ƒå¯ä»¥å¤„ç†ï¼š</p>
<ul>
<li>æ•°ä»¥ç™¾ä¸‡çš„ç›‘æ§æŒ‡æ ‡</li>
<li>æ¯ç§’å¤„ç†æ•°åä¸‡çš„æ•°æ®ç‚¹</li>
</ul>
<p><strong>æ˜“äºé›†æˆ</strong></p>
<p><code>Prometheus</code> ç¤¾åŒºè¿˜æä¾›äº†å¤§é‡ç¬¬ä¸‰æ–¹å®ç°çš„ç›‘æ§æ•°æ®é‡‡é›†æ”¯æŒï¼š<code>MySQL</code>ã€<code>Consul</code>ã€<code>Redis</code> ç­‰ç­‰ã€‚</p>
<p><strong>å¯è§†åŒ–</strong></p>
<p><code>Prometheus Server</code> ä¸­è‡ªå¸¦äº†ä¸€ä¸ª <code>Prometheus UI</code>ï¼Œé€šè¿‡è¿™ä¸ª UI å¯ä»¥æ–¹ä¾¿åœ°ç›´æ¥å¯¹æ•°æ®è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä¸”æ”¯æŒç›´æ¥ä»¥å›¾å½¢åŒ–çš„å½¢å¼å±•ç¤ºæ•°æ®ã€‚å¼€æºç¬¬ä¸‰æ–¹å¯è§†åŒ–å·¥å…· <code>Grafana</code> ä¹Ÿå·²ç»æä¾›äº†å®Œæ•´çš„ <code>Prometheus</code> æ”¯æŒï¼ŒåŸºäº <code>Grafana</code> å¯ä»¥åˆ›å»ºæ›´åŠ ç²¾ç¾çš„ç›‘æ§å›¾æ ‡ã€‚</p>
<p><strong>ç¼ºç‚¹</strong>ï¼šç›¸æ¯”äº <a href="https://www.zabbix.com/" target="_blank" rel="noopener"><strong>zabbix</strong></a>ï¼Œæ›´åŠ æ¶ˆè€—èµ„æº</p>
<h3 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h3><p><img src="http://ww3.sinaimg.cn/large/006y8mN6ly1g6d2tdrnvxj311j0mjjtq.jpg" alt="Prometheus architecture"></p>
<p><strong>Prometheus Server</strong>ï¼šæ˜¯ <code>Prometheus</code> ç»„ä»¶ä¸­çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œè´Ÿè´£å®ç°å¯¹ç›‘æ§æ•°æ®çš„è·å–ã€å­˜å‚¨ä»¥åŠæŸ¥è¯¢ã€‚</p>
<ul>
<li><code>Prometheus Server</code> å¯ä»¥é€šè¿‡é™æ€é…ç½®ç®¡ç†ç›‘æ§ç›®æ ‡ï¼ˆ<code>prometheus.yml</code>ï¼‰ï¼Œä¹Ÿå¯ä»¥é…åˆä½¿ç”¨ <code>Service Discovery</code> çš„æ–¹å¼åŠ¨æ€ç®¡ç†ç›‘æ§ç›®æ ‡ï¼Œå¹¶ä»è¿™äº›ç›‘æ§ç›®æ ‡ä¸­è·å–æ•°æ®ã€‚</li>
<li><code>Prometheus Server</code> éœ€è¦å¯¹é‡‡é›†åˆ°çš„ç›‘æ§æ•°æ®è¿›è¡Œå­˜å‚¨ï¼Œå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªæ—¶åºæ•°æ®åº“ï¼Œå°†é‡‡é›†åˆ°çš„ç›‘æ§æ•°æ®æŒ‰ç…§æ—¶é—´åºåˆ—çš„æ–¹å¼å­˜å‚¨åœ¨æœ¬åœ°ç£ç›˜å½“ä¸­ã€‚</li>
<li><code>Prometheus Server</code> å¯¹å¤–æä¾›äº†è‡ªå®šä¹‰çš„ <code>PromQL</code> è¯­è¨€ï¼Œå®ç°å¯¹æ•°æ®çš„æŸ¥è¯¢ä»¥åŠåˆ†æã€‚</li>
</ul>
<p><strong>exporters</strong>ï¼šè´Ÿè´£å°†ç›‘æ§æ•°æ®é‡‡é›†çš„ç«¯ç‚¹é€šè¿‡ <code>HTTP</code> æœåŠ¡çš„å½¢å¼æš´éœ²ç»™ <code>Prometheus Server</code>ï¼Œ<code>Prometheus Server</code> é€šè¿‡è®¿é—®è¯¥ <code>exporter</code> æä¾›çš„ <code>Endpoint</code> ç«¯ç‚¹ï¼Œå³å¯è·å–åˆ°éœ€è¦é‡‡é›†çš„ç›‘æ§æ•°æ®ã€‚ä¸€èˆ¬æ¥è¯´å¯ä»¥å°†<code>exporter</code> åˆ†ä¸º 2 ç±»ï¼š</p>
<ul>
<li>ç›´æ¥é‡‡é›†ï¼šè¿™ä¸€ç±» <code>exporter</code> ç›´æ¥å†…ç½®äº†å¯¹ <code>Prometheus</code> ç›‘æ§çš„æ”¯æŒï¼Œä¾‹å¦‚ï¼š<code>Kubernetes</code>ã€‚</li>
<li>é—´æ¥é‡‡é›†ï¼šåŸæœ‰ç›‘æ§ç›®æ ‡å¹¶ä¸ç›´æ¥æ”¯æŒ <code>Prometheus</code>ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡ <code>Prometheus</code> æä¾›çš„ <code>Client Library</code> ç¼–å†™è¯¥ç›‘æ§ç›®æ ‡çš„ç›‘æ§é‡‡é›†ç¨‹åºã€‚ä¾‹å¦‚ï¼šç›‘æ§ä¸»æœºæœ‰ <a href="https://github.com/prometheus/node_exporter" target="_blank" rel="noopener"><strong>node_exporter</strong></a>ï¼Œç›‘æ§ <code>MySQL</code> æœ‰ <a href="https://github.com/prometheus/mysqld_exporter" target="_blank" rel="noopener"><strong>mysqld_exporter</strong></a>ã€‚</li>
</ul>
<p><strong>Pushgateway</strong>ï¼šç”±äº <code>Prometheus</code> æ•°æ®é‡‡é›†åŸºäº <code>Pull</code> æ¨¡å‹è¿›è¡Œè®¾è®¡ï¼Œå› æ­¤åœ¨ç½‘ç»œç¯å¢ƒçš„é…ç½®ä¸Šå¿…é¡»è¦è®©<code>Prometheus Server</code> èƒ½å¤Ÿç›´æ¥ä¸ <code>exporter</code> è¿›è¡Œé€šä¿¡ã€‚ å½“è¿™ç§ç½‘ç»œéœ€æ±‚æ— æ³•ç›´æ¥æ»¡è¶³æ—¶ï¼Œå°±å¯ä»¥åˆ©ç”¨<code>PushGateway</code> æ¥è¿›è¡Œä¸­è½¬ã€‚å¯ä»¥é€šè¿‡ <code>PushGateway</code> å°†å†…éƒ¨ç½‘ç»œçš„ç›‘æ§æ•°æ®ä¸»åŠ¨ <code>Push</code> åˆ° <code>Gateway</code> å½“ä¸­ã€‚è€Œ <code>Prometheus Server</code> åˆ™å¯ä»¥é‡‡ç”¨åŒæ · <code>Pull</code> çš„æ–¹å¼ä» <code>PushGateway</code> ä¸­è·å–åˆ°ç›‘æ§æ•°æ®ã€‚</p>
<p><strong>Alertmanager</strong>ï¼šåœ¨ <code>Prometheus Server</code> ä¸­æ”¯æŒåŸºäº <code>PromQL</code> åˆ›å»ºå‘Šè­¦è§„åˆ™ï¼Œå¦‚æœæ»¡è¶³ <code>PromQL</code> å®šä¹‰çš„è§„åˆ™ï¼Œåˆ™ä¼šäº§ç”Ÿä¸€æ¡å‘Šè­¦ï¼Œè€Œå‘Šè­¦çš„åç»­å¤„ç†æµç¨‹åˆ™ç”± <code>AlertManager</code> è¿›è¡Œç®¡ç†ã€‚åœ¨ <code>AlertManager</code> ä¸­æˆ‘ä»¬å¯ä»¥ä¸é‚®ä»¶ï¼Œ<code>Slack</code> ç­‰ç­‰å†…ç½®çš„é€šçŸ¥æ–¹å¼è¿›è¡Œé›†æˆï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>Webhook</code> è‡ªå®šä¹‰å‘Šè­¦å¤„ç†æ–¹å¼ã€‚<code>AlertManager</code> å³ <code>Prometheus</code> ä½“ç³»ä¸­çš„å‘Šè­¦å¤„ç†ä¸­å¿ƒã€‚</p>
<p><strong>Web UI</strong>ï¼šæ•°æ®å¯è§†åŒ–ï¼Œä¸»è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…· <a href="https://grafana.com/" target="_blank" rel="noopener"><strong>Grafana</strong></a> æ¥å®ç°ã€‚</p>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><h4 id="Prometheus-Server"><a href="#Prometheus-Server" class="headerlink" title="Prometheus Server"></a>Prometheus Server</h4><p><strong>äºŒè¿›åˆ¶åŒ…æ–¹å¼å®‰è£…</strong></p>
<p>ï¼ˆ1ï¼‰ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ <a href="https://prometheus.io/download/" target="_blank" rel="noopener"><strong>è½¯ä»¶åŒ…</strong></a></p>
<p>ï¼ˆ2ï¼‰è§£å‹</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">wget</span> <span class="attr">https://github.com/prometheus/prometheus/releases/download/v2.12.0/prometheus-2.12.0.linux-amd64.tar.gz</span></span><br><span class="line"><span class="string">tar</span> <span class="bullet">-xzf</span> <span class="string">prometheus-2.12.0.linux-amd64.tar.gz</span></span><br><span class="line"><span class="string">cd</span> <span class="string">prometheus-2.12.0.linux-amd64</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰é…ç½®æ–‡ä»¶ <code>promethes.yml</code>ï¼Œä¿®æ”¹ <code>job_name</code>ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># my global config</span></span><br><span class="line"><span class="attr">global:</span></span><br><span class="line"><span class="attr">  scrape_interval:</span>     <span class="number">15</span><span class="string">s</span> <span class="comment"># Set the scrape interval to every 15 seconds. Default is every 1 minute.</span></span><br><span class="line"><span class="attr">  evaluation_interval:</span> <span class="number">15</span><span class="string">s</span> <span class="comment"># Evaluate rules every 15 seconds. The default is every 1 minute.</span></span><br><span class="line">  <span class="comment"># scrape_timeout is set to the global default (10s).</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Alertmanager configuration</span></span><br><span class="line"><span class="attr">alerting:</span></span><br><span class="line"><span class="attr">  alertmanagers:</span></span><br><span class="line"><span class="attr">  - static_configs:</span></span><br><span class="line"><span class="attr">    - targets:</span></span><br><span class="line">      <span class="comment"># - alertmanager:9093</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load rules once and periodically evaluate them according to the global 'evaluation_interval'.</span></span><br><span class="line"><span class="attr">rule_files:</span></span><br><span class="line">  <span class="comment"># - "first_rules.yml"</span></span><br><span class="line">  <span class="comment"># - "second_rules.yml"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># A scrape configuration containing exactly one endpoint to scrape:</span></span><br><span class="line"><span class="comment"># Here it's Prometheus itself.</span></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="comment"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span></span><br><span class="line"><span class="attr">  - job_name:</span> <span class="string">'prometheus'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># metrics_path defaults to '/metrics'</span></span><br><span class="line">    <span class="comment"># scheme defaults to 'http'.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    static_configs:</span></span><br><span class="line"><span class="attr">    - targets:</span> <span class="string">['localhost:9090']</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ4ï¼‰åˆ›å»ºæ•°æ®å­˜å‚¨ç›®å½•ï¼Œé»˜è®¤çš„å­˜å‚¨è·¯å¾„ä¸º <code>data/</code>ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡å‚æ•° <code>--storage.tsdb.path=&quot;data/&quot;</code> ä¿®æ”¹æœ¬åœ°æ•°æ®å­˜å‚¨çš„è·¯å¾„ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">mkdir</span> <span class="bullet">-p</span> <span class="string">data</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ5ï¼‰å¯åŠ¨ <code>prometheus</code> æœåŠ¡ï¼Œ<a href="http://10.133.0.53:9090/" target="_blank" rel="noopener"><strong>http://10.133.0.53:9090</strong></a></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">./prometheus</span></span><br><span class="line"><span class="string">level=info</span> <span class="string">ts=2019-08-26T07:33:43.420Z</span> <span class="string">caller=main.go:293</span> <span class="string">msg="no</span> <span class="string">time</span> <span class="string">or</span> <span class="string">size</span> <span class="string">retention</span> <span class="string">was</span> <span class="string">set</span> <span class="string">so</span> <span class="string">using</span> <span class="string">the</span> <span class="string">default</span> <span class="string">time</span> <span class="string">retention"</span> <span class="string">duration=15d</span></span><br><span class="line"><span class="string">level=info</span> <span class="string">ts=2019-08-26T07:33:43.420Z</span> <span class="string">caller=main.go:329</span> <span class="string">msg="Starting</span> <span class="string">Prometheus"</span> <span class="string">version="(version=2.12.0,</span> <span class="string">branch=HEAD,</span> <span class="string">revision=43acd0e2e93f9f70c49b2267efa0124f1e759e86)"</span></span><br><span class="line"><span class="string">level=info</span> <span class="string">ts=2019-08-26T07:33:43.420Z</span> <span class="string">caller=main.go:330</span> <span class="string">build_context="(go=go1.12.8,</span> <span class="string">user=root@7a9dbdbe0cc7,</span> <span class="string">date=20190818-13:53:16)"</span></span><br><span class="line"><span class="string">level=info</span> <span class="string">ts=2019-08-26T07:33:43.421Z</span> <span class="string">caller=main.go:331</span> <span class="string">host_details="(Linux</span> <span class="number">3.10</span><span class="number">.0</span><span class="bullet">-693.</span><span class="string">el7.x86_64</span> <span class="comment">#1 SMP Tue Aug 22 21:09:27 UTC 2017 x86_64 ptdsmapp05 (none))"</span></span><br><span class="line"><span class="string">level=info</span> <span class="string">ts=2019-08-26T07:33:43.421Z</span> <span class="string">caller=main.go:332</span> <span class="string">fd_limits="(soft=65536,</span> <span class="string">hard=65536)"</span></span><br><span class="line"><span class="string">level=info</span> <span class="string">ts=2019-08-26T07:33:43.421Z</span> <span class="string">caller=main.go:333</span> <span class="string">vm_limits="(soft=unlimited,</span> <span class="string">hard=unlimited)"</span></span><br><span class="line"><span class="string">level=info</span> <span class="string">ts=2019-08-26T07:33:43.423Z</span> <span class="string">caller=web.go:448</span> <span class="string">component=web</span> <span class="string">msg="Start</span> <span class="string">listening</span> <span class="string">for</span> <span class="string">connections"</span> <span class="string">address=0.0.0.0:9090</span></span><br><span class="line"><span class="string">level=info</span> <span class="string">ts=2019-08-26T07:33:43.423Z</span> <span class="string">caller=main.go:654</span> <span class="string">msg="Starting</span> <span class="string">TSDB</span> <span class="string">..."</span></span><br><span class="line"><span class="string">level=info</span> <span class="string">ts=2019-08-26T07:33:43.442Z</span> <span class="string">caller=head.go:509</span> <span class="string">component=tsdb</span> <span class="string">msg="replaying</span> <span class="string">WAL,</span> <span class="string">this</span> <span class="string">may</span> <span class="string">take</span> <span class="string">awhile"</span></span><br><span class="line"><span class="string">level=info</span> <span class="string">ts=2019-08-26T07:33:43.445Z</span> <span class="string">caller=head.go:557</span> <span class="string">component=tsdb</span> <span class="string">msg="WAL</span> <span class="string">segment</span> <span class="string">loaded"</span> <span class="string">segment=0</span> <span class="string">maxSegment=0</span></span><br><span class="line"><span class="string">level=info</span> <span class="string">ts=2019-08-26T07:33:43.446Z</span> <span class="string">caller=main.go:669</span> <span class="string">fs_type=XFS_SUPER_MAGIC</span></span><br><span class="line"><span class="string">level=info</span> <span class="string">ts=2019-08-26T07:33:43.446Z</span> <span class="string">caller=main.go:670</span> <span class="string">msg="TSDB</span> <span class="string">started"</span></span><br><span class="line"><span class="string">level=info</span> <span class="string">ts=2019-08-26T07:33:43.446Z</span> <span class="string">caller=main.go:740</span> <span class="string">msg="Loading</span> <span class="string">configuration</span> <span class="string">file"</span> <span class="string">filename=prometheus.yml</span></span><br><span class="line"><span class="string">level=info</span> <span class="string">ts=2019-08-26T07:33:43.448Z</span> <span class="string">caller=main.go:768</span> <span class="string">msg="Completed</span> <span class="string">loading</span> <span class="string">of</span> <span class="string">configuration</span> <span class="string">file"</span> <span class="string">filename=prometheus.yml</span></span><br><span class="line"><span class="string">level=info</span> <span class="string">ts=2019-08-26T07:33:43.448Z</span> <span class="string">caller=main.go:623</span> <span class="string">msg="Server</span> <span class="string">is</span> <span class="string">ready</span> <span class="string">to</span> <span class="string">receive</span> <span class="string">web</span> <span class="string">requests."</span></span><br></pre></td></tr></table></figure>

<p><strong>docker æ–¹å¼å®‰è£…</strong></p>
<p>ç›´æ¥ä½¿ç”¨ <code>Prometheus</code> çš„é•œåƒå³å¯å¯åŠ¨ <code>Prometheus Server</code>ã€‚å¯åŠ¨å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ <a href="http://10.133.0.53:9090/" target="_blank" rel="noopener"><strong>http://10.133.0.53:9090</strong></a> è®¿é—® <code>UI</code> ç•Œé¢ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">docker</span> <span class="string">run</span> <span class="bullet">-p</span> <span class="number">9090</span><span class="string">:9090</span> <span class="bullet">-v</span> <span class="string">/etc/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml</span> <span class="string">prom/prometheus</span></span><br></pre></td></tr></table></figure>

<p><img src="http://ww4.sinaimg.cn/large/006y8mN6ly1g6d58mi60uj32800ke415.jpg" alt="Prometheus UI"></p>
<h4 id="node-exporter"><a href="#node-exporter" class="headerlink" title="node_exporter"></a>node_exporter</h4><p>é‡‡é›†ä¸»æœºçš„è¿è¡ŒæŒ‡æ ‡å¦‚ CPUã€å†…å­˜ã€ç£ç›˜ç­‰ä¿¡æ¯ã€‚åŒæ ·é‡‡ç”¨ <code>Golang</code> ç¼–å†™ï¼Œå¹¶ä¸”ä¸å­˜åœ¨ä»»ä½•çš„ç¬¬ä¸‰æ–¹ä¾èµ–ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">wget</span> <span class="attr">https://github.com/prometheus/node_exporter/releases/download/v0.18.1/node_exporter-0.18.1.linux-amd64.tar.gz</span></span><br><span class="line"><span class="string">tar</span> <span class="bullet">-xzf</span> <span class="string">node_exporter-0.18.1.linux-amd64.tar.gz</span></span><br><span class="line"><span class="string">cd</span> <span class="string">node_exporter-0.18.1.linux-amd64</span></span><br><span class="line"><span class="string">cp</span> <span class="string">node_exporter-0.18.1.linux-amd64/node_exporter</span> <span class="string">/usr/local/bin</span></span><br><span class="line"><span class="string">./node_exporter</span></span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨æˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">INFO[0000]</span> <span class="string">Listening</span> <span class="string">on</span> <span class="string">:9100</span>                            <span class="string">source="node_exporter.go:170"</span></span><br></pre></td></tr></table></figure>

<p>è®¿é—® <strong><a href="http://10.133.0.53:9100/metrics" target="_blank" rel="noopener">http://10.133.0.53:9100/metrics</a></strong>ï¼Œå¯ä»¥çœ‹åˆ°é‡‡é›†åˆ°çš„ç›‘æ§æ•°æ®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># HELP node_cpu Seconds the cpus spent in each mode.</span></span><br><span class="line"><span class="comment"># TYPE node_cpu counter</span></span><br><span class="line"><span class="string">node_cpu&#123;cpu="cpu0",mode="idle"&#125;</span> <span class="number">362812.7890625</span></span><br><span class="line"><span class="comment"># HELP node_load1 1m load average.</span></span><br><span class="line"><span class="comment"># TYPE node_load1 gauge</span></span><br><span class="line"><span class="string">node_load1</span> <span class="number">3.0703125</span></span><br></pre></td></tr></table></figure>

<p><strong>HELP</strong>ï¼šè§£é‡Šå½“å‰æŒ‡æ ‡çš„å«ä¹‰ã€‚</p>
<p><strong>TYPE</strong>ï¼šè¯´æ˜å½“å‰æŒ‡æ ‡çš„æ•°æ®ç±»å‹ã€‚æœ‰å››ç§æ•°æ®ç±»å‹ï¼Œ<code>counter</code>ï¼ˆè®¡æ•°å™¨ï¼‰ã€<code>gauge</code>ï¼ˆä»ªè¡¨ç›˜ï¼‰ã€<code>histogram</code>ï¼ˆç›´æ–¹å›¾ï¼‰ã€<code>summary</code>ï¼ˆæ±‚å’Œï¼‰</p>
<p>é™¤äº†è¿™äº›ä¹‹å¤–ï¼Œè¿˜å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç›‘æ§æŒ‡æ ‡ï¼š</p>
<ul>
<li>node_boot_timeï¼šç³»ç»Ÿå¯åŠ¨æ—¶é—´</li>
<li>node_cpuï¼šç³»ç»Ÿ <code>CPU</code> ä½¿ç”¨é‡</li>
<li>node_disk_*ï¼šç£ç›˜ <code>IO</code></li>
<li>node_filesystem_*ï¼šæ–‡ä»¶ç³»ç»Ÿç”¨é‡</li>
<li>node_load1ï¼šç³»ç»Ÿè´Ÿè½½</li>
<li>node_memeory_*ï¼šå†…å­˜ä½¿ç”¨é‡</li>
<li>node_network_*ï¼šç½‘ç»œå¸¦å®½</li>
<li>node_timeï¼šå½“å‰ç³»ç»Ÿæ—¶é—´</li>
<li>go_*ï¼š<code>node_exporter</code> ä¸­ <code>go</code> ç›¸å…³æŒ‡æ ‡</li>
<li>process_*ï¼š<code>node_exporter</code> è‡ªèº«è¿›ç¨‹ç›¸å…³è¿è¡ŒæŒ‡æ ‡</li>
</ul>
<h4 id="mysqld-exporter"><a href="#mysqld-exporter" class="headerlink" title="mysqld_exporter"></a>mysqld_exporter</h4><p>ï¼ˆ1ï¼‰ä¸‹è½½<a href="https://prometheus.io/download/" target="_blank" rel="noopener"><strong>äºŒè¿›åˆ¶åŒ…</strong></a></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">wget</span> <span class="attr">https://github.com/prometheus/mysqld_exporter/releases/download/v0.12.1/mysqld_exporter-0.12.1.linux-amd64.tar.gz</span></span><br><span class="line"><span class="string">tar</span> <span class="bullet">-xzf</span> <span class="string">mysqld_exporter-0.12.1.linux-amd64.tar.gz</span></span><br><span class="line"><span class="string">cd</span> <span class="string">mysqld_exporter-0.12.1.linux-amd64</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰ç¼–è¾‘ <code>.my.cnf</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">[client]</span></span><br><span class="line"><span class="string">user=hdm</span></span><br><span class="line"><span class="string">password=Hdm@123!</span></span><br><span class="line"><span class="string">host=10.133.0.53</span></span><br><span class="line"><span class="string">port=3306</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰å¯åŠ¨ <code>mysqld_exporter</code>ï¼Œé»˜è®¤ç«¯å£æ˜¯ <code>9104</code>ï¼Œå¯ä»¥çœ‹åˆ°é‡‡é›†åˆ°çš„ MySQL <a href="http://10.133.0.53:9104/metrics" target="_blank" rel="noopener"><strong>Metrics</strong></a>ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">./mysqld_exporter</span> <span class="bullet">--config.my-cnf=/data/mysqld_exporter-0.12.1.linux-amd64/.my.cnf</span></span><br></pre></td></tr></table></figure>

<h3 id="æ•°æ®æ”¶é›†"><a href="#æ•°æ®æ”¶é›†" class="headerlink" title="æ•°æ®æ”¶é›†"></a>æ•°æ®æ”¶é›†</h3><p>ä¸ºäº†èƒ½å¤Ÿè®© <code>Prometheus Server</code> èƒ½å¤Ÿä»å½“å‰ <code>node_exporter</code> è·å–åˆ°ç›‘æ§æ•°æ®ï¼Œè¿™é‡Œéœ€è¦ä¿®æ”¹ <code>Prometheus</code> é…ç½®æ–‡ä»¶ï¼Œç¼–è¾‘ <code>prometheus.yml</code> å¹¶åœ¨ <code>scrape_configs</code> èŠ‚ç‚¹ä¸‹æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line"><span class="attr">  - job_name:</span> <span class="string">'prometheus'</span></span><br><span class="line"><span class="attr">    static_configs:</span></span><br><span class="line"><span class="attr">      - targets:</span> <span class="string">['localhost:9090']</span></span><br><span class="line">  <span class="comment"># é‡‡é›†node exporterç›‘æ§æ•°æ®</span></span><br><span class="line"><span class="attr">  - job_name:</span> <span class="string">'node'</span></span><br><span class="line"><span class="attr">    static_configs:</span></span><br><span class="line"><span class="attr">      - targets:</span> <span class="string">['localhost:9100']</span></span><br></pre></td></tr></table></figure>

<p>é‡æ–°å¯åŠ¨ <code>Prometheus Server</code>ï¼Œè®¿é—® <a href="http://10.133.0.53:9090/" target="_blank" rel="noopener"><strong>http://10.133.0.53:9090</strong></a>ï¼Œè¿›å…¥åˆ° <code>Prometheus Server</code>ã€‚å¦‚æœè¾“å…¥ <code>up</code> å¹¶ä¸”ç‚¹å‡»æ‰§è¡ŒæŒ‰é’®ä»¥åï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/006y8mN6ly1g6df70foddj32cs0riwia.jpg" alt="image-20190826215234095"></p>
<p>å¦‚æœ <code>Prometheus</code> èƒ½å¤Ÿæ­£å¸¸ä» <code>node_exporter</code> è·å–æ•°æ®ï¼Œåˆ™ä¼šçœ‹åˆ°ä»¥ä¸‹ç»“æœï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">up&#123;instance="localhost:9090",job="prometheus"&#125;</span>	<span class="number">1</span></span><br><span class="line"><span class="string">up&#123;instance="localhost:9100",job="node"&#125;</span>	<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>&quot;1&quot;</code> è¡¨ç¤ºæ­£å¸¸ï¼Œåä¹‹ <code>&quot;0&quot;</code> åˆ™ä¸ºå¼‚å¸¸ã€‚</p>
<h3 id="æ•°æ®æ¨¡å‹"><a href="#æ•°æ®æ¨¡å‹" class="headerlink" title="æ•°æ®æ¨¡å‹"></a>æ•°æ®æ¨¡å‹</h3><p><code>Prometheus</code> å­˜å‚¨çš„æ˜¯ <a href="https://en.wikipedia.org/wiki/Time_series" target="_blank" rel="noopener"><strong>æ—¶åºæ•°æ®</strong></a>ï¼Œå³æŒ‰ç…§ç›¸åŒæ—¶åºï¼ˆç›¸åŒçš„åå­—å’Œæ ‡ç­¾ï¼‰ï¼Œä»¥æ—¶é—´ç»´åº¦å­˜å‚¨è¿ç»­çš„æ•°æ®çš„é›†åˆã€‚æ—¶åºï¼ˆ<code>Time Series</code>ï¼‰æ˜¯ç”±åå­—ï¼ˆ<code>Metric</code>ï¼‰ï¼Œä»¥åŠä¸€ç»„ <code>key/value</code> æ ‡ç­¾å®šä¹‰çš„ï¼Œå…·æœ‰ç›¸åŒçš„åå­—ä»¥åŠæ ‡ç­¾å±äºç›¸åŒæ—¶åºã€‚æ—¶åºçš„åå­—ç”± <code>ASCII</code> å­—ç¬¦ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€ä»¥åŠå†’å·ç»„æˆï¼Œå®ƒå¿…é¡»æ»¡è¶³æ­£åˆ™è¡¨è¾¾å¼ <code>[a-zA-Z_:][a-zA-Z0-9_:]*</code>, å…¶åå­—åº”è¯¥å…·æœ‰è¯­ä¹‰åŒ–ï¼Œä¸€èˆ¬è¡¨ç¤ºä¸€ä¸ªå¯ä»¥åº¦é‡çš„æŒ‡æ ‡ï¼Œä¾‹å¦‚ï¼š <code>http_requests_total</code>, å¯ä»¥è¡¨ç¤º <code>http</code> è¯·æ±‚çš„æ€»æ•°ã€‚</p>
<p>æ—¶åºçš„æ ‡ç­¾å¯ä»¥ä½¿ <code>Prometheus</code> çš„æ•°æ®æ›´åŠ ä¸°å¯Œï¼Œèƒ½å¤ŸåŒºåˆ†å…·ä½“ä¸åŒçš„å®ä¾‹ï¼Œä¾‹å¦‚ <code>http_requests_total{method=&quot;POST&quot;}</code> å¯ä»¥è¡¨ç¤ºæ‰€æœ‰ <code>Http</code> ä¸­çš„ <code>POST</code> è¯·æ±‚ã€‚æ ‡ç­¾åç§°ç”± <code>ASCII</code> å­—ç¬¦ï¼Œæ•°å­—ï¼Œä»¥åŠä¸‹åˆ’çº¿ç»„æˆï¼Œ å…¶ä¸­ <code>__</code> å¼€å¤´å±äº <code>Prometheus</code> ä¿ç•™ï¼Œæ ‡ç­¾çš„å€¼å¯ä»¥æ˜¯ä»»ä½• <code>Unicode</code> å­—ç¬¦ï¼Œæ”¯æŒä¸­æ–‡ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">&lt;metric</span> <span class="string">name&gt;&#123;&lt;label</span> <span class="string">name&gt;=&lt;label</span> <span class="string">value&gt;,</span> <span class="string">...&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="æ•°æ®å¯è§†åŒ–"><a href="#æ•°æ®å¯è§†åŒ–" class="headerlink" title="æ•°æ®å¯è§†åŒ–"></a>æ•°æ®å¯è§†åŒ–</h3><p><code>Prometheus UI</code> æä¾›äº†å¿«é€ŸéªŒè¯ <code>PromQL</code> ä»¥åŠä¸´æ—¶å¯è§†åŒ–æ”¯æŒçš„èƒ½åŠ›ï¼Œè€Œåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹å¼•å…¥ç›‘æ§ç³»ç»Ÿé€šå¸¸è¿˜éœ€è¦æ„å»ºå¯ä»¥é•¿æœŸä½¿ç”¨çš„ç›‘æ§æ•°æ®å¯è§†åŒ–é¢æ¿ï¼ˆ <a href="https://grafana.com/grafana/dashboards" target="_blank" rel="noopener"><strong>Dashboard</strong></a> ï¼‰ã€‚è¿™æ—¶ç”¨æˆ·å¯ä»¥è€ƒè™‘ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„å¯è§†åŒ–å·¥å…·å¦‚<code>Grafana</code>ï¼Œ<a href="https://grafana.com/" target="_blank" rel="noopener"><strong>Grafana</strong></a> æ˜¯ä¸€ä¸ªå¼€æºçš„å¯è§†åŒ–å¹³å°ï¼Œå¹¶ä¸”æä¾›äº†å¯¹ <code>Prometheus</code> çš„å®Œæ•´æ”¯æŒã€‚</p>
<p>å®‰è£… <code>Grafana</code>ï¼ˆä½¿ç”¨å‘å¯¼ï¼šå®‰è£… -&gt; æ·»åŠ æ•°æ®æº -&gt; åˆ›å»º Dashboard -&gt; é‚€è¯·æˆå‘˜ -&gt; å®‰è£…åº”ç”¨å’Œæ’ä»¶ï¼‰</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">dockeræ–¹å¼ï¼š</span></span><br><span class="line"><span class="string">docker</span> <span class="string">run</span> <span class="bullet">-d</span> <span class="bullet">-p</span> <span class="number">3000</span><span class="string">:3000</span> <span class="string">grafana/grafana</span></span><br><span class="line"></span><br><span class="line"><span class="string">äºŒè¿›åˆ¶åŒ…æ–¹å¼ï¼š</span></span><br><span class="line"><span class="string">wget</span> <span class="attr">https://dl.grafana.com/oss/release/grafana-6.3.3.linux-amd64.tar.gz</span></span><br><span class="line"><span class="string">tar</span> <span class="bullet">-zxvf</span> <span class="string">grafana-6.3.3.linux-amd64.tar.gz</span></span><br><span class="line"></span><br><span class="line"><span class="string">rpmæ–¹å¼ï¼š</span></span><br><span class="line"><span class="string">wget</span> <span class="attr">https://dl.grafana.com/oss/release/grafana-6.3.3-1.x86_64.rpm</span> </span><br><span class="line"><span class="string">sudo</span> <span class="string">yum</span> <span class="string">localinstall</span> <span class="string">grafana-6.3.3-1.x86_64.rpm</span> </span><br><span class="line"></span><br><span class="line"><span class="string">Pie</span> <span class="string">Chartæ’ä»¶ï¼š</span></span><br><span class="line"><span class="string">grafana-cli</span> <span class="string">plugins</span> <span class="string">install</span> <span class="string">grafana-piechart-panel</span></span><br></pre></td></tr></table></figure>

<p>è®¿é—® <a href="http://10.133.0.53:3000/" target="_blank" rel="noopener"><strong>http://10.133.0.53:3000</strong></a> å°±å¯ä»¥è¿›å…¥åˆ° <code>Grafana</code> çš„ç•Œé¢ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨è´¦æˆ· <code>admin/admin</code> è¿›è¡Œç™»å½•</p>
<h3 id="ä»»åŠ¡å’Œå®ä¾‹"><a href="#ä»»åŠ¡å’Œå®ä¾‹" class="headerlink" title="ä»»åŠ¡å’Œå®ä¾‹"></a>ä»»åŠ¡å’Œå®ä¾‹</h3><p>åœ¨ <code>Prometheus</code> ä¸­ï¼Œæ¯ä¸€ä¸ªæš´éœ²ç›‘æ§æ ·æœ¬æ•°æ®çš„ <code>HTTP</code> æœåŠ¡ç§°ä¸ºä¸€ä¸ªå®ä¾‹ã€‚ä¾‹å¦‚åœ¨å½“å‰ä¸»æœºä¸Šè¿è¡Œçš„ <code>node_exporter</code> å¯ä»¥è¢«ç§°ä¸ºä¸€ä¸ª<strong>å®ä¾‹</strong>ï¼ˆ<code>Instance</code>ï¼‰ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line"><span class="attr">  - job_name:</span> <span class="string">'prometheus'</span></span><br><span class="line"><span class="attr">    static_configs:</span></span><br><span class="line"><span class="attr">      - targets:</span> <span class="string">['localhost:9090']</span></span><br><span class="line"><span class="attr">  - job_name:</span> <span class="string">'node'</span></span><br><span class="line"><span class="attr">    static_configs:</span></span><br><span class="line"><span class="attr">      - targets:</span> <span class="string">['localhost:9100']</span></span><br></pre></td></tr></table></figure>

<p>è€Œä¸€ç»„ç”¨äºç›¸åŒé‡‡é›†ç›®çš„çš„å®ä¾‹ï¼Œæˆ–è€…åŒä¸€ä¸ªé‡‡é›†è¿›ç¨‹çš„å¤šä¸ªå‰¯æœ¬åˆ™é€šè¿‡ä¸€ä¸ª<strong>ä»»åŠ¡</strong>ï¼ˆ<code>Job</code>ï¼‰è¿›è¡Œç®¡ç†ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">*</span> <span class="attr">job:</span> <span class="string">node</span></span><br><span class="line">    <span class="string">*</span> <span class="string">instance</span> <span class="number">2</span><span class="string">:</span> <span class="number">1.2</span><span class="number">.3</span><span class="number">.4</span><span class="string">:9100</span></span><br><span class="line">    <span class="string">*</span> <span class="string">instance</span> <span class="number">4</span><span class="string">:</span> <span class="number">5.6</span><span class="number">.7</span><span class="number">.8</span><span class="string">:9100</span></span><br></pre></td></tr></table></figure>

<p>å½“å‰åœ¨æ¯ä¸€ä¸ª <code>Job</code> ä¸­ä¸»è¦ä½¿ç”¨äº†é™æ€é…ç½®ï¼ˆ<code>static_configs</code>ï¼‰çš„æ–¹å¼å®šä¹‰ç›‘æ§ç›®æ ‡ï¼Œ<code>Prometheus</code> è¿˜æ”¯æŒä¸ <code>Consul</code>ã€<code>Kubernetes</code> ç­‰è¿›è¡Œé›†æˆå®ç°è‡ªåŠ¨å‘ç°å®ä¾‹ï¼Œå¹¶ä»è¿™äº›å®ä¾‹ä¸Šè·å–ç›‘æ§æ•°æ®ã€‚å¯ä»¥è®¿é—® <a href="http://10.133.0.53:9090/targets" target="_blank" rel="noopener"><strong>targets</strong></a> ç›´æ¥æŸ¥çœ‹å½“å‰æ‰€æœ‰çš„ä»»åŠ¡ä»¥åŠæ¯ä¸ªä»»åŠ¡å¯¹åº”çš„å®ä¾‹ä¿¡æ¯ã€‚</p>
<h2 id="æœåŠ¡å‘ç°"><a href="#æœåŠ¡å‘ç°" class="headerlink" title="æœåŠ¡å‘ç°"></a>æœåŠ¡å‘ç°</h2><h3 id="Push-vs-Pull"><a href="#Push-vs-Pull" class="headerlink" title="Push vs Pull"></a>Push vs Pull</h3><p><img src="https://github.com/huiraoo/prometheus-book/raw/master/sd/static/pulls_vs_push.png" alt="Push"></p>
<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œå±•ç¤ºäº† <code>Push</code> ç³»ç»Ÿå’Œ <code>Pull</code> ç³»ç»Ÿçš„æ ¸å¿ƒå·®å¼‚ã€‚ç›¸è¾ƒäº <code>Push</code> æ¨¡å¼ï¼Œ<code>Pull</code> æ¨¡å¼çš„ä¼˜ç‚¹å¯ä»¥ç®€å•æ€»ç»“ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>åªè¦ <code>exporter</code> åœ¨è¿è¡Œï¼Œä½ å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ï¼ˆæ¯”å¦‚åœ¨æœ¬åœ°ï¼‰ï¼Œæ­å»ºä½ çš„ç›‘æ§ç³»ç»Ÿï¼›</li>
<li>ä½ å¯ä»¥æ›´å®¹æ˜“çš„æŸ¥çœ‹ç›‘æ§ç›®æ ‡å®ä¾‹çš„å¥åº·çŠ¶æ€ï¼Œå¹¶ä¸”å¯ä»¥å¿«é€Ÿå®šä½æ•…éšœï¼›</li>
<li>æ›´åˆ©äºæ„å»º <code>DevOps</code> æ–‡åŒ–çš„å›¢é˜Ÿï¼›</li>
<li>æ¾è€¦åˆçš„æ¶æ„æ¨¡å¼æ›´é€‚åˆäºäº‘åŸç”Ÿçš„éƒ¨ç½²ç¯å¢ƒã€‚</li>
</ul>
<h3 id="Consul"><a href="#Consul" class="headerlink" title="Consul"></a>Consul</h3><p><a href="https://www.consul.io" target="_blank" rel="noopener"><strong>Consul</strong></a>ï¼šç”± <code>HashiCorp</code> å¼€å‘çš„ä¸€ä¸ªæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒçš„åˆ†å¸ƒå¼æœåŠ¡å‘ç°å’Œé”®å€¼å¯¹å­˜å‚¨æœåŠ¡çš„å¼€æºè½¯ä»¶ï¼Œè¢«å¤§é‡åº”ç”¨äºåŸºäºå¾®æœåŠ¡çš„è½¯ä»¶æ¶æ„å½“ä¸­ï¼Œä½¿ç”¨ <code>Golang</code> è¯­è¨€å¼€å‘ã€‚</p>
<h4 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p>ä¸‹è½½<a href="https://www.consul.io/downloads.html" target="_blank" rel="noopener"><strong>äºŒè¿›åˆ¶åŒ…</strong></a></p>
<h4 id="ä¸-Prometheus-é›†æˆ"><a href="#ä¸-Prometheus-é›†æˆ" class="headerlink" title="ä¸ Prometheus é›†æˆ"></a>ä¸ Prometheus é›†æˆ</h4><h2 id="PromQL"><a href="#PromQL" class="headerlink" title="PromQL"></a>PromQL</h2><p>PromQLï¼ˆ<code>Prometheus Query Language</code>ï¼‰ï¼Œæ˜¯ <code>Prometheus</code> è‡ªå·±å¼€å‘çš„æ•°æ®æŸ¥è¯¢ <code>DSL</code> è¯­è¨€ï¼Œ<code>PromQL</code> ä½œä¸º<code>Prometheus</code> çš„æ ¸å¿ƒèƒ½åŠ›é™¤äº†å®ç°æ•°æ®çš„å¯¹å¤–æŸ¥è¯¢å’Œå±•ç°ï¼ŒåŒæ—¶å‘Šè­¦ç›‘æ§ä¹Ÿæ˜¯ä¾èµ– <code>PromQL</code> å®ç°çš„ã€‚</p>
<h3 id="æ—¶é—´åºåˆ—"><a href="#æ—¶é—´åºåˆ—" class="headerlink" title="æ—¶é—´åºåˆ—"></a>æ—¶é—´åºåˆ—</h3><p>Prometheus å¯ä»¥é‡‡é›†åˆ°å½“å‰ä¸»æœºæ‰€æœ‰ç›‘æ§æŒ‡æ ‡çš„æ ·æœ¬æ•°æ®ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># HELP node_cpu Seconds the cpus spent in each mode.</span></span><br><span class="line"><span class="comment"># TYPE node_cpu counter</span></span><br><span class="line"><span class="string">node_cpu&#123;cpu="cpu0",mode="idle"&#125;</span> <span class="number">362812.7890625</span></span><br><span class="line"><span class="comment"># HELP node_load1 1m load average.</span></span><br><span class="line"><span class="comment"># TYPE node_load1 gauge</span></span><br><span class="line"><span class="string">node_load1</span> <span class="number">3.0703125</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­é # å¼€å¤´çš„æ¯ä¸€è¡Œè¡¨ç¤ºå½“å‰ node_exporter é‡‡é›†åˆ°çš„ä¸€ä¸ªç›‘æ§æ ·æœ¬ï¼šnode_cpu å’Œ node_load1 è¡¨æ˜äº†å½“å‰æŒ‡æ ‡çš„åç§°ã€å¤§æ‹¬å·ä¸­çš„æ ‡ç­¾åˆ™åæ˜ äº†å½“å‰æ ·æœ¬çš„ä¸€äº›ç‰¹å¾å’Œç»´åº¦ã€æµ®ç‚¹æ•°åˆ™æ˜¯è¯¥ç›‘æ§æ ·æœ¬çš„å…·ä½“å€¼ã€‚</p>
<h3 id="æ ·æœ¬"><a href="#æ ·æœ¬" class="headerlink" title="æ ·æœ¬"></a>æ ·æœ¬</h3><p>Prometheus ä¼šå°†æ‰€æœ‰é‡‡é›†åˆ°çš„æ ·æœ¬æ•°æ®ä»¥æ—¶é—´åºåˆ—ï¼ˆtime-seriesï¼‰çš„æ–¹å¼ä¿å­˜åœ¨å†…å­˜æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸”å®šæ—¶ä¿å­˜åˆ°ç¡¬ç›˜ä¸Šã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œå¯ä»¥å°† time-series ç†è§£ä¸ºä¸€ä¸ªä»¥æ—¶é—´ä¸º Y è½´çš„æ•°å­—çŸ©é˜µï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">^</span></span><br><span class="line"><span class="string">â”‚</span>   <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span>   <span class="string">.</span> <span class="string">.</span>   <span class="string">node_cpu&#123;cpu="cpu0",mode="idle"&#125;</span></span><br><span class="line"><span class="string">â”‚</span>     <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span>   <span class="string">node_cpu&#123;cpu="cpu0",mode="system"&#125;</span></span><br><span class="line"><span class="string">â”‚</span>     <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span>   <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span>   <span class="string">node_load1&#123;&#125;</span></span><br><span class="line"><span class="string">â”‚</span>     <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span> <span class="string">.</span>   <span class="string">.</span> <span class="string">.</span>  </span><br><span class="line"><span class="string">v</span></span><br><span class="line">  <span class="string">&lt;------------------</span> <span class="string">æ—¶é—´</span> <span class="bullet">----------------&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ time-series ä¸­çš„æ¯ä¸€ä¸ªç‚¹ç§°ä¸ºä¸€ä¸ªæ ·æœ¬ï¼ˆsampleï¼‰ï¼Œæ ·æœ¬ç”±ä»¥ä¸‹ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>æŒ‡æ ‡ (metric)ï¼šmetric name å’Œæè¿°å½“å‰æ ·æœ¬ç‰¹å¾çš„ label setsã€‚</li>
<li>æ—¶é—´æˆ³ (timestamp)ï¼šä¸€ä¸ªç²¾ç¡®åˆ°æ¯«ç§’çš„æ—¶é—´æˆ³ã€‚</li>
<li>æ ·æœ¬å€¼ (value)ï¼š ä¸€ä¸ª folat64 çš„æµ®ç‚¹å‹æ•°æ®è¡¨ç¤ºå½“å‰æ ·æœ¬çš„å€¼ã€‚</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">&lt;---------------</span> <span class="string">metric</span> <span class="bullet">---------------------&gt;&lt;-timestamp</span> <span class="bullet">-&gt;&lt;-value-&gt;</span></span><br><span class="line"><span class="string">http_request_total&#123;status="200",</span> <span class="string">method="GET"&#125;@1434417560938</span> <span class="string">=&gt;</span> <span class="number">94355</span></span><br><span class="line"><span class="string">http_request_total&#123;status="200",</span> <span class="string">method="GET"&#125;@1434417561287</span> <span class="string">=&gt;</span> <span class="number">94334</span></span><br><span class="line"></span><br><span class="line"><span class="string">http_request_total&#123;status="404",</span> <span class="string">method="GET"&#125;@1434417560938</span> <span class="string">=&gt;</span> <span class="number">38473</span></span><br><span class="line"><span class="string">http_request_total&#123;status="404",</span> <span class="string">method="GET"&#125;@1434417561287</span> <span class="string">=&gt;</span> <span class="number">38544</span></span><br><span class="line"></span><br><span class="line"><span class="string">http_request_total&#123;status="200",</span> <span class="string">method="POST"&#125;@1434417560938</span> <span class="string">=&gt;</span> <span class="number">4748</span></span><br><span class="line"><span class="string">http_request_total&#123;status="200",</span> <span class="string">method="POST"&#125;@1434417561287</span> <span class="string">=&gt;</span> <span class="number">4785</span></span><br></pre></td></tr></table></figure>

<h3 id="æŒ‡æ ‡-Metric"><a href="#æŒ‡æ ‡-Metric" class="headerlink" title="æŒ‡æ ‡ (Metric)"></a>æŒ‡æ ‡ (Metric)</h3><p>åœ¨å½¢å¼ä¸Šï¼Œæ‰€æœ‰çš„æŒ‡æ ‡ (Metric) éƒ½é€šè¿‡å¦‚ä¸‹æ ¼å¼æ ‡ç¤ºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">&lt;metric</span> <span class="string">name&gt;&#123;&lt;label</span> <span class="string">name&gt;=&lt;label</span> <span class="string">value&gt;,</span> <span class="string">...&#125;</span></span><br></pre></td></tr></table></figure>

<p>æŒ‡æ ‡åç§°ï¼ˆmetric nameï¼‰ï¼šåæ˜ ç›‘æ§æ ·æœ¬çš„å«ä¹‰ã€‚</p>
<p>æ ‡ç­¾ï¼ˆlabelï¼‰ï¼šåæ˜ å½“å‰æ ·æœ¬çš„ç‰¹å¾ç»´åº¦ã€‚</p>
<p>æŒ‡æ ‡ç±»å‹ï¼šCounterï¼ˆè®¡æ•°å™¨ï¼‰ã€Gaugeï¼ˆä»ªè¡¨ç›˜ï¼‰ã€Histogramï¼ˆç›´æ–¹å›¾ï¼‰ã€Summaryï¼ˆæ‘˜è¦ï¼‰</p>
<p>Counterï¼šåªå¢ä¸å‡çš„è®¡æ•°å™¨</p>
<p>Gaugeï¼šå¯å¢å¯å‡çš„ä»ªè¡¨ç›˜</p>
<p>ä½¿ç”¨ Histogram å’Œ Summary åˆ†ææ•°æ®åˆ†å¸ƒæƒ…å†µ</p>
<h2 id="å‘Šè­¦"><a href="#å‘Šè­¦" class="headerlink" title="å‘Šè­¦"></a>å‘Šè­¦</h2>]]></content>
      <categories>
        <category>Prometheus</category>
      </categories>
  </entry>
  <entry>
    <title>é¡¹ç›®</title>
    <url>/blog/2019/10/22/project/</url>
    <content><![CDATA[<h2 id="ç›‘æ§å‘Šè­¦"><a href="#ç›‘æ§å‘Šè­¦" class="headerlink" title="ç›‘æ§å‘Šè­¦"></a>ç›‘æ§å‘Šè­¦</h2><p><strong>èƒŒæ™¯</strong>ï¼šä¸ºäº†æ‰˜ç®¡å·²ä¸Šçº¿ <code>MySQL</code> ç³»ç»Ÿï¼Œå»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»ï¼Œæå‡ä¸šåŠ¡ç³»ç»Ÿç¨³å®šæ€§ï¼Œè¾¾åˆ°ä»¥ä¸‹ <code>3</code> ä¸ªç›®çš„ï¼š</p>
<ul>
<li><strong>å‘Šè­¦</strong>ï¼šå½“ç³»ç»Ÿå‡ºç°æˆ–è€…å³å°†å‡ºç°æ•…éšœæ—¶ï¼Œç›‘æ§ç³»ç»Ÿéœ€è¦è¿…é€Ÿååº”å¹¶é€šçŸ¥ç®¡ç†å‘˜ï¼Œä»è€Œèƒ½å¤Ÿå¯¹é—®é¢˜è¿›è¡Œå¿«é€Ÿçš„å¤„ç†æˆ–è€…æå‰é¢„é˜²é—®é¢˜çš„å‘ç”Ÿï¼Œé¿å…å‡ºç°å¯¹ä¸šåŠ¡çš„å½±å“ã€‚</li>
<li><strong>æ•…éšœåˆ†æä¸å®šä½</strong>ï¼šå½“é—®é¢˜å‘ç”Ÿåï¼Œéœ€è¦å¯¹é—®é¢˜è¿›è¡Œè°ƒæŸ¥å’Œå¤„ç†ã€‚é€šè¿‡å¯¹ä¸åŒç›‘æ§ç›‘æ§ä»¥åŠå†å²æ•°æ®çš„åˆ†æï¼Œèƒ½å¤Ÿæ‰¾åˆ°å¹¶è§£å†³æ ¹æºé—®é¢˜ã€‚</li>
<li><strong>æ•°æ®å¯è§†åŒ–</strong>ï¼šé€šè¿‡å¯è§†åŒ–ä»ªè¡¨ç›˜èƒ½å¤Ÿç›´æ¥è·å–ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ã€èµ„æºä½¿ç”¨æƒ…å†µã€ä»¥åŠæœåŠ¡è¿è¡ŒçŠ¶æ€ç­‰ç›´è§‚çš„ä¿¡æ¯ã€‚</li>
</ul>
<p><strong>æŠ€æœ¯æ–¹æ¡ˆ</strong>ï¼š[<a href="https://prometheus.io" target="_blank" rel="noopener"><strong>Prometheus</strong></a>] [<a href="https://grafana.com" target="_blank" rel="noopener"><strong>Grafana</strong></a>] [<a href="https://www.consul.io/" target="_blank" rel="noopener"><strong>Consul</strong></a>] [<a href="https://www.percona.com/doc/percona-monitoring-and-management/index.html" target="_blank" rel="noopener"><strong>PMM</strong></a>] </p>
<h2 id="è¿ç»´å·¥å•"><a href="#è¿ç»´å·¥å•" class="headerlink" title="è¿ç»´å·¥å•"></a>è¿ç»´å·¥å•</h2><p><strong>èƒŒæ™¯</strong>ï¼šæ—¥å¸¸è¿ç»´é—®é¢˜ç¹å¤šï¼Œæé«˜è¿ç»´æ•ˆç‡ã€‚</p>
<p><strong>æŠ€æœ¯æ–¹æ¡ˆ</strong>ï¼š[<a href="https://golang.google.cn/" target="_blank" rel="noopener"><strong>Golang</strong></a>] [<a href="https://cn.vuejs.org/" target="_blank" rel="noopener"><strong>Vue</strong></a>] [<a href="https://element.eleme.cn/#/" target="_blank" rel="noopener"><strong>Element UI</strong></a>] [<a href="https://www.heidisql.com/" target="_blank" rel="noopener"><strong>HeidiSQL</strong></a>] [<a href="https://www.percona.com/downloads/percona-toolkit" target="_blank" rel="noopener"><strong>Percona Toolkit</strong></a>] </p>
<h2 id="å¤‡ä»½"><a href="#å¤‡ä»½" class="headerlink" title="å¤‡ä»½"></a>å¤‡ä»½</h2><p><strong>èƒŒæ™¯</strong>ï¼šä¸Šçº¿é¡¹ç›®ç³»ç»Ÿï¼ˆ<code>MySQL</code>ã€<code>Oracle</code>ã€<code>Server SQL</code>ã€å°å‹æœºã€etc. ï¼‰ä¹‹å‰æœªåšå¤‡ä»½æ¢å¤æ¼”ç»ƒï¼Œä¹Ÿæœ‰éƒ¨åˆ†ä¸Šçº¿ç³»ç»Ÿæœªå¤‡ä»½ï¼Œå­˜åœ¨å·¨å¤§çš„æ•°æ®å®‰å…¨é£é™©ï¼Œå…¨é‡æ’æŸ¥æ¶ˆé™¤éšæ‚£ã€‚</p>
<p><strong>æŠ€æœ¯æ–¹æ¡ˆ</strong>ï¼š[<a href="https://www.commvault.com.cn/" target="_blank" rel="noopener"><strong>Commvault</strong></a>] [<a href="https://www.percona.com/software/mysql-database/percona-xtrabackup" target="_blank" rel="noopener"><strong>Percona XtraBackup</strong></a>]</p>
<h2 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h2><p><strong>èƒŒæ™¯</strong>ï¼šæ•°æ®åº“ <code>slowlog</code> å‘å¸ƒæ¯å‘¨æŠ¥å‘Šï¼Œéœ€è¦ä»ç®¡ç†è§†è§’é©±åŠ¨è´¨é‡æå‡ï¼Œå±•ç°æŠ€æœ¯å¹³å°çš„ä»·å€¼ã€‚</p>
<p><strong>æŠ€æœ¯æ–¹æ¡ˆ</strong>ï¼š[<a href="https://www.aliyun.com/product/hdm" target="_blank" rel="noopener"><strong>HDM</strong></a>] [<a href="https://www.percona.com/downloads/percona-toolkit" target="_blank" rel="noopener"><strong>Percona Toolkit</strong></a>]</p>
<h2 id="å ¡å’æœº"><a href="#å ¡å’æœº" class="headerlink" title="å ¡å’æœº"></a>å ¡å’æœº</h2><p><strong>èƒŒæ™¯</strong>ï¼šæ ¸å¿ƒåŠŸèƒ½æ˜¯ç”¨äºå®ç°å¯¹è¿ç»´æ“ä½œäººå‘˜çš„<strong>æƒé™æ§åˆ¶</strong>ä¸<strong>æ“ä½œè¡Œä¸ºå®¡è®¡</strong>ï¼Œ<a href="http://www.openskill.cn/article/260" target="_blank" rel="noopener"><strong>å·¥ä½œåŸç†</strong></a></p>
<p><strong>æŠ€æœ¯æ–¹æ¡ˆ</strong>ï¼š[<a href="http://www.jumpserver.org" target="_blank" rel="noopener"><strong>Jumpserver</strong></a>]</p>
<h2 id="å®¹ç¾"><a href="#å®¹ç¾" class="headerlink" title="å®¹ç¾"></a>å®¹ç¾</h2><p><strong>èƒŒæ™¯</strong>ï¼šä¸ºè§£å†³æœ¬åœ°æœºæˆ¿å‘ç”Ÿé‡å¤§ç¾éš¾ï¼Œæ•°æ®ä¸å¯æ¢å¤ï¼Œç‰¹åœ¨çº¢å²›å»ºç«‹çš„ç¾å¤‡æ•°æ®ä¸­å¿ƒã€‚</p>
<p><strong>æŠ€æœ¯æ–¹æ¡ˆ</strong>ï¼š[<strong><a href="https://huiraoo.github.io/blog/2019/09/04/mysql-disaster/">å®¹ç¾</a></strong>]</p>
]]></content>
      <categories>
        <category>é¡¹ç›®</category>
      </categories>
  </entry>
  <entry>
    <title>Python</title>
    <url>/blog/2019/10/22/python/</url>
    <content><![CDATA[<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-26-091030.jpeg" alt></p>
<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ul>
<li><a href="https://huiraoo.github.io/blog/2019/10/24/python-introduction/">Python Â· ç®€ä»‹å®‰è£…</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/24/python-datatype/">Python Â· æ•°æ®ç±»å‹</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/24/python-control/">Python Â· æ§åˆ¶æµ</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/24/python-function/">Python Â· å‡½æ•°</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/24/python-module/">Python Â· æ¨¡å—å’ŒåŒ…</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/24/python-oop/">Python Â· é¢å‘å¯¹è±¡ç¼–ç¨‹</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/24/python-exception/">Python Â· å¼‚å¸¸</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/24/python-io/">Pyhton Â· I/O ç¼–ç¨‹</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/24/python-threads/">Python Â· è¿›ç¨‹ä¸çº¿ç¨‹</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/24/python-regular/">Python Â· æ­£åˆ™è¡¨è¾¾å¼</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/24/python-socket/">Python Â· ç½‘ç»œç¼–ç¨‹</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/24/python-testing/">Python Â· æµ‹è¯•</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/24/python-rules/">Python Â· å¼€å‘è§„èŒƒ</a></li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· æ¡ˆä¾‹åˆ†æ Â· ç£ç›˜ç©ºé—´ä¸è¶³</title>
    <url>/blog/2019/10/21/mysql-case-diskspace/</url>
    <content><![CDATA[<h2 id="é—®é¢˜ç°è±¡"><a href="#é—®é¢˜ç°è±¡" class="headerlink" title="é—®é¢˜ç°è±¡"></a>é—®é¢˜ç°è±¡</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ df -h</span><br><span class="line">Filesystem                               Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos_cosmoim--zdyq05-root  <span class="number">100</span>G   <span class="number">13</span>G   <span class="number">87</span>G  <span class="number">13</span>% /</span><br><span class="line">devtmpfs                                  <span class="number">63</span>G     <span class="number">0</span>   <span class="number">63</span>G   <span class="number">0</span>% /dev</span><br><span class="line">tmpfs                                     <span class="number">63</span>G     <span class="number">0</span>   <span class="number">63</span>G   <span class="number">0</span>% /dev/shm</span><br><span class="line">tmpfs                                     <span class="number">63</span>G  <span class="number">130</span>M   <span class="number">63</span>G   <span class="number">1</span>% /run</span><br><span class="line">tmpfs                                     <span class="number">63</span>G     <span class="number">0</span>   <span class="number">63</span>G   <span class="number">0</span>% /sys/fs/cgroup</span><br><span class="line">/dev/sda1                                <span class="number">497</span>M  <span class="number">172</span>M  <span class="number">326</span>M  <span class="number">35</span>% /boot</span><br><span class="line">/dev/mapper/centos_cosmoim--zdyq05-data  <span class="number">888</span>G  <span class="number">581</span>G  <span class="number">308</span>G  <span class="number">66</span>% /<span class="keyword">data</span></span><br><span class="line">tmpfs                                     <span class="number">13</span>G   <span class="number">12</span>K   <span class="number">13</span>G   <span class="number">1</span>% /run/user/<span class="number">42</span></span><br><span class="line">tmpfs                                     <span class="number">13</span>G     <span class="number">0</span>   <span class="number">13</span>G   <span class="number">0</span>% /run/user/<span class="number">1001</span></span><br><span class="line">tmpfs                                     <span class="number">13</span>G     <span class="number">0</span>   <span class="number">13</span>G   <span class="number">0</span>% /run/user/<span class="number">1002</span></span><br><span class="line">tmpfs                                     <span class="number">13</span>G     <span class="number">0</span>   <span class="number">13</span>G   <span class="number">0</span>% /run/user/<span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h2><p><strong>æ–‡ä»¶æ’åºå‘½ä»¤</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ du -sxh /dir/* | sort -rh | head -<span class="number">5</span></span><br><span class="line"></span><br><span class="line">du</span><br><span class="line">-sï¼šä»…æ˜¾ç¤ºæ€»è®¡</span><br><span class="line">-xï¼šä»¥ä¸€å¼€å§‹çš„æ–‡ä»¶ç³»ç»Ÿä¸ºå‡†ï¼Œå¿½ç•¥å…¶ä»–ä¸åŒæ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•</span><br><span class="line">-hï¼šä»¥å¯è¯»å½¢å¼æ˜¾ç¤ºæ–‡ä»¶å¤§å°</span><br><span class="line"></span><br><span class="line">sort</span><br><span class="line">-rï¼šå€’åºæ’åº</span><br><span class="line">-hï¼šä»¥å¯è¯»æ•°å­—è¿›è¡Œæ¯”è¾ƒ</span><br><span class="line"></span><br><span class="line">head</span><br><span class="line">-nï¼šæ‰“å°æ–‡æœ¬çš„å‰nè¡Œ</span><br></pre></td></tr></table></figure>

<p><strong>å¤šæ¬¡æ‰§è¡ŒæŸ¥æ‰¾æœ€å¤§æ–‡ä»¶</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ du -sxh /<span class="keyword">data</span>/* | sort -rh | head -<span class="number">5</span></span><br><span class="line"><span class="number">339</span>G	/<span class="keyword">data</span>/mysql</span><br><span class="line"><span class="number">243</span>G	/<span class="keyword">data</span>/backup</span><br><span class="line"><span class="number">4.0</span>K	/<span class="keyword">data</span>/backup.sh</span><br><span class="line"></span><br><span class="line">$ du -sxh /<span class="keyword">data</span>/mysql/* | sort -rh | head -<span class="number">5</span></span><br><span class="line"><span class="number">267</span>G	/<span class="keyword">data</span>/mysql/cosmo_im_1004</span><br><span class="line"><span class="number">1.1</span>G	/<span class="keyword">data</span>/mysql/mysql-binlog.<span class="number">000944</span></span><br><span class="line"><span class="number">1.1</span>G	/<span class="keyword">data</span>/mysql/mysql-binlog.<span class="number">000943</span></span><br><span class="line"><span class="number">1.1</span>G	/<span class="keyword">data</span>/mysql/mysql-binlog.<span class="number">000942</span></span><br><span class="line"><span class="number">1.1</span>G	/<span class="keyword">data</span>/mysql/mysql-binlog.<span class="number">000941</span></span><br><span class="line"></span><br><span class="line">$ du -sxh /<span class="keyword">data</span>/mysql/cosmo_im_1004/* | sort -rh | head -<span class="number">5</span></span><br><span class="line"><span class="number">231</span>G	/<span class="keyword">data</span>/mysql/cosmo_im_1004/bns_pm_pokayoke.ibd</span><br><span class="line"><span class="number">3.8</span>G	/<span class="keyword">data</span>/mysql/cosmo_im_1004/bns_pm_scanscehistory.ibd</span><br><span class="line"><span class="number">3.5</span>G	/<span class="keyword">data</span>/mysql/cosmo_im_1004/bns_pm_scanhistory_month.ibd</span><br><span class="line"><span class="number">3.4</span>G	/<span class="keyword">data</span>/mysql/cosmo_im_1004/bns_io_pm_pokayoke.ibd</span><br><span class="line"><span class="number">3.0</span>G	/<span class="keyword">data</span>/mysql/cosmo_im_1004/bns_pm_operation.ibd</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆï¼Œç¡®å®šæœ€å¤§æ–‡ä»¶æ˜¯ <code>/data/mysql/cosmo_im_1004/bns_pm_pokayoke.ibd</code></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>CentOS 7 å®‰è£… Python pip</title>
    <url>/blog/2019/10/21/centos7-pip/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><code>CentOS 7.x</code> é»˜è®¤å®‰è£…çš„ç‰ˆæœ¬ä¸º <code>python 2.7.5</code>ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰å®‰è£… <code>pip</code></p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p><strong>yum å®‰è£…</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ yum -y install epel-release</span><br><span class="line">$ yum -y install python-pip</span><br></pre></td></tr></table></figure>

<p><strong>è„šæœ¬å®‰è£…</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py</span><br><span class="line">$ python get-pip.py</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· è¯¯æ“ä½œåœºæ™¯ä¸‹æ•°æ®å¿«é€Ÿæ¢å¤</title>
    <url>/blog/2019/10/21/mysql-rollback/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>çº¿ä¸Šç¯å¢ƒæ ¸å¿ƒä¸šåŠ¡æ•°æ®ï¼Œ<code>delete/update</code> æ“ä½œä¸€å¼ è¡¨ï¼Œå¿˜åŠ  <code>where</code> é™åˆ¶æ¡ä»¶ï¼Œ<strong>å¦‚ä½•å¿«é€Ÿæ¢å¤ï¼Ÿ</strong></p>
<h2 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h2><ul>
<li><strong>å¤‡ä»½æ¢å¤</strong>ï¼šå…ˆç”¨å…¨é‡å¤‡ä»½æ¢å¤å®ä¾‹ï¼Œå†åˆ©ç”¨å¢é‡ <code>binlog</code> å¤‡ä»½æ¢å¤åˆ°è¯¯æ“ä½œä¹‹å‰çš„çŠ¶æ€ï¼Œ<strong>è´¹æ—¶è´¹åŠ›ï¼</strong></li>
<li><strong>ç¬¬ä¸‰æ–¹å·¥å…·</strong>ï¼š<a href="https://github.com/danfengcao/binlog2sql" target="_blank" rel="noopener">binlog2sql</a>ï¼ˆæ”¯æŒ <code>DML Delete/Update</code> ç­‰è¯­å¥å›æ»šï¼Œä¸æ”¯æŒ <code>DDL Drop</code> ç­‰è¯­å¥å›æ»šï¼‰</li>
</ul>
<h2 id="binlog2sql-å·¥å…·å®æˆ˜"><a href="#binlog2sql-å·¥å…·å®æˆ˜" class="headerlink" title="binlog2sql å·¥å…·å®æˆ˜"></a>binlog2sql å·¥å…·å®æˆ˜</h2><h3 id="æ”¯æŒ"><a href="#æ”¯æŒ" class="headerlink" title="æ”¯æŒ"></a>æ”¯æŒ</h3><ul>
<li>MySQL 5.6/5.7</li>
<li>Deleteã€Update</li>
</ul>
<h3 id="è¦æ±‚"><a href="#è¦æ±‚" class="headerlink" title="è¦æ±‚"></a>è¦æ±‚</h3><ul>
<li><strong>MySQL é…ç½®è¦æ±‚</strong></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">server_id = <span class="number">1</span></span><br><span class="line">log_bin = /<span class="keyword">data</span>/mysql/mysql-bin.log</span><br><span class="line">binlog_format = row</span><br><span class="line">binlog_row_image = full</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">'server_id'</span>;</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Variable_name | Value   |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| server_id     | <span class="number">3306100</span> |</span><br><span class="line">+---------------+---------+</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like <span class="string">'log_bin%'</span>;</span><br><span class="line">+---------------------------------+--------------------------------+</span><br><span class="line">| Variable_name                   | Value                          |</span><br><span class="line">+---------------------------------+--------------------------------+</span><br><span class="line">| log_bin                         | ON                             |</span><br><span class="line">| log_bin_basename                | /<span class="keyword">data</span>/mysql/mysql-binlog       |                        </span><br><span class="line">+---------------------------------+--------------------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like <span class="string">'binlog_format'</span>;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| binlog_format | ROW   |</span><br><span class="line">+---------------+-------+</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like <span class="string">'binlog_row_image'</span>;</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| binlog_row_image | FULL  |</span><br><span class="line">+------------------+-------+</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>MySQL æƒé™è¦æ±‚</strong>ï¼š<code>SELECT</code>ã€<code>REPLICATION SLAVE</code>ã€<code>REPLICATION CLIENT</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show grants for 'cosmo_t'\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">Grants for cosmo_t@%: <span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span>, <span class="keyword">UPDATE</span>, <span class="keyword">DELETE</span>, <span class="keyword">CREATE</span>, <span class="keyword">DROP</span>, RELOAD, <span class="keyword">SHUTDOWN</span>, PROCESS, <span class="keyword">FILE</span>, <span class="keyword">REFERENCES</span>, <span class="keyword">INDEX</span>, <span class="keyword">ALTER</span>, <span class="keyword">SHOW</span> <span class="keyword">DATABASES</span>, SUPER, <span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> <span class="keyword">TABLES</span>, <span class="keyword">LOCK</span> <span class="keyword">TABLES</span>, <span class="keyword">EXECUTE</span>, <span class="keyword">REPLICATION</span> <span class="keyword">SLAVE</span>, <span class="keyword">REPLICATION</span> <span class="keyword">CLIENT</span>, <span class="keyword">CREATE</span> <span class="keyword">VIEW</span>, <span class="keyword">SHOW</span> <span class="keyword">VIEW</span>, <span class="keyword">CREATE</span> ROUTINE, <span class="keyword">ALTER</span> ROUTINE, <span class="keyword">CREATE</span> <span class="keyword">USER</span>, <span class="keyword">EVENT</span>, <span class="keyword">TRIGGER</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'cosmo_t'</span>@<span class="string">'%'</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>ç”³è¯·ç‰¹æƒè´¦å·ï¼Œç™»å½•æœåŠ¡å™¨</strong></li>
</ul>
<h3 id="æ“ä½œæ­¥éª¤"><a href="#æ“ä½œæ­¥éª¤" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><ul>
<li><p>å®‰è£… <a href="https://huiraoo.github.io/blog/2019/10/21/centos7-pip/">pip</a></p>
</li>
<li><p>å®‰è£… <a href="https://github.com/danfengcao/binlog2sql" target="_blank" rel="noopener">binlog2sql</a></p>
</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ cd /usr/local/src</span><br><span class="line">$ git clone https://github.com/danfengcao/binlog2sql.git &amp;&amp; cd binlog2sql</span><br><span class="line">$ pip install -r requirements.txt</span><br></pre></td></tr></table></figure>

<ul>
<li>æ ¹æ®è¯¯æ“ä½œæ—¶é—´ï¼Œç¡®å®š <code>binlog</code> æ–‡ä»¶</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mysql&gt; show master status;</span><br><span class="line">+---------------------+-----------+--------------+------------------+-------------------+</span><br><span class="line">| File                | Position  | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+---------------------+-----------+--------------+------------------+-------------------+</span><br><span class="line">| mysql-bin.<span class="number">000020</span>    | <span class="number">576640842</span> |              |                  |                   |</span><br><span class="line">+---------------------+-----------+--------------+------------------+-------------------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">$ ll /<span class="keyword">data</span>/mysql | grep mysql-bin</span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Oct <span class="number">23</span> <span class="number">03</span>:<span class="number">03</span> mysql-binlog.<span class="number">000224</span></span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Oct <span class="number">24</span> <span class="number">12</span>:<span class="number">25</span> mysql-binlog.<span class="number">000225</span></span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Oct <span class="number">25</span> <span class="number">18</span>:<span class="number">32</span> mysql-binlog.<span class="number">000226</span></span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Oct <span class="number">27</span> <span class="number">00</span>:<span class="number">21</span> mysql-binlog.<span class="number">000227</span></span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Oct <span class="number">28</span> <span class="number">05</span>:<span class="number">45</span> mysql-binlog.<span class="number">000228</span></span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Oct <span class="number">29</span> <span class="number">12</span>:<span class="number">32</span> mysql-binlog.<span class="number">000229</span></span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Oct <span class="number">30</span> <span class="number">19</span>:<span class="number">00</span> mysql-binlog.<span class="number">000230</span></span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Nov  <span class="number">1</span> <span class="number">16</span>:<span class="number">30</span> mysql-binlog.<span class="number">000231</span></span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Nov  <span class="number">3</span> <span class="number">00</span>:<span class="number">20</span> mysql-binlog.<span class="number">000232</span></span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Nov  <span class="number">4</span> <span class="number">16</span>:<span class="number">47</span> mysql-binlog.<span class="number">000233</span></span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql <span class="number">1.1</span>G Nov  <span class="number">6</span> <span class="number">00</span>:<span class="number">21</span> mysql-binlog.<span class="number">000234</span></span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql <span class="number">473</span>M Nov  <span class="number">6</span> <span class="number">14</span>:<span class="number">48</span> mysql-binlog.<span class="number">000235</span></span><br><span class="line">-rw-r----- <span class="number">1</span> mysql mysql  <span class="number">384</span> Nov  <span class="number">6</span> <span class="number">00</span>:<span class="number">21</span> mysql-binlog.index</span><br></pre></td></tr></table></figure>

<ul>
<li>å®šä½è¯¯æ‰§è¡Œ <code>SQL</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$ python binlog2sql.py -h'x.x.x.x' -uroot -p'xx' -dtest -temployees <span class="comment">--start-file='mysql-bin.000020' --sql-type=DELETE &gt; result.sql</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="string">`test`</span>.<span class="string">`employees`</span> <span class="keyword">WHERE</span> <span class="string">`name`</span>=<span class="string">'xujinliang'</span> <span class="keyword">AND</span> <span class="string">`gmt_modified`</span>=<span class="string">'2019-09-24 17:13:00'</span> <span class="keyword">AND</span> <span class="string">`age`</span>=<span class="number">32</span> <span class="keyword">AND</span> <span class="string">`gmt_create`</span>=<span class="string">'2019-09-24 17:13:00'</span> <span class="keyword">AND</span> <span class="string">`address`</span>=<span class="string">'å±±ä¸œçœé’å²›å¸‚'</span> <span class="keyword">AND</span> <span class="string">`id`</span>=<span class="number">1</span> <span class="keyword">LIMIT</span> <span class="number">1</span>; <span class="comment">#start 66374969 end 66375406 time 2019-10-21 15:38:49</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="string">`test`</span>.<span class="string">`employees`</span> <span class="keyword">WHERE</span> <span class="string">`name`</span>=<span class="string">'maofang'</span> <span class="keyword">AND</span> <span class="string">`gmt_modified`</span>=<span class="string">'2019-09-24 17:40:49'</span> <span class="keyword">AND</span> <span class="string">`age`</span>=<span class="number">32</span> <span class="keyword">AND</span> <span class="string">`gmt_create`</span>=<span class="string">'2019-09-24 17:32:00'</span> <span class="keyword">AND</span> <span class="string">`address`</span>=<span class="string">'å±±ä¸œçœé’å²›å¸‚'</span> <span class="keyword">AND</span> <span class="string">`id`</span>=<span class="number">2</span> <span class="keyword">LIMIT</span> <span class="number">1</span>; <span class="comment">#start 66374969 end 66375406 time 2019-10-21 15:38:49</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="string">`test`</span>.<span class="string">`employees`</span> <span class="keyword">WHERE</span> <span class="string">`name`</span>=<span class="string">'raohui'</span> <span class="keyword">AND</span> <span class="string">`gmt_modified`</span>=<span class="string">'2019-09-24 17:39:28'</span> <span class="keyword">AND</span> <span class="string">`age`</span>=<span class="number">29</span> <span class="keyword">AND</span> <span class="string">`gmt_create`</span>=<span class="string">'2019-09-24 17:39:28'</span> <span class="keyword">AND</span> <span class="string">`address`</span>=<span class="string">'é™•è¥¿çœè¥¿å®‰å¸‚'</span> <span class="keyword">AND</span> <span class="string">`id`</span>=<span class="number">3</span> <span class="keyword">LIMIT</span> <span class="number">1</span>; <span class="comment">#start 66374969 end 66375406 time 2019-10-21 15:38:49</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="string">`test`</span>.<span class="string">`employees`</span> <span class="keyword">WHERE</span> <span class="string">`name`</span>=<span class="string">'yangnan'</span> <span class="keyword">AND</span> <span class="string">`gmt_modified`</span>=<span class="string">'2019-09-24 17:39:52'</span> <span class="keyword">AND</span> <span class="string">`age`</span>=<span class="number">22</span> <span class="keyword">AND</span> <span class="string">`gmt_create`</span>=<span class="string">'2019-09-24 17:39:52'</span> <span class="keyword">AND</span> <span class="string">`address`</span> <span class="keyword">IS</span> <span class="literal">NULL</span> <span class="keyword">AND</span> <span class="string">`id`</span>=<span class="number">4</span> <span class="keyword">LIMIT</span> <span class="number">1</span>; <span class="comment">#start 66374969 end 66375406 time 2019-10-21 15:38:49</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="string">`test`</span>.<span class="string">`employees`</span> <span class="keyword">WHERE</span> <span class="string">`name`</span>=<span class="string">'yuzhiqiang'</span> <span class="keyword">AND</span> <span class="string">`gmt_modified`</span>=<span class="string">'2019-09-24 17:40:03'</span> <span class="keyword">AND</span> <span class="string">`age`</span>=<span class="number">29</span> <span class="keyword">AND</span> <span class="string">`gmt_create`</span>=<span class="string">'2019-09-24 17:40:03'</span> <span class="keyword">AND</span> <span class="string">`address`</span> <span class="keyword">IS</span> <span class="literal">NULL</span> <span class="keyword">AND</span> <span class="string">`id`</span>=<span class="number">5</span> <span class="keyword">LIMIT</span> <span class="number">1</span>; <span class="comment">#start 66374969 end 66375406 time 2019-10-21 15:38:49</span></span><br></pre></td></tr></table></figure>

<ul>
<li>è§£æå‡ºå›æ»š <code>SQL</code>ï¼Œå¹¶æ£€æŸ¥å›æ»š <code>SQL</code> æ˜¯å¦æ­£ç¡®</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$ python binlog2sql.py -h127.0.0.1 -P3306 -uroot -p'xx' -dtest -temployees <span class="comment">--start-file='mysql-bin.000020' --start-pos=66374969 --end-pos=66375406 -B &gt; rollback.sql</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`test`</span>.<span class="string">`employees`</span>(<span class="string">`name`</span>, <span class="string">`gmt_modified`</span>, <span class="string">`age`</span>, <span class="string">`gmt_create`</span>, <span class="string">`address`</span>, <span class="string">`id`</span>) <span class="keyword">VALUES</span> (<span class="string">'yuzhiqiang'</span>, <span class="string">'2019-09-24 17:40:03'</span>, <span class="number">29</span>, <span class="string">'2019-09-24 17:40:03'</span>, <span class="literal">NULL</span>, <span class="number">5</span>); <span class="comment">#start 66374969 end 66375406 time 2019-10-21 15:38:49</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`test`</span>.<span class="string">`employees`</span>(<span class="string">`name`</span>, <span class="string">`gmt_modified`</span>, <span class="string">`age`</span>, <span class="string">`gmt_create`</span>, <span class="string">`address`</span>, <span class="string">`id`</span>) <span class="keyword">VALUES</span> (<span class="string">'yangnan'</span>, <span class="string">'2019-09-24 17:39:52'</span>, <span class="number">22</span>, <span class="string">'2019-09-24 17:39:52'</span>, <span class="literal">NULL</span>, <span class="number">4</span>); <span class="comment">#start 66374969 end 66375406 time 2019-10-21 15:38:49</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`test`</span>.<span class="string">`employees`</span>(<span class="string">`name`</span>, <span class="string">`gmt_modified`</span>, <span class="string">`age`</span>, <span class="string">`gmt_create`</span>, <span class="string">`address`</span>, <span class="string">`id`</span>) <span class="keyword">VALUES</span> (<span class="string">'raohui'</span>, <span class="string">'2019-09-24 17:39:28'</span>, <span class="number">29</span>, <span class="string">'2019-09-24 17:39:28'</span>, <span class="string">'é™•è¥¿çœè¥¿å®‰å¸‚'</span>, <span class="number">3</span>); <span class="comment">#start 66374969 end 66375406 time 2019-10-21 15:38:49</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`test`</span>.<span class="string">`employees`</span>(<span class="string">`name`</span>, <span class="string">`gmt_modified`</span>, <span class="string">`age`</span>, <span class="string">`gmt_create`</span>, <span class="string">`address`</span>, <span class="string">`id`</span>) <span class="keyword">VALUES</span> (<span class="string">'maofang'</span>, <span class="string">'2019-09-24 17:40:49'</span>, <span class="number">32</span>, <span class="string">'2019-09-24 17:32:00'</span>, <span class="string">'å±±ä¸œçœé’å²›å¸‚'</span>, <span class="number">2</span>); <span class="comment">#start 66374969 end 66375406 time 2019-10-21 15:38:49</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`test`</span>.<span class="string">`employees`</span>(<span class="string">`name`</span>, <span class="string">`gmt_modified`</span>, <span class="string">`age`</span>, <span class="string">`gmt_create`</span>, <span class="string">`address`</span>, <span class="string">`id`</span>) <span class="keyword">VALUES</span> (<span class="string">'xujinliang'</span>, <span class="string">'2019-09-24 17:13:00'</span>, <span class="number">32</span>, <span class="string">'2019-09-24 17:13:00'</span>, <span class="string">'å±±ä¸œçœé’å²›å¸‚'</span>, <span class="number">1</span>); <span class="comment">#start 66374969 end 66375406 time 2019-10-21 15:38:49</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Tips</strong>ï¼šå›æ»šæ¡æ•°å¯ä»¥ä½¿ç”¨ <code>%s/pattern/&amp;/g</code> è¿›è¡Œç»Ÿè®¡ï¼Œ<code>pattern</code> æ˜¯è¦æœç´¢çš„å…³é”®å­—ã€‚</p>
</blockquote>
<ul>
<li>ç¡®è®¤å›æ»š <code>SQL</code> æ­£ç¡®ï¼Œæ‰§è¡Œå›æ»šè¯­å¥</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$ mysql -h127.0.0.1 -P3306 -uroot -p'xx' &lt; rollback.sql</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from employees;</span><br><span class="line">+<span class="comment">----+------------+--------------------+-----+---------------------+---------------------+</span></span><br><span class="line">| id | name       | address            | age | gmt_create          | gmt_modified        |</span><br><span class="line">+<span class="comment">----+------------+--------------------+-----+---------------------+---------------------+</span></span><br><span class="line">|  1 | xujinliang | å±±ä¸œçœé’å²›å¸‚         |  32 | 2019-09-24 17:13:00 | 2019-09-24 17:13:00 |</span><br><span class="line">|  2 | maofang    | å±±ä¸œçœé’å²›å¸‚         |  32 | 2019-09-24 17:32:00 | 2019-09-24 17:40:49 |</span><br><span class="line">|  3 | raohui     | é™•è¥¿çœè¥¿å®‰å¸‚         |  29 | 2019-09-24 17:39:28 | 2019-09-24 17:39:28 |</span><br><span class="line">|  4 | yangnan    | NULL               |  22 | 2019-09-24 17:39:52 | 2019-09-24 17:39:52 |</span><br><span class="line">|  5 | yuzhiqiang | NULL               |  29 | 2019-09-24 17:40:03 | 2019-09-24 17:40:03 |</span><br><span class="line">+<span class="comment">----+------------+--------------------+-----+---------------------+---------------------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥é…ç½®</span></span><br><span class="line">-h host; -P port; -u user; -p password</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£ææ¨¡å¼</span></span><br><span class="line">-B, --flashback              <span class="comment"># ç”Ÿæˆå›æ»šSQL</span></span><br><span class="line">--start-file                 <span class="comment"># èµ·å§‹è§£ææ–‡ä»¶</span></span><br><span class="line">--start-position/--start-pos <span class="comment"># èµ·å§‹è§£æä½ç½®</span></span><br><span class="line">--stop-file/--end-file       <span class="comment"># ç»ˆæ­¢è§£ææ–‡ä»¶</span></span><br><span class="line">--stop-position/--end-pos    <span class="comment"># ç»ˆæ­¢è§£æä½ç½®</span></span><br><span class="line">--start-datetime             <span class="comment"># èµ·å§‹è§£ææ—¶é—´</span></span><br><span class="line">--stop-datetime              <span class="comment"># ç»ˆæ­¢è§£ææ—¶é—´ï¼Œæ ¼å¼'%Y-%m-%d %H:%M:%S'</span></span><br><span class="line">-d, --databases              <span class="comment"># åªè§£æç›®æ ‡DBçš„SQLï¼Œå¤šä¸ªåº“ç”¨ç©ºæ ¼éš”å¼€</span></span><br><span class="line">-t, --tables                 <span class="comment"># åªè§£æç›®æ ‡è¡¨çš„SQLï¼Œå¤šå¼ è¡¨ç”¨ç©ºæ ¼éš”å¼€</span></span><br><span class="line">--only-dml                   <span class="comment"># åªè§£æDMLï¼Œå¿½ç•¥DDL</span></span><br><span class="line">--sql-type                   <span class="comment"># åªè§£ææŒ‡å®šç±»å‹ï¼Œæ”¯æŒINSERT, UPDATE, DELETEï¼Œå¤šä¸ªç±»å‹ç”¨ç©ºæ ¼éš”å¼€</span></span><br></pre></td></tr></table></figure>

<h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><ul>
<li>è¿˜æ˜¯å…ˆæ¢å¤å†å»é¢å£æ€è¿‡å§ï¼</li>
<li>æ‰‹å·¥æ‰§è¡Œ <code>delete</code>ã€<code>update</code> è¯­å¥å‰ï¼Œå…ˆæ‰§è¡Œ <code>selete</code> è¯­å¥ã€‚</li>
<li><code>drop</code> æˆ–è€… <code>truncate</code> è¯­å¥é€ æˆçš„è¯¯æ“ä½œï¼Œé€šè¿‡å¤‡ä»½æ¥æ¢å¤ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>æœ€ä½³å®è·µ</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL Â· ä¿®æ”¹æ•°æ®åº“å</title>
    <url>/blog/2019/10/21/mysql-modify-dbname/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p><strong>éœ€æ±‚</strong>ï¼šå°†æ•°æ®åº“ <code>hrtrqu</code> ä¿®æ”¹ <code>hrtrzq</code></p>
<p><strong>æ–¹æ¡ˆ</strong>ï¼šMySQL æ²¡æœ‰ <code>rename database</code> å‘½ä»¤ï¼Œåªèƒ½å˜ç›¸ä¿®æ”¹è¡¨åˆ°ç›®æ ‡åº“é‡Œçš„è¡¨æ¥å®ç°ã€‚</p>
<h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><p><strong>1. å¯¼å‡ºåº“æ•°æ®</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ mysqldump  --single-transaction -S /<span class="keyword">data</span>/mysql3308/mysql.sock -usre -p<span class="string">'xx'</span> hrtrqu &gt; hrtrqu.sql</span><br></pre></td></tr></table></figure>

<p><strong>2. åˆ›å»ºæ–°åº“ hrtrzq</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> hrtrzq <span class="keyword">default</span> <span class="keyword">charset</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci;</span><br></pre></td></tr></table></figure>

<p><strong>3. å¯¼å…¥æ•°æ®åˆ°æ–°åº“</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ mysql -S /<span class="keyword">data</span>/mysql3308/mysql.sock -usre -p<span class="string">'sre@@p$i'</span> hrtrzq &lt; hrtrqu.sql</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· å¿«é€Ÿåˆ é™¤å¤§è¡¨</title>
    <url>/blog/2019/10/21/mysql-delete-bigtable/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ç”Ÿäº§ç¯å¢ƒæœ‰ä¸€å¼ æ—¥å¿—è¡¨ <code>schedule_task_error_log</code> ï¼Œæ•°æ®é‡è¶…è¿‡ <code>5000w</code>ï¼Œæƒ³é€šè¿‡ <code>drop</code> åˆ é™¤ä½†æ˜¯é€Ÿåº¦å¾ˆæ…¢ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql <span class="number">5.1</span>K Jan  <span class="number">8</span>  <span class="number">2018</span> schedule_task_error_log.frm</span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">36</span>G May <span class="number">16</span> <span class="number">18</span>:<span class="number">14</span> schedule_task_error_log.ibd</span><br></pre></td></tr></table></figure>

<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-21-114430.jpg" alt></p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p><strong>å‰æ</strong>ï¼š<code>MySQL</code> å¼€å¯äº†<strong>ç‹¬ç«‹è¡¨ç©ºé—´</strong>ï¼Œ<code>MySQL 5.6.7</code> ä¹‹åé»˜è®¤å¼€å¯ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">MariaDB&gt; show variables like 'innodb_file_per_table';</span><br><span class="line">+<span class="comment">-----------------------+-------+</span></span><br><span class="line">| Variable_name         | Value |</span><br><span class="line">+<span class="comment">-----------------------+-------+</span></span><br><span class="line">| innodb_file_per_table | ON    |</span><br><span class="line">+<span class="comment">-----------------------+-------+</span></span><br></pre></td></tr></table></figure>

<p><code>MySQL</code> åœ¨åˆ é™¤å¤§è¡¨çš„æ—¶å€™ä¸ºä»€ä¹ˆæ…¢ï¼Ÿ</p>
<ul>
<li><code>Buffer Pool</code> é¡µé¢æ¸…é™¤è¿‡ç¨‹ï¼ˆæ‹¥æœ‰ <code>InnoDB</code> å…¨å±€é”ï¼‰</li>
<li>åˆ é™¤ <code>ibd</code> ç£ç›˜æ–‡ä»¶è¿‡ç¨‹</li>
</ul>
<p><strong>æ–¹æ¡ˆ</strong>ï¼šåˆ©ç”¨äº† <code>Linux</code> ä¸­ <strong>ç¡¬é“¾æ¥</strong> å‡å°‘ <code>DDL</code> æ—¶é—´ï¼ŒåŠ å¿«é”é‡Šæ”¾ï¼Œæ¥è¿›è¡Œå¿«é€Ÿåˆ é™¤ã€‚</p>
<h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><p><strong>1. å»ºç«‹ç¡¬è¿æ¥</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ ln schedule_task_error_log.ibd schedule_task_error_log.ibd.hdlk</span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql <span class="number">5.1</span>K Jan  <span class="number">8</span>  <span class="number">2018</span> schedule_task_error_log.frm</span><br><span class="line">-rw-rw----. <span class="number">2</span> mysql mysql  <span class="number">36</span>G May <span class="number">16</span> <span class="number">18</span>:<span class="number">14</span> schedule_task_error_log.ibd</span><br><span class="line">-rw-rw----. <span class="number">2</span> mysql mysql  <span class="number">36</span>G May <span class="number">16</span> <span class="number">18</span>:<span class="number">14</span> schedule_task_error_log.ibd.hdlk</span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql <span class="number">5.8</span>K Mar <span class="number">14</span>  <span class="number">2018</span> user_operation_syslog.frm</span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql <span class="number">272</span>K Feb <span class="number">13</span>  <span class="number">2019</span> user_operation_syslog.ibd</span><br></pre></td></tr></table></figure>

<p><strong>2. drop table</strong></p>
<p>å†çœ‹ç‰©ç†æ–‡ä»¶çš„å¼•ç”¨æ•°å˜ä¸º 1ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥å¦å¤–æ‰¾æ—¶é—´æ‰‹åŠ¨åˆ é™¤ç‰©ç†æ–‡ä»¶ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">MariaDB&gt; drop table schedule_task_error_log;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.78</span> sec)</span><br><span class="line"></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">36</span>G May <span class="number">16</span> <span class="number">18</span>:<span class="number">14</span> schedule_task_error_log.ibd.hdlk</span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql <span class="number">5.8</span>K Mar <span class="number">14</span>  <span class="number">2018</span> user_operation_syslog.frm</span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql <span class="number">272</span>K Feb <span class="number">13</span>  <span class="number">2019</span> user_operation_syslog.ibd</span><br></pre></td></tr></table></figure>

<p><strong>3. åˆ é™¤ç‰©ç†æ–‡ä»¶</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ rm -rf schedule_task_error_log.ibd.hdlk</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>Redis</title>
    <url>/blog/2019/10/20/redis/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Redis (Remote Dictionary Server)ï¼Œ</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ wget http://download.redis.io/releases/redis-<span class="number">5.0</span>.<span class="number">5</span>.tar.gz</span><br><span class="line">$ tar xzf redis-<span class="number">5.0</span>.<span class="number">5</span>.tar.gz</span><br><span class="line">$ cd redis-<span class="number">5.0</span>.<span class="number">5</span></span><br><span class="line">$ make</span><br><span class="line">$ cd src</span><br><span class="line">$ ./redis-server</span><br><span class="line">$ ./redis-server ../redis.conf</span><br><span class="line"></span><br><span class="line">$ ps -ef | grep redis</span><br><span class="line">root     <span class="number">112021</span>      <span class="number">1</span>  <span class="number">0</span> <span class="number">15</span>:<span class="number">02</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> ./redis-server *:<span class="number">6379</span></span><br><span class="line">root     <span class="number">112563</span>  <span class="number">82349</span>  <span class="number">0</span> <span class="number">15</span>:<span class="number">04</span> pts/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> grep --color=auto redis</span><br></pre></td></tr></table></figure>

<p><code>redis.conf</code> æ˜¯é»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æ ¹æ®éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ cd src</span><br><span class="line">$ ./redis-cli</span><br><span class="line">redis&gt; set foo bar</span><br><span class="line">OK</span><br><span class="line">redis&gt; get foo</span><br><span class="line"><span class="string">"bar"</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Redis</category>
      </categories>
  </entry>
  <entry>
    <title>Percona Toolkit Â· ç£ç›˜åˆ†æå·¥å…· pt-diskstats</title>
    <url>/blog/2019/10/19/pt-diskstats/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Percona Toolkit</category>
      </categories>
  </entry>
  <entry>
    <title>Percona Toolkit Â· ç”¨æˆ·æƒé™æ˜¾ç¤ºå·¥å…· pt-show-grants</title>
    <url>/blog/2019/10/19/pt-show-grants/</url>
    <content><![CDATA[<h2 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h2><p>æ˜¾ç¤º <code>mysql.user</code> æ‰€æœ‰ç”¨æˆ·åŠæƒé™</p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><ul>
<li>å…ˆæŸ¥æ‰¾æ‰€æœ‰ <code>user</code> å’Œ <code>host</code></li>
<li>ç„¶åé€ä¸ªæ‰§è¡Œ <code>show grants</code></li>
</ul>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ pt-show-grants -u <span class="string">'xx'</span> -p <span class="string">'xx'</span> -S /tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">-- Grants dumped by pt-show-grants</span><br><span class="line">-- Dumped from server Localhost via UNIX socket, MySQL <span class="number">5.7</span>.<span class="number">23</span>-log at <span class="number">2019</span>-<span class="number">10</span>-<span class="number">18</span> <span class="number">15</span>:<span class="number">56</span>:<span class="number">29</span></span><br><span class="line">-- Grants <span class="keyword">for</span> <span class="string">'hdm'</span><span class="string">@'%'</span></span><br><span class="line"><span class="string">CREATE USER IF NOT EXISTS 'hdm'@'%';</span></span><br><span class="line"><span class="string">ALTER USER 'hdm'@'%' IDENTIFIED WITH 'mysql_native_password' AS '*14533888C6CA3952B3957903FF7E69469C7E3A2B' REQUIRE NONE PASSWORD EXPIRE DEFAULT ACCOUNT UNLOCK;</span></span><br><span class="line"><span class="string">GRANT PROCESS, REPLICATION CLIENT, REPLICATION SLAVE, SELECT, SHOW DATABASES ON *.* TO 'hdm'@'%';</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-- Grants for 'monitor'@'10.138.228.%'</span></span><br><span class="line"><span class="string">CREATE USER IF NOT EXISTS 'monitor'@'10.138.228.%';</span></span><br><span class="line"><span class="string">ALTER USER 'monitor'@'10.138.228.%' IDENTIFIED WITH 'mysql_native_password' AS '*67C7E9852A88EE023433F77C5C63AF9DD730667B' REQUIRE NONE PASSWORD EXPIRE DEFAULT ACCOUNT UNLOCK;</span></span><br><span class="line"><span class="string">GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'monitor'@'10.138.228.%';</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Percona Toolkit</category>
      </categories>
  </entry>
  <entry>
    <title>Percona Toolkit Â· ç´¢å¼•åˆ†æå·¥å…· pt-index-usage</title>
    <url>/blog/2019/10/19/pt-index-usage/</url>
    <content><![CDATA[<h2 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h2><p>ä»æ—¥å¿—å½“ä¸­åˆ†æç´¢å¼•çš„ä½¿ç”¨æƒ…å†µï¼Œæ£€æµ‹å¤šä½™çš„ç´¢å¼•</p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>é€šè¿‡ <code>EXPLAIN</code> æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­çš„ <code>SQL</code>ï¼Œç„¶åç”¨æ‰§è¡Œè®¡åˆ’å’Œæ•°æ®åº“ä¸­çš„ç´¢å¼•åšå¯¹æ¯”ï¼Œçœ‹å“ªäº›ç´¢å¼•æ²¡æœ‰è¢«åˆ©ç”¨</p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ pt-index-usage /<span class="keyword">data</span>/mysql/slow.log  -u <span class="string">'xx'</span> -p <span class="string">'xx'</span> -S /tmp/mysql.sock</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Percona Toolkit</category>
      </categories>
  </entry>
  <entry>
    <title>Percona Toolkit Â· å¤åˆ¶å¼‚å¸¸ä¿®å¤å·¥å…· pt-slave-restart</title>
    <url>/blog/2019/10/19/pt-slave-restart/</url>
    <content><![CDATA[<h2 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h2><p><a href="https://www.percona.com/doc/percona-toolkit/LATEST/pt-slave-restart.html" target="_blank" rel="noopener"><strong>pt-slave-restart</strong></a>ï¼šæ˜¯ä¸€ä¸ªä¿®å¤ç”±äºä¸åŒçš„é”™è¯¯è€Œæ„å¤–ç»ˆæ­¢ <code>slave</code> å¤åˆ¶çš„å·¥å…·ï¼Œå’Œé…ç½®å‚æ•° <a href="https://dev.mysql.com/doc/refman/5.7/en/replication-options-slave.html#sysvar_slave_skip_errors" target="_blank" rel="noopener">slave_skip_errors</a> åŠŸèƒ½ç±»ä¼¼ã€‚</p>
<blockquote>
<p><strong>Warning</strong>ï¼šé™¤éçŸ¥é“è·³è¿‡æ“ä½œçš„å½±å“æˆ–åæœï¼Œå¦åˆ™ä¸è¦è‡ªåŠ¨è·³è¿‡ä»»ä½•é”™è¯¯ï¼Œä¼šå½±å“æ•°æ®ä¸€è‡´æ€§ã€‚</p>
</blockquote>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>å®ƒä»¥æŒ‡æ•°å˜åŒ–çš„ç¡çœ æ—¶é—´å®šæœŸå·¡è§†æ£€æŸ¥ <code>slave</code> å¤åˆ¶çŠ¶æ€ï¼Œåˆå§‹é»˜è®¤ <code>1s</code>ï¼Œå¹¶è¯•å›¾è·³è¿‡å¯¼è‡´é”™è¯¯çš„è¯­å¥ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">Usage: pt-slave-restart [OPTIONS] [DSN]</span><br><span class="line">Options:</span><br><span class="line"></span><br><span class="line">  --always               Start slaves even when there is no errorï¼ˆä¸å»ºè®®ä½¿ç”¨æ­¤å‚æ•°ï¼‰</span><br><span class="line">  --ask-pass             Prompt <span class="keyword">for</span> a password when connecting to MySQL</span><br><span class="line">  --charset=s        -A  Default character set</span><br><span class="line">  --[no]check-relay-log  Check the last relay log file and position before</span><br><span class="line">                         checking <span class="keyword">for</span> slave errors (default yes)</span><br><span class="line">  --config=A             Read this comma-separated list of config files; <span class="keyword">if</span></span><br><span class="line">                         specified, this must be the first option on the</span><br><span class="line">                         command line</span><br><span class="line">  --daemonize            Fork to the background and detach from the shell</span><br><span class="line">  --database=s       -D  Database to use</span><br><span class="line">  --defaults-file=s  -F  Only read mysql options from the given file</span><br><span class="line">  --error-length=i       Max length of error message to print</span><br><span class="line">  --error-numbers=h      Only restart this comma-separated list of errors</span><br><span class="line">  --error-text=s         Only restart errors that match this pattern</span><br><span class="line">  --help                 Show help and <span class="keyword">exit</span></span><br><span class="line">  --host=s           -h  Connect to host</span><br><span class="line">  --log=s                Print all output to this file when daemonized</span><br><span class="line">  --master-uuid=s        When using GTID, an empty transaction should be</span><br><span class="line">                         created <span class="keyword">in</span> order to skip it</span><br><span class="line">  --max-sleep=f          Maximum sleep seconds (default <span class="number">64</span>)</span><br><span class="line">  --min-sleep=f          The minimum time pt-slave-restart will sleep before</span><br><span class="line">                         polling the slave again (default <span class="number">0.015625</span>)</span><br><span class="line">  --monitor              Whether to monitor the slave (default)</span><br><span class="line">  --password=s       -p  Password to use when connecting</span><br><span class="line">  --pid=s                Create the given PID file</span><br><span class="line">  --port=i           -P  Port number to use <span class="keyword">for</span> connection</span><br><span class="line">  --quiet            -q  Suppresses normal output (disables --verbose)</span><br><span class="line">  --recurse=i            Watch slaves of the specified server, up to the</span><br><span class="line">                         specified number of servers deep <span class="keyword">in</span> the hierarchy (</span><br><span class="line">                         default <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">./pt-slave-restart -uroot -p<span class="string">'xx'</span> --error-numbers=<span class="number">1062</span></span><br><span class="line"><span class="number">2019</span>-<span class="number">05</span>-<span class="number">04</span>T00:<span class="number">59</span>:<span class="number">09</span> P=<span class="number">3306</span>,h=x.x.x.x,p=...,u=root relay-bin.<span class="number">000005</span>         <span class="number">369</span> <span class="number">1032</span> </span><br><span class="line"><span class="number">2019</span>-<span class="number">05</span>-<span class="number">04</span>T00:<span class="number">59</span>:<span class="number">20</span> P=<span class="number">3306</span>,h=x.x.x.x,p=...,u=root relay-bin.<span class="number">000005</span>         <span class="number">726</span> <span class="number">1032</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Percona Toolkit</category>
      </categories>
  </entry>
  <entry>
    <title>Percona Toolkit Â· æ…¢æ—¥å¿—åˆ†æå·¥å…· pt-query-digest</title>
    <url>/blog/2019/10/19/pt-query-digest/</url>
    <content><![CDATA[<h2 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h2><p>æä¾›æ…¢æ—¥å¿—åˆ†æåŠŸèƒ½ï¼Œä¸ <code>mysqldumpshow</code> å·¥å…·ç›¸æ¯”ï¼Œ<code>pt-query-digest</code> å·¥å…·çš„åˆ†æç»“æœæ›´å…·ä½“ï¼Œæ›´å®Œå–„ã€‚</p>
<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p><strong>ç¬¬ä¸€éƒ¨åˆ†ï¼šæ€»ä½“ç»Ÿè®¡ç»“æœ</strong></p>
<ul>
<li><strong>Overall</strong>ï¼šæ€»å…±æœ‰å¤šå°‘æ¡æŸ¥è¯¢</li>
<li><strong>Time range</strong>ï¼šæŸ¥è¯¢æ‰§è¡Œçš„æ—¶é—´èŒƒå›´</li>
<li><strong>unique</strong>ï¼šå”¯ä¸€æŸ¥è¯¢æ•°é‡ï¼Œå³å¯¹æŸ¥è¯¢æ¡ä»¶è¿›è¡Œå‚æ•°åŒ–ä»¥åï¼Œæ€»å…±æœ‰å¤šå°‘ä¸ªä¸åŒçš„æŸ¥è¯¢</li>
<li><strong>total</strong>ï¼šæ€»è®¡   </li>
<li><strong>min</strong>ï¼šæœ€å°   </li>
<li><strong>max</strong>ï¼šæœ€å¤§  </li>
<li><strong>avg</strong>ï¼šå¹³å‡</li>
<li><strong>95%</strong>ï¼šæŠŠæ‰€æœ‰å€¼ä»å°åˆ°å¤§æ’åˆ—ï¼Œä½ç½®ä½äº <code>95%</code> çš„é‚£ä¸ªæ•°ï¼Œè¿™ä¸ªæ•°ä¸€èˆ¬æœ€å…·æœ‰å‚è€ƒä»·å€¼</li>
<li><strong>median</strong>ï¼šä¸­ä½æ•°ï¼ŒæŠŠæ‰€æœ‰å€¼ä»å°åˆ°å¤§æ’åˆ—ï¼Œä½ç½®ä½äºä¸­é—´é‚£ä¸ªæ•°</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 8.7s user time, 170ms system time, 47.34M rss, 241.90M vsz</span></span><br><span class="line"><span class="comment"># Current date: Wed Oct 16 16:25:30 2019</span></span><br><span class="line"><span class="comment"># Hostname: console</span></span><br><span class="line"><span class="comment"># Files: slow.log</span></span><br><span class="line"><span class="comment"># Overall: 7.99k total, 894 unique, 0.00 QPS, 0.02x concurrency __________</span></span><br><span class="line"><span class="comment"># Time range: 2018-12-21T14:35:34 to 2019-10-16T07:09:56</span></span><br><span class="line"><span class="comment"># Attribute          total     min     max     avg     95%  stddev  median</span></span><br><span class="line"><span class="comment"># ============     ======= ======= ======= ======= ======= ======= =======</span></span><br><span class="line"><span class="comment"># Exec time        529092s      5s   6210s     66s    234s    211s     14s</span></span><br><span class="line"><span class="comment"># Lock time           808s       0    163s   101ms     5ms      3s   761us</span></span><br><span class="line"><span class="comment"># Rows sent        152.93M       0  15.14M  19.60k   1.39k 284.79k    0.99</span></span><br><span class="line"><span class="comment"># Rows examine     188.85G       0 867.98M  24.20M  72.18M  44.34M   3.68M</span></span><br><span class="line"><span class="comment"># Query size        31.32M       6  66.00k   4.01k  18.47k   5.60k  793.42</span></span><br></pre></td></tr></table></figure>

<p><strong>ç¬¬äºŒéƒ¨åˆ†ï¼šæŸ¥è¯¢åˆ†ç»„ç»Ÿè®¡ç»“æœ</strong></p>
<ul>
<li><strong>Rank</strong>ï¼šæ‰€æœ‰è¯­å¥çš„æ’åï¼Œé»˜è®¤æŒ‰ã€timeã€‘é™åºæ’åˆ—ï¼Œé€šè¿‡ <code>--order-by</code> æŒ‡å®š</li>
<li><strong>Query ID</strong>ï¼šè¯­å¥ <code>ID</code></li>
<li><strong>Response</strong>ï¼šæ€»çš„å“åº”æ—¶é—´ï¼Œå•ä½ä¸º <code>S</code></li>
<li><strong>Time</strong>ï¼šè¯¥æŸ¥è¯¢åœ¨æœ¬æ¬¡åˆ†æä¸­æ€»çš„æ—¶é—´å æ¯”</li>
<li><strong>Calls</strong>ï¼šæ‰§è¡Œæ¬¡æ•°ï¼Œå³æœ¬æ¬¡åˆ†ææ€»å…±æœ‰å¤šå°‘æ¡è¿™ç§ç±»å‹çš„æŸ¥è¯¢è¯­å¥</li>
<li><strong>R/Call</strong>ï¼šå¹³å‡æ¯æ¬¡æ‰§è¡Œçš„å“åº”æ—¶é—´</li>
<li><strong>Item</strong>ï¼šæŸ¥è¯¢å¯¹è±¡</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Profile</span></span><br><span class="line"><span class="comment"># Rank Query ID                    Response time     Calls R/Call    V/M</span></span><br><span class="line"><span class="comment"># ==== =========================== ================= ===== ========= =====</span></span><br><span class="line"><span class="comment">#    1 0xFFF66E9B3D962FA319C806... 211420.4504 40.0%   260  813.1556 25.32 ROLLBACK</span></span><br><span class="line"><span class="comment">#    2 0x73AFBACFEBF3942B3B02FB...  33680.6071  6.4%   173  194.6856  0.26 INSERT SELECT UNION SELECT UNION SELECT UNION SELECT UNION SELECT UNION SELECT UNION SELECT UNION SELECT UNION SELECT UNION SELECT UNION SELECT UNION SELECT d_etl_odsgvs_faglflext_all tdmetl.odsgvs_faglflext_all</span></span><br><span class="line"><span class="comment">#    3 0xE1EA5439ED76CBFAA1C5A3...  24517.0767  4.6%     4 6129.2692  1.79 SELECT v_gvs_zgvs_bseg_edw</span></span><br><span class="line"><span class="comment">#    4 0xE562308914915E2720E128...  21322.3718  4.0%  1282   16.6321  8.55 SELECT tdmetl.gvs_zgvs_bseg_edw</span></span><br><span class="line"><span class="comment">#    5 0x0159EC63419857F0EC9D5B...  17472.3139  3.3%    71  246.0889  1.03 SELECT v_edw_data</span></span><br><span class="line"><span class="comment">#    6 0x2DD4B63FCE7C5DEEE14F92...  14743.4445  2.8%   159   92.7261  0.73 UPDATE SELECT d_tax_moth_data</span></span><br><span class="line"><span class="comment">#    7 0x9C084CB3E04D24D29E8BE9...   9081.9772  1.7%    85  106.8468 90.61 DELETE tdmetl.gvs_zgvs_bseg_edw</span></span><br><span class="line"><span class="comment">#    8 0xF879E6613E39CC61E92478...   7834.1462  1.5%   307   25.5184 62... SELECT v_gvs_zgvs_bseg_edw</span></span><br><span class="line"><span class="comment">#    9 0x2B3FA3F89D3D4498CC6FFD...   7490.2099  1.4%    35  214.0060  2.56 INSERT SELECT gvs_zgvs_bseg_edw_hz tdmetl.gvs_zgvs_bseg_edw</span></span><br><span class="line"><span class="comment">#   10 0x6DBDA9B50953D60A486825...   6925.0820  1.3%    71   97.5364 25... INSERT SELECT d_tax_moth_data v_d_tax_profit_data</span></span><br></pre></td></tr></table></figure>

<p><strong>ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ¯ä¸€ç§æŸ¥è¯¢çš„è¯¦ç»†ç»Ÿè®¡ç»“æœ</strong></p>
<ul>
<li><strong>ID</strong>ï¼šæŸ¥è¯¢çš„ <code>ID</code> å·ï¼Œå’Œä¸Šå›¾çš„ <code>Query ID</code> å¯¹åº”</li>
<li><strong>Databases</strong>ï¼šæ•°æ®åº“å</li>
<li><strong>Hosts</strong>ï¼šå„ä¸ª <code>Host</code> æ‰§è¡Œçš„æ¬¡æ•°å æ¯”</li>
<li><strong>Users</strong>ï¼šæŸ¥è¯¢ç”¨æˆ·</li>
<li><strong>Query_time distribution</strong> ï¼šæŸ¥è¯¢æ—¶é—´åˆ†å¸ƒï¼Œé•¿çŸ­ä½“ç°åŒºé—´å æ¯”</li>
<li><strong>Tables</strong>ï¼šæŸ¥è¯¢ä¸­æ¶‰åŠåˆ°çš„è¡¨</li>
<li><strong>Explain</strong>ï¼š<code>SQL</code> è¯­å¥</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Query 1: 0.00 QPS, 0.05x concurrency, ID 0xFFF66E9B3D962FA319C8068B5C1997CD at byte 3105049</span></span><br><span class="line"><span class="comment"># This item is included in the report because it matches --limit.</span></span><br><span class="line"><span class="comment"># Scores: V/M = 25.32</span></span><br><span class="line"><span class="comment"># Time range: 2019-02-15T18:37:47 to 2019-04-03T21:18:48</span></span><br><span class="line"><span class="comment"># Attribute    pct   total     min     max     avg     95%  stddev  median</span></span><br><span class="line"><span class="comment"># ============ === ======= ======= ======= ======= ======= ======= =======</span></span><br><span class="line"><span class="comment"># Count          3     260</span></span><br><span class="line"><span class="comment"># Exec time     39 211420s    322s   1078s    813s   1013s    143s    793s</span></span><br><span class="line"><span class="comment"># Lock time      0       0       0       0       0       0       0       0</span></span><br><span class="line"><span class="comment"># Rows sent      0       0       0       0       0       0       0       0</span></span><br><span class="line"><span class="comment"># Rows examine   0       0       0       0       0       0       0       0</span></span><br><span class="line"><span class="comment"># Query size     0   2.03k       8       8       8       8       0       8</span></span><br><span class="line"><span class="comment"># String:</span></span><br><span class="line"><span class="comment"># Databases    tdmetl</span></span><br><span class="line"><span class="comment"># Hosts        10.138.225.51 (140/53%), 10.138.225.43 (69/26%)... 3 more</span></span><br><span class="line"><span class="comment"># Users        tdmsetldev</span></span><br><span class="line"><span class="comment"># Query_time distribution</span></span><br><span class="line"><span class="comment">#   1us</span></span><br><span class="line"><span class="comment">#  10us</span></span><br><span class="line"><span class="comment"># 100us</span></span><br><span class="line"><span class="comment">#   1ms</span></span><br><span class="line"><span class="comment">#  10ms</span></span><br><span class="line"><span class="comment"># 100ms</span></span><br><span class="line"><span class="comment">#    1s</span></span><br><span class="line"><span class="comment">#  10s+  ################################################################</span></span><br><span class="line">rollback\G</span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ†æå…¨é‡æ…¢æŸ¥è¯¢æ—¥å¿—</span></span><br><span class="line">$ pt-query-digest slow.log &gt; slow_report.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†ææœ€è¿‘12ä¸ªå°æ—¶å†…çš„æŸ¥è¯¢</span></span><br><span class="line">$ pt-query-digest --since=<span class="number">12</span>h  slow.log &gt; slow_report.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†ææœ€è¿‘1ä¸ªæœˆå†…çš„æŸ¥è¯¢</span></span><br><span class="line">$ pt-query-digest slow.log --since <span class="string">'2019-06-08 10:00:00'</span> --until <span class="string">'2019-07-08 10:00:00'</span> &gt; slow_report.log</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Percona Toolkit</category>
      </categories>
  </entry>
  <entry>
    <title>Percona Toolkit Â· åœ¨çº¿ä¿®æ”¹è¡¨ç»“æ„å·¥å…· pt-online-schema-change</title>
    <url>/blog/2019/10/19/pt-online-schema-change/</url>
    <content><![CDATA[<h2 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h2><p>æ”¯æŒä¸é”è¡¨åœ¨çº¿ä¿®æ”¹è¡¨ç»“æ„</p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>ä»¥ <code>test.employees</code> ä¸ºä¾‹ï¼š</p>
<ul>
<li>åˆ›å»ºæ–°è¡¨ï¼Œ<code>test.employees_new</code> è¡¨ç»“æ„ä¸ <code>test.employees</code> ä¸€è‡´</li>
<li><code>test.employees_new</code> æ‰§è¡Œ SQL</li>
<li><code>test.employees</code> æ·»åŠ è§¦å‘å™¨ (<code>DELETE/UPDATE/INSERT</code>)</li>
<li>æ‰¹é‡ä» <code>test.employees</code> æ‹·è´æ•°æ®åˆ° <code>test.employees_new</code>ï¼Œæ‹·è´è¿‡ç¨‹ä¸­é€šè¿‡è§¦å‘å™¨è‡ªåŠ¨æ›´æ–°</li>
<li>ä¿®æ”¹è¡¨åï¼Œ<code>test.employees</code> ä¿®æ”¹ä¸º <code>test.employees_old</code>ï¼Œ<code>test.employees_new</code> ä¿®æ”¹ä¸º <code>test.employees</code></li>
<li>åˆ é™¤ <code>test.employees_old</code> å’Œè§¦å‘å™¨</li>
</ul>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p><strong>å‚æ•°è¯´æ˜</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">--host=xxx </span><br><span class="line">--user=xxx </span><br><span class="line">--password=xxx     <span class="comment"># è¿æ¥å®ä¾‹ä¿¡æ¯</span></span><br><span class="line">--user=            <span class="comment"># è¿æ¥mysqlçš„ç”¨æˆ·å</span></span><br><span class="line">--password=        <span class="comment"># è¿æ¥mysqlçš„å¯†ç </span></span><br><span class="line">--host=            <span class="comment"># è¿æ¥mysqlçš„åœ°å€</span></span><br><span class="line">P=<span class="number">3306</span>             <span class="comment"># è¿æ¥mysqlçš„ç«¯å£å·</span></span><br><span class="line">D=                 <span class="comment"># è¿æ¥mysqlçš„åº“å</span></span><br><span class="line">t=                 <span class="comment"># è¿æ¥mysqlçš„è¡¨å</span></span><br><span class="line">--alter            <span class="comment"># ä¿®æ”¹è¡¨ç»“æ„çš„è¯­å¥</span></span><br><span class="line">--dry-run          <span class="comment"># åˆ›å»ºå’Œä¿®æ”¹æ–°è¡¨</span></span><br><span class="line">--print            <span class="comment"># æ‰“å°ä¿¡æ¯</span></span><br><span class="line">--execute          <span class="comment"># æ‰§è¡Œä¿®æ”¹è¡¨ç»“æ„ ï¼Œ--dry-runä¸--executeå¿…é¡»æŒ‡å®šä¸€ä¸ªï¼ŒäºŒè€…ç›¸äº’æ’æ–¥</span></span><br><span class="line">--charset=utf8     <span class="comment"># ä½¿ç”¨utf8ç¼–ç ï¼Œé¿å…ä¸­æ–‡ä¹±ç </span></span><br><span class="line">--no-version-check <span class="comment"># ä¸æ£€æŸ¥ç‰ˆæœ¬ï¼Œåœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸­ä¸€èˆ¬åŠ å…¥æ­¤å‚æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br></pre></td></tr></table></figure>

<p><strong>æ·»åŠ ç´¢å¼•</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ pt-online-schema-change --user=root --password=<span class="string">'xx'</span> --socket=/<span class="keyword">data</span>/mysql-tdds/mysql.sock --alter <span class="string">"ADD INDEX idx_address(address)"</span> D=test,t=employees --print --execute</span><br></pre></td></tr></table></figure>

<p><strong>åˆ é™¤ç´¢å¼•</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ pt-online-schema-change --user=root --password=<span class="string">'xx'</span> --socket=/<span class="keyword">data</span>/mysql-tdds/mysql.sock --alter <span class="string">"DROP INDEX idx_address"</span> D=test,t=employees --print --execute</span><br><span class="line"></span><br><span class="line">Operation, tries, wait:</span><br><span class="line">  analyze_table, <span class="number">10</span>, <span class="number">1</span></span><br><span class="line">  copy_rows, <span class="number">10</span>, <span class="number">0.25</span></span><br><span class="line">  create_triggers, <span class="number">10</span>, <span class="number">1</span></span><br><span class="line">  drop_triggers, <span class="number">10</span>, <span class="number">1</span></span><br><span class="line">  swap_tables, <span class="number">10</span>, <span class="number">1</span></span><br><span class="line">  update_foreign_keys, <span class="number">10</span>, <span class="number">1</span></span><br><span class="line">Altering `test`.`employees`...</span><br><span class="line">Creating new table...</span><br><span class="line">CREATE TABLE `test`.`_employees_new` (</span><br><span class="line">  `id` bigint(<span class="number">20</span>) unsigned NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `name` char(<span class="number">20</span>) NOT NULL DEFAULT <span class="string">''</span>,</span><br><span class="line">  `address` varchar(<span class="number">50</span>) DEFAULT NULL,</span><br><span class="line">  `age` tinyint(<span class="number">3</span>) unsigned NOT NULL DEFAULT <span class="string">'0'</span>,</span><br><span class="line">  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  KEY `idx_address` (`address`)</span><br><span class="line">) /*!<span class="number">50100</span> TABLESPACE `innodb_file_per_table` */ ENGINE=InnoDB AUTO_INCREMENT=<span class="number">6</span> DEFAULT CHARSET=utf8</span><br><span class="line">Created new table test._employees_new OK.</span><br><span class="line">Altering new table...</span><br><span class="line">ALTER TABLE `test`.`_employees_new` DROP INDEX idx_address</span><br><span class="line">Altered `test`.`_employees_new` OK.</span><br><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">22</span>T15:<span class="number">59</span>:<span class="number">32</span> Creating triggers...</span><br><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">22</span>T15:<span class="number">59</span>:<span class="number">32</span> Created triggers OK.</span><br><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">22</span>T15:<span class="number">59</span>:<span class="number">32</span> Copying approximately <span class="number">5</span> rows...</span><br><span class="line">INSERT LOW_PRIORITY IGNORE INTO `test`.`_employees_new` (`id`, `name`, `address`, `age`, `gmt_create`, `gmt_modified`) SELECT `id`, `name`, `address`, `age`, `gmt_create`, `gmt_modified` FROM `test`.`employees` LOCK <span class="keyword">IN</span> SHARE MODE /*pt-online-schema-change <span class="number">112205</span> copy table*/</span><br><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">22</span>T15:<span class="number">59</span>:<span class="number">32</span> Copied rows OK.</span><br><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">22</span>T15:<span class="number">59</span>:<span class="number">32</span> Analyzing new table...</span><br><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">22</span>T15:<span class="number">59</span>:<span class="number">32</span> Swapping tables...</span><br><span class="line">RENAME TABLE `test`.`employees` TO `test`.`_employees_old`, `test`.`_employees_new` TO `test`.`employees`</span><br><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">22</span>T15:<span class="number">59</span>:<span class="number">32</span> Swapped original and new tables OK.</span><br><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">22</span>T15:<span class="number">59</span>:<span class="number">32</span> Dropping old table...</span><br><span class="line">DROP TABLE <span class="keyword">IF</span> EXISTS `test`.`_employees_old`</span><br><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">22</span>T15:<span class="number">59</span>:<span class="number">32</span> Dropped old table `test`.`_employees_old` OK.</span><br><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">22</span>T15:<span class="number">59</span>:<span class="number">32</span> Dropping triggers...</span><br><span class="line">DROP TRIGGER <span class="keyword">IF</span> EXISTS `test`.`pt_osc_test_employees_del`</span><br><span class="line">DROP TRIGGER <span class="keyword">IF</span> EXISTS `test`.`pt_osc_test_employees_upd`</span><br><span class="line">DROP TRIGGER <span class="keyword">IF</span> EXISTS `test`.`pt_osc_test_employees_ins`</span><br><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">22</span>T15:<span class="number">59</span>:<span class="number">32</span> Dropped triggers OK.</span><br><span class="line">Successfully altered `test`.`employees`.</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Percona Toolkit</category>
      </categories>
  </entry>
  <entry>
    <title>Percona Toolkit Â· å½’æ¡£å·¥å…· pt-archiver</title>
    <url>/blog/2019/10/19/pt-archiver/</url>
    <content><![CDATA[<h2 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h2><p>å°† MySQL æ•°æ®åº“ä¸­è¡¨çš„è®°å½•å½’æ¡£åˆ°å¦å¤–ä¸€ä¸ªè¡¨æˆ–è€…æ–‡ä»¶</p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-19-103800.png" alt="pt"></p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŠŠæ•°æ®å½’æ¡£è‡³å½’æ¡£è¡¨</span></span><br><span class="line">pt-archiver --source h=<span class="number">10.138</span>.<span class="number">228.231</span>,P=<span class="number">3306</span>,u=sre,p=<span class="string">'xxx'</span>,D=matomo,t=matomo_log_link_visit_action --charset=utf8 --dest h=<span class="number">10.138</span>.<span class="number">228.231</span>,P=<span class="number">3306</span>,u=sre,p=<span class="string">'xxx'</span>,D=matomo,t=matomo_log_link_visit_action_history --where <span class="string">"server_time &lt; '2019-01-01'"</span> --limit <span class="number">1000</span> --commit-each --bulk-insert --no-version-check</span><br><span class="line"></span><br><span class="line"><span class="comment"># h=10.138.228.231               -- æ•°æ®åº“å®ä¾‹åœ°å€</span></span><br><span class="line"><span class="comment"># P=3306                         -- æ•°æ®åº“å®ä¾‹ç«¯å£</span></span><br><span class="line"><span class="comment"># u=sre                          -- æ•°æ®åº“å®ä¾‹ç”¨æˆ·</span></span><br><span class="line"><span class="comment"># p=xxx                          -- æ•°æ®åº“å®ä¾‹ç”¨æˆ·å¯†ç </span></span><br><span class="line"><span class="comment"># D=matomo                       -- æ•°æ®åº“å®ä¾‹æ•°æ®åº“</span></span><br><span class="line"><span class="comment"># t=matomo_log_link_visit_action -- æ•°æ®åº“å®ä¾‹è¡¨åç§°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --source                       -- æŒ‡å®šè¦è¢«å½’æ¡£çš„æ•°æ®æº</span></span><br><span class="line"><span class="comment"># --charset=utf8                 -- ä½¿ç”¨çš„å­—ç¬¦é›†ï¼Œéœ€ä¸è¡¨å­—ç¬¦é›†ä¸€è‡´</span></span><br><span class="line"><span class="comment"># --file                         -- æŒ‡å®šç›®æ ‡æ“ä½œç³»ç»Ÿæ–‡ä»¶å</span></span><br><span class="line"><span class="comment"># --dest                         -- æŒ‡å®šå½’æ¡£åˆ°çš„ç›®æ ‡è¡¨</span></span><br><span class="line"><span class="comment"># --where "id &gt; 3008"            -- æŒ‡å®š where è¿‡æ»¤æ¡ä»¶ï¼Œè¿‡æ»¤å‡ºè¦å½’æ¡£çš„æ•°æ®</span></span><br><span class="line"><span class="comment"># --limit 1000                   -- æ¯æ¡è¯­å¥è¯»å–å’Œå½’æ¡£çš„æ•°æ®è¡Œæ•°ï¼Œé»˜è®¤æ˜¯ 1</span></span><br><span class="line"><span class="comment"># --commit-each                  -- æ¯æ¬¡è·å–å’Œå½’æ¡£æ•°æ®åï¼Œcommitæäº¤</span></span><br><span class="line"><span class="comment"># --no-version-check             -- ä¸åšç‰ˆæœ¬æ£€æŸ¥</span></span><br><span class="line"><span class="comment"># --bulk-insert                  -- æ‰¹é‡æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="comment"># --statistics                   -- æ˜¾ç¤º pt-archiver æœ¬æ¬¡æ“ä½œçš„ç»Ÿè®¡ä¿¡æ¯ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯5000æ¡åˆ é™¤1æ¬¡ï¼Œæ¯éš”2000è¡Œè¾“å‡ºä¸€æ¬¡æ•°æ®</span></span><br><span class="line">pt-archiver --source D=ibilling_pay_hupu,t=purchase_order --user=root --password=<span class="string">'root'</span> -S /tmp/mysql.sock --where <span class="string">"create_datetime &lt;= '2015-06-20 00:00:00'"</span> --purge --limit=<span class="number">5000</span> --progress <span class="number">2000</span> --why-quit --no-check-charset &gt; /opt/<span class="number">1</span>.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨äºæŠŠæ•°æ®å¯¼å‡ºæ–‡ä»¶ï¼Œä¸ç”¨åˆ é™¤åŸè¡¨ä¸­æ•°æ®</span></span><br><span class="line">pt-archiver --source h=<span class="number">127.0</span>.<span class="number">0.1</span>,P=<span class="number">58886</span>,D=test,t=t_info_refresh --no-check-charset  --where <span class="string">'id &gt; 1'</span> --progress <span class="number">4000</span> --no-delete --file <span class="string">"/tmp/pt-archiver.sql"</span> --limit=<span class="number">10000</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Percona Toolkit</category>
      </categories>
  </entry>
  <entry>
    <title>Percona Toolkit Â· ä¿¡æ¯æ”¶é›†å·¥å…· pt-summary</title>
    <url>/blog/2019/10/18/pt-summary/</url>
    <content><![CDATA[<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ pt-summary</span><br><span class="line"><span class="comment"># Percona Toolkit System Summary Report ######################</span></span><br><span class="line">        Date | <span class="number">2019</span>-<span class="number">10</span>-<span class="number">18</span> <span class="number">09</span>:<span class="number">41</span>:<span class="number">24</span> UTC (local TZ: CST +<span class="number">0800</span>)</span><br><span class="line">    Hostname | hrmk-Dubbo4</span><br><span class="line">      Uptime | <span class="number">182</span> days, <span class="number">20</span>:<span class="number">56</span>,  <span class="number">1</span> user,  load average: <span class="number">0.66</span>, <span class="number">0.69</span>, <span class="number">0.69</span></span><br><span class="line">      System | Dell Inc.; PowerEdge R730; vNot Specified (Rack Mount Chassis)</span><br><span class="line"> Service Tag | <span class="number">5</span>K6GBD2</span><br><span class="line">    Platform | Linux</span><br><span class="line">     Release | CentOS release <span class="number">6.10</span> (Final)</span><br><span class="line">      Kernel | <span class="number">2.6</span>.<span class="number">32</span>-<span class="number">431</span>.el6.x86_64</span><br><span class="line">Architecture | CPU = <span class="number">64</span>-bit, OS = <span class="number">64</span>-bit</span><br><span class="line">   Threading | NPTL <span class="number">2.12</span></span><br><span class="line">     SELinux | Enforcing</span><br><span class="line"> Virtualized | No virtualization detected</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Processor ##################################################</span></span><br><span class="line">  Processors | physical = <span class="number">2</span>, cores = <span class="number">12</span>, virtual = <span class="number">24</span>, hyperthreading = yes</span><br><span class="line">      Speeds | <span class="number">24</span>x2400.<span class="number">128</span></span><br><span class="line">      Models | <span class="number">24</span>xIntel(R) Xeon(R) CPU E5-<span class="number">2620</span> v3 @ <span class="number">2.40</span>GHz</span><br><span class="line">      Caches | <span class="number">24</span>x15360 KB</span><br><span class="line">      </span><br><span class="line"><span class="comment"># Memory #####################################################</span></span><br><span class="line">       Total | <span class="number">15.6</span>G</span><br><span class="line">        Free | <span class="number">217.5</span>M</span><br><span class="line">        Used | physical = <span class="number">15.4</span>G, swap allocated = <span class="number">7.8</span>G, swap used = <span class="number">96.0</span>k, virtual = <span class="number">15.4</span>G</span><br><span class="line">      Shared | <span class="number">1.2</span>M</span><br><span class="line">     Buffers | <span class="number">221.9</span>M</span><br><span class="line">      Caches | <span class="number">2.2</span>G</span><br><span class="line">       Dirty | <span class="number">344</span> kB</span><br><span class="line">     UsedRSS | <span class="number">12.4</span>G</span><br><span class="line">  Swappiness | <span class="number">60</span></span><br><span class="line"> DirtyPolicy | <span class="number">20</span>, <span class="number">10</span></span><br><span class="line"> DirtyStatus | <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Network Devices ############################################</span></span><br><span class="line">  Device    Speed     Duplex</span><br><span class="line">  ========= ========= =========</span><br><span class="line">  em2        <span class="number">1000</span>Mb/s   Full      </span><br><span class="line">  em3        Unknown!   Unknown!  </span><br><span class="line">  em4        <span class="number">1000</span>Mb/s   Full      </span><br><span class="line">  bond0      <span class="number">1000</span>Mb/s   Full      </span><br><span class="line">  virbr0-nic <span class="number">10</span>Mb/s     Full      </span><br><span class="line">  virbr0                          </span><br><span class="line">  em1        <span class="number">1000</span>Mb/s   Full</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Percona Toolkit</category>
      </categories>
  </entry>
  <entry>
    <title>Percona Toolkit ç³»åˆ—</title>
    <url>/blog/2019/10/18/percona-toolkit/</url>
    <content><![CDATA[<h2 id="ä¸€ã€å®‰è£…"><a href="#ä¸€ã€å®‰è£…" class="headerlink" title="ä¸€ã€å®‰è£…"></a>ä¸€ã€å®‰è£…</h2><p><a href="https://huiraoo.github.io/blog/2019/07/05/mysql-toolkit/">Percona Toolkit  Â· ç®€ä»‹å®‰è£…</a> </p>
<h2 id="äºŒã€å·¥å…·"><a href="#äºŒã€å·¥å…·" class="headerlink" title="äºŒã€å·¥å…·"></a>äºŒã€å·¥å…·</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ pt-align</span><br><span class="line">â”œâ”€â”€ pt-archiver</span><br><span class="line">â”œâ”€â”€ pt-config-diff</span><br><span class="line">â”œâ”€â”€ pt-deadlock-logger</span><br><span class="line">â”œâ”€â”€ pt-diskstats</span><br><span class="line">â”œâ”€â”€ pt-duplicate-key-checker</span><br><span class="line">â”œâ”€â”€ pt-fifo-split</span><br><span class="line">â”œâ”€â”€ pt-find</span><br><span class="line">â”œâ”€â”€ pt-fingerprint</span><br><span class="line">â”œâ”€â”€ pt-fk-error-logger</span><br><span class="line">â”œâ”€â”€ pt-heartbeat</span><br><span class="line">â”œâ”€â”€ pt-index-usage</span><br><span class="line">â”œâ”€â”€ pt-ioprofile</span><br><span class="line">â”œâ”€â”€ pt-kill</span><br><span class="line">â”œâ”€â”€ pt-mext</span><br><span class="line">â”œâ”€â”€ pt-mongodb-query-digest</span><br><span class="line">â”œâ”€â”€ pt-mongodb-summary</span><br><span class="line">â”œâ”€â”€ pt-mysql-summary</span><br><span class="line">â”œâ”€â”€ pt-online-schema-change</span><br><span class="line">â”œâ”€â”€ pt-pmp</span><br><span class="line">â”œâ”€â”€ pt-query-digest</span><br><span class="line">â”œâ”€â”€ pt-secure-collect</span><br><span class="line">â”œâ”€â”€ pt-show-grants</span><br><span class="line">â”œâ”€â”€ pt-sift</span><br><span class="line">â”œâ”€â”€ pt-slave-delay</span><br><span class="line">â”œâ”€â”€ pt-slave-find</span><br><span class="line">â”œâ”€â”€ pt-slave-restart</span><br><span class="line">â”œâ”€â”€ pt-stalk</span><br><span class="line">â”œâ”€â”€ pt-summary</span><br><span class="line">â”œâ”€â”€ pt-table-checksum</span><br><span class="line">â”œâ”€â”€ pt-table-sync</span><br><span class="line">â”œâ”€â”€ pt-table-usage</span><br><span class="line">â”œâ”€â”€ pt-upgrade</span><br><span class="line">â”œâ”€â”€ pt-variable-advisor</span><br><span class="line">â””â”€â”€ pt-visual-explain</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€ä½¿ç”¨"><a href="#ä¸‰ã€ä½¿ç”¨" class="headerlink" title="ä¸‰ã€ä½¿ç”¨"></a>ä¸‰ã€ä½¿ç”¨</h2><ul>
<li><a href="https://huiraoo.github.io/blog/2019/10/19/pt-align/">Percona Toolkit Â· æ ¼å¼åŒ–è¾“å‡ºå·¥å…· pt-align</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/19/pt-archiver/">Percona Toolkit Â· å½’æ¡£å·¥å…· pt-archiver</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/18/pt-summary/">Percona Toolkit Â· ä¿¡æ¯æ”¶é›†å·¥å…· pt-summary</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/19/pt-config-diff/">Percona Toolkit Â· é…ç½®å¯¹æ¯”å·¥å…· pt-config-diff</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/19/pt-deadlock-logger/">Percona Toolkit Â· æ­»é”ç›‘æ§å·¥å…· pt-deadlock-logger</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/19/pt-diskstats/">Percona Toolkit Â· ç£ç›˜åˆ†æå·¥å…· pt-diskstats</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/19/pt-duplicate-key-checker/">Percona Toolkit Â· å†—ä½™ç´¢å¼•æ£€æµ‹å·¥å…· pt-duplicate-key-checker</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/19/pt-index-usage/">Percona Toolkit Â· ç´¢å¼•åˆ†æå·¥å…· pt-index-usage</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/19/pt-online-schema-change/">Percona Toolkit Â· åœ¨çº¿ä¿®æ”¹è¡¨ç»“æ„å·¥å…· pt-online-schema-change</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/19/pt-query-digest/">Percona Toolkit Â· æ…¢æ—¥å¿—åˆ†æå·¥å…· pt-query-digest</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/19/pt-show-grants/">Percona Toolkit Â· ç”¨æˆ·æƒé™æ˜¾ç¤ºå·¥å…· pt-show-grants</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/19/pt-slave-restart/">Percona Toolkit Â· Slave å¼‚å¸¸ä¿®å¤å·¥å…· pt-slave-restart</a></li>
</ul>
]]></content>
      <categories>
        <category>Percona Toolkit</category>
      </categories>
  </entry>
  <entry>
    <title>CentOS é…ç½®é˜¿é‡Œ Yum æº</title>
    <url>/blog/2019/10/18/update-yum/</url>
    <content><![CDATA[<p><strong>å¤‡ä»½å½“å‰ Yum æº</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br></pre></td></tr></table></figure>

<p><strong>ä¸‹è½½é˜¿é‡Œ Yum æº</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># CentOS 6</span></span><br><span class="line">$ wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-<span class="number">6</span>.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS 7</span></span><br><span class="line">$ wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-<span class="number">7</span>.repo</span><br></pre></td></tr></table></figure>

<p><strong>æ¸…ç†</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ yum clean all</span><br></pre></td></tr></table></figure>

<p><strong>æ›´æ–°ç¼“å­˜</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ yum makecache</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
  </entry>
  <entry>
    <title>Markdown ç¼–å†™è§„èŒƒ</title>
    <url>/blog/2019/10/18/markdown-standards/</url>
    <content><![CDATA[<h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>å›¢é˜Ÿç»Ÿä¸€éµå¾ªçº¦å®šçš„ <strong>Markdown ç¼–å†™è§„èŒƒ</strong>ï¼Œç›®çš„æ˜¯æé«˜æ–‡æ¡£çš„å¯è¯»æ€§ï¼Œé™ä½å›¢é˜Ÿæˆå‘˜ä¹‹é—´çš„æ²Ÿé€šæˆæœ¬ã€‚</p>
<h2 id="è§„åˆ™"><a href="#è§„åˆ™" class="headerlink" title="è§„åˆ™"></a>è§„åˆ™</h2><h3 id="é€šç”¨"><a href="#é€šç”¨" class="headerlink" title="é€šç”¨"></a>é€šç”¨</h3><ul>
<li>åç¼€å¿…é¡»ä½¿ç”¨ <code>.md</code></li>
<li>æ–‡ä»¶åå¿…é¡»ä½¿ç”¨å°å†™ï¼Œå¤šä¸ªå•è¯ä¹‹é—´ä½¿ç”¨ <code>-</code> åˆ†éš”</li>
<li>æ–‡ä»¶ç¼–ç å¿…é¡»ç”¨ <code>UTF-8</code></li>
<li>ç« èŠ‚æ ‡é¢˜å¿…é¡»ä»¥ <code>##</code> å¼€å§‹ï¼Œè€Œä¸æ˜¯ <code>#</code></li>
<li>ç« èŠ‚æ ‡é¢˜å’Œå†…å®¹é—´å¿…é¡»æœ‰ä¸€ä¸ªç©ºè¡Œ</li>
</ul>
<h3 id="ç©ºæ ¼"><a href="#ç©ºæ ¼" class="headerlink" title="ç©ºæ ¼"></a>ç©ºæ ¼</h3><ul>
<li>ä¸­æ–‡ä¸è‹±æ–‡ã€æ•°å­—åŠ <code>@ # $ % ^ &amp; * . ( )</code> ç­‰ç¬¦å·ä¹‹é—´éœ€è¦åŠ ç©ºæ ¼</li>
<li>æ•°å­—ä¸å•ä½ä¹‹é—´éœ€è¦åŠ ç©ºæ ¼</li>
<li>é“¾æ¥å‰åéœ€è¦åŠ ç©ºæ ¼</li>
<li>ä¸­æ–‡æ ‡ç‚¹ä¸å‰åå­—ç¬¦ä¹‹é—´ä¸éœ€è¦åŠ ç©ºæ ¼</li>
<li><code>Â° ï¼ %</code> ä¸æ•°å­—ä¹‹é—´ä¸éœ€è¦å¢åŠ ç©ºæ ¼</li>
</ul>
<h3 id="ä¸­æ–‡ç¬¦å·"><a href="#ä¸­æ–‡ç¬¦å·" class="headerlink" title="ä¸­æ–‡ç¬¦å·"></a>ä¸­æ–‡ç¬¦å·</h3><ul>
<li>å¦‚æœæ‹¬å·å†…æœ‰ä¸­æ–‡ï¼Œåˆ™ä½¿ç”¨ä¸­æ–‡æ‹¬å·</li>
<li>å¦‚æœæ‹¬å·ä¸­çš„å†…å®¹å…¨éƒ¨éƒ½æ˜¯è‹±æ–‡ï¼Œåˆ™ä½¿ç”¨åŠè§’è‹±æ–‡æ‹¬å·</li>
<li>ç®€ä½“ä¸­æ–‡ä½¿ç”¨ç›´è§’å¼•å·ï¼ˆã€Œã€ï¼‰ä»£æ›¿åŒå¼•å·ï¼ˆâ€œâ€ï¼‰</li>
<li>çœç•¥å·ä½¿ç”¨ã€Œâ€¦â€¦ã€ï¼Œè€Œã€Œã€‚ã€‚ã€‚ã€ä»…ç”¨äºè¡¨ç¤ºåœé¡¿</li>
<li>ä¸“æœ‰åè¯ä½¿ç”¨æ­£ç¡®çš„å¤§å°å†™ï¼Œå¦‚ <code>GitHub</code></li>
</ul>
]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· æ•°æ®å½’æ¡£</title>
    <url>/blog/2019/10/17/mysql-archiver/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>å¤§è¡¨ <code>base_barcode_info</code> æ•°æ®é‡ <code>5000w+</code>ï¼Œé‡åˆ°å¾ˆå¤§çš„æ€§èƒ½ç“¶é¢ˆï¼Œéœ€è¦å°†è¡¨ä¸­çš„å†å²æ•°æ®è¿›è¡Œå½’æ¡£ã€‚</p>
<h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><ol>
<li><p>å®‰è£… <a href="https://huiraoo.github.io/blog/2019/07/05/mysql-toolkit/"><strong>Percona Toolkit</strong></a></p>
</li>
<li><p>åˆ›å»ºå½’æ¡£è¡¨ <code>base_barcode_info_history_20190801</code></p>
</li>
<li><p>ä½¿ç”¨ <a href="https://tool.lu/crontab/" target="_blank" rel="noopener"><strong>crontab</strong></a> æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œ<code>archiver.sh</code> è„šæœ¬</p>
</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åå°æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">nohup sh archiver.sh &gt; myout.file <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># archiver.sh</span></span><br><span class="line">pt-archiver --source h=<span class="number">10.138</span>.<span class="number">232.85</span>,P=<span class="number">3306</span>,u=sre,p=<span class="string">'xx'</span>,D=<span class="string">'csomo-barcode'</span>,t=base_barcode_info --charset=utf8 --dest  h=<span class="number">10.138</span>.<span class="number">232.85</span>,P=<span class="number">3306</span>,u=sre,p=<span class="string">'xx'</span>,D=<span class="string">'csomo-barcode'</span>,t=base_barcode_info_history_20190801 --where <span class="string">"barcode_request_id IN (SELECT id FROM base_barcode_request WHERE TYPE = '5' AND est &lt; '2019-08-01 00:00:00')"</span> --limit <span class="number">1000</span> --commit-each --bulk-insert --no-version-check</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>æŸ¥çœ‹å½’æ¡£è¿›åº¦</li>
</ol>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; use information_schema;</span><br><span class="line">mysql&gt; select table_name,table_rows from tables where TABLE_SCHEMA = 'csomo-barcode' and table_name='base_barcode_info_history_20190801';</span><br><span class="line">mysql&gt; select table_name,table_rows from tables where TABLE_SCHEMA = 'csomo-barcode' and table_name='base_barcode_info';</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>å½’æ¡£ <code>46598706</code> èŠ±è´¹çº¦ <code>16</code> å°æ—¶</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Fri Sep 13 08:19:34 CST 2019</span></span><br><span class="line">+------------------------------------+------------+</span><br><span class="line">| table_name                         | table_rows |</span><br><span class="line">+------------------------------------+------------+</span><br><span class="line">| base_barcode_info_history_20190801 |     <span class="number">0</span>      |</span><br><span class="line">+------------------------------------+------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fri Sep 13 12:29:07 CST 2019</span></span><br><span class="line">+------------------------------------+------------+</span><br><span class="line">| table_name                         | table_rows |</span><br><span class="line">+------------------------------------+------------+</span><br><span class="line">| base_barcode_info_history_20190801 |   <span class="number">13462385</span> |</span><br><span class="line">+------------------------------------+------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fri Sep 13 17:29:47 CST 2019</span></span><br><span class="line">+------------------------------------+------------+</span><br><span class="line">| table_name                         | table_rows |</span><br><span class="line">+------------------------------------+------------+</span><br><span class="line">| base_barcode_info_history_20190801 |   <span class="number">26300649</span> |</span><br><span class="line">+------------------------------------+------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fri Sep 13 22:21:25 CST 2019</span></span><br><span class="line">+------------------------------------+------------+</span><br><span class="line">| table_name                         | table_rows |</span><br><span class="line">+------------------------------------+------------+</span><br><span class="line">| base_barcode_info_history_20190801 |   <span class="number">36529410</span> |</span><br><span class="line">+------------------------------------+------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># ?</span></span><br><span class="line">+------------------------------------+------------+</span><br><span class="line">| table_name                         | table_rows |</span><br><span class="line">+------------------------------------+------------+</span><br><span class="line">| base_barcode_info_history_20190801 |   <span class="number">46598706</span> |</span><br><span class="line">+------------------------------------+------------+</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>åˆ›å®¢ä¸“é¡¹æå‡è¯¾</title>
    <url>/blog/2019/10/13/training/</url>
    <content><![CDATA[<h2 id="è¯¾ç¨‹ä¸€ï¼šæ²Ÿé€šå½±å“æŠ€æœ¯"><a href="#è¯¾ç¨‹ä¸€ï¼šæ²Ÿé€šå½±å“æŠ€æœ¯" class="headerlink" title="è¯¾ç¨‹ä¸€ï¼šæ²Ÿé€šå½±å“æŠ€æœ¯"></a>è¯¾ç¨‹ä¸€ï¼šæ²Ÿé€šå½±å“æŠ€æœ¯</h2><p><strong>èƒŒæ™¯</strong>ï¼šåœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œéš¾å…ç¢°åˆ°å†²çªã€è¯¯è§£ã€çŸ›ç›¾ï¼Œä½ æ˜¯å¦é‡åˆ°ä»¥ä¸‹æ²Ÿé€šé—®é¢˜çš„è¯¯åŒºï¼š</p>
<ul>
<li>æƒåˆ©è‡³ä¸Šè®ºï¼šè°æƒåŠ›å¤§ã€è°å°±è¯´çš„ç®—ï¼Œä¸è¡Œå°±è®©é¢†å¯¼å‡ºé¢å§ã€‚</li>
<li>åˆ©ç›Šè‡³ä¸Šè®ºï¼šå¤§å®¶å„æœ‰å„çš„åˆ©ç›Šï¼Œè¯´äº†ä¹Ÿæ²¡ç”¨ï¼Œå¤šè¯´åè€Œæœ‰å®³ã€‚</li>
<li>é“ç†ä¸ºç‹è®ºï¼šæµç¨‹è§„å®šè¯¥ç”±è°è´Ÿè´£å°±æ˜¯è°è´Ÿè´£ã€‚</li>
</ul>
<p>ä¸ºå¸®åŠ©èµ°å‡ºæ²Ÿé€šè¯¯åŒºï¼Œæå‡åˆä½œæ•ˆç‡ï¼Œå·©å›ºåˆä½œå…³ç³»ï¼Œçœ‹æ¸…å¯¹æ–¹â€œè¢«å½±å“â€çš„æœ¬è´¨ï¼ŒæŒæ¡â€œå½±å“â€ä»–äººçš„åŸåˆ™å’Œæ–¹æ³•ï¼Œæˆä¸ºä¼˜ç§€çš„å½±å“è€…ï¼Œæœ‰èƒ½åŠ›é©¾é©­â€œæŒ‘æˆ˜çš„â€æ²Ÿé€šã€‚</p>
<p><strong>æ—¶é—´</strong>ï¼š2019å¹´9æœˆ5æ—¥  09:00~17:00</p>
<p><strong>åœ°ç‚¹</strong>ï¼šæµ·å°”å¤§å­¦ B201</p>
<p><strong>è€å¸ˆ</strong>ï¼šç‹è¾°é˜³</p>
<p><strong>å­¦ä¹ æ”¶è·</strong>ï¼š</p>
<p>â‘  è‡ªæˆ‘ä»‹ç»æ—¶ï¼Œæ˜¯æ‹‰è¿‘äººä¸äººè·ç¦»æœ€é‡è¦æ—¶æœºï¼ŒæœŸæœ›è¾¾åˆ°çš„ç›®æ ‡æ˜¯â€œ<strong>è®©äººä¸è®¨åŒ</strong>â€ï¼Œç‹è€å¸ˆåœ¨ä»‹ç»è‡ªå·±çš„æ—¶å€™ï¼Œæˆ‘è§‰å¾—è¾¾åˆ°äº†è¿™ç§ç›®çš„ï¼Œå€¼å¾—å‚è€ƒï¼Œä»–å†™äº†ä¸‰ä¸ªå…³é”®å­—ï¼š</p>
<ul>
<li>åŒ—ï¼ˆå·¥ï¼‰å¤§ï¼Œ<code>5å¹´</code></li>
<li>è¥¿é—¨å­ï¼Œ<code>10å¹´</code></li>
<li>ç«è¶Šï¼Œ<code>15å¹´</code></li>
</ul>
<p>ç”¨<strong>å¹½é»˜ã€æˆè°‘</strong>çš„è¯­æ°”ä»‹ç»è‡ªå·±ï¼Œå¹¶ç€é‡è¯´æ˜è¿™ 3 ä¸ªå…³é”®è¯ä¹‹é—´çš„å…³ç³»ï¼Œç®€æ˜æ‰¼è¦åœ°å®Œæˆè‡ªæˆ‘ä»‹ç»ã€‚</p>
<p>â‘¡ å’¨è¯¢åˆ«äººæ„è§æ€åº¦æ—¶ï¼Œå°†ç¬¬ä¸€äººç§°æ”¹ä¸ºç¬¬ä¸‰äººç§°</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">ç¤ºä¾‹ï¼šä½ çˆ±æˆ‘å—ï¼Ÿä½ è§‰å¾—æˆ‘æ€ä¹ˆæ ·ï¼Ÿ</span><br><span class="line">ä¿®æ”¹ä¸ºï¼šä½ è§‰å¾—èµµè–‡æ€ä¹ˆæ ·ï¼Ÿä½ è§‰å¾—ä»–æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</span><br></pre></td></tr></table></figure>

<h2 id="è¯¾ç¨‹äºŒï¼šä¸šåŠ¡é¢è¯•å®˜åŸ¹è®­"><a href="#è¯¾ç¨‹äºŒï¼šä¸šåŠ¡é¢è¯•å®˜åŸ¹è®­" class="headerlink" title="è¯¾ç¨‹äºŒï¼šä¸šåŠ¡é¢è¯•å®˜åŸ¹è®­"></a><strong>è¯¾ç¨‹äºŒ</strong>ï¼šä¸šåŠ¡é¢è¯•å®˜åŸ¹è®­</h2><p><strong>åŸ¹è®­æ—¶é—´</strong>ï¼š2019å¹´8æœˆ20æ—¥ 14:00-17:00</p>
<p><strong>åœ°ç‚¹</strong>ï¼šåˆ›ç‰Œä¸€æ¥¼ä¼šè®®å®¤ A09</p>
<p><strong>åŸ¹è®­å†…å®¹</strong>ï¼š</p>
<ul>
<li><strong>æ‹›è˜é¢è¯•åŸºæœ¬å«ä¹‰</strong>ï¼šæµ‹è¯„åŠé¢è¯•çš„åŸºæœ¬æ¦‚å¿µå’Œå†å²ï¼Œé¢è¯•çš„åŸºæœ¬æ€åº¦åŠä»ªè¡¨è¦æ±‚ï¼Œé¢è¯•ä¸­å¸¸è§çš„è¯¯å·®ï¼Œé¢è¯•å¯¹äºä¼ä¸šçš„å…¬å…³ä»·å€¼åŠæ„ä¹‰ã€‚</li>
<li><strong>é¢è°ˆçš„æ“ä½œæ–¹æ³•åŠæŠ€å·§</strong>ï¼šBEIï¼ˆè¡Œä¸ºäº‹ä»¶è®¿è°ˆï¼‰éœ€è¦æ³¨æ„çš„äº‹é¡¹ï¼Œå¦‚ä½•è¯†åˆ«è™šå‡çš„ BEIï¼ˆè°è¨€è¯†åˆ«ï¼‰åŠäº‹ä»¶è®¿è°ˆæŠ€å·§ã€‚BEI è¡Œä¸ºäº‹ä»¶é¢è¯•æ³•æœ€æ ¸å¿ƒçš„æ¦‚å¿µå³ â€œäººè¿‡å»è¡¨ç°å‡ºæ¥çš„è¡Œä¸ºæ–¹å¼æ˜¯äººæœªæ¥è¡Œä¸ºæœ€å¯é çš„é¢„æµ‹æŒ‡æ ‡â€ï¼Œä»æ‹›è˜â€œ<strong>æœ€ä¼˜ç§€çš„äºº</strong>â€è½¬å˜è½åœ°ä¸ºæ‹›è˜â€œ<strong>æœ€é€‚åˆçš„äºº</strong>â€ã€‚</li>
<li><strong>é¢è¯•çš„æ–¹æ³•å’ŒæŠ€å·§</strong>ï¼šä¸åŒæƒ…æ™¯ä¸‹çš„å¸¸è§é¢è¯•æ–¹æ³•æ¦‚è§ˆï¼ˆæ ¡å›­æ‹›è˜&amp; ç¤¾ä¼šæ‹›è˜ &amp; å†…éƒ¨ç«è˜ ï¼‰ï¼Œç»“æ„åŒ–é¢è¯•çš„æ¦‚å¿µåŠå…­ç§é—®é¢˜ç±»å‹ï¼Œå¦‚ä½•è¿½é—®å’Œè¯†åˆ«è™šå‡å›ç­”ã€‚</li>
<li><strong>åŸºäºå²—ä½èƒœä»»åŠ›æ¨¡å‹çš„é¢è¯•è¯„ä»·</strong>ï¼šèƒœä»»ç‰¹å¾çš„æ¦‚å¿µåŠç”±æ¥ï¼Œå²—ä½èƒœä»»åŠ›æ¨¡å‹ä¸äººæ‰ç”„é€‰çš„å…³ç³»ï¼Œé¢è¯•é€‰æ‹”çš„ä¾æ®å’Œæ ‡å‡†ï¼Œå¸¸è§çš„ç»´åº¦åŠè¡Œä¸ºè§‚æµ‹ç‚¹ã€‚</li>
<li><strong>å¦‚ä½•é˜…è¯»ç®€å†å¹¶è¿›è¡Œæœ‰æ•ˆæé—®</strong>ï¼šä»ç®€å†ä¸­å¯»æ‰¾ä¸é¢è¯•ç›¸å…³çš„å‡ ç±»ä¿¡æ¯ï¼Œä¾é ç®€å†é¢è¯•çš„æ­¥éª¤ï¼Œæ ‡å‡†åŒ–é¢è¯•æ‹›è˜æµç¨‹å»ºè®®ï¼Œé¢è¯•çš„è¯„åˆ†è¦ç‚¹åŠæŠ€å·§é‡ç”³ã€‚</li>
</ul>
<p><strong>å­¦ä¹ æ”¶è·</strong>ï¼š</p>
<p>â‘  ä½ æœ€è¿‘è¯»ä»€ä¹ˆä¹¦ï¼Ÿæ˜¯ä¸€ä¸ªå¥½é—®é¢˜çš„åˆ‡å…¥ç‚¹ï¼Œé€šè¿‡ä¹¦å±•å¼€äº†è§£çŸ¥è¯†å¹¿åº¦å’Œæ·±åº¦ã€‚</p>
<p>â‘¡ åœ¨ç¡®è®¤æŸä»¶äº‹æƒ…çš„çœŸå®æ€§æ—¶ï¼Œå¯ä»¥æé—® â€œè¯·ä¸¾ä¸€ä¸ªä¾‹å­ï¼Ÿâ€</p>
]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· æµ‹è¯•æ•°æ®é›†</title>
    <url>/blog/2019/10/13/mysql-dataset/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><a href="https://dev.mysql.com/doc/employee/en/employees-introduction.html" target="_blank" rel="noopener">ä»‹ç»</a> | <a href="https://github.com/datacharmer/test_db" target="_blank" rel="noopener">æ•°æ®é›†</a></p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p><strong>ä¸‹è½½</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ wget https://github.com/datacharmer/test_db.git</span><br><span class="line">$ cd test_db</span><br></pre></td></tr></table></figure>

<p><strong>å­˜å‚¨</strong>ï¼šç¼–è¾‘ <code>employees.sql</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">   set storage_engine = InnoDB;</span><br><span class="line">-- set storage_engine = MyISAM;</span><br><span class="line">-- set storage_engine = Falcon;</span><br><span class="line">-- set storage_engine = PBXT;</span><br><span class="line">-- set storage_engine = Maria;</span><br></pre></td></tr></table></figure>

<p><strong>å¯¼å…¥</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ mysql -t -u<span class="string">'xx'</span> -p<span class="string">'xx'</span> &lt; employees.sql</span><br><span class="line">+-----------------------------+</span><br><span class="line">| INFO                        |</span><br><span class="line">+-----------------------------+</span><br><span class="line">| CREATING DATABASE STRUCTURE |</span><br><span class="line">+-----------------------------+</span><br><span class="line">+------------------------+</span><br><span class="line">| INFO                   |</span><br><span class="line">+------------------------+</span><br><span class="line">| storage engine: InnoDB |</span><br><span class="line">+------------------------+</span><br><span class="line">+---------------------+</span><br><span class="line">| INFO                |</span><br><span class="line">+---------------------+</span><br><span class="line">| LOADING departments |</span><br><span class="line">+---------------------+</span><br><span class="line">+-------------------+</span><br><span class="line">| INFO              |</span><br><span class="line">+-------------------+</span><br><span class="line">| LOADING employees |</span><br><span class="line">+-------------------+</span><br><span class="line">+------------------+</span><br><span class="line">| INFO             |</span><br><span class="line">+------------------+</span><br><span class="line">| LOADING dept_emp |</span><br><span class="line">+------------------+</span><br><span class="line">+----------------------+</span><br><span class="line">| INFO                 |</span><br><span class="line">+----------------------+</span><br><span class="line">| LOADING dept_manager |</span><br><span class="line">+----------------------+</span><br><span class="line">+----------------+</span><br><span class="line">| INFO           |</span><br><span class="line">+----------------+</span><br><span class="line">| LOADING titles |</span><br><span class="line">+----------------+</span><br><span class="line">+------------------+</span><br><span class="line">| INFO             |</span><br><span class="line">+------------------+</span><br><span class="line">| LOADING salaries |</span><br><span class="line">+------------------+</span><br></pre></td></tr></table></figure>

<p><strong>æ•°æ®ç»“æ„</strong></p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-13-182810.png" alt></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>é˜¿é‡Œäº‘ Â· RDS</title>
    <url>/blog/2019/10/10/aliyun-rds/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><strong>ä»‹ç»</strong>ï¼šé˜¿é‡Œäº‘ <code>RDS</code>ï¼ˆRelational Database Serviceï¼‰æ˜¯ä¸€ç§<strong>ç¨³å®šå¯é </strong>ã€<strong>å¯å¼¹æ€§ä¼¸ç¼©</strong>çš„åœ¨çº¿æ•°æ®åº“æœåŠ¡ã€‚</p>
<p><strong>åŠŸèƒ½</strong>ï¼šæä¾›<strong>å®¹ç¾</strong>ã€<strong>å¤‡ä»½</strong>ã€<strong>æ¢å¤</strong>ã€<strong>ç›‘æ§</strong>ã€<strong>æŠ¥è­¦</strong>ã€<strong>é«˜å¯ç”¨</strong>ã€<strong>è¿ç§»</strong>ç­‰å…¨å¥—è§£å†³æ–¹æ¡ˆï¼Œå½»åº•è§£å†³æ•°æ®åº“è¿ç»´çš„çƒ¦æ¼ã€‚</p>
<p><strong>æ•°æ®åº“</strong>ï¼šæ”¯æŒ <code>MySQL</code>ã€<code>SQL Server</code>ã€<code>PostgreSQL</code>ã€ <code>MariaDB</code> ç­‰å¼•æ“ã€‚</p>
<p><strong>ä¼˜åŠ¿</strong>ï¼šä¾¿å®œæ˜“ç”¨ï¼ˆæŒ‰éœ€å˜é…ï¼Œçµæ´»è®¡è´¹ï¼‰ã€é«˜æ€§èƒ½ï¼ˆæœ€ä½³å®è·µï¼ŒCloudDBAï¼‰ã€ç¾å¤‡è®¾è®¡ï¼ˆè‡ªåŠ¨å¤‡ä»½ï¼Œå¼‚åœ°å®¹ç¾ï¼‰ã€é«˜å®‰å…¨æ€§ï¼ˆé˜² <code>DDoS</code> æ”»å‡»ï¼Œé“¾è·¯åŠ å¯†ï¼Œè®¿é—®æ§åˆ¶ï¼Œå®‰å…¨å®¡è®¡ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th align="left">å¯¹æ¯”é¡¹</th>
<th align="left">äº‘æ•°æ®åº“ RDS</th>
<th align="left">æœ¬åœ° IDC è‡ªå»º</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æœåŠ¡å¯ç”¨æ€§</td>
<td align="left">é«˜å¯ç”¨æ¶æ„</td>
<td align="left">éœ€è‡ªè¡Œæ­å»ºä¸»å¤‡å¤åˆ¶ï¼Œä¿éšœé«˜å¯ç”¨</td>
</tr>
<tr>
<td align="left">æ•°æ®å¯é æ€§</td>
<td align="left">è‡ªåŠ¨ä¸»å¤‡å¤åˆ¶ã€æ•°æ®å¤‡ä»½ã€æ—¥å¿—å¤‡ä»½</td>
<td align="left">éœ€è‡ªè¡Œçƒ­å¤‡ã€å†·å¤‡</td>
</tr>
<tr>
<td align="left">ç³»ç»Ÿå®‰å…¨æ€§</td>
<td align="left">é˜² <code>DDoS</code> æ”»å‡»ï¼ŒåŠæ—¶ä¿®å¤å„ç§æ•°æ®åº“å®‰å…¨æ¼æ´</td>
<td align="left">è‡ªè¡Œä¿®å¤æ•°æ®åº“å®‰å…¨æ¼æ´</td>
</tr>
<tr>
<td align="left">æ•°æ®åº“å¤‡ä»½</td>
<td align="left">è‡ªåŠ¨å¤‡ä»½</td>
<td align="left">è‡ªè¡Œå®ç°ï¼Œéœ€è¦å¯»æ‰¾å¤‡ä»½å­˜å‚¨ä»¥åŠå®šæœŸæ¼”ç»ƒ</td>
</tr>
<tr>
<td align="left">è½¯ç¡¬ä»¶æŠ•å…¥</td>
<td align="left">æ— è½¯ç¡¬ä»¶æŠ•å…¥ï¼ŒæŒ‰éœ€ä»˜è´¹</td>
<td align="left">æœåŠ¡å™¨æˆæœ¬ç›¸å¯¹è¾ƒé«˜</td>
</tr>
<tr>
<td align="left">ç³»ç»Ÿæ‰˜ç®¡</td>
<td align="left">æ— æ‰˜ç®¡è´¹ç”¨</td>
<td align="left">æœåŠ¡å™¨æœ‰æ‰˜ç®¡è´¹ç”¨</td>
</tr>
<tr>
<td align="left">ç»´æŠ¤æˆæœ¬</td>
<td align="left">æ— éœ€ä¸“èŒè¿ç»´</td>
<td align="left">éœ€è¦ DBA ä¸“èŒè¿ç»´</td>
</tr>
<tr>
<td align="left">éƒ¨ç½²æ‰©å®¹</td>
<td align="left">å³æ—¶å¼€é€šï¼Œå¼¹æ€§æ‰©å®¹</td>
<td align="left">éœ€è¦ç¡¬ä»¶é‡‡è´­ã€å®‰è£…éƒ¨ç½²ç­‰å·¥ä½œï¼Œå‘¨æœŸè¾ƒé•¿</td>
</tr>
<tr>
<td align="left">èµ„æºåˆ©ç”¨ç‡</td>
<td align="left">æŒ‰å®é™…ç»“ç®—ï¼Œ100% åˆ©ç”¨ç‡</td>
<td align="left">ä¸šåŠ¡æœ‰é«˜å³°æœŸå’Œä½å³°æœŸï¼Œèµ„æºåˆ©ç”¨ç‡ä½</td>
</tr>
</tbody></table>
<p><strong>åŸºæœ¬æ¦‚å¿µ</strong>ï¼š</p>
<ul>
<li><strong>å®ä¾‹</strong>ï¼šä¸€ä¸ªç‹¬ç«‹å ç”¨ç‰©ç†å†…å­˜çš„æ•°æ®åº“æœåŠ¡è¿›ç¨‹ï¼Œç”¨æˆ·å¯ä»¥è®¾ç½®ä¸åŒçš„å†…å­˜å¤§å°ã€ç£ç›˜ç©ºé—´å’Œæ•°æ®åº“ç±»å‹ã€‚</li>
<li><strong>æ•°æ®åº“</strong>ï¼šåœ¨ä¸€ä¸ªå®ä¾‹ä¸‹åˆ›å»ºçš„é€»è¾‘å•å…ƒï¼Œä¸€ä¸ªå®ä¾‹å¯ä»¥åˆ›å»ºå¤šä¸ªæ•°æ®åº“ï¼Œæ•°æ®åº“åœ¨å®ä¾‹å†…çš„å‘½åå”¯ä¸€ã€‚</li>
<li><strong>åœ°åŸŸ</strong>ï¼šæ˜¯æŒ‡ç‰©ç†çš„æ•°æ®ä¸­å¿ƒã€‚</li>
<li><strong>å¯ç”¨åŒº</strong>ï¼šæ˜¯æŒ‡åœ¨åŒä¸€åœ°åŸŸå†…ï¼Œç”µåŠ›å’Œç½‘ç»œäº’ç›¸ç‹¬ç«‹çš„ç‰©ç†åŒºåŸŸã€‚</li>
<li><strong>è¿æ¥æ•°</strong>ï¼šå®ä¾‹å½“å‰æ€»è¿æ¥æ•°ï¼ŒåŒ…æ‹¬æ´»è·ƒè¿æ¥æ•°å’Œæ€»è¿æ¥æ•°ã€‚</li>
<li><strong>IOPS</strong>ï¼šå®ä¾‹çš„æ¯ç§’ <code>I/O</code> è¯·æ±‚æ¬¡æ•°ï¼Œå•ä½ï¼šæ¬¡/ç§’ï¼Œè¡¡é‡éšæœºè®¿é—®çš„æ€§èƒ½ã€‚</li>
</ul>
<h2 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><p><strong>é€‰å‹</strong>ï¼ˆownerï¼šæ¶æ„å¸ˆï¼‰-&gt;  ç”³è¯·ï¼ˆownerï¼šé¡¹ç›®ç»ç†ï¼‰-&gt;  äº¤ä»˜ï¼ˆownerï¼šäº‘ç®¡ç†ï¼‰-&gt;  <strong>è¿ç»´</strong>ï¼ˆownerï¼šDBAï¼‰</p>
<h2 id="é€‰å‹"><a href="#é€‰å‹" class="headerlink" title="é€‰å‹"></a>é€‰å‹</h2><h3 id="äº§å“ç³»åˆ—"><a href="#äº§å“ç³»åˆ—" class="headerlink" title="äº§å“ç³»åˆ—"></a>äº§å“ç³»åˆ—</h3><table>
<thead>
<tr>
<th align="left">ç³»åˆ—</th>
<th align="left">è¯´æ˜</th>
<th align="left">é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td align="left">åŸºç¡€ç‰ˆ</td>
<td align="left">å•èŠ‚ç‚¹å®ä¾‹ï¼Œå¯å®ç°è¶…é«˜çš„æ€§ä»·æ¯”ï¼Œè¯·å‚è§<a href="https://help.aliyun.com/document_detail/48980.html#concept-nyq-cvw-5db" target="_blank" rel="noopener">åŸºç¡€ç‰ˆ</a></td>
<td align="left">ä¸ªäººå­¦ä¹  / å¼€å‘æµ‹è¯•</td>
</tr>
<tr>
<td align="left">é«˜å¯ç”¨ç‰ˆ</td>
<td align="left">ä¸€ä¸»ä¸€å¤‡é«˜å¯ç”¨æ¶æ„ï¼Œé€‚åˆ <code>80%</code> ä»¥ä¸Šç”¨æˆ·åœºæ™¯</td>
<td align="left">å¤§ä¸­å‹ä¼ä¸šç”Ÿäº§æ•°æ®åº“</td>
</tr>
<tr>
<td align="left">ä¸‰èŠ‚ç‚¹ä¼ä¸šç‰ˆ</td>
<td align="left">ä¸€ä¸»ä¸¤å¤‡ä¸‰èŠ‚ç‚¹æ¶æ„ï¼Œæä¾›é‡‘èçº§å¯é æ€§ï¼Œè¯·å‚è§<a href="https://help.aliyun.com/document_detail/51701.html#concept-yqy-zvw-5db" target="_blank" rel="noopener">ä¸‰èŠ‚ç‚¹ä¼ä¸šç‰ˆ</a></td>
<td align="left">å¤§å‹ä¼ä¸šæ ¸å¿ƒæ•°æ®åº“</td>
</tr>
</tbody></table>
<p><strong>åŠŸèƒ½å¯¹æ¯”</strong></p>
<table>
<thead>
<tr>
<th align="left">åŠŸèƒ½</th>
<th align="left">åŸºç¡€ç‰ˆ</th>
<th align="left">é«˜å¯ç”¨ç‰ˆï¼ˆæ¨èï¼‰</th>
<th align="left">ä¸‰èŠ‚ç‚¹ä¼ä¸šç‰ˆï¼ˆåŸé‡‘èç‰ˆï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left"></td>
<td align="left">MySQL 5.7 / 8.0</td>
<td align="left">MySQL 5.5 / 5.6 / 5.7 / 8.0</td>
<td align="left">MySQL 5.6 / 5.7</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/102074.html#concept-sp4-jgl-jgb" target="_blank" rel="noopener">ç›‘æ§ä¸æŠ¥è­¦</a></td>
<td align="left">æ”¯æŒ</td>
<td align="left">æ”¯æŒ</td>
<td align="left">æ”¯æŒ</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/43185.html#concept-pdr-k2f-vdb" target="_blank" rel="noopener">IPç™½åå•</a></td>
<td align="left">æ”¯æŒ</td>
<td align="left">æ”¯æŒ</td>
<td align="left">æ”¯æŒ</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/98818.html#concept-l1m-xgn-ydb" target="_blank" rel="noopener">å¤‡ä»½ä¸æ¢å¤</a></td>
<td align="left">æ”¯æŒ</td>
<td align="left">æ”¯æŒ</td>
<td align="left">æ”¯æŒ</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/96063.html#concept-lfl-xmn-wdb" target="_blank" rel="noopener">å‚æ•°è®¾ç½®</a></td>
<td align="left">æ”¯æŒ</td>
<td align="left">æ”¯æŒ</td>
<td align="left">æ”¯æŒ</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/96122.html#concept-ujc-hz4-ydb" target="_blank" rel="noopener">æ—¥å¿—ç®¡ç†</a></td>
<td align="left"><strong>ä¸æ”¯æŒ</strong></td>
<td align="left">æ”¯æŒ</td>
<td align="left">æ”¯æŒ</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/96054.html#task-ftz-42j-wdb" target="_blank" rel="noopener">ä¸»å¤‡åº“åˆ‡æ¢</a></td>
<td align="left"><strong>ä¸æ”¯æŒ</strong></td>
<td align="left">æ”¯æŒ</td>
<td align="left">æ”¯æŒ</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/96120.html#concept-ack-rv4-ydb" target="_blank" rel="noopener">SSL</a></td>
<td align="left"><strong>ä¸æ”¯æŒ</strong></td>
<td align="left">æ”¯æŒ</td>
<td align="left">æ”¯æŒ</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/96121.html#task-jrp-dw4-ydb" target="_blank" rel="noopener">é€æ˜æ•°æ®åŠ å¯†</a></td>
<td align="left"><strong>ä¸æ”¯æŒ</strong></td>
<td align="left">æ”¯æŒ</td>
<td align="left">æ”¯æŒ</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/96124.html#concept-fqw-r5x-wdb" target="_blank" rel="noopener">æ€§èƒ½ä¼˜åŒ–</a></td>
<td align="left"><strong>ä¸æ”¯æŒ</strong></td>
<td align="left">æ”¯æŒ</td>
<td align="left">æ”¯æŒ</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/96053.html#concept-zwp-gdj-wdb" target="_blank" rel="noopener">è¿ç§»å¯ç”¨åŒº</a></td>
<td align="left"><strong>ä¸æ”¯æŒ</strong></td>
<td align="left">æ”¯æŒ</td>
<td align="left">æ”¯æŒ</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/96073.html#concept-ptl-fl4-wdb" target="_blank" rel="noopener">è¯»å†™åˆ†ç¦»</a></td>
<td align="left"><strong>ä¸æ”¯æŒ</strong></td>
<td align="left">æ”¯æŒ</td>
<td align="left">æ”¯æŒ</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/26136.html#concept-cst-z45-vdb" target="_blank" rel="noopener">åªè¯»å®ä¾‹</a></td>
<td align="left"><strong>ä¸æ”¯æŒ</strong></td>
<td align="left"><strong>æ”¯æŒï¼ˆå¦è®¡è´¹ï¼‰</strong></td>
<td align="left"><strong>æ”¯æŒï¼ˆå¦è®¡è´¹ï¼‰</strong></td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/96123.html#task-msp-gz1-mfb" target="_blank" rel="noopener">SQLæ´å¯Ÿ</a></td>
<td align="left"><strong>ä¸æ”¯æŒ</strong></td>
<td align="left"><strong>æ”¯æŒï¼ˆå¦è®¡è´¹ï¼‰</strong></td>
<td align="left"><strong>æ”¯æŒï¼ˆå…è´¹ä½¿ç”¨ï¼‰</strong></td>
</tr>
</tbody></table>
<h3 id="å­˜å‚¨ç±»å‹"><a href="#å­˜å‚¨ç±»å‹" class="headerlink" title="å­˜å‚¨ç±»å‹"></a>å­˜å‚¨ç±»å‹</h3><table>
<thead>
<tr>
<th align="left">å­˜å‚¨ç±»å‹</th>
<th align="left">è¯´æ˜</th>
<th align="left">æ”¯æŒç³»åˆ—</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æœ¬åœ° <code>SSD</code> ç›˜</td>
<td align="left">ä¸æ•°æ®åº“å¼•æ“ä½äºåŒä¸€èŠ‚ç‚¹ï¼Œ<code>I/O</code> å»¶æ—¶ä½</td>
<td align="left">é«˜å¯ç”¨ç‰ˆ / ä¸‰èŠ‚ç‚¹ä¼ä¸šç‰ˆ</td>
</tr>
<tr>
<td align="left"><code>SSD</code> äº‘ç›˜</td>
<td align="left">åŸºäºåˆ†å¸ƒå¼å­˜å‚¨æ¶æ„çš„å¼¹æ€§å—å­˜å‚¨è®¾å¤‡ï¼Œå®ç°è®¡ç®—ä¸å­˜å‚¨åˆ†ç¦»</td>
<td align="left">åŸºç¡€ç‰ˆ</td>
</tr>
<tr>
<td align="left"><code>ESSD</code> äº‘ç›˜</td>
<td align="left">å¢å¼ºå‹ <code>SSD</code> äº‘ç›˜ï¼Œæ˜¯é˜¿é‡Œäº‘å…¨æ–°æ¨å‡ºçš„è¶…é«˜æ€§èƒ½äº‘ç›˜äº§å“</td>
<td align="left">é«˜å¯ç”¨ç‰ˆ / ä¸‰èŠ‚ç‚¹ä¼ä¸šç‰ˆ</td>
</tr>
</tbody></table>
<p><strong>ç‰¹æ€§å¯¹æ¯”</strong></p>
<table>
<thead>
<tr>
<th align="left">å¯¹æ¯”é¡¹</th>
<th align="left">æœ¬åœ° SSD ç›˜ï¼ˆæ¨èï¼‰</th>
<th align="left">SSD äº‘ç›˜</th>
<th align="left">ESSD äº‘ç›˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">I/O æ€§èƒ½</td>
<td align="left">â˜…â˜…â˜…â˜…â˜…</td>
<td align="left">â˜…â˜…â˜…â˜…</td>
<td align="left">â˜…â˜…â˜…â˜…â˜…</td>
</tr>
<tr>
<td align="left">åŠŸèƒ½å®Œå¤‡åº¦</td>
<td align="left">â˜…â˜…â˜…â˜…â˜…</td>
<td align="left">â˜…â˜…â˜…</td>
<td align="left">â˜…â˜…â˜…</td>
</tr>
<tr>
<td align="left">è§„æ ¼é…ç½®çµæ´»æ€§</td>
<td align="left">â˜…â˜…â˜…</td>
<td align="left">â˜…â˜…â˜…â˜…â˜…</td>
<td align="left">â˜…â˜…â˜…â˜…â˜…</td>
</tr>
<tr>
<td align="left">å¼¹æ€§æ‰©å±•èƒ½åŠ›</td>
<td align="left">â˜…â˜…â˜…</td>
<td align="left">â˜…â˜…â˜…â˜…â˜…</td>
<td align="left">â˜…â˜…â˜…â˜…â˜…</td>
</tr>
</tbody></table>
<p><strong>åŠŸèƒ½å¯¹æ¯”</strong></p>
<table>
<thead>
<tr>
<th align="left">å¯¹æ¯”é¡¹</th>
<th align="left">æœ¬åœ° SSD ç›˜</th>
<th align="left">SSD äº‘ç›˜ / ESSD äº‘ç›˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æœ€å¤§å­˜å‚¨å®¹é‡</td>
<td align="left">6 TB</td>
<td align="left">6 TB</td>
</tr>
<tr>
<td align="left">ç½‘ç»œç±»å‹</td>
<td align="left">ç»å…¸ç½‘ç»œå’Œ <code>VPC</code></td>
<td align="left">ç»å…¸ç½‘ç»œå’Œ <code>VPC</code></td>
</tr>
<tr>
<td align="left">å¼¹æ€§å‡é™çº§</td>
<td align="left">æ”¯æŒï¼Œæ—¶é—´ä¸ºå°æ—¶çº§åˆ«ï¼Œå–å†³äºæ•°æ®é‡å¤§å°</td>
<td align="left">æ”¯æŒï¼Œä¸€èˆ¬åªéœ€è¦ <code>10</code> åˆ†é’Ÿ</td>
</tr>
<tr>
<td align="left">è¿ç§»å¯ç”¨åŒº</td>
<td align="left">æ”¯æŒ</td>
<td align="left">å¼€å‘ä¸­</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/26136.html#concept-cst-z45-vdb" target="_blank" rel="noopener">åªè¯»å®ä¾‹</a></td>
<td align="left">æ”¯æŒ</td>
<td align="left">éƒ¨åˆ†å¼•æ“æ”¯æŒ</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/51073.html#concept-ptl-fl4-wdb" target="_blank" rel="noopener">è¯»å†™åˆ†ç¦»</a></td>
<td align="left">æ”¯æŒ</td>
<td align="left">éƒ¨åˆ†å¼•æ“æ”¯æŒ</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/26197.html#concept-njf-cr4-ydb" target="_blank" rel="noopener">SQLå®¡è®¡</a></td>
<td align="left">æ”¯æŒ</td>
<td align="left">å¼€å‘ä¸­</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/59980.html#concept-wpx-tqn-wdb" target="_blank" rel="noopener">CloudDBA</a></td>
<td align="left">æ”¯æŒ</td>
<td align="left">éƒ¨åˆ†å¼•æ“æ”¯æŒ</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/32474.html#concept-ack-rv4-ydb" target="_blank" rel="noopener">SSLåŠ å¯†</a> å’Œ <a href="https://help.aliyun.com/document_detail/33510.html#concept-jrp-dw4-ydb" target="_blank" rel="noopener">TDE</a></td>
<td align="left">æ”¯æŒ</td>
<td align="left">éƒ¨åˆ†å¼•æ“æ”¯æŒ</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/26206.html#concept-l1m-xgn-ydb" target="_blank" rel="noopener">å¤‡ä»½æ–¹å¼</a></td>
<td align="left">ç‰©ç† &amp; é€»è¾‘å¤‡ä»½</td>
<td align="left">å¿«ç…§å¤‡ä»½</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/44088.html#concept-vrh-qp4-ydb" target="_blank" rel="noopener">æŒ‰å¤‡ä»½é›†æ¢å¤</a></td>
<td align="left">æ”¯æŒ</td>
<td align="left">æ”¯æŒ</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/44088.html#concept-vrh-qp4-ydb" target="_blank" rel="noopener">æŒ‰æ—¶é—´ç‚¹æ¢å¤</a></td>
<td align="left">æ”¯æŒ</td>
<td align="left">æ”¯æŒ</td>
</tr>
</tbody></table>
<h3 id="å®ä¾‹è§„æ ¼"><a href="#å®ä¾‹è§„æ ¼" class="headerlink" title="å®ä¾‹è§„æ ¼"></a>å®ä¾‹è§„æ ¼</h3><p>é€šç”¨å‹ vs ç‹¬äº«å‹</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-11-163310.png" alt></p>
<table>
<thead>
<tr>
<th align="left">è§„æ ¼æ—</th>
<th align="left">è§„æ ¼ä»£ç </th>
<th align="left">CPU / å†…å­˜</th>
<th align="left">å­˜å‚¨ç©ºé—´</th>
<th align="left">æœ€å¤§è¿æ¥æ•°</th>
<th align="left">IOPS</th>
<th align="left">åŒ…æœˆä»·</th>
</tr>
</thead>
<tbody><tr>
<td align="left">é€šç”¨å‹</td>
<td align="left">rds.mysql.c1.xlarge</td>
<td align="left">8 æ ¸ 32GB</td>
<td align="left">500GB</td>
<td align="left">8000</td>
<td align="left">12000</td>
<td align="left">ï¿¥1480.00</td>
</tr>
<tr>
<td align="left"><strong>ç‹¬äº«å‹ï¼ˆæ¨èï¼‰</strong></td>
<td align="left">mysql.x4.xlarge.2</td>
<td align="left">8 æ ¸ 32GB</td>
<td align="left">500GB</td>
<td align="left">5000</td>
<td align="left">9000</td>
<td align="left">ï¿¥1800.00</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">è§„æ ¼ä»£ç </th>
<th align="left">CPUæ ¸æ•°</th>
<th align="left">å†…å­˜ï¼ˆGBï¼‰</th>
<th align="left">è¿æ¥æ•°</th>
<th align="left">IOPS</th>
<th align="left">TPS</th>
<th align="left">QPS</th>
</tr>
</thead>
<tbody><tr>
<td align="left">mysql.x8.medium.2</td>
<td align="left">2</td>
<td align="left">16</td>
<td align="left">2500</td>
<td align="left">4500</td>
<td align="left">391</td>
<td align="left">7054</td>
</tr>
<tr>
<td align="left">mysql.x8.large.2</td>
<td align="left">4</td>
<td align="left">32</td>
<td align="left">5000</td>
<td align="left">9000</td>
<td align="left">794</td>
<td align="left">14297</td>
</tr>
<tr>
<td align="left">mysql.x8.xlarge.2</td>
<td align="left">8</td>
<td align="left">64</td>
<td align="left">10000</td>
<td align="left">18000</td>
<td align="left">1541</td>
<td align="left">27751</td>
</tr>
<tr>
<td align="left">mysql.x8.2xlarge.2</td>
<td align="left">16</td>
<td align="left">128</td>
<td align="left">20000</td>
<td align="left">36000</td>
<td align="left">2672</td>
<td align="left">48102</td>
</tr>
<tr>
<td align="left">rds.mysql.st.d13</td>
<td align="left">30</td>
<td align="left">220</td>
<td align="left">64000</td>
<td align="left">20000</td>
<td align="left">3693</td>
<td align="left">65508</td>
</tr>
</tbody></table>
<h3 id="ç½‘ç»œç±»å‹"><a href="#ç½‘ç»œç±»å‹" class="headerlink" title="ç½‘ç»œç±»å‹"></a>ç½‘ç»œç±»å‹</h3><ul>
<li><strong>ç»å…¸ç½‘ç»œ</strong>ï¼šå®ä¾‹ä¹‹é—´ä¸é€šè¿‡ç½‘ç»œè¿›è¡Œéš”ç¦»ï¼Œåªèƒ½ä¾é å®ä¾‹è‡ªèº«çš„ç™½åå•ç­–ç•¥æ¥é˜»æŒ¡éæ³•è®¿é—®ã€‚</li>
<li><strong>ä¸“æœ‰ç½‘ç»œ</strong>ï¼š <code>VPC</code> æ˜¯ä¸€ç§éš”ç¦»çš„ç½‘ç»œç¯å¢ƒï¼Œå®‰å…¨æ€§å’Œæ€§èƒ½å‡é«˜äºä¼ ç»Ÿçš„ç»å…¸ç½‘ç»œï¼Œ<strong>æ¨èä½¿ç”¨ä¸“æœ‰ç½‘ç»œ</strong>ã€‚</li>
</ul>
<h3 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h3><table>
<thead>
<tr>
<th>é€‰é¡¹</th>
<th>é…ç½®</th>
</tr>
</thead>
<tbody><tr>
<td>åœ°åŸŸ</td>
<td>ååŒ— 1ï¼ˆé’å²›ï¼‰</td>
</tr>
<tr>
<td>æ•°æ®åº“ç‰ˆæœ¬</td>
<td>MySQL 5.7</td>
</tr>
<tr>
<td>ç³»åˆ—</td>
<td>é«˜å¯ç”¨ç‰ˆ</td>
</tr>
<tr>
<td>å­˜å‚¨ç±»å‹</td>
<td>æœ¬åœ° SSD ç›˜</td>
</tr>
<tr>
<td>å¯ç”¨åŒº</td>
<td>å¯ç”¨åŒº C / å¯ç”¨åŒº B</td>
</tr>
<tr>
<td>ç½‘ç»œç±»å‹</td>
<td>ä¸“æœ‰ç½‘ç»œ</td>
</tr>
<tr>
<td>è§„æ ¼</td>
<td>8 æ ¸ 32Gï¼ˆç‹¬äº«å¥—é¤ï¼‰</td>
</tr>
<tr>
<td>å­˜å‚¨ç©ºé—´</td>
<td>500GB</td>
</tr>
</tbody></table>
<h2 id="è¿ç»´"><a href="#è¿ç»´" class="headerlink" title="è¿ç»´"></a>è¿ç»´</h2><h3 id="å¼€é€šæœåŠ¡"><a href="#å¼€é€šæœåŠ¡" class="headerlink" title="å¼€é€šæœåŠ¡"></a>å¼€é€šæœåŠ¡</h3><p><strong>ç™»å½•</strong>ï¼š<a href="https://signin.aliyun.com/login.htm" target="_blank" rel="noopener">å…¥å£</a></p>
<p><strong>RAMè´¦å·</strong>ï¼šraohui@1596633715004367.onaliyun.com</p>
<h3 id="å¿«é€Ÿä½¿ç”¨"><a href="#å¿«é€Ÿä½¿ç”¨" class="headerlink" title="å¿«é€Ÿä½¿ç”¨"></a>å¿«é€Ÿä½¿ç”¨</h3><p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-11-092550.png" alt></p>
<p><strong>åˆ›å»ºå®ä¾‹</strong>ï¼šäº‘ç®¡ç†å›¢é˜Ÿæä¾›</p>
<p><strong>è®¾ç½®ç™½åå•</strong>ï¼šå°†é€šç”¨ç™½åå•æ¨¡å¼åˆ‡æ¢ä¸ºé«˜å®‰å…¨ç™½åå•æ¨¡å¼ï¼Œæ‹¥æœ‰æ›´é«˜çš„å®‰å…¨æ€§</p>
<table>
<thead>
<tr>
<th>ç½‘ç»œç±»å‹</th>
<th>ç™½åå•</th>
</tr>
</thead>
<tbody><tr>
<td>ä¸“æœ‰ç½‘ç»œ</td>
<td>10.138.0.0/16,10.153.0.0/16,10.163.0.0/16,10.133.0.0/16,10.190.0.0/16</td>
</tr>
</tbody></table>
<p><strong>åˆ›å»ºæ•°æ®åº“</strong>ï¼šæ¨èåº“åä¸åº”ç”¨åç§°å°½é‡ä¸€è‡´ï¼Œç”±å°å†™å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿æˆ–ä¸­åˆ’çº¿ç»„æˆï¼Œé»˜è®¤å­—ç¬¦é›† <code>utf8</code></p>
<p><strong>åˆ›å»ºè´¦å·</strong></p>
<table>
<thead>
<tr>
<th>è´¦å·ç±»å‹</th>
<th>è¯´æ˜</th>
<th>æƒé™</th>
</tr>
</thead>
<tbody><tr>
<td>é«˜æƒé™è´¦å·</td>
<td>æ‹¥æœ‰å®ä¾‹ä¸‹æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰æƒé™ï¼Œä¸€ä¸ªå®ä¾‹ä¸­åªèƒ½åˆ›å»ºä¸€ä¸ª</td>
<td><a href="https://help.aliyun.com/document_detail/96089.html?spm=a2c4g.11186623.6.674.41cb2f36ofYQv8#section-qgv-4q5-tfb" target="_blank" rel="noopener">åˆ—è¡¨</a></td>
</tr>
<tr>
<td>æ™®é€šè´¦å·</td>
<td>å››ç§ç±»å‹æƒé™ï¼š<strong>åªè¯»</strong> / <strong>è¯»å†™</strong> / ä»…DDL / ä»…DML</td>
<td><a href="https://help.aliyun.com/document_detail/96089.html?spm=a2c4g.11186623.6.674.41cb2f36ofYQv8#section-qgv-4q5-tfb" target="_blank" rel="noopener">åˆ—è¡¨</a></td>
</tr>
</tbody></table>
<p><strong>å¯†ç </strong>ï¼šç”±å¤§å†™å­—æ¯ã€å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ä¸­çš„ä»»æ„ä¸‰ç§ç»„æˆï¼Œç‰¹æ®Šå­—ç¬¦ä¸º <code>!@#$%^&amp;*()_+-=</code></p>
<h3 id="ç›‘æ§å‘Šè­¦"><a href="#ç›‘æ§å‘Šè­¦" class="headerlink" title="ç›‘æ§å‘Šè­¦"></a>ç›‘æ§å‘Šè­¦</h3><p><strong>ç›‘æ§</strong></p>
<table>
<thead>
<tr>
<th align="left">å®ä¾‹ç±»å‹</th>
<th align="left">5ç§’/æ¬¡</th>
<th align="left">60ç§’/æ¬¡</th>
<th align="left">300ç§’/æ¬¡</th>
</tr>
</thead>
<tbody><tr>
<td align="left">åŸºç¡€ç‰ˆ</td>
<td align="left">ä¸æ”¯æŒ</td>
<td align="left">å…è´¹æ”¯æŒ</td>
<td align="left"><strong>é»˜è®¤é…ç½®</strong></td>
</tr>
<tr>
<td align="left">é«˜å¯ç”¨ç‰ˆã€ä¸‰èŠ‚ç‚¹ä¼ä¸šç‰ˆï¼šå†…å­˜ &lt; 8G</td>
<td align="left">ä¸æ”¯æŒ</td>
<td align="left">å…è´¹æ”¯æŒ</td>
<td align="left"><strong>é»˜è®¤é…ç½®</strong></td>
</tr>
<tr>
<td align="left">é«˜å¯ç”¨ç‰ˆã€ä¸‰èŠ‚ç‚¹ä¼ä¸šç‰ˆï¼šå†…å­˜ &gt;= 8G</td>
<td align="left">ä»˜è´¹æ”¯æŒ</td>
<td align="left"><strong>é»˜è®¤é…ç½®</strong></td>
<td align="left">å…è´¹æ”¯æŒ</td>
</tr>
</tbody></table>
<p><strong>å‘Šè­¦</strong>ï¼š<a href="https://huiraoo.github.io/blog/2019/10/09/mysql-hdm/">ç»Ÿä¸€å‘Šè­¦</a>ï¼Œéœ€è¦è‡ªè¡Œ<a href="https://help.aliyun.com/document_detail/96113.html?spm=a2c4g.11186623.2.26.5a2849eat7zURd#concept-ir2-twp-wdb" target="_blank" rel="noopener">è®¾ç½®æŠ¥è­¦è§„åˆ™</a></p>
<h3 id="å¤‡ä»½æ¢å¤"><a href="#å¤‡ä»½æ¢å¤" class="headerlink" title="å¤‡ä»½æ¢å¤"></a>å¤‡ä»½æ¢å¤</h3><table>
<thead>
<tr>
<th>å¤‡ä»½æ–¹å¼</th>
<th>é»˜è®¤</th>
<th>å­˜å‚¨</th>
<th>æ¢å¤</th>
<th>è®¡è´¹</th>
</tr>
</thead>
<tbody><tr>
<td>é»˜è®¤å¤‡ä»½</td>
<td>å¼€å¯</td>
<td>å®ä¾‹æ‰€åœ¨åœ°åŸŸ</td>
<td><a href="https://help.aliyun.com/document_detail/96147.html?spm=a2c4g.11186623.2.18.1f4148ceRRiyUY#concept-vrh-qp4-ydb" target="_blank" rel="noopener">å½“å‰åœ°åŸŸçš„æ–°å®ä¾‹æˆ–åŸå®ä¾‹</a></td>
<td>å…è´¹é¢åº¦ = 50% * å­˜å‚¨ç©ºé—´</td>
</tr>
<tr>
<td>è·¨åœ°åŸŸå¤‡ä»½</td>
<td>å…³é—­</td>
<td>å¦ä¸€ä¸ªåœ°åŸŸ</td>
<td>æºåœ°åŸŸæˆ–ç›®çš„åœ°åŸŸçš„æ–°å®ä¾‹</td>
<td>å­˜å‚¨ 0.001å…ƒ/GB/å°æ—¶ + <a href="https://help.aliyun.com/document_detail/70005.html?spm=a2c4g.11186623.2.19.1f4148ceRRiyUY#h2-rds-3" target="_blank" rel="noopener">æµé‡è´¹</a></td>
</tr>
</tbody></table>
<p>é»˜è®¤å¤‡ä»½</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-12-093300.png" alt></p>
<h3 id="å¼‚åœ°å®¹ç¾"><a href="#å¼‚åœ°å®¹ç¾" class="headerlink" title="å¼‚åœ°å®¹ç¾"></a>å¼‚åœ°å®¹ç¾</h3><p><strong>åœºæ™¯</strong>ï¼šå¯¹äºæ•°æ®å¯é æ€§æœ‰å¼ºéœ€æ±‚çš„ä¸šåŠ¡åœºæ™¯æˆ–æ˜¯æœ‰ç›‘ç®¡éœ€æ±‚çš„é‡‘èä¸šåŠ¡åœºæ™¯ã€‚</p>
<ul>
<li><a href="https://help.aliyun.com/document_detail/26137.html?spm=a2c4g.11186623.2.11.438719bbr36Auk#concept-bpb-gw5-vdb" target="_blank" rel="noopener">ç¾å¤‡å®ä¾‹</a>ï¼šé€šè¿‡<a href="https://help.aliyun.com/document_detail/26592.html" target="_blank" rel="noopener">æ•°æ®ä¼ è¾“æœåŠ¡</a>ï¼ˆ<code>DTS</code>ï¼‰å®ç°ä¸»å®ä¾‹å’Œå¼‚åœ°ç¾å¤‡å®ä¾‹ä¹‹é—´çš„å®æ—¶åŒæ­¥ï¼Œç¾å¤‡å®ä¾‹ä¸ä¸»å®ä¾‹é…ç½®å®Œå…¨ç›¸åŒï¼Œå½“ä¸»å®ä¾‹æ‰€åœ¨åŒºåŸŸå‘ç”Ÿçªå‘æ€§è‡ªç„¶ç¾å®³ç­‰çŠ¶å†µï¼Œä¸»èŠ‚ç‚¹ï¼ˆ<code>Master</code>ï¼‰å’Œå¤‡èŠ‚ç‚¹ï¼ˆ<code>Slave</code>ï¼‰å‡æ— æ³•è¿æ¥æ—¶ï¼Œå¯å°†å¼‚åœ°ç¾å¤‡å®ä¾‹åˆ‡æ¢ä¸ºä¸»å®ä¾‹ï¼Œåœ¨åº”ç”¨ç«¯ä¿®æ”¹æ•°æ®åº“é“¾æ¥åœ°å€åï¼Œå³å¯å¿«é€Ÿæ¢å¤åº”ç”¨çš„ä¸šåŠ¡è®¿é—®ï¼Œ<strong>è®¡è´¹ï¼šç¾å¤‡å®ä¾‹ + DTS</strong>ã€‚</li>
<li><a href="https://help.aliyun.com/document_detail/120824.html?spm=a2c4g.11186623.2.12.438719bbxQlAAm#concept-405443" target="_blank" rel="noopener">è·¨åœ°åŸŸå¤‡ä»½</a>ï¼šè‡ªåŠ¨å°†æœ¬åœ°å¤‡ä»½æ–‡ä»¶å¤åˆ¶åˆ°å¦ä¸€ä¸ªåœ°åŸŸçš„ <code>OSS</code> ä¸Šï¼Œæ–‡ä»¶å¯ä¿ç•™ <code>7~1825</code> å¤©ï¼Œå³æœ€å¤šä¿ç•™ <code>5</code> å¹´ï¼Œ<strong>è®¡è´¹ï¼šå­˜å‚¨ï¼ˆ0.001å…ƒ/GB/å°æ—¶ï¼‰ + <a href="https://help.aliyun.com/document_detail/70005.html?spm=a2c4g.11186623.2.19.1f4148ceRRiyUY#h2-rds-3" target="_blank" rel="noopener">æµé‡è´¹</a>ã€‚</strong></li>
</ul>
<h3 id="é«˜å¯ç”¨"><a href="#é«˜å¯ç”¨" class="headerlink" title="é«˜å¯ç”¨"></a>é«˜å¯ç”¨</h3><p>è´­ä¹°æ—¶å»ºè®®é€‰æ‹©<strong>é«˜å¯ç”¨ç‰ˆ</strong>ï¼Œæˆ–æ›´é«˜çš„<strong>ä¸‰èŠ‚ç‚¹ä¼ä¸šç‰ˆ</strong>ï¼Œé«˜å¯ç”¨ç‰ˆå®ä¾‹æœ‰ä¸€ä¸ªå¤‡å®ä¾‹ï¼Œä¸‰èŠ‚ç‚¹ä¼ä¸šç‰ˆå®ä¾‹æœ‰ä¸¤ä¸ªå¤‡å®ä¾‹ï¼Œä¸»å¤‡å®ä¾‹çš„æ•°æ®ä¼šå®æ—¶åŒæ­¥ï¼Œä¸šåŠ¡åªèƒ½è®¿é—®ä¸»å®ä¾‹ï¼Œå¤‡å®ä¾‹ä»…ä½œä¸ºå¤‡ä»½å½¢å¼å­˜åœ¨ï¼Œä¸æä¾›ä¸šåŠ¡è®¿é—®ã€‚</p>
<ul>
<li><strong>è‡ªåŠ¨åˆ‡æ¢</strong>ï¼šå®ä¾‹é»˜è®¤ä¸ºè‡ªåŠ¨åˆ‡æ¢ï¼Œå½“ä¸»å®ä¾‹å‡ºç°æ•…éšœæ— æ³•è®¿é—®æ—¶ï¼Œä¼šå®ç°ç§’çº§è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡å®ä¾‹ã€‚</li>
<li><strong>æ‰‹åŠ¨åˆ‡æ¢</strong>ï¼šå³ä½¿è‡ªåŠ¨åˆ‡æ¢æ˜¯å¼€å¯çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨è¿›è¡Œä¸»å¤‡åˆ‡æ¢ã€‚</li>
</ul>
<p>å•å¯ç”¨åŒº</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-12-094143.png" alt></p>
<p>å¤šå¯ç”¨åŒº</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-12-094215.png" alt></p>
<h3 id="è¯»å†™åˆ†ç¦»"><a href="#è¯»å†™åˆ†ç¦»" class="headerlink" title="è¯»å†™åˆ†ç¦»"></a>è¯»å†™åˆ†ç¦»</h3><p><strong>åœºæ™¯</strong>ï¼šåœ¨å¯¹æ•°æ®åº“æœ‰å°‘é‡å†™è¯·æ±‚ï¼Œä½†æœ‰å¤§é‡è¯»è¯·æ±‚çš„åº”ç”¨åœºæ™¯ä¸‹ï¼Œå•ä¸ªå®ä¾‹å¯èƒ½æ— æ³•æ‰¿å—è¯»å–å‹åŠ›ï¼Œç”šè‡³å¯¹ä¸šåŠ¡äº§ç”Ÿå½±å“ï¼Œä¸ºäº†åˆ†æ‹…æ•°æ®åº“å‹åŠ›ï¼Œåˆ›å»º<a href="https://help.aliyun.com/document_detail/26136.html?spm=a2c4g.11186623.6.599.179411b2DWRQex" target="_blank" rel="noopener">åªè¯»å®ä¾‹</a>ï¼Œæ»¡è¶³å¤§é‡çš„æ•°æ®åº“è¯»å–éœ€æ±‚ï¼Œå¢åŠ åº”ç”¨çš„ååé‡ã€‚</p>
<p><strong>åŸç†</strong>ï¼šåˆ›å»ºåªè¯»å®ä¾‹æ—¶ä¼šä»å¤‡å®ä¾‹å¤åˆ¶æ•°æ®ï¼Œæ•°æ®ä¸ä¸»å®ä¾‹ä¸€è‡´ï¼Œä¸»å®ä¾‹çš„æ•°æ®æ›´æ–°ä¹Ÿä¼šåœ¨ä¸»å®ä¾‹å®Œæˆæ“ä½œåç«‹å³è‡ªåŠ¨åŒæ­¥åˆ°æ‰€æœ‰åªè¯»å®ä¾‹ï¼Œä¹Ÿå¯ä»¥åœ¨åªè¯»å®ä¾‹ä¸Šè®¾ç½®<a href="https://help.aliyun.com/document_detail/96056.html#task-dk2-kjq-p2b" target="_blank" rel="noopener">åªè¯»å®ä¾‹å»¶æ—¶å¤åˆ¶</a>ã€‚</p>
<p>åªè¯»å®ä¾‹ vs ä¸»å¤‡å®ä¾‹ vs ç¾å¤‡å®ä¾‹</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-12-101600.png" alt></p>
<h3 id="æ•°æ®å®‰å…¨"><a href="#æ•°æ®å®‰å…¨" class="headerlink" title="æ•°æ®å®‰å…¨"></a>æ•°æ®å®‰å…¨</h3><p>æä¾›äº†å¤šæ ·åŒ–çš„å®‰å…¨åŠ å›ºåŠŸèƒ½æ¥ä¿éšœç”¨æˆ·æ•°æ®çš„å®‰å…¨ï¼Œå…¶ä¸­åŒ…æ‹¬ä½†ä¸é™äºï¼š</p>
<p>â‘  <strong>ç½‘ç»œ</strong>ï¼š<code>IP</code> ç™½åå•ã€<code>VPC</code> ç½‘ç»œã€<code>SSL</code>ï¼ˆå®‰å…¨å¥—æ¥å±‚åè®®ï¼‰</p>
<p>â‘¡ <strong>å­˜å‚¨</strong>ï¼š<code>TDE</code>ï¼ˆé€æ˜æ•°æ®åŠ å¯†ï¼‰ã€è‡ªåŠ¨å¤‡ä»½</p>
<p>â‘¢ <strong>å®¹ç¾</strong>ï¼šåŒåŸå®¹ç¾ï¼ˆå¤šå¯ç”¨åŒºå®ä¾‹ï¼‰ã€å¼‚åœ°å®¹ç¾ï¼ˆä¸¤åœ°å¤šä¸­å¿ƒ)</p>
<p><strong>ç™½åå•</strong>ï¼šå¯ä»¥è®©å®ä¾‹å¾—åˆ°é«˜çº§åˆ«çš„è®¿é—®å®‰å…¨ä¿æŠ¤ï¼Œå»ºè®®å®šæœŸç»´æŠ¤ã€‚</p>
<ul>
<li>é»˜è®¤çš„ <code>IP</code> ç™½åå•åªåŒ…å«é»˜è®¤åœ°å€ <code>127.0.0.1</code>ï¼Œè¡¨ç¤ºä»»ä½•è®¾å¤‡å‡æ— æ³•è®¿é—®è¯¥ <code>RDS</code> å®ä¾‹</li>
<li><code>0.0.0.0/0</code> è¡¨ç¤ºå…è®¸ä»»ä½•è®¾å¤‡è®¿é—® <code>RDS</code> å®ä¾‹ï¼Œè¯·è°¨æ…ä½¿ç”¨</li>
<li>é«˜å®‰å…¨ç™½åå•æ¨¡å¼ä¸‹ï¼Œç»å…¸ç½‘ç»œç™½åå•åˆ†ç»„é€‚ç”¨äºå…¬ç½‘è®¿é—®ï¼Œå¦‚æœæœ‰å…¬ç½‘è®¾å¤‡è¦è®¿é—® <code>RDS</code> å®ä¾‹ï¼Œè¯·å°†å…¬ç½‘è®¾å¤‡ <code>IP</code> åœ°å€æ·»åŠ åˆ°ç»å…¸ç½‘ç»œç™½åå•åˆ†ç»„</li>
</ul>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-12-103244.png" alt></p>
<p><strong>SSLåŠ å¯†</strong>ï¼š<code>SSL</code> åœ¨ä¼ è¾“å±‚å¯¹ç½‘ç»œè¿æ¥è¿›è¡ŒåŠ å¯†ï¼Œèƒ½æå‡é€šä¿¡é“¾è·¯æ•°æ®çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ï¼Œä½†ä¼šåŒæ—¶å¢åŠ ç½‘ç»œè¿æ¥å“åº”æ—¶é—´ï¼Œå¼€é€š <code>SSL</code> åŠ å¯†åï¼Œåº”ç”¨æˆ–è€…å®¢æˆ·ç«¯è¿æ¥ <code>RDS</code> æ—¶éœ€è¦é…ç½® <code>SSL CA</code> è¯ä¹¦ã€‚</p>
<p><strong>é€æ˜æ•°æ®åŠ å¯† TDE</strong>ï¼šTDEï¼ˆTransparent Data Encryptionï¼‰å¯å¯¹æ•°æ®æ–‡ä»¶æ‰§è¡Œå®æ—¶ <code>I/O</code> åŠ å¯†å’Œè§£å¯†ï¼Œæ•°æ®åœ¨å†™å…¥ç£ç›˜ä¹‹å‰è¿›è¡ŒåŠ å¯†ï¼Œä»ç£ç›˜è¯»å…¥å†…å­˜æ—¶è¿›è¡Œè§£å¯†ã€‚<code>TDE</code> ä¸ä¼šå¢åŠ æ•°æ®æ–‡ä»¶çš„å¤§å°ï¼Œå¼€å‘äººå‘˜æ— éœ€æ›´æ”¹ä»»ä½•åº”ç”¨ç¨‹åºï¼Œå³å¯ä½¿ç”¨ <code>TDE</code> åŠŸèƒ½ã€‚</p>
<p><strong>äº‘ç›˜åŠ å¯†</strong>ï¼šé˜¿é‡Œäº‘å…è´¹æä¾›äº‘ç›˜åŠ å¯†åŠŸèƒ½ï¼ŒåŸºäºå—å­˜å‚¨å¯¹æ•´ä¸ªæ•°æ®ç›˜è¿›è¡ŒåŠ å¯†ï¼Œå³ä½¿æ•°æ®å¤‡ä»½æ³„éœ²ä¹Ÿæ— æ³•è§£å¯†ï¼Œæœ€å¤§é™åº¦ä¿æŠ¤æ•°æ®å®‰å…¨ï¼Œè€Œä¸”åŠ å¯†ä¸ä¼šå½±å“ä¸šåŠ¡ï¼Œåº”ç”¨ç¨‹åºä¹Ÿæ— éœ€ä¿®æ”¹ã€‚</p>
<h3 id="è¯Šæ–­ä¼˜åŒ–"><a href="#è¯Šæ–­ä¼˜åŒ–" class="headerlink" title="è¯Šæ–­ä¼˜åŒ–"></a>è¯Šæ–­ä¼˜åŒ–</h3><p><strong>æ—¥å¿—ç®¡ç†</strong>ï¼šé”™è¯¯æ—¥å¿—ã€æ…¢æ—¥å¿—ã€ä¸»å¤‡åˆ‡æ¢æ—¥å¿—ï¼Œå¸®åŠ©æ•…éšœå®šä½åˆ†æ</p>
<ul>
<li><p><strong>é”™è¯¯æ—¥å¿—</strong>ï¼šè®°å½• <code>1</code> ä¸ªæœˆå†…æ•°æ®åº“è¿è¡Œå‡ºé”™çš„æ—¥å¿—ã€‚</p>
</li>
<li><p><strong>æ…¢æ—¥å¿—</strong>ï¼šå¯¹ <code>1</code> ä¸ªæœˆå†…æ•°æ®åº“ä¸­æ‰§è¡Œæ—¶é—´è¶…è¿‡ <code>1</code> ç§’ï¼ˆå¯ä»¥åœ¨<a href="https://help.aliyun.com/document_detail/96063.html#concept-lfl-xmn-wdb" target="_blank" rel="noopener">å‚æ•°è®¾ç½®</a> ä¸­ä¿®æ”¹ <code>long_query_time</code> æ¥è®¾ç½®ï¼‰çš„ <code>SQL</code> è¯­å¥è¿›è¡Œç»Ÿè®¡æ±‡æ€»ï¼Œæ§åˆ¶å°æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ï¼Œå®æ—¶çš„æ…¢æ—¥å¿—æ˜ç»†å¯ä»¥æŸ¥çœ‹ <code>mysql.slow_log</code> è¡¨ã€‚</p>
</li>
<li><p><strong>ä¸»å¤‡åˆ‡æ¢æ—¥å¿—</strong>ï¼šè¯¥åŠŸèƒ½é€‚ç”¨äºé«˜å¯ç”¨ç‰ˆã€ä¸‰èŠ‚ç‚¹ä¼ä¸šç‰ˆã€‚</p>
</li>
</ul>
<p><strong>ä¼˜åŒ–åˆ†æ</strong>ï¼šCloudDBAï¼ˆ<a href="https://help.aliyun.com/document_detail/128450.html?spm=a2c4g.11186623.6.738.2c523e41D3xODK" target="_blank" rel="noopener">æ…¢SQL</a>ã€<a href="https://help.aliyun.com/document_detail/128449.html?spm=a2c4g.11186623.6.737.277517b6vOn3F3" target="_blank" rel="noopener">å®æ—¶ä¼šè¯</a>ã€<a href="https://help.aliyun.com/document_detail/128456.html?spm=a2c4g.11186623.6.744.684d491fBOr7tL" target="_blank" rel="noopener">SQLä¼˜åŒ–</a>ã€<a href="https://help.aliyun.com/document_detail/128452.html?spm=a2c4g.11186623.6.740.34ca35a6nvMLEO" target="_blank" rel="noopener">ç©ºé—´åˆ†æ</a>ã€<a href="https://help.aliyun.com/document_detail/128455.html?spm=a2c4g.11186623.6.743.222b650aIRkmEW" target="_blank" rel="noopener">æ­»é”</a>ã€<a href="https://help.aliyun.com/document_detail/128453.html?spm=a2c4g.11186623.6.741.2ff835a6XmFXQu" target="_blank" rel="noopener">è¯Šæ–­æŠ¥å‘Š</a>ï¼‰</p>
]]></content>
      <categories>
        <category>é˜¿é‡Œäº‘</category>
      </categories>
  </entry>
  <entry>
    <title>é˜¿é‡Œäº‘ Â· æ•°æ®åº“ç½‘å…³</title>
    <url>/blog/2019/10/10/aliyun-dbgateway/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><strong>æ•°æ®åº“ç½‘å…³</strong>ï¼ˆDatabase Gatewayï¼Œ<code>DG</code>ï¼‰æ— éœ€æœ¬åœ°å¼€é€šå…¬ç½‘ç«¯å£ï¼Œå°†æœ¬åœ°æ•°æ®åº“ä¸äº‘æœåŠ¡è¿æ¥èµ·æ¥ï¼Œä¸”å¯ä»¥ä¸é˜¿é‡Œäº‘äº§å“ï¼ˆå¦‚ï¼šæ•°æ®ä¼ è¾“æœåŠ¡ <code>DTS</code>ï¼Œæ•°æ®åº“å¤‡ä»½ <code>DBS</code>ï¼Œæ•°æ®ç®¡ç† <code>DMS</code>ï¼Œæ··åˆæ•°æ®åº“ç®¡ç† <code>HDM</code> ç­‰ï¼‰é›†æˆä½¿ç”¨ï¼Œæä¾›å®‰å…¨ã€å¯é ã€ä½æˆæœ¬çš„ç§ç½‘æ•°æ®åº“æ¥å…¥èƒ½åŠ›ã€‚</p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>é€šè¿‡æ•°æ®åº“ç½‘å…³ï¼Œå¯ä»¥ä½¿ç”¨åº”ç”¨ç¨‹åºæˆ–äº‘æœåŠ¡è®¿é—®å¹¶ç®¡ç†æœ¬åœ° <code>IDC</code> æ•°æ®åº“å’Œå…¶ä»–äº‘å‚å•†æ•°æ®åº“ã€‚</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-10-161400.png" alt></p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<p>â‘  æœ¬åœ°å®‰è£…ä¸€ä¸ª<strong>æ•°æ®åº“ç½‘å…³ä»£ç†</strong>ï¼ˆdatabase gateway agentï¼‰</p>
<p>â‘¡ ç½‘å…³ä»£ç†è´Ÿè´£ä¸<strong>æ•°æ®åº“ç½‘å…³äº‘ç«¯æœåŠ¡</strong>ï¼ˆdatabase gateway cloud serviceï¼‰å»ºç«‹å®‰å…¨çš„ã€å¯ä¿¡ä»»çš„é€šé“ï¼Œä¸åŒè´¦å·ã€ä¸åŒç½‘å…³æ‰€å»ºç«‹çš„é€šé“å½¼æ­¤éš”ç¦»</p>
<p>â‘¢ é€šé“å»ºç«‹åï¼Œå½“åœ¨äº‘ç«¯ä½¿ç”¨æ•°æ®åº“äº§å“ï¼ˆå¦‚ <code>HDM</code>ã€<code>DBS</code>ï¼‰éœ€è¦è®¿é—®è¯¥ç½‘ç»œå†…çš„æœ¬åœ°æ•°æ®åº“æ—¶ï¼Œæ•°æ®åº“äº§å“ä¼šé€šè¿‡å·²å»ºç«‹å¥½çš„é€šé“ï¼Œè®¿é—®è‡³æœ¬åœ°ç½‘ç»œ</p>
<h2 id="DBGateway"><a href="#DBGateway" class="headerlink" title="DBGateway"></a>DBGateway</h2><p>æ˜¯ <code>HDM</code> çš„ä¸€ä¸ªç»„ä»¶ï¼Œéƒ¨ç½²åœ¨ç”¨æˆ·ç¯å¢ƒä¸­çš„ <code>Daemon</code> ç¨‹åºï¼Œå®ƒè´Ÿè´£è¿›è¡Œæ•°æ®åº“æ€§èƒ½æ•°æ®çš„é‡‡é›†ã€è®¡ç®—ï¼Œä¸è¯»å–ç”¨æˆ·ä¸šåŠ¡æ•°æ®ï¼Œå¹¶ä¸”é€šè¿‡åŠ å¯†å‹ç¼©çš„æ–¹å¼è¿›è¡Œé€šä¿¡ã€‚</p>
<p><strong>ç›®å½•ç»“æ„</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ bin</span><br><span class="line">â”‚   â”œâ”€â”€ dbgateway</span><br><span class="line">â”‚   â””â”€â”€ dbgateway-manager</span><br><span class="line">â”œâ”€â”€ conf</span><br><span class="line">â”‚   â”œâ”€â”€ dbgateway.conf</span><br><span class="line">â”‚   â””â”€â”€ server.crt</span><br><span class="line">â””â”€â”€ log</span><br><span class="line">    â”œâ”€â”€ dbgateway.err</span><br><span class="line">    â”œâ”€â”€ dbgateway.log</span><br><span class="line">    â””â”€â”€ dbgateway_manager.log</span><br></pre></td></tr></table></figure>

<p><strong>å¸¸ç”¨å‘½ä»¤</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é‡å¯ </span></span><br><span class="line">/opt/dbgateway/bin/dbgateway-manager -d restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨ </span></span><br><span class="line">/opt/dbgateway/bin/dbgateway-manager -d start</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢ </span></span><br><span class="line">/opt/dbgateway/bin/dbgateway-manager -d stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤</span></span><br><span class="line">rm -rf /opt/dbgateway</span><br></pre></td></tr></table></figure>

<h2 id="APIå‚è€ƒ"><a href="#APIå‚è€ƒ" class="headerlink" title="APIå‚è€ƒ"></a>APIå‚è€ƒ</h2><table>
<thead>
<tr>
<th align="left">API</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/123415.html#concept-861901" target="_blank" rel="noopener">CreateGateway</a></td>
<td align="left">åˆ›å»ºç½‘å…³</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/123570.html#concept-878728" target="_blank" rel="noopener">ModifyGateway</a></td>
<td align="left">ä¿®æ”¹ç½‘å…³</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/123572.html#concept-878734" target="_blank" rel="noopener">DeleteGateway</a></td>
<td align="left">åˆ é™¤ç½‘å…³</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/123575.html#concept-878745" target="_blank" rel="noopener">StopGateway</a></td>
<td align="left">åœæ­¢ç½‘å…³</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/123579.html#concept-878753" target="_blank" rel="noopener">CreateGatewayVerifyCode</a></td>
<td align="left">ç”Ÿæˆçº¿ä¸‹å®‰è£…ç½‘å…³æ—¶éœ€è¦çš„éªŒè¯ç </td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/123581.html#concept-878756" target="_blank" rel="noopener">DownloadGatewayProgram</a></td>
<td align="left">è¿”å›ç½‘å…³ç¨‹åºçš„ä¸‹è½½åœ°å€</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/123590.html#concept-878811" target="_blank" rel="noopener">ConnectDatabase</a></td>
<td align="left">é€šè¿‡ç½‘å…³è¿æ¥æ•°æ®åº“</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/123703.html#concept-895452" target="_blank" rel="noopener">GetUserDatabases</a></td>
<td align="left">è¿”å›ç”¨æˆ·æ•°æ®åº“åˆ—è¡¨ä¿¡æ¯</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/123602.html#concept-878845" target="_blank" rel="noopener">AddDatabase</a></td>
<td align="left">æ·»åŠ æ•°æ®åº“</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/123604.html#concept-878851" target="_blank" rel="noopener">ModifyDatabase</a></td>
<td align="left">ä¿®æ”¹æ•°æ®åº“</td>
</tr>
<tr>
<td align="left"><a href="https://help.aliyun.com/document_detail/123600.html#concept-878841" target="_blank" rel="noopener">DeleteDatabase</a></td>
<td align="left">åˆ é™¤æ•°æ®åº“</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>é˜¿é‡Œäº‘</category>
      </categories>
  </entry>
  <entry>
    <title>é˜¿é‡Œäº‘ Â· HDM</title>
    <url>/blog/2019/10/09/aliyun-hdm/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>æ··åˆäº‘æ•°æ®åº“ç®¡ç† ï¼ˆHybrid Cloud Database Managementï¼Œ ç®€ç§° <a href="https://www.aliyun.com/product/hdm" target="_blank" rel="noopener"><strong>HDM</strong></a>) ï¼Œå¸®åŠ©ä¼ä¸šæ‰“é€šæ··åˆäº‘æ•°æ®åº“æ¶æ„ï¼Œæä¾›<strong>å¤šç¯å¢ƒ</strong>ã€<strong>å¤šæ•°æ®åº“</strong>çš„ç»Ÿä¸€<strong>ç›‘æ§</strong>ã€<strong>æŠ¥è­¦</strong>ã€<strong>è¿ç»´</strong>ã€<strong>ç®¡ç†</strong>çš„èƒ½åŠ›ï¼Œ<a href="https://help.aliyun.com/product/63907.html?spm=a2c4g.750001.list.48.4cc17b13Z8O4eh" target="_blank" rel="noopener">å¸®åŠ©æ–‡æ¡£</a>ã€‚</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-09-162000.png" alt></p>
<p><strong>æ ¸å¿ƒåŠŸèƒ½</strong>ï¼šé›†ç¾¤ç®¡ç†ã€ç»Ÿä¸€ç›‘æ§ã€ç»Ÿä¸€å‘Šè­¦ã€<code>Dashboard</code>ã€æ•…éšœè¯Šæ–­ã€æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨å®¡è®¡ã€è¯Šæ–­æŠ¥å‘Šç­‰</p>
<p><strong>ç›®å‰æ”¯æŒæ•°æ®åº“</strong>ï¼š<code>MySQL</code>ã€<code>Redis</code>ã€<code>MongoDB</code>ã€<code>PostgreSQL</code> </p>
<p><strong>æ”¯æŒç¯å¢ƒ</strong>ï¼š</p>
<table>
<thead>
<tr>
<th align="left">ç¯å¢ƒ</th>
<th align="center">ç»Ÿä¸€æ¥å…¥</th>
<th align="right">ç»Ÿä¸€ç›‘æ§</th>
<th align="right">ç»Ÿä¸€å‘Šè­¦</th>
<th align="right">é›†ç¾¤ç®¡ç†</th>
</tr>
</thead>
<tbody><tr>
<td align="left">é˜¿é‡Œäº‘ <code>RDS</code></td>
<td align="center">æ”¯æŒ</td>
<td align="right">æ”¯æŒ</td>
<td align="right">æ”¯æŒ</td>
<td align="right">æ”¯æŒ</td>
</tr>
<tr>
<td align="left">é˜¿é‡Œäº‘ <code>ECS</code> è‡ªå»ºæ•°æ®åº“</td>
<td align="center">æ”¯æŒ</td>
<td align="right">æ”¯æŒ</td>
<td align="right">æ”¯æŒ</td>
<td align="right">æ”¯æŒ</td>
</tr>
<tr>
<td align="left">æœ¬åœ° <code>IDC</code> è‡ªå»ºæ•°æ®åº“</td>
<td align="center">æ”¯æŒ</td>
<td align="right">æ”¯æŒ</td>
<td align="right">æ”¯æŒ</td>
<td align="right">æ”¯æŒ</td>
</tr>
<tr>
<td align="left">å…¶ä»–äº‘æ•°æ®åº“</td>
<td align="center">æ”¯æŒ</td>
<td align="right">æ”¯æŒ</td>
<td align="right">æ”¯æŒ</td>
<td align="right">æ”¯æŒ</td>
</tr>
</tbody></table>
<p><strong>ç›®æ ‡ç”¨æˆ·</strong>ï¼šDBA</p>
<p><strong>ç™»å½•åœ°å€</strong>ï¼š<a href="https://signin.aliyun.com/login.htm" target="_blank" rel="noopener">å…¥å£</a></p>
<p><strong>RAMè´¦å·</strong>ï¼šsre@1596633715004367.onaliyun.com</p>
<h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><h3 id="å¼€é€šæœåŠ¡"><a href="#å¼€é€šæœåŠ¡" class="headerlink" title="å¼€é€šæœåŠ¡"></a>å¼€é€šæœåŠ¡</h3><p><a href="https://help.aliyun.com/knowledge_detail/66674.html?spm=a2c4g.11186623.2.12.7ac677adzLmyV7" target="_blank" rel="noopener">æ‰‹å†Œ</a></p>
<h3 id="å®ä¾‹æ¥å…¥"><a href="#å®ä¾‹æ¥å…¥" class="headerlink" title="å®ä¾‹æ¥å…¥"></a>å®ä¾‹æ¥å…¥</h3><p><strong>æ¥å…¥æ–¹å¼</strong>ï¼š<a href="https://help.aliyun.com/document_detail/65405.html?spm=a2c4g.11186623.6.552.58c5b105ScOBwq" target="_blank" rel="noopener">é˜¿é‡Œäº‘ RDS</a>ã€<a href="https://help.aliyun.com/document_detail/65407.html?spm=a2c4g.11186623.6.553.6aa210edll0oBP" target="_blank" rel="noopener">é˜¿é‡Œäº‘ ECS è‡ªå»ºæ•°æ®åº“</a>ã€<a href="https://help.aliyun.com/document_detail/65406.html?spm=a2c4g.11186623.6.554.29e19c69mPchPY" target="_blank" rel="noopener">æœ¬åœ° IDC è‡ªå»ºæ•°æ®åº“</a>ã€<a href="https://help.aliyun.com/document_detail/99480.html?spm=a2c4g.11186623.6.555.51a5cf58DNb8ol" target="_blank" rel="noopener">è´¦å·ç›´è¿</a></p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-09-172707.png" alt></p>
<p><strong>åŠŸèƒ½å¯¹æ¯”</strong>ï¼š</p>
<table>
<thead>
<tr>
<th align="left">åŠŸèƒ½</th>
<th align="right">ç›´è¿æ¥å…¥</th>
<th align="center">é›†ä¸­æ¨¡å¼æ¥å…¥</th>
<th align="center">ä¸»æœºæ¨¡å¼æ¥å…¥ï¼ˆæ¨èï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æ•°æ®åº“ç›‘æ§æŒ‡æ ‡</td>
<td align="right">æ”¯æŒ</td>
<td align="center">æ”¯æŒ</td>
<td align="center">æ”¯æŒ</td>
</tr>
<tr>
<td align="left">å®æ—¶æ€§èƒ½</td>
<td align="right">æ”¯æŒ</td>
<td align="center">æ”¯æŒ</td>
<td align="center">æ”¯æŒ</td>
</tr>
<tr>
<td align="left">å®æ—¶ä¼šè¯</td>
<td align="right">æ”¯æŒ</td>
<td align="center">æ”¯æŒ</td>
<td align="center">æ”¯æŒ</td>
</tr>
<tr>
<td align="left">ç©ºé—´åˆ†æ</td>
<td align="right">æ”¯æŒ</td>
<td align="center">æ”¯æŒ</td>
<td align="center">æ”¯æŒ</td>
</tr>
<tr>
<td align="left">SQLè¯Šæ–­</td>
<td align="right">æ”¯æŒ</td>
<td align="center">æ”¯æŒ</td>
<td align="center">æ”¯æŒ</td>
</tr>
<tr>
<td align="left">æ…¢è¯·æ±‚åˆ†æ</td>
<td align="right">æ”¯æŒ</td>
<td align="center">æ”¯æŒ</td>
<td align="center">æ”¯æŒ</td>
</tr>
<tr>
<td align="left">ä¸»æœºç›‘æ§æŒ‡æ ‡</td>
<td align="right"><em>ä¸æ”¯æŒ</em></td>
<td align="center"><em>ä¸æ”¯æŒ</em></td>
<td align="center">æ”¯æŒ</td>
</tr>
<tr>
<td align="left">è¯·æ±‚è¯Šæ–­</td>
<td align="right"><em>ä¸æ”¯æŒ</em></td>
<td align="center"><em>ä¸æ”¯æŒ</em></td>
<td align="center">æ”¯æŒ</td>
</tr>
<tr>
<td align="left">å…¨é‡è¯·æ±‚åˆ†æ</td>
<td align="right"><em>ä¸æ”¯æŒ</em></td>
<td align="center"><em>ä¸æ”¯æŒ</em></td>
<td align="center">æ”¯æŒ</td>
</tr>
<tr>
<td align="left">è¯·æ±‚å“åº”æ—¶é—´</td>
<td align="right"><em>ä¸æ”¯æŒ</em></td>
<td align="center"><em>ä¸æ”¯æŒ</em></td>
<td align="center">æ”¯æŒ</td>
</tr>
<tr>
<td align="left">å®‰å…¨å®¡è®¡</td>
<td align="right"><em>ä¸æ”¯æŒ</em></td>
<td align="center"><em>ä¸æ”¯æŒ</em></td>
<td align="center">æ”¯æŒ</td>
</tr>
</tbody></table>
<p><strong>æ¥å…¥æ­¥éª¤</strong>ï¼š</p>
<blockquote>
<p>ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©ç½‘ç»œç±»å‹</p>
</blockquote>
<ul>
<li>å¦‚æœæ˜¯æœ‰å…¬ç½‘çš„è‡ªå»ºæ•°æ®åº“ï¼Œè¯·é€‰æ‹©â€œå…¬ç½‘ï¼ˆç»å…¸ç½‘ç»œï¼‰â€ã€‚</li>
<li>å¦‚æœæ˜¯é€šè¿‡ä¸“çº¿ï¼<code>VPN</code> æ–¹å¼è¿æ¥é˜¿é‡Œäº‘ <code>VPC</code> çš„æœ¬åœ° <code>IDC</code> æˆ–è€…å…¶ä»–äº‘ï¼Œè¯·é€‰æ‹©â€œä¸“æœ‰ç½‘ç»œâ€ã€‚</li>
</ul>
<blockquote>
<p>ç¬¬äºŒæ­¥ï¼šéƒ¨ç½²ç½‘å…³</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">sudo wget -O install-dbgateway http://hdm-dbgateway-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/DBGateway/install-dbgateway &amp;&amp; sudo /bin/bash install-dbgateway --id idc_iQn5Df7QC5docekj --token <span class="number">70</span>EE4B0C444E215700BEFD8B14DB026EF6A958FBE42DACDEE304FC91880A933D --endpoint master-hdm-cn-hangzhou.aliyuncs.com --region default --native</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç¬¬ä¸‰æ­¥ï¼šæˆæƒéªŒè¯</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'hdm'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="keyword">PASSWORD</span> <span class="string">'Hdm@123!'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SHOW</span> <span class="keyword">DATABASES</span>, PROCESS, <span class="keyword">REPLICATION</span> <span class="keyword">SLAVE</span>, <span class="keyword">REPLICATION</span> <span class="keyword">CLIENT</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'hdm'</span>@<span class="string">'%'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> *.*  <span class="keyword">TO</span> <span class="string">'hdm'</span>@<span class="string">'%'</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸‰ç§ç½‘ç»œè¿æ¥æ–¹å¼</strong>ï¼š</p>
<p><strong>ä¸“çº¿</strong></p>
<ul>
<li>ä¸“çº¿æ˜¯æŒ‡é˜¿é‡Œäº‘æ¥å…¥ç‚¹å’Œæœ¬åœ°æ•°æ®ä¸­å¿ƒä¹‹é—´çš„ç½‘ç»œçº¿è·¯çš„æŠ½è±¡ã€‚</li>
<li>æ‚¨éœ€è¦é€šè¿‡ä¸€æ¡ç§Ÿç”¨çš„è¿è¥å•†ä¸“çº¿å°†æœ¬åœ° <code>IDC</code> è¿æ¥åˆ°é˜¿é‡Œäº‘æ¥å…¥ç‚¹ï¼Œå»ºç«‹ä¸“çº¿è¿æ¥ã€‚</li>
<li>ç‰©ç†ä¸“çº¿çš„ç§ç½‘è¿æ¥ä¸é€šè¿‡å…¬ç½‘ï¼Œå› æ­¤ä¸ä¼ ç»Ÿçš„å…¬ç½‘ç›¸æ¯”ï¼Œä¸“çº¿è¿æ¥æ›´åŠ å®‰å…¨ã€å¯é ã€é€Ÿåº¦æ›´å¿«ã€å»¶è¿Ÿæ›´ä½ã€‚</li>
</ul>
<p><strong>VPN</strong></p>
<p><code>VPN</code> ç½‘å…³æ˜¯ä¸€æ¬¾åŸºäºäº’è”ç½‘é€šä¿¡æŠ€æœ¯ï¼Œé€šè¿‡åŠ å¯†é€šé“å°†ä¼ä¸šæ•°æ®ä¸­å¿ƒå’Œé˜¿é‡Œäº‘ä¸“æœ‰ç½‘ç»œå®‰å…¨å¯é åœ°è¿æ¥èµ·æ¥çš„æœåŠ¡ã€‚</p>
<p><strong>äº’è”ç½‘</strong></p>
<p>æœ¬åœ° <code>IDC</code> ç›´æ¥é€šè¿‡äº’è”ç½‘å’Œé˜¿é‡Œäº‘å…¬æœ‰äº‘äº’è”ï¼Œ<code>HDM</code> ä¼šå¯¹æ•°æ®è®¿é—®é“¾è·¯è¿›è¡ŒåŠ å¯†ï¼Œç”¨æˆ·æ— éœ€æ‹…å¿ƒå®‰å…¨é—®é¢˜ã€‚</p>
<h3 id="ç»Ÿä¸€ç›‘æ§"><a href="#ç»Ÿä¸€ç›‘æ§" class="headerlink" title="ç»Ÿä¸€ç›‘æ§"></a>ç»Ÿä¸€ç›‘æ§</h3><h4 id="MySQL-Server"><a href="#MySQL-Server" class="headerlink" title="MySQL Server"></a>MySQL Server</h4><p><strong>TPS/QPS</strong></p>
<p>QPS (Queries Per Second)ï¼Œæ¯ç§’ <code>SQL</code> è¯­å¥æ‰§è¡Œæ¬¡æ•°</p>
<p>TPS (Transactions Per Second)ï¼Œæ¯ç§’äº‹åŠ¡æ“ä½œæ¬¡æ•°</p>
<table>
<thead>
<tr>
<th align="left">æŒ‡æ ‡</th>
<th align="left">å•ä½</th>
<th align="left">å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">mysql.tps</td>
<td align="left">Per Second</td>
<td align="left">è®¡ç®—å…¬å¼ï¼š(Com_commit + Com_rollback) / Uptime</td>
</tr>
<tr>
<td align="left">mysql.qps</td>
<td align="left">Per Second</td>
<td align="left">è®¡ç®—å…¬å¼ï¼šQuestions / Uptime</td>
</tr>
</tbody></table>
<p><strong>ä¼šè¯è¿æ¥</strong></p>
<table>
<thead>
<tr>
<th align="left">æŒ‡æ ‡</th>
<th align="left">å•ä½</th>
<th align="left">å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">mysql.threads_created</td>
<td align="left">Count</td>
<td align="left">å½“å‰æ–°åˆ›å»ºçš„çº¿ç¨‹</td>
</tr>
<tr>
<td align="left">mysql.threads_cached</td>
<td align="left">Count</td>
<td align="left">å½“å‰ <code>cached</code> çº¿ç¨‹</td>
</tr>
<tr>
<td align="left"><strong>mysql.threads_connected</strong></td>
<td align="left">Count</td>
<td align="left">å½“å‰å…¨éƒ¨çº¿ç¨‹æ•°</td>
</tr>
<tr>
<td align="left">mysql.threads_rejected</td>
<td align="left">Count</td>
<td align="left">å½“å‰ <code>rejected</code> çº¿ç¨‹</td>
</tr>
<tr>
<td align="left"><strong>mysql.threads_running</strong></td>
<td align="left">Count</td>
<td align="left">å½“å‰æ´»è·ƒçº¿ç¨‹æ•°</td>
</tr>
</tbody></table>
<p><strong>æ‰§è¡Œæ¬¡æ•°</strong></p>
<table>
<thead>
<tr>
<th align="left">æŒ‡æ ‡</th>
<th align="left">å•ä½</th>
<th align="left">å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">mysql.insert_ps</td>
<td align="left">Per Second</td>
<td align="left">å¹³å‡æ¯ç§’ <code>insert</code> è¯­å¥æ‰§è¡Œæ¬¡æ•°</td>
</tr>
<tr>
<td align="left">mysql.select_ps</td>
<td align="left">Per Second</td>
<td align="left">å¹³å‡æ¯ç§’ <code>select</code> è¯­å¥æ‰§è¡Œæ¬¡æ•°</td>
</tr>
<tr>
<td align="left">mysql.update_ps</td>
<td align="left">Per Second</td>
<td align="left">å¹³å‡æ¯ç§’ <code>update</code> è¯­å¥æ‰§è¡Œæ¬¡æ•°</td>
</tr>
<tr>
<td align="left">mysql.delete_ps</td>
<td align="left">Per Second</td>
<td align="left">å¹³å‡æ¯ç§’ <code>delete</code> è¯­å¥æ‰§è¡Œæ¬¡æ•°</td>
</tr>
<tr>
<td align="left">mysql.replace_ps</td>
<td align="left">Per Second</td>
<td align="left">å¹³å‡æ¯ç§’ <code>replace</code> è¯­å¥æ‰§è¡Œæ¬¡æ•°</td>
</tr>
</tbody></table>
<p><strong>æµé‡åå</strong>ï¼ˆå•ä½ï¼š<code>KB</code>ï¼‰</p>
<table>
<thead>
<tr>
<th align="left">æŒ‡æ ‡</th>
<th align="left">å•ä½</th>
<th align="left">å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">mysql.bytes_received</td>
<td align="left">KByte</td>
<td align="left">å¹³å‡æ¯ç§’ä»æ‰€æœ‰å®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„å­—èŠ‚æ•°</td>
</tr>
<tr>
<td align="left">mysql.bytes_sent</td>
<td align="left">KByte</td>
<td align="left">å¹³å‡æ¯ç§’å‘é€ç»™æ‰€æœ‰å®¢æˆ·ç«¯çš„å­—èŠ‚æ•°</td>
</tr>
</tbody></table>
<h4 id="InnoDB-å­˜å‚¨å¼•æ“"><a href="#InnoDB-å­˜å‚¨å¼•æ“" class="headerlink" title="InnoDB å­˜å‚¨å¼•æ“"></a>InnoDB å­˜å‚¨å¼•æ“</h4><p><strong>InnoDB Buffer Pool å‘½ä¸­ç‡</strong>ï¼ˆ%ï¼‰</p>
<table>
<thead>
<tr>
<th align="left">æŒ‡æ ‡</th>
<th align="left">å•ä½</th>
<th align="left">å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">mysql.innodb_bp_dirty_pct</td>
<td align="left">%</td>
<td align="left">è„é¡µæ¯”ç‡ï¼šInnodb_buffer_pool_pages_dirty / Innodb_buffer_pool_pages_data * 100%</td>
</tr>
<tr>
<td align="left">mysql.innodb_bp_hit</td>
<td align="left">%</td>
<td align="left">è¯»ç¼“å­˜å‘½ä¸­ç‡ï¼š(Innodb_buffer_pool_read_requests - Innodb_buffer_pool_reads) / Innodb_buffer_pool_read_requests * 100%</td>
</tr>
<tr>
<td align="left"><strong>mysql.innodb_bp_usage_pct</strong></td>
<td align="left">%</td>
<td align="left">ä½¿ç”¨ç‡ï¼šinnodb_buffer_pool_pages_data / ( innodb_buffer_pool_pages_data + innodb_buffer_pool_pages_free ) * 100%</td>
</tr>
</tbody></table>
<p><strong>InnoDB Data è¯»å†™ååé‡</strong>ï¼ˆå•ä½ï¼š<code>KB</code>ï¼‰</p>
<table>
<thead>
<tr>
<th align="left">æŒ‡æ ‡</th>
<th align="left">å•ä½</th>
<th align="left">å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">mysql.innodb_data_written</td>
<td align="left">KByte</td>
<td align="left"><code>InnoDB</code> å¹³å‡æ¯ç§’å†™å­—èŠ‚æ•°</td>
</tr>
<tr>
<td align="left">mysql.innodb_data_read</td>
<td align="left">KByte</td>
<td align="left"><code>InnoDB</code> å¹³å‡æ¯ç§’è¯»å­—èŠ‚æ•°</td>
</tr>
</tbody></table>
<p><strong>InnoDB Row Operations</strong></p>
<table>
<thead>
<tr>
<th align="left">æŒ‡æ ‡</th>
<th align="left">å•ä½</th>
<th align="left">å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">mysql.innodb_rows_deleted</td>
<td align="left">Per Second</td>
<td align="left"><code>InnoDB</code> å¹³å‡æ¯ç§’åˆ é™¤çš„è¡Œæ•°</td>
</tr>
<tr>
<td align="left">mysql.innodb_rows_read</td>
<td align="left">Per Second</td>
<td align="left"><code>InnoDB</code> å¹³å‡æ¯ç§’è¯»å–çš„è¡Œæ•°</td>
</tr>
<tr>
<td align="left">mysql.innodb_rows_inserted</td>
<td align="left">Per Second</td>
<td align="left"><code>InnoDB</code> å¹³å‡æ¯ç§’æ’å…¥çš„è¡Œæ•°</td>
</tr>
<tr>
<td align="left">mysql.innodb_rows_updated</td>
<td align="left">Per Second</td>
<td align="left"><code>InnoDB</code> å¹³å‡æ¯ç§’æ›´æ–°çš„è¡Œæ•°</td>
</tr>
</tbody></table>
<h4 id="MySQL-æœåŠ¡è¿›ç¨‹"><a href="#MySQL-æœåŠ¡è¿›ç¨‹" class="headerlink" title="MySQL æœåŠ¡è¿›ç¨‹"></a>MySQL æœåŠ¡è¿›ç¨‹</h4><p><strong>MySQL CPU åˆ©ç”¨ç‡</strong>ï¼ˆ%ï¼‰</p>
<table>
<thead>
<tr>
<th align="left">æŒ‡æ ‡</th>
<th align="left">å•ä½</th>
<th align="left">å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">mysql.cpu_usage</td>
<td align="left">%</td>
<td align="left">MySQL æœåŠ¡è¿›ç¨‹ <code>CPU</code> ä½¿ç”¨ç‡ï¼ˆ <code>200%</code> ä»£è¡¨ä½¿ç”¨ 2 ä¸ª <code>CPU Core</code>ï¼‰</td>
</tr>
</tbody></table>
<p><strong>MySQL å†…å­˜ä½¿ç”¨é‡</strong>ï¼ˆå•ä½ï¼š<code>GB</code>ï¼‰</p>
<table>
<thead>
<tr>
<th align="left">æŒ‡æ ‡</th>
<th align="left">å•ä½</th>
<th align="left">å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">mysql.mem_used</td>
<td align="left">GByte</td>
<td align="left">MySQL æœåŠ¡è¿›ç¨‹å†…å­˜ä½¿ç”¨é‡</td>
</tr>
</tbody></table>
<p><strong>MySQL å­˜å‚¨ç©ºé—´ä½¿ç”¨é‡</strong>ï¼ˆå•ä½ï¼š<code>GB</code>ï¼‰</p>
<table>
<thead>
<tr>
<th align="left">æŒ‡æ ‡</th>
<th align="left">å•ä½</th>
<th align="left">å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">mysql.storage.data.used</td>
<td align="left">GByte</td>
<td align="left">æ•°æ®æ–‡ä»¶ç›®å½•çš„ç©ºé—´ä½¿ç”¨é‡</td>
</tr>
<tr>
<td align="left">mysql.storage.log.used</td>
<td align="left">GByte</td>
<td align="left">æ—¥å¿—æ–‡ä»¶ç›®å½•çš„ç©ºé—´ä½¿ç”¨é‡</td>
</tr>
</tbody></table>
<h4 id="ä¸»æœº"><a href="#ä¸»æœº" class="headerlink" title="ä¸»æœº"></a>ä¸»æœº</h4><p><strong>ä¸»æœº Load è´Ÿè½½</strong></p>
<p>åœ¨ <code>UNIX</code> ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿè´Ÿè½½æ˜¯å¯¹å½“å‰ <code>CPU</code> å·¥ä½œé‡çš„åº¦é‡ï¼Œè¢«å®šä¹‰ä¸ºç‰¹å®šæ—¶é—´é—´éš”å†…è¿è¡Œé˜Ÿåˆ—ä¸­çš„å¹³å‡çº¿ç¨‹æ•°å¯¹äºå•ä¸ª <code>CPU</code>ï¼Œæœ‰äººè®¤ä¸ºå¦‚æœ <code>Load</code> è¶…è¿‡ <code>0.7</code> å°±ç®—æ˜¯è¶…å‡ºæ­£å¸¸èŒƒå›´äº†ï¼Œè¿™ä¸ªå€¼è¶Šä½è¶Šå¥½ï¼Œè´Ÿè½½è¿‡é«˜ä¼šå¯¼è‡´æœºå™¨æ— æ³•å¤„ç†å…¶ä»–è¯·æ±‚åŠæ“ä½œï¼Œç”šè‡³å¯¼è‡´å®•æœºã€‚</p>
<table>
<thead>
<tr>
<th align="left">æŒ‡æ ‡</th>
<th align="left">å•ä½</th>
<th align="left">å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">load1</td>
<td align="left">Count</td>
<td align="left">ä¸»æœºè´Ÿè½½ <code>load1</code></td>
</tr>
</tbody></table>
<p><strong>ä¸»æœº CPU åˆ©ç”¨ç‡</strong>ï¼ˆ%ï¼‰</p>
<table>
<thead>
<tr>
<th>æŒ‡æ ‡</th>
<th>å•ä½</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>host.cpu.user_usage</td>
<td>Count</td>
<td>ç³»ç»Ÿ <code>CPU user</code> åˆ©ç”¨ç‡</td>
</tr>
<tr>
<td>host.cpu.si_usage</td>
<td>Count</td>
<td>ç³»ç»Ÿ <code>CPU</code> è½¯ä¸­æ–­åˆ©ç”¨ç‡</td>
</tr>
<tr>
<td><strong>host.cpu.usage</strong></td>
<td>Count</td>
<td>ç³»ç»Ÿ <code>CPU</code> åˆ©ç”¨ç‡</td>
</tr>
<tr>
<td>host.cpu.hi_usage</td>
<td>Count</td>
<td>ç³»ç»Ÿ <code>CPU</code> ç¡¬ä¸­æ–­åˆ©ç”¨ç‡</td>
</tr>
<tr>
<td>host.cpu.iowait_usage</td>
<td>Count</td>
<td>ç³»ç»Ÿ <code>CPU iowait</code> åˆ©ç”¨ç‡</td>
</tr>
<tr>
<td>host.cpu.sys_usage</td>
<td>Count</td>
<td>ç³»ç»Ÿ <code>CPU sys</code> åˆ©ç”¨ç‡</td>
</tr>
</tbody></table>
<p><strong>ä¸»æœºå†…å­˜ä½¿ç”¨é‡</strong>ï¼ˆå•ä½ï¼š<code>MB</code>ï¼‰</p>
<table>
<thead>
<tr>
<th>æŒ‡æ ‡</th>
<th>å•ä½</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>mem.buffers</td>
<td>MByte</td>
<td>ç³»ç»Ÿ <code>IO Buffer</code> å ç”¨å†…å­˜å¤§å°</td>
</tr>
<tr>
<td><strong>mem.used</strong></td>
<td>MByte</td>
<td>ç³»ç»Ÿå·²ç”¨å†…å­˜</td>
</tr>
<tr>
<td>mem.cached</td>
<td>MByte</td>
<td>ç³»ç»Ÿ <code>Page Cache</code> å ç”¨å†…å­˜å¤§å°</td>
</tr>
<tr>
<td>gw.pidstat.mem_used</td>
<td>MByte</td>
<td><code>DBGateway</code> å†…å­˜ä½¿ç”¨é‡</td>
</tr>
<tr>
<td>mem.swap_used</td>
<td>MByte</td>
<td>ç³»ç»Ÿ <code>swap</code> ä½¿ç”¨å¤§å°</td>
</tr>
<tr>
<td><strong>mem.total</strong></td>
<td>MByte</td>
<td>ç³»ç»Ÿæ€»å¯ç”¨å†…å­˜</td>
</tr>
</tbody></table>
<p><strong>ä¸»æœºç½‘ç»œåå</strong>ï¼ˆå•ä½ï¼š<code>KB</code>ï¼‰</p>
<table>
<thead>
<tr>
<th>æŒ‡æ ‡</th>
<th>å•ä½</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>net.recv</td>
<td>KByte</td>
<td>ç½‘å¡æ¯ç§’æ¥æ”¶æ•°æ®é‡</td>
</tr>
<tr>
<td>net.send</td>
<td>KByte</td>
<td>ç½‘å¡æ¯ç§’å‘é€æ•°æ®é‡</td>
</tr>
</tbody></table>
<h3 id="ç»Ÿä¸€å‘Šè­¦"><a href="#ç»Ÿä¸€å‘Šè­¦" class="headerlink" title="ç»Ÿä¸€å‘Šè­¦"></a>ç»Ÿä¸€å‘Šè­¦</h3><p><strong>å‘Šè­¦åŠŸèƒ½</strong>ï¼šé…ç½®æ¨¡ç‰ˆã€è§¦å‘è§„åˆ™ã€å±è”½å‘Šè­¦ã€è§£é™¤å±è”½ã€å‘Šè­¦è®¢é˜…ç­‰</p>
<p><strong>å‘Šè­¦é…ç½®</strong>ï¼šå‘Šè­¦æ¨¡æ¿  -&gt;  å‘Šè­¦è”ç³»ç»„  -&gt;  å…³è”èµ„æºï¼Œå‘Šè­¦æ¨¡æ¿é»˜è®¤é…ç½® <code>8</code> æ¡å‘Šè­¦ï¼Œå¯è‡ªå®šä¹‰</p>
<table>
<thead>
<tr>
<th>å‘Šè­¦é¡¹</th>
<th>å‘Šè­¦è§„åˆ™</th>
<th>å‘é€é—´éš”</th>
<th>å‘Šè­¦ç±»å‹</th>
<th>å‘Šè­¦å¯¹è±¡</th>
<th>é€šçŸ¥æ–¹å¼</th>
</tr>
</thead>
<tbody><tr>
<td>ä¸»æœº <code>CPU</code> ä½¿ç”¨ç‡</td>
<td>è¿ç»­ <code>3</code> æ¬¡ â‰¥  <code>90</code></td>
<td><code>30</code> åˆ†é’Ÿ</td>
<td>é˜ˆå€¼å‘Šè­¦</td>
<td>è”ç³»ç»„</td>
<td>çŸ­ä¿¡ / é‚®ä»¶ / é’‰é’‰</td>
</tr>
<tr>
<td>ä¸»æœºå†…å­˜ä½¿ç”¨ç‡</td>
<td>è¿ç»­ <code>3</code> æ¬¡ â‰¥  <code>95</code></td>
<td><code>30</code> åˆ†é’Ÿ</td>
<td>é˜ˆå€¼å‘Šè­¦</td>
<td>è”ç³»ç»„</td>
<td>çŸ­ä¿¡ / é‚®ä»¶ / é’‰é’‰</td>
</tr>
<tr>
<td>ä¸»æœºç½‘ç»œå‘é€å¸¦å®½ä½¿ç”¨ç‡</td>
<td>è¿ç»­ <code>3</code> æ¬¡ â‰¥  <code>95</code></td>
<td><code>30</code> åˆ†é’Ÿ</td>
<td>é˜ˆå€¼å‘Šè­¦</td>
<td>è”ç³»ç»„</td>
<td>çŸ­ä¿¡ / é‚®ä»¶ / é’‰é’‰</td>
</tr>
<tr>
<td>ä¸»æœºç½‘ç»œæ¥æ”¶å¸¦å®½ä½¿ç”¨ç‡</td>
<td>è¿ç»­ <code>3</code> æ¬¡ â‰¥  <code>95</code></td>
<td><code>30</code> åˆ†é’Ÿ</td>
<td>é˜ˆå€¼å‘Šè­¦</td>
<td>è”ç³»ç»„</td>
<td>çŸ­ä¿¡ / é‚®ä»¶ / é’‰é’‰</td>
</tr>
<tr>
<td>æ•°æ®åº“æ— æ³•è¿æ¥</td>
<td>è¿ç»­ <code>3</code> æ¬¡</td>
<td><code>30</code> åˆ†é’Ÿ</td>
<td>äº‹ä»¶å‘Šè­¦</td>
<td>è”ç³»ç»„</td>
<td>çŸ­ä¿¡ / é‚®ä»¶ / é’‰é’‰</td>
</tr>
<tr>
<td><code>MySQL</code> å¤åˆ¶ä¸­æ–­</td>
<td>è¿ç»­ <code>3</code> æ¬¡</td>
<td><code>30</code> åˆ†é’Ÿ</td>
<td>äº‹ä»¶å‘Šè­¦</td>
<td>è”ç³»ç»„</td>
<td>çŸ­ä¿¡ / é‚®ä»¶ / é’‰é’‰</td>
</tr>
<tr>
<td><code>MySQL</code> å¤åˆ¶å»¶è¿Ÿ</td>
<td>è¿ç»­ <code>3</code> æ¬¡ â‰¥  <code>1800</code></td>
<td><code>30</code> åˆ†é’Ÿ</td>
<td>é˜ˆå€¼å‘Šè­¦</td>
<td>è”ç³»ç»„</td>
<td>çŸ­ä¿¡ / é‚®ä»¶ / é’‰é’‰</td>
</tr>
<tr>
<td><code>MySQL</code> æ´»è·ƒä¼šè¯æ•°</td>
<td>è¿ç»­ <code>3</code> æ¬¡ â‰¥  <code>100</code></td>
<td><code>30</code> åˆ†é’Ÿ</td>
<td>é˜ˆå€¼å‘Šè­¦</td>
<td>è”ç³»ç»„</td>
<td>çŸ­ä¿¡ / é‚®ä»¶ / é’‰é’‰</td>
</tr>
</tbody></table>
<h3 id="é—®é¢˜è¯Šæ–­"><a href="#é—®é¢˜è¯Šæ–­" class="headerlink" title="é—®é¢˜è¯Šæ–­"></a>é—®é¢˜è¯Šæ–­</h3><p><strong>å®ä¾‹ä¼šè¯</strong>ï¼šåŸç†æ˜¯æ‰§è¡Œ <code>show processlist</code>ï¼ŒæŸ¥çœ‹æ´»è·ƒä¼šè¯å’Œå…¨éƒ¨ä¼šè¯ï¼Œå¯å¿«é€Ÿè¯Šæ–­é˜»å¡çš„ <code>SQL</code>ï¼Œç´§æ€¥æƒ…å†µä¸‹å…ˆç»“æŸä¼šè¯ï¼Œé‡Šæ”¾èµ„æºã€‚</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-10-112617.png" alt></p>
<p><strong>æ‹“æ‰‘ç»“æ„</strong></p>
<blockquote>
<p>æ³¨æ„ï¼šç›®å‰å®ä¾‹æ‹“æ‰‘ä»…æ”¯æŒ <code>MySQL</code></p>
</blockquote>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-09-25-140100.png" alt></p>
<p><strong>æ€§èƒ½å¿«ç…§</strong></p>
<p>ä¸å‘Šè­¦è§„åˆ™å…³è”ï¼Œé€šè¿‡è‡ªåŠ¨è§¦å‘æ–¹å¼äº§ç”Ÿæ€§èƒ½å¿«ç…§ï¼Œä¿å­˜å¼‚å¸¸ç°åœºï¼Œæ–¹ä¾¿ DBA æ’æŸ¥æ•°æ®åº“å¼‚å¸¸ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">åœºæ™¯ç¤ºä¾‹ï¼š</span><br><span class="line">MySQLæ•°æ®åº“å‡Œæ™¨<span class="number">1</span>ç‚¹å‘ç”Ÿäº†CPU <span class="number">90</span>%çš„å‘Šè­¦ï¼Œå¯¼è‡´æ­£å¸¸ä¸šåŠ¡å“åº”æ—¶é—´å˜é•¿ï¼Œä½†æ˜¯ç­‰DBAç™»å½•æ•°æ®åº“ä¸Šè¿›è¡Œæ’æŸ¥ï¼Œå¼‚å¸¸å·²ç»æ¶ˆå¤±ï¼Œä»ç›‘æ§å†å²ä¸Šåªèƒ½çœ‹åˆ°CPUé£™é«˜ã€æ´»è·ƒä¼šè¯å¢é•¿ï¼Œæ²¡æœ‰æ…¢SQLã€‚åœ¨è¿™ç§ç¼ºå°‘æ•°æ®ã€ç¼ºå°‘ç°åœºçš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰åŠæ³•ç¡®è®¤æ ¹æœ¬åŸå› ï¼ŒåŒæ ·çš„é—®é¢˜å¯èƒ½ä¼šæŒç»­å‘ç”Ÿï¼Œå½±å“ä¸šåŠ¡å¯ç”¨æ€§ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h3><p><strong>æ…¢ SQL</strong>ï¼šæ¶æ„è®¾è®¡ã€SQLåˆ†æ  [<a href="https://help.aliyun.com/document_detail/87374.html?spm=a2c4g.11186623.6.577.5e2f690dVvEL0F" target="_blank" rel="noopener">æ ·æœ¬</a> | <a href="https://help.aliyun.com/document_detail/102635.html?spm=a2c4g.11186623.6.568.62631a4cLlP0XJ" target="_blank" rel="noopener">ä¼˜åŒ–</a>]</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-10-111910.png" alt></p>
<p><strong>æ­»é”</strong></p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-10-10-145357.png" alt></p>
<p>å¯é€šè¿‡ä»¥ä¸‹æ‰‹æ®µé™ä½æ­»é”å‘ç”Ÿçš„æ¦‚ç‡ï¼š</p>
<ul>
<li>å¦‚æœä¸åŒç¨‹åºä¼šå¹¶å‘å­˜å–å¤šä¸ªè¡¨ï¼Œå°½é‡çº¦å®šä»¥ç›¸åŒçš„é¡ºåºè®¿é—®è¡¨ï¼Œå¯ä»¥å¤§å¤§é™ä½æ­»é”æœºä¼šï¼›</li>
<li>ä¸ºè¡¨æ·»åŠ åˆç†çš„ç´¢å¼•ï¼Œå¦‚æœä¸èµ°ç´¢å¼•å°†ä¼šä¸ºè¡¨çš„æ¯ä¸€è¡Œè®°å½•åŠ é”ï¼Œæ­»é”çš„æ¦‚ç‡å°±ä¼šå¤§å¤§å¢å¤§ï¼›</li>
<li>é¿å…å¤§äº‹åŠ¡ï¼Œå°½é‡å°†å¤§äº‹åŠ¡æ‹†æˆå¤šä¸ªå°äº‹åŠ¡æ¥å¤„ç†ï¼›å¤§äº‹åŠ¡å ç”¨èµ„æºå¤šï¼Œè€—æ—¶é•¿ï¼Œä¸å…¶ä»–äº‹åŠ¡å†²çªçš„æ¦‚ç‡ä¹Ÿä¼šå˜é«˜ï¼›</li>
<li>åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå°½å¯èƒ½åšåˆ°ä¸€æ¬¡é”å®šæ‰€éœ€è¦çš„æ‰€æœ‰èµ„æºï¼Œå‡å°‘æ­»é”äº§ç”Ÿæ¦‚ç‡ï¼›</li>
<li>å¯¹äºéå¸¸å®¹æ˜“äº§ç”Ÿæ­»é”çš„ä¸šåŠ¡éƒ¨åˆ†ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨å‡çº§é”å®šé¢—ç²’åº¦ï¼Œé€šè¿‡è¡¨çº§é”å®šæ¥å‡å°‘æ­»é”äº§ç”Ÿçš„æ¦‚ç‡ã€‚</li>
</ul>
<p><strong>ç©ºé—´åˆ†æ</strong>ï¼šå¯ä»¥æŸ¥çœ‹æ¯å¼ è¡¨çš„å ç”¨ç©ºé—´ã€ç´¢å¼•ç©ºé—´ã€ç¢ç‰‡ç‡ç­‰ï¼Œç‚¹å‡»è¡¨åå¯ä»¥æŸ¥çœ‹è¡¨ç»“æ„å’Œç´¢å¼•ï¼Œå¼‚å¸¸æ¡ä»¶ï¼š</p>
<ul>
<li>å®ä¾‹çš„ç©ºé—´ä½¿ç”¨ç‡å¤§äº <code>90%</code>ã€‚</li>
<li>å®ä¾‹çš„åº“è¡¨æ€»ç©ºé—´ï¼ˆç‰©ç†ï¼‰å‰©ä½™å¯ç”¨å¤©æ•°ä¼°è®¡ä¸è¶³ <code>7</code> å¤©ã€‚</li>
<li>å®ä¾‹å¯å›æ”¶ç©ºé—´å¤§äº <code>60GB</code>ï¼Œä¸”ç¢ç‰‡ç‡å¤§äº <code>5%</code>ã€‚</li>
<li>å•è¡¨å¤§äº <code>6G</code>ï¼Œå¹¶ä¸”ç¢ç‰‡ç‡å¤§äº <code>30%</code>ã€‚</li>
<li>å•è¡¨å¤§äº <code>50GB</code>ã€‚</li>
<li>å•è¡¨è¡Œæ•°å¤§äº <code>500w</code>ï¼Œä¸”å¹³å‡è¡Œé•¿å¤§äº <code>10KB</code>ã€‚</li>
</ul>
<h3 id="å®‰å…¨å®¡è®¡"><a href="#å®‰å…¨å®¡è®¡" class="headerlink" title="å®‰å…¨å®¡è®¡"></a>å®‰å…¨å®¡è®¡</h3><p><code>HDM</code> çš„å®‰å…¨å®¡è®¡åŠŸèƒ½ï¼Œé‡‡ç”¨æ—è·¯çš„æŠ€æœ¯ï¼Œé‡‡é›†å¹¶åˆ†æå¯¹æ•°æ®åº“æœåŠ¡å™¨çš„å„ç±»æ“ä½œè¡Œä¸ºï¼Œå®æ—¶åœ°ã€æ™ºèƒ½åœ°è§£æå¯¹æ•°æ®åº“æœåŠ¡å™¨çš„å„ç§æ“ä½œï¼Œè‡ªåŠ¨è¯†åˆ«<strong>é«˜å± SQL</strong>ã€<strong>SQL æ³¨å…¥</strong>ã€<strong>æ–°å¢è®¿é—®æ¥æº</strong>ç­‰é£é™©ã€‚</p>
<p><strong>é«˜å± SQL</strong></p>
<p>åœ¨ <code>HDM</code> ä¸­ï¼Œä¼šæ ¹æ®é¢„è®¾çš„è§„åˆ™åº“ï¼Œè‡ªåŠ¨è¯†åˆ«ä¸‰ç§ç±»å‹çš„é«˜å± <code>SQL</code> ï¼š</p>
<p>â‘  <code>DDL</code>ï¼ˆæ–°å»ºè¡¨ã€ä¿®æ”¹è¡¨ç»“æ„ã€ä¿®æ”¹ç´¢å¼•ã€é‡å‘½åè¡¨ç­‰æ“ä½œ)ï¼›</p>
<p>â‘¡ å…¨è¡¨æ›´æ–°ï¼ˆä¾‹å¦‚å…¨è¡¨ <code>Update</code> ã€å…¨è¡¨ <code>Delete</code> ç­‰)ï¼›</p>
<p>â‘¢ å¤§è¯·æ±‚ï¼Œé»˜è®¤è§„åˆ™æ˜¯æ»¡è¶³ä¸‹é¢ä¸‰ä¸ªæ¡ä»¶ä¸­çš„ä»»æ„ä¸€ä¸ªï¼š</p>
<ul>
<li>æ‰«æè¡Œæ•° &gt;= <code>100w</code></li>
<li>è¿”å›è¡Œæ•° &gt;= <code>10w</code></li>
<li>æ›´æ–°è¡Œæ•° &gt;= <code>10w</code></li>
</ul>
<p><strong>SQL æ³¨å…¥</strong></p>
<p>æ‰€è°“ <code>SQL</code> æ³¨å…¥ï¼Œå°±æ˜¯é€šè¿‡æŠŠ <code>SQL</code> å‘½ä»¤æ’å…¥åˆ° <code>Web</code> è¡¨å•æäº¤æˆ–è¾“å…¥åŸŸåæˆ–é¡µé¢è¯·æ±‚çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œæœ€ç»ˆè¾¾åˆ°æ¬ºéª—æœåŠ¡å™¨æ‰§è¡Œæ¶æ„çš„ <code>SQL</code> å‘½ä»¤ï¼Œä¸¥é‡å±å®³æ•°æ®åº“çš„å¥åº·ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ç¤ºä¾‹ï¼š</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">'xx'</span> <span class="keyword">FROM</span> <span class="string">'xx'</span> <span class="keyword">WHERE</span> <span class="number">1</span> = <span class="number">1</span> <span class="keyword">AND</span> <span class="number">1</span> = <span class="number">1</span></span><br><span class="line">- <span class="keyword">Where</span> å­å¥ä¸­è¿ç»­å‡ºç°ä¸¤ä¸ªå¸¸é‡è¿ç®—è¡¨è¾¾å¼</span><br><span class="line">- <span class="keyword">Where</span> å­å¥ä¸­æœ‰éƒ¨åˆ†æ¡ä»¶æ€»ä¸ºçœŸ</span><br></pre></td></tr></table></figure>

<p><strong>æ–°å¢è®¿é—®æ¥æº</strong></p>
<p>å’Œå†å²çš„è®¿é—®æ¥æºçºªå½•è¿›è¡Œå¯¹æ¯”ï¼Œè‡ªåŠ¨è¯†åˆ«æ–°å¢çš„è®¿é—®æ¥æºï¼Œå¸®åŠ©ç”¨æˆ·ç¡®è®¤æ˜¯å¦å­˜åœ¨æœªçŸ¥çš„æœºå™¨åœ¨è®¿é—®æˆ–è€…è¯»å–æ•°æ®åº“ï¼Œé»˜è®¤è§„åˆ™æ˜¯è¿‡å»<strong>ä¸ƒå¤©</strong>æ²¡æœ‰å‡ºç°è¿‡çš„è®¿é—®æ¥æºï¼Œå³ä¸ºæ–°å¢è®¿é—®æ¥æºã€‚</p>
<h3 id="è¯Šæ–­æŠ¥å‘Š"><a href="#è¯Šæ–­æŠ¥å‘Š" class="headerlink" title="è¯Šæ–­æŠ¥å‘Š"></a>è¯Šæ–­æŠ¥å‘Š</h3><p><strong>åŠŸèƒ½</strong>ï¼šæ”¯æŒç”¨æˆ·<strong>åˆ›å»º</strong>ã€<strong>æŸ¥çœ‹</strong>ã€<strong>ä¸‹è½½</strong>è¯Šæ–­æŠ¥å‘Š</p>
<p><strong>è¦æ±‚</strong>ï¼šè¯Šæ–­æ—¶é—´å¿…é¡»å°äº <code>24å°æ—¶</code></p>
<p><strong>å†…å®¹</strong>ï¼šå®ä¾‹ä¿¡æ¯ã€å¥åº·çŠ¶å†µï¼ˆ<code>CPU</code> / è¿æ¥æ•° / æ´»è·ƒä¼šè¯ / <code>QPS</code> / <code>TPS</code>ï¼‰ã€å‘Šè­¦åˆ—è¡¨ã€æ´»è·ƒä¼šè¯åˆ—è¡¨ã€Top5 æ…¢ SQLã€Top5 è¡¨ç©ºé—´ã€æ­»é”åˆ†æã€æ€§èƒ½è¶‹åŠ¿ï¼ˆ<code>CPU</code> / ç½‘ç»œ / å†…å­˜ / <code>QPS and TPS</code> / ä¼šè¯ / ç©ºé—´å˜åŒ–ï¼‰</p>
<h3 id="å®¹é‡è¯„ä¼°"><a href="#å®¹é‡è¯„ä¼°" class="headerlink" title="å®¹é‡è¯„ä¼°"></a>å®¹é‡è¯„ä¼°</h3><blockquote>
<p>é™åˆ¶ï¼šç›®å‰ä»…æ”¯æŒ <code>MySQL RDS</code></p>
</blockquote>
<p><strong>åŠŸèƒ½</strong>ï¼šå®¹é‡å»ºè®® | å®¹é‡è¯„ä¼°ï¼ˆ<code>CPU</code> / å†…å­˜ / <code>IOPS</code> / æ´»è·ƒä¼šè¯ / å­˜å‚¨ç©ºé—´ï¼‰</p>
<h2 id="FA-amp-Q"><a href="#FA-amp-Q" class="headerlink" title="FA&amp;Q"></a>FA&amp;Q</h2><p>â‘  æœ‰äº›æ•°æ®åº“æœåŠ¡å™¨æœªè¿æ¥å¤–ç½‘ï¼Œ<code>dbgateway</code> æ— æ³•ä¸‹è½½ï¼Œå®ä¾‹å¦‚ä½•æ¥å…¥ï¼Ÿ</p>
<p>é€šè¿‡æ­å»ºä»£ç†æœåŠ¡å™¨ <a href="http://www.squid-cache.org/" target="_blank" rel="noopener"><strong>Squid</strong></a> è¿›è¡Œä¸‹è½½ï¼ŒåŸç†å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-09-09-073606.jpg" alt="squid"></p>
<p><strong>æ­å»ºä»£ç†æœåŠ¡å™¨</strong></p>
<blockquote>
<p>é’å²›ä»£ç†æœåŠ¡å™¨åœ°å€ï¼š<code>10.133.0.53:3128</code></p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…squid</span></span><br><span class="line">yum -y install squid</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®è‡ªå¯åŠ¨</span></span><br><span class="line">systemctl enable squid.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®squid</span></span><br><span class="line">vim /etc/squid/squid.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨squid</span></span><br><span class="line">systemctl start squid.service</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨ä»£ç†æ¥å…¥HDM</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¢åŠ ä»£ç†</span></span><br><span class="line">echo  <span class="string">"</span></span><br><span class="line"><span class="string">http_proxy=10.133.0.53:3128</span></span><br><span class="line"><span class="string">https_proxy=10.133.0.53:3128</span></span><br><span class="line"><span class="string">ssl_proxy=10.133.0.53:3128</span></span><br><span class="line"><span class="string">tls_proxy=10.133.0.53:3128</span></span><br><span class="line"><span class="string">ftp_proxy=10.133.0.53:3128</span></span><br><span class="line"><span class="string">tcp_proxy=10.133.0.53:3128</span></span><br><span class="line"><span class="string">export http_proxy</span></span><br><span class="line"><span class="string">export https_proxy</span></span><br><span class="line"><span class="string">export ssl_proxy</span></span><br><span class="line"><span class="string">export ftp_proxy</span></span><br><span class="line"><span class="string">export tcp_proxy</span></span><br><span class="line"><span class="string">export tls_proxy"</span> &gt;&gt; /etc/profile ;  source /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹wgetä»£ç†é…ç½®æ–‡ä»¶</span></span><br><span class="line">echo <span class="string">"</span></span><br><span class="line"><span class="string">https_proxy=http://10.133.0.53:3128/</span></span><br><span class="line"><span class="string">http_proxy=http://10.133.0.53:3128/</span></span><br><span class="line"><span class="string">ftp_proxy=http://10.133.0.53:3128/"</span> &gt;&gt; /etc/wgetrc ;  source /etc/wgetrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½install-dbgateway</span></span><br><span class="line">sudo wget -O install-dbgateway http://hdm-dbgateway-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/DBGateway/install-dbgateway &amp;&amp; sudo /bin/bash install-dbgateway --id idc_zqSS2oMpeyKubndD --token <span class="number">3</span>E24C01713C83B7328F9A2F4C411078DC820E63FAFBC058F6635FAC5B0B4B7F2 --endpoint master-hdm-cn-hangzhou.aliyuncs.com --region default --native</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹install-dbgateway</span></span><br><span class="line">æ³¨é‡Šä»¥ä¸‹ä»£ç </span><br><span class="line">curl -v --connect-timeout <span class="number">3</span> --silent $&#123;endpoint&#125;:<span class="number">80</span> --output -</span><br><span class="line"><span class="keyword">if</span> [ $? != <span class="number">0</span> -a $? != <span class="number">52</span> ]; then</span><br><span class="line">       echo <span class="string">"Error! Can not connect to $&#123;endpoint&#125;:80, please check your network environment."</span></span><br><span class="line">       <span class="keyword">exit</span> <span class="number">1</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…å®Œæˆ</span></span><br><span class="line">sudo /bin/bash install-dbgateway --id idc_zqSS2oMpeyKubndD --token <span class="number">3</span>E24C01713C83B7328F9A2F4C411078DC820E63FAFBC058F6635FAC5B0B4B7F2 --endpoint master-hdm-cn-hangzhou.aliyuncs.com --region default --native</span><br><span class="line"></span><br><span class="line">-------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ä»£ç†</span></span><br><span class="line">echo  <span class="string">"</span></span><br><span class="line"><span class="string">http_proxy=http://qd-aliyun-proxy.haier.net:3128</span></span><br><span class="line"><span class="string">https_proxy=http://qd-aliyun-proxy.haier.net:3128</span></span><br><span class="line"><span class="string">ssl_proxy=http://qd-aliyun-proxy.haier.net:3128</span></span><br><span class="line"><span class="string">tls_proxy=http://qd-aliyun-proxy.haier.net:3128</span></span><br><span class="line"><span class="string">ftp_proxy=http://qd-aliyun-proxy.haier.net:3128</span></span><br><span class="line"><span class="string">tcp_proxy=http://qd-aliyun-proxy.haier.net:3128</span></span><br><span class="line"><span class="string">export http_proxy</span></span><br><span class="line"><span class="string">export https_proxy</span></span><br><span class="line"><span class="string">export ssl_proxy</span></span><br><span class="line"><span class="string">export ftp_proxy</span></span><br><span class="line"><span class="string">export tcp_proxy</span></span><br><span class="line"><span class="string">export tls_proxy"</span> &gt;&gt; /etc/profile ;  source /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®wgetä»£ç†</span></span><br><span class="line">echo <span class="string">"</span></span><br><span class="line"><span class="string">https_proxy=http://qd-aliyun-proxy.haier.net:3128/</span></span><br><span class="line"><span class="string">http_proxy=http://qd-aliyun-proxy.haier.net:3128/</span></span><br><span class="line"><span class="string">ftp_proxy=http://qd-aliyun-proxy.haier.net:3128/"</span> &gt;&gt; /etc/wgetrc ;  source /etc/wgetrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½install-dbgateway</span></span><br><span class="line">sudo wget -O install-dbgateway http://hdm-dbgateway-cn-qingdao.vpc100-oss-cn-qingdao.aliyuncs.com/DBGateway/install-dbgateway &amp;&amp; sudo /bin/bash install-dbgateway --id vpc-m5e6olft3vnne1ug6rdcd --token <span class="number">3359</span>FC7C28FB5B29459803F85B808D6D37B16B64FB2D56F485E632868E3C5798 --endpoint master-hdm-inner.cn-qingdao.aliyuncs.com --region cn-qingdao --native</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹install-dbgateway</span></span><br><span class="line">æ³¨é‡Šä»¥ä¸‹ä»£ç </span><br><span class="line">curl -v --connect-timeout <span class="number">3</span> --silent $&#123;endpoint&#125;:<span class="number">80</span> --output -</span><br><span class="line"><span class="keyword">if</span> [ $? != <span class="number">0</span> -a $? != <span class="number">52</span> ]; then</span><br><span class="line">       echo <span class="string">"Error! Can not connect to $&#123;endpoint&#125;:80, please check your network environment."</span></span><br><span class="line">       <span class="keyword">exit</span> <span class="number">1</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…å®Œæˆ</span></span><br><span class="line">sudo /bin/bash install-dbgateway --id vpc-m5e6olft3vnne1ug6rdcd --token <span class="number">3359</span>FC7C28FB5B29459803F85B808D6D37B16B64FB2D56F485E632868E3C5798 --endpoint master-hdm-inner.cn-qingdao.aliyuncs.com --region cn-qingdao --native</span><br></pre></td></tr></table></figure>

<p>â‘¡ å®ä¾‹æ¥å…¥åï¼Œæ˜¾ç¤ºçš„ <code>IP</code> ä¸æ˜¯çœŸå®çš„ä¸šåŠ¡ <code>IP</code> ï¼Ÿ</p>
<p>ç»ä¸é˜¿é‡Œäº‘å¼€å‘æ²Ÿé€šï¼Œæ–°ç‰ˆæœ¬åœ¨ <code>/opt/dbgateway/conf/dbgateway.conf</code> ä¸­æ·»åŠ  <code>gateway.local.ip=</code>  é…ç½®é¡¹ï¼Œ<code>dbgateway</code> ä¼˜å…ˆä½¿ç”¨é…ç½®ä¸­çš„ <code>ip</code> ã€‚</p>
<p>â‘¢ æœåŠ¡å™¨æ–­ç”µå¯åŠ¨åï¼Œ<code>dbgateway</code> æœåŠ¡æœªè‡ªåŠ¨é‡å¯ï¼Ÿ</p>
<p>æš‚ä¸æ”¯æŒ</p>
]]></content>
      <categories>
        <category>é˜¿é‡Œäº‘</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· æ•°æ®ç›®å½•</title>
    <url>/blog/2019/09/29/mysql-datadir/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><strong>æ–‡ä»¶ç³»ç»Ÿ</strong>ï¼šæ“ä½œç³»ç»Ÿç”¨æ¥ç®¡ç†ç£ç›˜çš„åŠŸèƒ½ï¼Œåƒ <code>InnoDB</code>ã€ <code>MyISAM</code> è¿™æ ·çš„å­˜å‚¨å¼•æ“éƒ½æ˜¯æŠŠè¡¨å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šã€‚</p>
<p><strong>å®‰è£…ç›®å½•</strong>ï¼šç”¨æ¥å­˜å‚¨å…³äºæ§åˆ¶å®¢æˆ·ç«¯ç¨‹åºå’ŒæœåŠ¡å™¨ç¨‹åºçš„å‘½ä»¤ï¼ˆå¦‚ <code>mysql</code>ï¼Œ<code>mysqld</code>ï¼Œ<code>mysqld_safe</code> ç­‰ï¼‰ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like 'basedir';</span><br><span class="line">+<span class="comment">---------------+-------------------------------------+</span></span><br><span class="line">| Variable_name | Value                               |</span><br><span class="line">+<span class="comment">---------------+-------------------------------------+</span></span><br><span class="line">| basedir       | /usr/local/mysql-5.7.23-el7-x86_64/ |</span><br><span class="line">+<span class="comment">---------------+-------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p><strong>æ•°æ®ç›®å½•</strong>ï¼šç”¨æ¥å­˜å‚¨ <code>MySQL</code> åœ¨è¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ•°æ®ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like 'datadir';</span><br><span class="line">+<span class="comment">---------------+-------------------+</span></span><br><span class="line">| Variable_name | Value             |</span><br><span class="line">+<span class="comment">---------------+-------------------+</span></span><br><span class="line">| datadir       | /data/mysql-tdds/ |</span><br><span class="line">+<span class="comment">---------------+-------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p><strong>ç³»ç»Ÿæ•°æ®åº“</strong></p>
<ul>
<li><p><code>mysql</code></p>
<p>å®ƒå­˜å‚¨äº† <code>MySQL</code> çš„ç”¨æˆ·è´¦æˆ·å’Œæƒé™ä¿¡æ¯ï¼Œä¸€äº›å­˜å‚¨è¿‡ç¨‹ã€äº‹ä»¶çš„å®šä¹‰ä¿¡æ¯ï¼Œä¸€äº›è¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ—¥å¿—ä¿¡æ¯ï¼Œä¸€äº›å¸®åŠ©ä¿¡æ¯ä»¥åŠæ—¶åŒºä¿¡æ¯ç­‰ã€‚</p>
</li>
<li><p><code>information_schema</code></p>
<p>å­˜å‚¨äº† <code>MySQL</code> æœåŠ¡å™¨ç»´æŠ¤çš„æ‰€æœ‰å…¶ä»–æ•°æ®åº“çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æœ‰è¡¨ã€è§†å›¾ã€è§¦å‘å™¨ã€åˆ—ã€ç´¢å¼•ç­‰ä¿¡æ¯ï¼Œè¿™äº›å¹¶ä¸æ˜¯çœŸå®çš„ç”¨æˆ·æ•°æ®ï¼Œè€Œæ˜¯ä¸€äº›æè¿°æ€§ä¿¡æ¯ï¼Œæœ‰æ—¶å€™ä¹Ÿç§°ä¹‹ä¸ºå…ƒæ•°æ®ã€‚</p>
</li>
<li><p><code>performance_schema</code></p>
<p>å­˜å‚¨äº† <code>MySQL</code> æœåŠ¡å™¨è¿è¡Œè¿‡ç¨‹ä¸­çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ï¼Œç®—æ˜¯å¯¹ <code>MySQL</code> æœåŠ¡å™¨çš„ä¸€ä¸ªæ€§èƒ½ç›‘æ§ã€‚åŒ…æ‹¬ç»Ÿè®¡æœ€è¿‘æ‰§è¡Œäº†å“ªäº›è¯­å¥ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹çš„æ¯ä¸ªé˜¶æ®µéƒ½èŠ±è´¹äº†å¤šé•¿æ—¶é—´ï¼Œå†…å­˜çš„ä½¿ç”¨æƒ…å†µç­‰ã€‚</p>
</li>
<li><p><code>sys</code></p>
<p>ä¸»è¦æ˜¯é€šè¿‡è§†å›¾çš„å½¢å¼æŠŠ <code>information_schema</code> å’Œ <code>performance_schema</code> ç»“åˆèµ·æ¥ï¼Œè®©ç¨‹åºå‘˜å¯ä»¥æ›´æ–¹ä¾¿çš„äº†è§£ <code>MySQL</code> æœåŠ¡å™¨çš„ä¸€äº›æ€§èƒ½ã€‚</p>
</li>
</ul>
<h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><h3 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h3><p>æ¯ä¸ªæ•°æ®åº“éƒ½å¯¹åº”æ•°æ®ç›®å½•ä¸‹çš„ä¸€ä¸ªå­ç›®å½•ï¼Œæˆ–è€…è¯´å¯¹åº”ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| information_schema |</span><br><span class="line">| employees          |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">| test               |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ auto.cnf</span><br><span class="line">â”œâ”€â”€ error.log</span><br><span class="line">â”œâ”€â”€ ib_buffer_pool</span><br><span class="line">â”œâ”€â”€ ibdata1</span><br><span class="line">â”œâ”€â”€ ib_logfile0</span><br><span class="line">â”œâ”€â”€ ib_logfile1</span><br><span class="line">â”œâ”€â”€ ibtmp1</span><br><span class="line">â”œâ”€â”€ mysql</span><br><span class="line">â”œâ”€â”€ mysql-binlog.<span class="number">000615</span></span><br><span class="line">â”œâ”€â”€ mysql-binlog.<span class="number">000616</span></span><br><span class="line">â”œâ”€â”€ mysql-binlog.<span class="number">000617</span></span><br><span class="line">â”œâ”€â”€ ...</span><br><span class="line">â”œâ”€â”€ mysql-binlog.index</span><br><span class="line">â”œâ”€â”€ mysql.pid</span><br><span class="line">â”œâ”€â”€ mysql.sock</span><br><span class="line">â”œâ”€â”€ mysql.sock.lock</span><br><span class="line">â”œâ”€â”€ performance_schema</span><br><span class="line">â”œâ”€â”€ slow.log</span><br><span class="line">â”œâ”€â”€ slow_query.log</span><br><span class="line">â”œâ”€â”€ sys</span><br><span class="line">â””â”€â”€ tdm</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>ibdata1</strong>ï¼šç³»ç»Ÿè¡¨çš„ç©ºé—´æ–‡ä»¶ï¼Œ<code>undo</code> ä¿¡æ¯ä¿å­˜åœ¨ç³»ç»Ÿæ–‡ä»¶ <code>ibdata1</code> ã€‚</li>
<li><strong>ib_logfile0</strong>ï¼šä¿å­˜ <code>InnoDB</code> å¼•æ“è¡¨çš„äº‹åŠ¡æ—¥å¿—ä¿¡æ¯ï¼Œå…¶æ–‡ä»¶å¤§å°å°ºå¯¸å›ºå®šï¼Œä¸å¯ä»¥æ”¹å˜ã€‚</li>
<li><strong>*.index</strong>ï¼šç´¢å¼•æ–‡ä»¶ï¼Œç”¨äºè®°å½•å“ªäº›æ—¥å¿—æ–‡ä»¶æ­£åœ¨è¢«ä½¿ç”¨ã€‚</li>
<li><strong>mysql-binlog.*</strong>ï¼šè®°å½•æ•°æ®åº“æ‰€æœ‰çš„ <code>DDL</code> å’Œ <code>DML</code>ï¼ˆé™¤äº†æ•°æ®æŸ¥è¯¢è¯­å¥ï¼‰è¯­å¥äº‹ä»¶ã€‚ </li>
</ul>
<h3 id="è¡¨"><a href="#è¡¨" class="headerlink" title="è¡¨"></a>è¡¨</h3><p><strong>InnoDBè¡¨</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ db.opt</span><br><span class="line">â”œâ”€â”€ test.frm</span><br><span class="line">â””â”€â”€ test.ibd</span><br><span class="line"></span><br><span class="line"><span class="comment"># db.optï¼šè¿™ä¸ªæ–‡ä»¶ä¸­åŒ…å«äº†è¯¥æ•°æ®åº“çš„å„ç§å±æ€§ï¼Œä¾‹å¦‚ï¼šæ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™</span></span><br><span class="line">default-character-set=utf8</span><br><span class="line">default-collation=utf8_general_ci</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¡¨ç»“æ„æ–‡ä»¶ï¼šå­˜å‚¨è¡¨åç§°ã€åˆ—ç±»å‹ã€çº¦æŸæ¡ä»¶ã€å­—ç¬¦é›†ç­‰ä¸“é—¨ç”¨äºæè¿°è¡¨ç»“æ„çš„æ–‡ä»¶</span></span><br><span class="line">test.frm</span><br><span class="line"></span><br><span class="line"><span class="comment"># InnoDBè¡¨æ•°æ®å­˜å‚¨æ–‡ä»¶</span></span><br><span class="line">test.ibd</span><br></pre></td></tr></table></figure>

<p><strong>ç³»ç»Ÿè¡¨ç©ºé—´ï¼ˆsystem tablespaceï¼‰</strong></p>
<p><code>ibdata1</code> æ˜¯ä¸€ä¸ªè‡ªæ‰©å±•æ–‡ä»¶ï¼Œé»˜è®¤ <code>12M</code>ï¼Œé…ç½®æ–‡ä»¶å¯é…ç½®ä»»æ„å¤§å°ï¼Œä¸å¤Ÿç”¨çš„æ—¶å€™ä¼šè‡ªå·±å¢åŠ æ–‡ä»¶å¤§å°</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">innodb_data_home_dir  = /<span class="keyword">data</span>/mysql</span><br><span class="line">innodb_data_file_path = ibdata1:<span class="number">1</span>G:autoextend</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tipsï¼šä» <code>MySQL 5.5.7</code> åˆ° <code>MySQL 5.6.6</code> ä¹‹é—´çš„å„ä¸ªç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬è¡¨ä¸­çš„æ•°æ®éƒ½ä¼šè¢«é»˜è®¤å­˜å‚¨åˆ°è¿™ä¸ª<strong>ç³»ç»Ÿè¡¨ç©ºé—´</strong></p>
</blockquote>
<p><strong>ç‹¬ç«‹è¡¨ç©ºé—´ï¼ˆfile-per-table tablespaceï¼‰</strong></p>
<p>åœ¨ <code>MySQL 5.6.6</code> ä»¥åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œ<code>InnoDB</code> å¹¶ä¸ä¼šé»˜è®¤çš„æŠŠå„ä¸ªè¡¨çš„æ•°æ®å­˜å‚¨åˆ°ç³»ç»Ÿè¡¨ç©ºé—´ä¸­ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸€ä¸ªè¡¨å»ºç«‹ä¸€ä¸ªç‹¬ç«‹è¡¨ç©ºé—´ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">test.ibd  <span class="comment"># ç”¨æ¥å­˜å‚¨testè¡¨ä¸­çš„æ•°æ®å’Œç´¢å¼•</span></span><br></pre></td></tr></table></figure>

<p><strong>innodb_file_per_table</strong>ï¼šæŒ‡å®šä½¿ç”¨ç³»ç»Ÿè¡¨ç©ºé—´è¿˜æ˜¯ç‹¬ç«‹è¡¨ç©ºé—´æ¥å­˜å‚¨æ•°æ®ï¼Œè¯¥å‚æ•°åªå¯¹æ–°å»ºçš„è¡¨èµ·ä½œç”¨ï¼Œå¯¹äºå·²ç»åˆ†é…äº†è¡¨ç©ºé—´çš„è¡¨å¹¶ä¸èµ·ä½œç”¨ã€‚</p>
<ul>
<li><p>å½“ <code>innodb_file_per_table</code> çš„å€¼ä¸º <code>0</code> æ—¶ï¼Œä»£è¡¨ä½¿ç”¨ç³»ç»Ÿè¡¨ç©ºé—´</p>
</li>
<li><p>å½“ <code>innodb_file_per_table</code> çš„å€¼ä¸º <code>1</code> æ—¶ï¼Œä»£è¡¨ä½¿ç”¨ç‹¬ç«‹è¡¨ç©ºé—´</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like 'innodb_file_per_table';</span><br><span class="line">+<span class="comment">-----------------------+-------+</span></span><br><span class="line">| Variable_name         | Value |</span><br><span class="line">+<span class="comment">-----------------------+-------+</span></span><br><span class="line">| innodb_file_per_table | ON    |</span><br><span class="line">+<span class="comment">-----------------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># testè¡¨ä»ç‹¬ç«‹è¡¨ç©ºé—´ç§»åŠ¨åˆ°ç³»ç»Ÿè¡¨ç©ºé—´</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">test</span> <span class="keyword">TABLESPACE</span> innodb_system;</span><br><span class="line"></span><br><span class="line"><span class="comment"># testè¡¨ä»ç³»ç»Ÿè¡¨ç©ºé—´ç§»åŠ¨åˆ°ç‹¬ç«‹è¡¨ç©ºé—´</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">test</span> <span class="keyword">TABLESPACE</span> innodb_file_per_table;</span><br></pre></td></tr></table></figure>

<p><strong>MyISAMè¡¨</strong></p>
<p><code>MyISAM</code> å¹¶æ²¡æœ‰ä»€ä¹ˆæ‰€è°“çš„è¡¨ç©ºé—´ä¸€è¯´ï¼Œè¡¨æ•°æ®éƒ½å­˜æ”¾åˆ°å¯¹åº”çš„æ•°æ®åº“å­ç›®å½•ä¸‹ï¼Œåœ¨ <code>MyISAM</code> ä¸­çš„ç´¢å¼•å…¨éƒ¨éƒ½æ˜¯äºŒçº§ç´¢å¼•ï¼Œè¯¥å­˜å‚¨å¼•æ“çš„æ•°æ®å’Œç´¢å¼•æ˜¯åˆ†å¼€å­˜æ”¾çš„ï¼Œæ‰€ä»¥åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ä¹Ÿæ˜¯ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶æ¥å­˜å‚¨æ•°æ®æ–‡ä»¶å’Œç´¢å¼•æ–‡ä»¶ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">test.frm  <span class="comment"># è¡¨ç»“æ„æ–‡ä»¶</span></span><br><span class="line">test.MYD  <span class="comment"># è¡¨æ•°æ®æ–‡ä»¶</span></span><br><span class="line">test.MYI  <span class="comment"># è¡¨ç´¢å¼•æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>

<h3 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h3><p>è§†å›¾æ˜¯è™šæ‹Ÿçš„è¡¨ï¼Œä¹Ÿå°±æ˜¯æŸä¸ªæŸ¥è¯¢è¯­å¥çš„ä¸€ä¸ªåˆ«åè€Œå·²ï¼Œæ‰€ä»¥åœ¨å­˜å‚¨è§†å›¾çš„æ—¶å€™æ˜¯ä¸éœ€è¦å­˜å‚¨çœŸå®çš„æ•°æ®çš„ï¼Œåªéœ€è¦æŠŠå®ƒçš„ç»“æ„å­˜å‚¨èµ·æ¥å°±è¡Œäº†ã€‚å’Œè¡¨ä¸€æ ·æè¿°è§†å›¾ç»“æ„çš„æ–‡ä»¶ä¹Ÿä¼šè¢«å­˜å‚¨åˆ°æ‰€å±æ•°æ®åº“å¯¹åº”çš„å­ç›®å½•ä¸‹è¾¹ï¼Œåªä¼šå­˜å‚¨ä¸€ä¸ª <code>è§†å›¾å.frm</code> çš„æ–‡ä»¶ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ db.opt</span><br><span class="line">â”œâ”€â”€ host_summary_by_file_io.frm</span><br><span class="line">â”œâ”€â”€ host_summary_by_file_io_type.frm</span><br><span class="line">â”œâ”€â”€ host_summary_by_stages.frm</span><br><span class="line">â”œâ”€â”€ host_summary_by_statement_latency.frm</span><br><span class="line">â”œâ”€â”€ host_summary_by_statement_type.frm</span><br><span class="line">â”œâ”€â”€ host_summary.frm</span><br><span class="line">â”œâ”€â”€ innodb_buffer_stats_by_schema.frm</span><br><span class="line">â”œâ”€â”€ innodb_buffer_stats_by_table.frm</span><br><span class="line">â””â”€â”€ innodb_lock_waits.frm</span><br></pre></td></tr></table></figure>

<h3 id="å…¶ä»–æ–‡ä»¶"><a href="#å…¶ä»–æ–‡ä»¶" class="headerlink" title="å…¶ä»–æ–‡ä»¶"></a>å…¶ä»–æ–‡ä»¶</h3><p>æ•°æ®ç›®å½•é™¤äº†å­˜å‚¨æ•°æ®æ–‡ä»¶ä»¥å¤–ï¼Œè¿˜åŒ…æ‹¬ä¸ºäº†æ›´å¥½è¿è¡Œç¨‹åºçš„ä¸€äº›é¢å¤–æ–‡ä»¶ï¼Œä¸»è¦åŒ…æ‹¬è¿™å‡ ç§ç±»å‹çš„æ–‡ä»¶ï¼š</p>
<p><strong>è¿›ç¨‹æ–‡ä»¶</strong></p>
<p><code>MySQL</code> æœåŠ¡å™¨ä¼šæŠŠè‡ªå·±çš„è¿›ç¨‹ <code>ID</code> å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ <code>mysql.pid</code></p>
<p><strong>æ—¥å¿—æ–‡ä»¶</strong></p>
<p>åœ¨ <code>mysqld</code> æœåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿå„ç§å„æ ·çš„æ—¥å¿—ï¼Œä¾‹å¦‚ï¼šæŸ¥è¯¢æ—¥å¿—ã€é”™è¯¯æ—¥å¿—ã€äºŒè¿›åˆ¶æ—¥å¿—ã€<code>redo</code> æ—¥å¿—ç­‰</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· InnoDB å­˜å‚¨å¼•æ“</title>
    <url>/blog/2019/09/26/mysql-innodb/</url>
    <content><![CDATA[<h2 id="InnoDB-é¡µ"><a href="#InnoDB-é¡µ" class="headerlink" title="InnoDB é¡µ"></a>InnoDB é¡µ</h2><p><code>InnoDB</code> æ˜¯ä¸€ä¸ªå°†è¡¨ä¸­çš„æ•°æ®å­˜å‚¨åˆ°ç£ç›˜ä¸Šçš„å­˜å‚¨å¼•æ“ï¼Œè€ŒçœŸæ­£å¤„ç†æ•°æ®çš„è¿‡ç¨‹æ˜¯å‘ç”Ÿåœ¨å†…å­˜ä¸­çš„ï¼Œæ‰€ä»¥éœ€è¦æŠŠç£ç›˜ä¸­çš„æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœæ˜¯å¤„ç†å†™å…¥æˆ–ä¿®æ”¹è¯·æ±‚çš„è¯ï¼Œè¿˜éœ€è¦æŠŠå†…å­˜ä¸­çš„å†…å®¹åˆ·æ–°åˆ°ç£ç›˜ä¸Šã€‚è€Œæˆ‘ä»¬çŸ¥é“è¯»å†™ç£ç›˜çš„é€Ÿåº¦éå¸¸æ…¢ï¼Œå’Œå†…å­˜è¯»å†™å·®äº†å‡ ä¸ªæ•°é‡çº§ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬æƒ³ä»è¡¨ä¸­è·å–æŸäº›è®°å½•æ—¶ï¼Œ<code>InnoDB</code> å­˜å‚¨å¼•æ“éœ€è¦ä¸€æ¡ä¸€æ¡çš„æŠŠè®°å½•ä»ç£ç›˜ä¸Šè¯»å‡ºæ¥ä¹ˆï¼Ÿä¸ï¼Œé‚£æ ·ä¼šæ…¢æ­»ï¼Œ<code>InnoDB</code> é‡‡å–çš„æ–¹å¼æ˜¯ï¼šå°†æ•°æ®åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªé¡µï¼Œä»¥é¡µä½œä¸ºç£ç›˜å’Œå†…å­˜ä¹‹é—´äº¤äº’çš„åŸºæœ¬å•ä½ï¼Œ<code>InnoDB</code> ä¸­é¡µçš„å¤§å°ä¸€èˆ¬ä¸º <code>16KB</code>ã€‚ä¹Ÿå°±æ˜¯åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€æ¬¡æœ€å°‘ä»ç£ç›˜ä¸­è¯»å– <code>16KB</code> çš„å†…å®¹åˆ°å†…å­˜ä¸­ï¼Œä¸€æ¬¡æœ€å°‘æŠŠå†…å­˜ä¸­çš„ <code>16KB</code> å†…å®¹åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚</p>
<blockquote>
<p><strong>å°ç»“</strong></p>
</blockquote>
<ul>
<li><p>é¡µæ˜¯ <code>MySQL</code> ä¸­ç£ç›˜å’Œå†…å­˜äº¤äº’çš„åŸºæœ¬å•ä½ï¼Œä¹Ÿæ˜¯ <code>MySQL</code> æ˜¯ç®¡ç†å­˜å‚¨ç©ºé—´çš„åŸºæœ¬å•ä½</p>
</li>
<li><p>æŒ‡å®šå’Œä¿®æ”¹è¡Œæ ¼å¼çš„è¯­æ³•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> è¡¨å (åˆ—çš„ä¿¡æ¯) ROW_FORMAT=è¡Œæ ¼å¼åç§°</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å ROW_FORMAT=è¡Œæ ¼å¼åç§°</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>InnoDB</code> ç›®å‰å®šä¹‰äº† 4 ç§è¡Œæ ¼å¼ï¼š<code>Compact</code>ã€<code>Redundant</code>ã€<code>Dynamic</code>ã€<code>Compressed</code></p>
</li>
<li><p>ä¸€ä¸ªé¡µä¸€èˆ¬æ˜¯ <code>16KB</code>ï¼Œå½“è®°å½•ä¸­çš„æ•°æ®å¤ªå¤šï¼Œå½“å‰é¡µæ”¾ä¸ä¸‹çš„æ—¶å€™ï¼Œä¼šæŠŠå¤šä½™çš„æ•°æ®å­˜å‚¨åˆ°å…¶ä»–é¡µä¸­ï¼Œè¿™ç§ç°è±¡ç§°ä¸º<strong>è¡Œæº¢å‡º</strong>ã€‚</p>
</li>
</ul>
<h2 id="InnoDB-æ•°æ®é¡µç»“æ„"><a href="#InnoDB-æ•°æ®é¡µç»“æ„" class="headerlink" title="InnoDB æ•°æ®é¡µç»“æ„"></a>InnoDB æ•°æ®é¡µç»“æ„</h2><p>InnoDB ä¸ºäº†ä¸åŒçš„ç›®çš„è€Œè®¾è®¡äº†ä¸åŒç±»å‹çš„é¡µï¼Œæˆ‘ä»¬æŠŠç”¨äºå­˜æ”¾è®°å½•çš„é¡µå«åš<strong>æ•°æ®é¡µ</strong>ã€‚</p>
<p>ä¸€ä¸ªæ•°æ®é¡µå¯ä»¥è¢«å¤§è‡´åˆ’åˆ†ä¸º 7 ä¸ªéƒ¨åˆ†ï¼š</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-09-26-152320.png" alt></p>
<ul>
<li><code>File Header</code>ï¼Œè¡¨ç¤ºé¡µçš„ä¸€äº›é€šç”¨ä¿¡æ¯ï¼Œå å›ºå®šçš„ <code>38</code> å­—èŠ‚ã€‚</li>
<li><code>Page Header</code>ï¼Œè¡¨ç¤ºæ•°æ®é¡µä¸“æœ‰çš„ä¸€äº›ä¿¡æ¯ï¼Œå å›ºå®šçš„ <code>56</code> ä¸ªå­—èŠ‚ã€‚</li>
<li><code>Infimum + Supremum</code>ï¼Œä¸¤ä¸ªè™šæ‹Ÿçš„ä¼ªè®°å½•ï¼Œåˆ†åˆ«è¡¨ç¤ºé¡µä¸­çš„æœ€å°å’Œæœ€å¤§è®°å½•ï¼Œå å›ºå®šçš„<code>26</code>ä¸ªå­—èŠ‚ã€‚</li>
<li><code>User Records</code>ï¼šçœŸå®å­˜å‚¨æˆ‘ä»¬æ’å…¥çš„è®°å½•çš„éƒ¨åˆ†ï¼Œå¤§å°ä¸å›ºå®šã€‚</li>
<li><code>Free Space</code>ï¼šé¡µä¸­å°šæœªä½¿ç”¨çš„éƒ¨åˆ†ï¼Œå¤§å°ä¸ç¡®å®šã€‚</li>
<li><code>Page Directory</code>ï¼šé¡µä¸­çš„æŸäº›è®°å½•ç›¸å¯¹ä½ç½®ï¼Œä¹Ÿå°±æ˜¯å„ä¸ªæ§½åœ¨é¡µé¢ä¸­çš„åœ°å€åç§»é‡ï¼Œå¤§å°ä¸å›ºå®šï¼Œæ’å…¥çš„è®°å½•è¶Šå¤šï¼Œè¿™ä¸ªéƒ¨åˆ†å ç”¨çš„ç©ºé—´è¶Šå¤šã€‚</li>
<li><code>File Trailer</code>ï¼šç”¨äºæ£€éªŒé¡µæ˜¯å¦å®Œæ•´çš„éƒ¨åˆ†ï¼Œå ç”¨å›ºå®šçš„ <code>8</code> ä¸ªå­—èŠ‚ã€‚</li>
</ul>
<p>æ¯ä¸ªè®°å½•çš„å¤´ä¿¡æ¯ä¸­éƒ½æœ‰ä¸€ä¸ª <code>next_record</code> å±æ€§ï¼Œä»è€Œä½¿é¡µä¸­çš„æ‰€æœ‰è®°å½•ä¸²è”æˆä¸€ä¸ªå•é“¾è¡¨ã€‚</p>
<p><code>InnoDB</code> ä¼šæŠŠé¡µä¸­çš„è®°å½•åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªç»„ï¼Œæ¯ä¸ªç»„çš„æœ€åä¸€ä¸ªè®°å½•çš„åœ°å€åç§»é‡ä½œä¸ºä¸€ä¸ª<strong>æ§½</strong>ï¼Œå­˜æ”¾åœ¨ <code>Page Directory</code> ä¸­ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªé¡µä¸­æ ¹æ®ä¸»é”®æŸ¥æ‰¾è®°å½•æ˜¯éå¸¸å¿«çš„ï¼Œåˆ†æˆä¸¤æ­¥ï¼š</p>
<ul>
<li>é€šè¿‡äºŒåˆ†æ³•ç¡®å®šè¯¥è®°å½•æ‰€åœ¨çš„æ§½</li>
<li>é€šè¿‡è®°å½•çš„next_recordå±æ€§éå†è¯¥æ§½æ‰€åœ¨çš„ç»„ä¸­çš„å„ä¸ªè®°å½•</li>
</ul>
<p>æ¯ä¸ªæ•°æ®é¡µçš„ <code>File Header</code> éƒ¨åˆ†éƒ½æœ‰ä¸Šä¸€ä¸ªå’Œä¸‹ä¸€ä¸ªé¡µçš„ç¼–å·ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°æ®é¡µä¼šç»„æˆä¸€ä¸ªåŒé“¾è¡¨ã€‚</p>
<p>ä¸ºä¿è¯ä»å†…å­˜ä¸­åŒæ­¥åˆ°ç£ç›˜çš„é¡µçš„å®Œæ•´æ€§ï¼Œåœ¨é¡µçš„é¦–éƒ¨å’Œå°¾éƒ¨éƒ½ä¼šå­˜å‚¨é¡µä¸­æ•°æ®çš„æ ¡éªŒå’Œå’Œé¡µé¢æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„ <code>LSN</code> å€¼ï¼Œå¦‚æœé¦–éƒ¨å’Œå°¾éƒ¨çš„æ ¡éªŒå’Œå’Œ <code>LSN</code> å€¼æ ¡éªŒä¸æˆåŠŸçš„è¯ï¼Œå°±è¯´æ˜åŒæ­¥è¿‡ç¨‹å‡ºç°äº†é—®é¢˜ã€‚</p>
<p>é¡µå’Œè®°å½•çš„å…³ç³»ï¼š</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-09-26-152840.png" alt></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· å­—ç¬¦é›†</title>
    <url>/blog/2019/09/25/mysql-character/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><strong>å­—ç¬¦é›†</strong>ï¼šè®¡ç®—æœºä¸­åªèƒ½å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼Œé‚£å­—ç¬¦ä¸²è¯¥å¦‚ä½•å­˜å‚¨å­—ç¬¦ä¸²å‘¢ï¼Ÿæ˜¯é å»ºç«‹å­—ç¬¦ä¸äºŒè¿›åˆ¶æ•°æ®çš„æ˜ å°„å…³ç³»ï¼Œå°†ä¸€ä¸ªå­—ç¬¦æ˜ å°„æˆä¸€ä¸ªäºŒè¿›åˆ¶æ•°æ®çš„è¿‡ç¨‹å«åš<strong>ç¼–ç </strong>ï¼Œå°†ä¸€ä¸ªäºŒè¿›åˆ¶æ•°æ®æ˜ å°„åˆ°ä¸€ä¸ªå­—ç¬¦çš„è¿‡ç¨‹å«åš<strong>è§£ç </strong>ï¼ŒæŠ½è±¡å‡ºä¸€ä¸ª<strong>å­—ç¬¦é›†</strong>çš„æ¦‚å¿µæ¥æè¿°æŸä¸ªå­—ç¬¦èŒƒå›´çš„ç¼–ç è§„åˆ™ã€‚</p>
<p><strong>æ¯”è¾ƒè§„åˆ™</strong>ï¼šè‹±æ–‡åä¸º <code>collation</code>ï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦çš„å¤§å°ã€‚</p>
<p><strong>å¸¸ç”¨å­—ç¬¦é›†</strong></p>
<ul>
<li><p><code>ASCII</code> å­—ç¬¦é›†</p>
<p>å…±æ”¶å½• <code>128</code> ä¸ªå­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€æ ‡ç‚¹ç¬¦å·ã€æ•°å­—ã€å¤§å°å†™å­—æ¯å’Œä¸€äº›ä¸å¯è§å­—ç¬¦ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="string">'L'</span> -&gt;  <span class="number">01001100</span>ï¼ˆåå…­è¿›åˆ¶ï¼š<span class="number">0</span>x4Cï¼Œåè¿›åˆ¶ï¼š<span class="number">76</span>ï¼‰</span><br><span class="line"><span class="string">'M'</span> -&gt;  <span class="number">01001101</span>ï¼ˆåå…­è¿›åˆ¶ï¼š<span class="number">0</span>x4Dï¼Œåè¿›åˆ¶ï¼š<span class="number">77</span>ï¼‰</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>ISO 8859-1</code> å­—ç¬¦é›†</p>
<p>å…±æ”¶å½• <code>256</code> ä¸ªå­—ç¬¦ï¼Œæ˜¯åœ¨ <code>ASCII</code> å­—ç¬¦é›†çš„åŸºç¡€ä¸Šåˆæ‰©å……äº† <code>128</code> ä¸ªè¥¿æ¬§å¸¸ç”¨å­—ç¬¦ï¼ˆåŒ…æ‹¬å¾·æ³•ä¸¤å›½çš„å­—æ¯ï¼‰ï¼Œè¿™ä¸ªå­—ç¬¦é›†ä¹Ÿæœ‰ä¸€ä¸ªåˆ«å <code>latin1</code>ã€‚</p>
</li>
<li><p><code>utf8</code> å­—ç¬¦é›†</p>
<p>æ”¶å½•åœ°çƒä¸Šèƒ½æƒ³åˆ°çš„æ‰€æœ‰å­—ç¬¦ï¼Œè€Œä¸”è¿˜åœ¨ä¸æ–­æ‰©å……ã€‚è¿™ç§å­—ç¬¦é›†å…¼å®¹ <code>ASCII</code> å­—ç¬¦é›†ï¼Œé‡‡ç”¨å˜é•¿ç¼–ç æ–¹å¼ï¼Œç¼–ç ä¸€ä¸ªå­—ç¬¦éœ€è¦ä½¿ç”¨ <code>1ï½4</code> ä¸ªå­—èŠ‚ï¼Œæ¯”æ–¹è¯´è¿™æ ·ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="string">'L'</span> -&gt;  <span class="number">01001100</span>ï¼ˆåå…­è¿›åˆ¶ï¼š<span class="number">0</span>x4Cï¼‰</span><br><span class="line"><span class="string">'å•Š'</span> -&gt;  <span class="number">111001011001010110001010</span>ï¼ˆåå…­è¿›åˆ¶ï¼š<span class="number">0</span>xE5958Aï¼‰</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tipsï¼š <code>utf8</code> åªæ˜¯ <code>Unicode</code> å­—ç¬¦é›†çš„ä¸€ç§ç¼–ç æ–¹æ¡ˆï¼Œ<code>Unicode</code> å­—ç¬¦é›†å¯ä»¥ç”¨ <code>utf8</code>ã€<code>utf16</code>ã€<code>utf32</code> è¿™å‡ ç§ç¼–ç æ–¹æ¡ˆï¼Œ<code>utf8</code> ä½¿ç”¨ <code>1ï½4</code> ä¸ªå­—èŠ‚ç¼–ç ä¸€ä¸ªå­—ç¬¦ã€‚</p>
</blockquote>
</li>
</ul>
<p><strong>æŸ¥çœ‹å­—ç¬¦é›†ï¼ˆcharacter set/charsetï¼‰</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mysql&gt; show charset like <span class="string">'utf8%'</span>;</span><br><span class="line">+---------+---------------+--------------------+--------+</span><br><span class="line">| Charset | Description   | Default collation  | Maxlen |</span><br><span class="line">+---------+---------------+--------------------+--------+</span><br><span class="line">| utf8    | UTF-<span class="number">8</span> Unicode | utf8_general_ci    |      <span class="number">3</span> |</span><br><span class="line">| utf8mb4 | UTF-<span class="number">8</span> Unicode | utf8mb4_general_ci |      <span class="number">4</span> |</span><br><span class="line">+---------+---------------+--------------------+--------+</span><br></pre></td></tr></table></figure>

<p><strong>æŸ¥çœ‹æ¯”è¾ƒè§„åˆ™ï¼ˆcollationï¼‰</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mysql&gt; show collation like <span class="string">'utf8%general_ci'</span>;</span><br><span class="line">+--------------------+---------+----+---------+----------+---------+</span><br><span class="line">| Collation          | Charset | Id | Default | Compiled | Sortlen |</span><br><span class="line">+--------------------+---------+----+---------+----------+---------+</span><br><span class="line">| utf8_general_ci    | utf8    | <span class="number">33</span> | Yes     | Yes      |       <span class="number">1</span> |</span><br><span class="line">| utf8mb4_general_ci | utf8mb4 | <span class="number">45</span> | Yes     | Yes      |       <span class="number">1</span> |</span><br><span class="line">+--------------------+---------+----+---------+----------+---------+</span><br></pre></td></tr></table></figure>

<p><code>utf8</code> å­—ç¬¦é›†é»˜è®¤çš„æ¯”è¾ƒè§„åˆ™æ˜¯ <code>utf8_general_ci</code>ï¼Œå®ƒæ˜¯ä¸€ç§é€šç”¨çš„æ¯”è¾ƒè§„åˆ™ï¼Œ<code>_ci</code> ç»“å°¾ï¼Œè¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™ã€‚</p>
<h2 id="å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™"><a href="#å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™" class="headerlink" title="å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™"></a>å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™</h2><p><code>MySQL</code> æœ‰å››ä¸ªçº§åˆ«çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>æœåŠ¡å™¨çº§åˆ«</li>
<li>æ•°æ®åº“çº§åˆ«</li>
<li>è¡¨çº§åˆ«</li>
<li>åˆ—çº§åˆ«</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">'character%'</span>;</span><br><span class="line">+--------------------------+----------------------------------------------------+</span><br><span class="line">| Variable_name            | Value                                              |</span><br><span class="line">+--------------------------+----------------------------------------------------+</span><br><span class="line">| character_set_client     | utf8                                               |</span><br><span class="line">| character_set_connection | utf8                                               |</span><br><span class="line">| character_set_database   | utf8                                               |</span><br><span class="line">| character_set_filesystem | binary                                             |</span><br><span class="line">| character_set_results    | utf8                                               |</span><br><span class="line">| character_set_server     | latin1                                             |</span><br><span class="line">| character_set_system     | utf8                                               |</span><br><span class="line">| character_sets_dir       | /usr/local/mysql-<span class="number">5.7</span>.<span class="number">23</span>-el7-x86_64/share/charsets/ |</span><br><span class="line">+--------------------------+----------------------------------------------------+</span><br></pre></td></tr></table></figure>

<ul>
<li>character_set_serverï¼š é»˜è®¤çš„å†…éƒ¨æ“ä½œå­—ç¬¦é›†</li>
<li>character_set_clientï¼š æœåŠ¡å™¨è§£ç è¯·æ±‚æ—¶ä½¿ç”¨çš„å­—ç¬¦é›†</li>
<li>character_set_connectionï¼šè¿æ¥å±‚å­—ç¬¦é›†</li>
<li>character_set_resultsï¼š æœåŠ¡å™¨å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®æ—¶ä½¿ç”¨çš„å­—ç¬¦é›†</li>
<li>character_set_databaseï¼š å½“å‰é€‰ä¸­æ•°æ®åº“çš„é»˜è®¤å­—ç¬¦é›†</li>
<li>character_set_systemï¼š ç³»ç»Ÿå…ƒæ•°æ®(å­—æ®µåç­‰)å­—ç¬¦é›†</li>
</ul>
<h3 id="æœåŠ¡å™¨çº§åˆ«"><a href="#æœåŠ¡å™¨çº§åˆ«" class="headerlink" title="æœåŠ¡å™¨çº§åˆ«"></a>æœåŠ¡å™¨çº§åˆ«</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ§åˆ¶å‚æ•°</span></span><br><span class="line">character_set_server</span><br><span class="line">collation_server</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®æ–‡ä»¶è®¾ç½®</span></span><br><span class="line">[client]</span><br><span class="line">default-character-<span class="keyword">set</span>  = utf8</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line"><span class="keyword">default</span>-<span class="built_in">character</span>-<span class="keyword">set</span>  = utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="built_in">character</span>-<span class="keyword">set</span>-<span class="keyword">server</span>   = utf8</span><br><span class="line"><span class="keyword">collation</span>-<span class="keyword">server</span>       = utf8_general_ci</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ–¹æ³•</span></span><br><span class="line">mysql&gt; <span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'character_set_server'</span>;</span><br><span class="line">+<span class="comment">----------------------+--------+</span></span><br><span class="line">| Variable_name        | Value  |</span><br><span class="line">+<span class="comment">----------------------+--------+</span></span><br><span class="line">| character_set_server | utf8   |</span><br><span class="line">+<span class="comment">----------------------+--------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'collation_server'</span>;</span><br><span class="line">+<span class="comment">------------------+-------------------+</span></span><br><span class="line">| Variable_name    | Value             |</span><br><span class="line">+<span class="comment">------------------+-------------------+</span></span><br><span class="line">| collation_server | utf8_general_ci   |</span><br><span class="line">+<span class="comment">------------------+-------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="æ•°æ®åº“çº§åˆ«"><a href="#æ•°æ®åº“çº§åˆ«" class="headerlink" title="æ•°æ®åº“çº§åˆ«"></a>æ•°æ®åº“çº§åˆ«</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ§åˆ¶å‚æ•°</span></span><br><span class="line">character_set_database</span><br><span class="line">collation_database</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè¯­æ³•</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> æ•°æ®åº“å</span><br><span class="line">    [[<span class="keyword">DEFAULT</span>] <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> å­—ç¬¦é›†åç§°]</span><br><span class="line">    [[<span class="keyword">DEFAULT</span>] <span class="keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°];</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> æ•°æ®åº“å</span><br><span class="line">    [[<span class="keyword">DEFAULT</span>] <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> å­—ç¬¦é›†åç§°]</span><br><span class="line">    [[<span class="keyword">DEFAULT</span>] <span class="keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°];</span><br><span class="line">    </span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ–¹æ³•</span></span><br><span class="line">mysql&gt; use test;</span><br><span class="line">mysql&gt; SELECT @@character_set_database, @@collation_database;</span><br><span class="line">+<span class="comment">--------------------------+----------------------+</span></span><br><span class="line">| @@character_set_database | @@collation_database |</span><br><span class="line">+<span class="comment">--------------------------+----------------------+</span></span><br><span class="line">| utf8                     | utf8_general_ci      |</span><br><span class="line">+<span class="comment">--------------------------+----------------------+</span></span><br></pre></td></tr></table></figure>

<p><strong>è§„åˆ™</strong></p>
<ul>
<li>åˆ›å»ºæ•°æ®åº“æ—¶ï¼ŒæŒ‡å®šäº† <code>CHARACTER SET</code> æˆ– <code>COLLATE</code>ï¼Œåˆ™ä»¥å¯¹åº”çš„å­—ç¬¦é›†ã€æ¯”è¾ƒè§„åˆ™ä¸ºå‡†ã€‚</li>
<li>åˆ›å»ºæ•°æ®åº“æ—¶ï¼Œæ²¡æœ‰æŒ‡å®šå­—ç¬¦é›†ã€æ’åºè§„åˆ™ï¼Œåˆ™ä»¥ <code>character_set_server</code>ã€<code>collation_server</code> ä¸ºå‡†ã€‚</li>
<li><code>character_set_database</code> å’Œ <code>collation_database</code> è¿™ä¸¤ä¸ªç³»ç»Ÿå˜é‡æ˜¯åªè¯»çš„ï¼Œä¸èƒ½é€šè¿‡ä¿®æ”¹è¿™ä¸¤ä¸ªå˜é‡çš„å€¼è€Œæ”¹å˜å½“å‰æ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ã€‚</li>
</ul>
<h3 id="è¡¨çº§åˆ«"><a href="#è¡¨çº§åˆ«" class="headerlink" title="è¡¨çº§åˆ«"></a>è¡¨çº§åˆ«</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºè¯­æ³•</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> è¡¨å (åˆ—çš„ä¿¡æ¯)</span><br><span class="line">    [[<span class="keyword">DEFAULT</span>] <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> å­—ç¬¦é›†åç§°]</span><br><span class="line">    [<span class="keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å</span><br><span class="line">    [[<span class="keyword">DEFAULT</span>] <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> å­—ç¬¦é›†åç§°]</span><br><span class="line">    [<span class="keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ–¹æ³•</span></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">table</span> <span class="keyword">status</span> <span class="keyword">from</span> <span class="keyword">test</span>\G</span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">           <span class="keyword">Name</span>: <span class="keyword">test</span></span><br><span class="line">         <span class="keyword">Engine</span>: <span class="keyword">InnoDB</span></span><br><span class="line">        <span class="keyword">Version</span>: <span class="number">10</span></span><br><span class="line">     Row_format: Dynamic</span><br><span class="line">           <span class="keyword">Rows</span>: <span class="number">5</span></span><br><span class="line"> Avg_row_length: <span class="number">3276</span></span><br><span class="line">    Data_length: <span class="number">16384</span></span><br><span class="line">Max_data_length: <span class="number">0</span></span><br><span class="line">   Index_length: <span class="number">0</span></span><br><span class="line">      Data_free: <span class="number">0</span></span><br><span class="line"> Auto_increment: <span class="number">6</span></span><br><span class="line">    Create_time: <span class="number">2019</span><span class="number">-09</span><span class="number">-24</span> <span class="number">18</span>:<span class="number">00</span>:<span class="number">54</span></span><br><span class="line">    Update_time: <span class="literal">NULL</span></span><br><span class="line">     Check_time: <span class="literal">NULL</span></span><br><span class="line">      <span class="keyword">Collation</span>: utf8_general_ci</span><br><span class="line">       <span class="keyword">Checksum</span>: <span class="literal">NULL</span></span><br><span class="line"> Create_options: </span><br><span class="line">        <span class="keyword">Comment</span>:</span><br></pre></td></tr></table></figure>

<p><strong>è§„åˆ™</strong></p>
<ul>
<li>æ˜ç¡®äº† <code>charset_name</code>ã€<code>collation_name</code>ï¼Œåˆ™é‡‡ç”¨ <code>charset_name</code>ã€<code>collation_name</code>ã€‚</li>
<li><code>charset_name</code>ã€<code>collation_name</code> å‡æœªæ˜ç¡®ï¼Œåˆ™é‡‡ç”¨æ•°æ®åº“çš„å­—ç¬¦é›†ã€æ¯”è¾ƒè§„åˆ™è®¾ç½®ã€‚</li>
</ul>
<h3 id="åˆ—çº§åˆ«"><a href="#åˆ—çº§åˆ«" class="headerlink" title="åˆ—çº§åˆ«"></a>åˆ—çº§åˆ«</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºè¯­æ³•</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> è¡¨å(</span><br><span class="line">    åˆ—å å­—ç¬¦ä¸²ç±»å‹ [<span class="built_in">CHARACTER</span> <span class="keyword">SET</span> å­—ç¬¦é›†åç§°] [<span class="keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°],</span><br><span class="line">    å…¶ä»–åˆ—...</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å <span class="keyword">MODIFY</span> åˆ—å å­—ç¬¦ä¸²ç±»å‹ [<span class="built_in">CHARACTER</span> <span class="keyword">SET</span> å­—ç¬¦é›†åç§°] [<span class="keyword">COLLATE</span> æ¯”è¾ƒè§„åˆ™åç§°];</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ–¹æ³•</span></span><br><span class="line">mysql&gt; SELECT CHARACTER_SET_NAME, COLLATION_NAME FROM information_schema.COLUMNS WHERE TABLE_SCHEMA="test" AND TABLE_NAME="test" AND COLUMN_NAME="name";</span><br><span class="line">+<span class="comment">--------------------+-----------------+</span></span><br><span class="line">| CHARACTER_SET_NAME | COLLATION_NAME  |</span><br><span class="line">+<span class="comment">--------------------+-----------------+</span></span><br><span class="line">| utf8               | utf8_general_ci |</span><br><span class="line">+<span class="comment">--------------------+-----------------+</span></span><br></pre></td></tr></table></figure>

<p><strong>è§„åˆ™</strong></p>
<ul>
<li>æ˜ç¡®äº† <code>charset_name</code>ã€<code>collation_name</code> å‡æ˜ç¡®ï¼Œåˆ™é‡‡ç”¨ <code>charset_name</code>ã€<code>collation_name</code> ä¸ºå‡†ã€‚</li>
<li><code>charset_name</code>ã€<code>collation_name</code> å‡æœªæ˜ç¡®ï¼Œåˆ™ä»¥è¡¨çš„å­—ç¬¦é›†ã€æ¯”è¾ƒè§„åˆ™ä¸ºå‡†ã€‚</li>
</ul>
<blockquote>
<p><strong>å°ç»“</strong></p>
</blockquote>
<ul>
<li>å¦‚æœåˆ›å»ºæˆ–ä¿®æ”¹åˆ—æ—¶æ²¡æœ‰æ˜¾å¼çš„æŒ‡å®šå­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œåˆ™è¯¥åˆ—é»˜è®¤ç”¨è¡¨çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™</li>
<li>å¦‚æœåˆ›å»ºæˆ–ä¿®æ”¹è¡¨æ—¶æ²¡æœ‰æ˜¾å¼çš„æŒ‡å®šå­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œåˆ™è¯¥è¡¨é»˜è®¤ç”¨æ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™</li>
<li>å¦‚æœåˆ›å»ºæˆ–ä¿®æ”¹æ•°æ®åº“æ—¶æ²¡æœ‰æ˜¾å¼çš„æŒ‡å®šå­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œåˆ™è¯¥æ•°æ®åº“é»˜è®¤ç”¨æœåŠ¡å™¨çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><strong>å­—ç¬¦é›†</strong>æ˜¯æŸä¸ªå­—ç¬¦èŒƒå›´çš„ç¼–ç è§„åˆ™ã€‚</li>
<li><strong>æ¯”è¾ƒè§„åˆ™</strong>æ˜¯é’ˆå¯¹æŸä¸ªå­—ç¬¦é›†ä¸­çš„å­—ç¬¦æ¯”è¾ƒå¤§å°çš„ä¸€ç§è§„åˆ™ã€‚</li>
<li>MySQL ä¸­ä¸€ä¸ªå­—ç¬¦é›†å¯ä»¥æœ‰è‹¥å¹²ç§æ¯”è¾ƒè§„åˆ™ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªé»˜è®¤çš„æ¯”è¾ƒè§„åˆ™ã€‚</li>
<li>MySQL æœ‰å››ä¸ªçº§åˆ«çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œä¼˜å…ˆçº§æ’åºï¼šåˆ— &gt; è¡¨ &gt; åº“ &gt; æœåŠ¡å™¨ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· é…ç½®æ–‡ä»¶</title>
    <url>/blog/2019/09/25/mysql-config/</url>
    <content><![CDATA[<h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><p>MySQL é»˜è®¤é…ç½®æ–‡ä»¶ï¼š<code>/etc/my.cnf</code>ï¼Œè‡ªåŠ¨ <a href="https://imysql.com/my_cnf_generator" target="_blank" rel="noopener">ç”Ÿæˆå·¥å…·</a></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[client]</span><br><span class="line">port                      = <span class="number">3306</span></span><br><span class="line">socket                    = /<span class="keyword">data</span>/mysql/mysql.sock</span><br><span class="line">default-character-set     = utf8</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set     = utf8</span><br><span class="line">no-auto-rehash</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">port                      = <span class="number">3306</span></span><br><span class="line">basedir                   = /usr/local/mysql</span><br><span class="line">datadir                   = /<span class="keyword">data</span>/mysql</span><br><span class="line">socket                    = /<span class="keyword">data</span>/mysql/mysql.sock</span><br><span class="line">pid-file                  = /<span class="keyword">data</span>/mysql/mysql.pid</span><br><span class="line">character-set-server      = utf8</span><br><span class="line">collation-server          = utf8_general_ci</span><br><span class="line">skip_name_resolve</span><br><span class="line"></span><br><span class="line"><span class="comment"># LOG</span></span><br><span class="line">slow_query_log            = <span class="number">1</span></span><br><span class="line">long_query_time           = <span class="number">5</span></span><br><span class="line">log_error                 = /<span class="keyword">data</span>/mysql/error.log</span><br><span class="line">slow_query_log_file       = /<span class="keyword">data</span>/mysql/slow.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># INNODB</span></span><br><span class="line">innodb_data_home_dir      = /<span class="keyword">data</span>/mysql</span><br><span class="line">innodb_buffer_pool_size   = <span class="number">10240</span>M</span><br><span class="line">innodb_log_file_size      = <span class="number">2</span>G</span><br><span class="line">innodb_data_file_path     = ibdata1:<span class="number">1</span>G:autoextend</span><br><span class="line">innodb_buffer_pool_instances = <span class="number">4</span></span><br><span class="line">innodb_max_undo_log_size  = <span class="number">4</span>G</span><br><span class="line"></span><br><span class="line"><span class="comment"># OTHER</span></span><br><span class="line">back_log                  = <span class="number">1024</span></span><br><span class="line">max_connections           = <span class="number">1000</span></span><br><span class="line">interactive_timeout       = <span class="number">600</span></span><br><span class="line">wait_timeout              = <span class="number">600</span></span><br><span class="line">sort_buffer_size          = <span class="number">16</span>M</span><br><span class="line">join_buffer_size          = <span class="number">16</span>M</span><br><span class="line">lower_case_table_names    = <span class="number">1</span></span><br><span class="line">log_timestamps            = SYSTEM</span><br><span class="line">explicit_defaults_for_timestamp = <span class="number">1</span></span><br><span class="line">log_queries_not_using_indexes   = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">server-id                 = <span class="number">3306100</span></span><br><span class="line">log-bin                   = /<span class="keyword">data</span>/mysql/mysql-bin</span><br><span class="line">sync_binlog               = <span class="number">1</span></span><br><span class="line">max_binlog_size           = <span class="number">1024</span>M</span><br><span class="line">binlog-format             = row</span><br><span class="line">expire_logs_days          = <span class="number">7</span></span><br></pre></td></tr></table></figure>

<ul>
<li>[<strong>mysql</strong>]ï¼šè¯¥éƒ¨åˆ†ç”± <code>MySQL</code> å‘½ä»¤è¡Œå®¢æˆ·ç«¯è¯»å–</li>
<li>[<strong>client</strong>]ï¼šè¯¥éƒ¨åˆ†ç”±æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯è¯»å–ï¼ˆåŒ…æ‹¬ <code>mysql cli</code>ï¼‰</li>
<li>[<strong>mysqld</strong>]ï¼šè¯¥éƒ¨åˆ†ç”± <code>MySQL</code> æœåŠ¡å™¨è¯»å–</li>
<li>[<strong>mysqldump</strong>]ï¼šè¯¥éƒ¨åˆ†ç”± <code>mysqldump</code> å‘½ä»¤è¯»å–</li>
<li>[<strong>mysqld_safe</strong>]ï¼šè¯¥éƒ¨åˆ†ç”± <code>mysqld_safe</code> å‘½ä»¤è¯»å–</li>
</ul>
<h2 id="å‚æ•°ç±»å‹"><a href="#å‚æ•°ç±»å‹" class="headerlink" title="å‚æ•°ç±»å‹"></a>å‚æ•°ç±»å‹</h2><ul>
<li><strong>é™æ€å‚æ•°</strong>ï¼šé‡å¯ <code>MySQL</code> æœåŠ¡åæ‰èƒ½ä½¿ä¹‹ç”Ÿæ•ˆã€‚</li>
<li><strong>åŠ¨æ€å‚æ•°</strong>ï¼šå¯ä»¥åœ¨ä¸é‡æ–°å¯åŠ¨ <code>MySQL</code> æœåŠ¡çš„æƒ…å†µä¸‹ç«‹å³ç”Ÿæ•ˆã€‚</li>
</ul>
<h2 id="å‚æ•°è¯¦è§£"><a href="#å‚æ•°è¯¦è§£" class="headerlink" title="å‚æ•°è¯¦è§£"></a>å‚æ•°è¯¦è§£</h2><ul>
<li>MySQL Â· é…ç½®å‚æ•° Â· innodb_buffer_pool_size</li>
<li>MySQL Â· é…ç½®å‚æ•° Â· max_connections</li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· å‚æ•°é€‰æ‹© Â· varchar vs char</title>
    <url>/blog/2019/09/24/mysql-stringtype/</url>
    <content><![CDATA[<p><strong>CHAR</strong> ï¼šæ˜¯ä¸€ç§<strong>å®šé•¿å­—ç¬¦ä¸²</strong>ç±»å‹ï¼Œå¹¶ä¸”å¿…é¡»åœ¨åœ†æ‹¬å·å†…ç”¨ä¸€ä¸ªå¤§å°ä¿®é¥°ç¬¦æ¥å®šä¹‰ï¼Œè¿™ä¸ªå¤§å°ä¿®é¥°ç¬¦çš„èŒƒå›´ä» 0ï½255ã€‚æ¯”æŒ‡å®šé•¿åº¦å¤§çš„å€¼å°†è¢«æˆªçŸ­ï¼Œè€Œæ¯”æŒ‡å®šé•¿åº¦å°çš„å€¼å°†ä¼šç”¨ç©ºæ ¼ä½œå¡«è¡¥ã€‚</p>
<p><strong>VARCHAR</strong> ï¼šæ˜¯ä¸€ç§<strong>å¯å˜é•¿åº¦</strong>çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œå¹¶ä¸”ä¹Ÿå¿…é¡»å¸¦æœ‰ä¸€ä¸ªèŒƒå›´æŒ‡ç¤ºå™¨ã€‚</p>
<table>
<thead>
<tr>
<th align="left">Value</th>
<th align="left">CHAR(4)</th>
<th align="left">Storage Required</th>
<th align="left">VARCHAR(4)</th>
<th align="left">Storage Required</th>
</tr>
</thead>
<tbody><tr>
<td align="left">â€˜â€™</td>
<td align="left">â€˜â€™</td>
<td align="left">4 bytes</td>
<td align="left">â€˜â€™</td>
<td align="left">1 byte</td>
</tr>
<tr>
<td align="left">â€˜abâ€™</td>
<td align="left">â€˜abâ€™</td>
<td align="left">4 bytes</td>
<td align="left">â€˜abâ€™</td>
<td align="left">3 bytes</td>
</tr>
<tr>
<td align="left">â€˜abcdâ€™</td>
<td align="left">â€˜abcdâ€™</td>
<td align="left">4 bytes</td>
<td align="left">â€˜abcdâ€™</td>
<td align="left">5 bytes</td>
</tr>
<tr>
<td align="left">â€˜abcdefghâ€™</td>
<td align="left">â€˜abcdâ€™</td>
<td align="left">4 bytes</td>
<td align="left">â€˜abcdâ€™</td>
<td align="left">5 bytes</td>
</tr>
</tbody></table>
<p><strong>æ€§èƒ½å¯¹æ¯”</strong></p>
<p>char &gt; varchar</p>
<p><strong>é€‰æ‹©</strong></p>
<p>é€‰æ‹©æœ€å°çš„æ•°æ®èŒƒå›´ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥å¤§å¤§å‡å°‘ç£ç›˜ç©ºé—´åŠç£ç›˜ I/O è¯»å†™å¼€é”€ï¼Œ<strong>å‡å°‘å†…å­˜å ç”¨ï¼Œå‡å°‘CPUå ç”¨ç‡</strong></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· å‚æ•°é€‰æ‹© Â· datetime vs timestamp</title>
    <url>/blog/2019/09/24/mysql-timetype/</url>
    <content><![CDATA[<p>MySQL ä¸­å¸¸ç”¨çš„ä¸¤ç§æ—¶é—´å‚¨å­˜ç±»å‹åˆ†åˆ«æ˜¯ <code>datetime</code> å’Œ <code>timestamp</code>ï¼Œå»ºè¡¨æ—¶è¯¥å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿ</p>
<p><strong>å ç”¨ç©ºé—´</strong></p>
<table>
<thead>
<tr>
<th align="left">ç±»å‹</th>
<th align="left">å æ®å­—èŠ‚</th>
<th align="left">è¡¨ç¤ºå½¢å¼</th>
</tr>
</thead>
<tbody><tr>
<td align="left">datetime</td>
<td align="left">8 å­—èŠ‚</td>
<td align="left">yyyy-mm-dd hh:mm:ss</td>
</tr>
<tr>
<td align="left">timestamp</td>
<td align="left">4 å­—èŠ‚</td>
<td align="left">yyyy-mm-dd hh:mm:ss</td>
</tr>
</tbody></table>
<p><strong>è¡¨ç¤ºèŒƒå›´</strong></p>
<table>
<thead>
<tr>
<th align="left">ç±»å‹</th>
<th align="left">è¡¨ç¤ºèŒƒå›´</th>
</tr>
</thead>
<tbody><tr>
<td align="left">datetime</td>
<td align="left">â€˜1000-01-01 00:00:00.000000â€™ to â€˜9999-12-31 23:59:59.999999â€™</td>
</tr>
<tr>
<td align="left">timestamp</td>
<td align="left">â€˜1970-01-01 00:00:01.000000â€™ to â€˜2038-01-19 03:14:07.999999â€™</td>
</tr>
</tbody></table>
<p><strong>æ—¶åŒº</strong></p>
<ul>
<li><p><code>timestamp</code> å  4 ä¸ªå­—èŠ‚ï¼Œè€Œä¸”æ˜¯ä»¥ <code>utc</code> æ ¼å¼å‚¨å­˜ï¼Œå®ƒä¼šè‡ªåŠ¨æ£€ç´¢å½“å‰æ—¶åŒºå¹¶è¿›è¡Œè½¬æ¢ï¼Œå­˜å’Œå–å¯èƒ½ä¸ä¸€æ ·ã€‚</p>
</li>
<li><p><code>datetime</code> å  8 ä¸ªå­—èŠ‚å‚¨å­˜ï¼Œä¸ä¼šè¿›è¡Œæ—¶åŒºçš„æ£€ç´¢ï¼Œå­˜å’Œå–ä¸€æ ·ã€‚</p>
</li>
<li><p>åŒºåˆ«ï¼šå¦‚æœå­˜è¿›å»çš„æ˜¯ <code>NULL</code>ï¼Œ<code>timestamp</code> ä¼šè‡ªåŠ¨å‚¨å­˜å½“å‰æ—¶é—´ï¼Œè€Œ <code>datetime</code> ä¼šå‚¨å­˜ <code>NULL</code>ã€‚</p>
</li>
</ul>
<p><strong>æµ‹è¯•</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæµ‹è¯•è¡¨</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> timedemo(st <span class="built_in">timestamp</span>,dt datetime);</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> timedemo <span class="keyword">values</span> (<span class="literal">null</span>,<span class="literal">null</span>), (<span class="keyword">now</span>(),<span class="keyword">now</span>()), (<span class="string">'20161001193450'</span>,<span class="string">'20161001193450'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># timestamp ä¼šè‡ªåŠ¨å‚¨å­˜å½“å‰æ—¶é—´ï¼Œè€Œ datetime ä¼šå‚¨å­˜ NULL</span></span><br><span class="line">mysql&gt; select * from timedemo;</span><br><span class="line">+<span class="comment">---------------------+---------------------+</span></span><br><span class="line">| st                  | dt                  |</span><br><span class="line">+<span class="comment">---------------------+---------------------+</span></span><br><span class="line">| 2019-09-24 14:00:15 | NULL                |</span><br><span class="line">| 2019-09-24 14:00:15 | 2019-09-24 14:00:15 |</span><br><span class="line">| 2016-10-01 19:34:50 | 2016-10-01 19:34:50 |</span><br><span class="line">+<span class="comment">---------------------+---------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ—¶åŒºä¿®æ”¹ä¸ºä¸œ9åŒºï¼Œä¼šå‘ç° timestamp æ¯” datetime å¤šä¸€å°æ—¶</span></span><br><span class="line">mysql&gt; set time_zone='+9:00';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like "time_zone";</span><br><span class="line">+<span class="comment">---------------+--------+</span></span><br><span class="line">| Variable_name | Value  |</span><br><span class="line">+<span class="comment">---------------+--------+</span></span><br><span class="line">| time_zone     | +09:00 |</span><br><span class="line">+<span class="comment">---------------+--------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> timedemo;</span><br><span class="line">+<span class="comment">---------------------+---------------------+</span></span><br><span class="line">| st                  | dt                  |</span><br><span class="line">+<span class="comment">---------------------+---------------------+</span></span><br><span class="line">| 2019-09-24 15:00:15 | NULL                |</span><br><span class="line">| 2019-09-24 15:00:15 | 2019-09-24 14:00:15 |</span><br><span class="line">| 2016-10-01 20:34:50 | 2016-10-01 19:34:50 |</span><br><span class="line">+<span class="comment">---------------------+---------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p><strong>é€‰æ‹©</strong></p>
<ul>
<li>å¦‚æœåœ¨æ—¶é—´ä¸Šè¦è¶…è¿‡ <code>Linux</code> æ—¶é—´çš„ï¼Œæˆ–è€…æœåŠ¡å™¨æ—¶åŒºä¸ä¸€æ ·çš„å°±å»ºè®®é€‰æ‹© <code>datetime</code>ã€‚</li>
<li>å¦‚æœæ˜¯æƒ³è¦ä½¿ç”¨è‡ªåŠ¨æ’å…¥æ—¶é—´æˆ–è€…è‡ªåŠ¨æ›´æ–°æ—¶é—´åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨ <code>timestamp</code>ã€‚</li>
<li>å­˜å‚¨å¹´ä½¿ç”¨ <code>year</code>ï¼Œå­˜å‚¨æ—¥æœŸä½¿ç”¨ <code>date</code>ï¼Œå­˜å‚¨æ—¶é—´ä½¿ç”¨ <code>datetime</code>ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· è¿ç»´å®è·µ Â· åœ¨çº¿æ­å»ºä»åº“</title>
    <url>/blog/2019/09/20/mysql-practice-slave/</url>
    <content><![CDATA[<h2 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h2><p>å¸¸è§æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š</p>
<ul>
<li>ä¸»ä»å¤åˆ¶ä¸­æ–­ï¼Œä¸» <code>binlog</code> ç¼ºå¤±ï¼Œéœ€è¦é‡æ–°æ­å»ºä»åº“</li>
<li>å•ä¸»æ¨¡å¼ï¼Œå‡çº§ä¸ºä¸»ä»æ¨¡å¼</li>
</ul>
<h2 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h2><p>ä½¿ç”¨ Percona XtraBackup å·¥å…·ä¸åœæœºä¸é”è¡¨åœ¨çº¿æ­å»ºä»åº“ã€‚</p>
<h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><ul>
<li>ä¸»ä»æœåŠ¡å™¨ï¼Œ<a href="https://huiraoo.github.io/blog/2019/06/18/mysql-xtrabackup/"><strong>å®‰è£… XtraBackup</strong></a></li>
</ul>
<ul>
<li><p><a href="https://huiraoo.github.io/blog/2019/07/08/linux-ssh/"><strong>é…ç½®ä¸»ä»äº’ä¿¡</strong></a></p>
</li>
<li><p>å¤‡ä»½ä¸»åº“</p>
</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ innobackupex --defaults-file=/etc/my.cnf --user=<span class="string">'xx'</span> --password=<span class="string">'xx'</span> --no-timestamp /<span class="keyword">data</span>/backup</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tipsï¼šå¤‡ä»½ç›®å½•è¦ä¾æ®æœåŠ¡å™¨ç£ç›˜åˆ†é…ï¼Œå¦åˆ™ä¼šå æ»¡ç£ç›˜ï¼Œå½±å“ä¸šåŠ¡ã€‚</p>
</blockquote>
<ul>
<li>ä¼ è¾“åˆ°ä»åº“</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ scp -r /<span class="keyword">data</span>/backup/* root@x.x.x.x:/<span class="keyword">data</span>/backup</span><br></pre></td></tr></table></figure>

<ul>
<li>æ¢å¤æ•°æ®</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ mysqladmin -uroot -p<span class="string">'xx'</span> shutdown</span><br><span class="line">$ innobackupex --apply-log /<span class="keyword">data</span>/backup</span><br><span class="line">$ mv mysql mysql_bak</span><br><span class="line">$ mkdir mysql</span><br><span class="line">$ innobackupex --copy-back /<span class="keyword">data</span>/backup</span><br><span class="line">$ chown -R mysql:mysql mysql</span><br><span class="line">$ /usr/local/mysql/bin/mysqld_safe --defaults-file=/etc/my.cnf --user=mysql &gt;/dev/null &amp;</span><br></pre></td></tr></table></figure>

<ul>
<li>å»ºç«‹å¤åˆ¶å…³ç³»</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ cat xtrabackup_binlog_info</span><br><span class="line">mysql-binlog.<span class="number">000297</span>	<span class="number">900834433</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®åŒæ­¥</span></span><br><span class="line">CHANGE MASTER TO </span><br><span class="line">MASTER_HOST=<span class="string">'x.x.x.x'</span>,</span><br><span class="line">MASTER_USER=<span class="string">'repl'</span>,</span><br><span class="line">MASTER_PASSWORD=<span class="string">'xx'</span>,</span><br><span class="line">MASTER_PORT=<span class="number">3306</span>,</span><br><span class="line">MASTER_LOG_FILE=<span class="string">'mysql-bin.000297'</span>, </span><br><span class="line">MASTER_LOG_POS=<span class="number">900834433</span>,</span><br><span class="line">MASTER_CONNECT_RETRY=<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯åŒæ­¥</span></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»åº“æ£€æŸ¥å‚æ•°</span></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+------------------+----------+--------------+------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">+------------------+----------+--------------+------------------+</span><br><span class="line">| mysql-bin.<span class="number">001958</span> | <span class="number">32629730</span> |              |                  |</span><br><span class="line">+------------------+----------+--------------+------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»åº“æ£€æŸ¥å‚æ•°</span></span><br><span class="line">show slave status\G</span><br><span class="line">Slave_IO_Running: Yes</span><br><span class="line">Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· æ¡ˆä¾‹åˆ†æ Â· ä¸»ä»å¤åˆ¶ä¸­æ–­</title>
    <url>/blog/2019/09/20/mysql-case-replication/</url>
    <content><![CDATA[<h2 id="å¤‡åº“æ‰¾ä¸åˆ°ä¸»åº“-binlog-æ–‡ä»¶"><a href="#å¤‡åº“æ‰¾ä¸åˆ°ä¸»åº“-binlog-æ–‡ä»¶" class="headerlink" title="å¤‡åº“æ‰¾ä¸åˆ°ä¸»åº“ binlog æ–‡ä»¶"></a>å¤‡åº“æ‰¾ä¸åˆ°ä¸»åº“ binlog æ–‡ä»¶</h2><h3 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h3><p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-09-20-015800.png" alt="image-20190920095751451"></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mysql&gt; show slave status\G</span><br><span class="line">************************* <span class="number">1</span>. row ***************************</span><br><span class="line">               Slave_IO_State: </span><br><span class="line">                  Master_Host: <span class="number">10.135</span>.<span class="number">22.70</span></span><br><span class="line">                  Master_User: repluser</span><br><span class="line">                  Master_Port: <span class="number">3308</span></span><br><span class="line">                Connect_Retry: <span class="number">10</span></span><br><span class="line">              Master_Log_File: mysql-bin.<span class="number">001935</span></span><br><span class="line">          Read_Master_Log_Pos: <span class="number">6587</span></span><br><span class="line">               Relay_Log_File: relay-log.<span class="number">001487</span></span><br><span class="line">                Relay_Log_Pos: <span class="number">4</span></span><br><span class="line">        Relay_Master_Log_File: mysql-bin.<span class="number">001935</span></span><br><span class="line">             Slave_IO_Running: No</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">                           .....</span><br><span class="line">        Seconds_Behind_Master: NULL</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: <span class="number">1236</span></span><br><span class="line">                Last_IO_Error: Got fatal error <span class="number">1236</span> from master when reading <span class="keyword">data</span> from binary log: <span class="string">'Could not find first log file name in binary log index file'</span></span><br><span class="line">               Last_SQL_Errno: <span class="number">0</span></span><br><span class="line">               Last_SQL_Error:</span><br></pre></td></tr></table></figure>

<h3 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h3><p>è¯¥é”™è¯¯å‘ç”Ÿåœ¨ä»åº“ <code>io</code> è¿›ç¨‹ä»ä¸»åº“æ‹‰å–æ—¥å¿—æ—¶ï¼Œå‘ç°ä¸»åº“çš„ <code>mysql_bin.index</code> æ–‡ä»¶ä¸­ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå‡ºç°æ­¤ç±»æŠ¥é”™å¯èƒ½æœ‰ä¸¤ä¸ªåŸå› ï¼š</p>
<ul>
<li><code>Slave</code> ç”±äºæŸç§åŸå› åœäº†å¥½é•¿ä¸€æ®µæ˜¯æ—¶é—´ï¼Œå½“ä½ é‡å¯ <code>Slave</code> å¤åˆ¶çš„æ—¶å€™ï¼Œåœ¨ä¸»åº“ä¸Šæ‰¾ä¸åˆ°ç›¸åº”çš„ <code>binlog</code> ã€‚</li>
<li>ç”±äºæŸäº›è®¾ç½®ä¸»åº“ä¸Šçš„ <code>binlog</code> è¢«åˆ é™¤äº†ï¼Œå¯¼è‡´ä»åº“è·å–ä¸åˆ°å¯¹åº”çš„ <code>binlog</code>ã€‚</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[root@hop02 mzjh]<span class="comment"># ll | grep mysql-bin</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1073742013</span> Sep <span class="number">12</span> <span class="number">14</span>:<span class="number">55</span> mysql-bin.<span class="number">001948</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1073742073</span> Sep <span class="number">13</span> <span class="number">11</span>:<span class="number">53</span> mysql-bin.<span class="number">001949</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1073742120</span> Sep <span class="number">14</span> <span class="number">08</span>:<span class="number">39</span> mysql-bin.<span class="number">001950</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1073859355</span> Sep <span class="number">15</span> <span class="number">06</span>:<span class="number">21</span> mysql-bin.<span class="number">001951</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1074054892</span> Sep <span class="number">16</span> <span class="number">06</span>:<span class="number">18</span> mysql-bin.<span class="number">001952</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1075243641</span> Sep <span class="number">17</span> <span class="number">06</span>:<span class="number">18</span> mysql-bin.<span class="number">001953</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1074801420</span> Sep <span class="number">18</span> <span class="number">06</span>:<span class="number">16</span> mysql-bin.<span class="number">001954</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1075257243</span> Sep <span class="number">19</span> <span class="number">06</span>:<span class="number">16</span> mysql-bin.<span class="number">001955</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql   <span class="number">619405162</span> Sep <span class="number">19</span> <span class="number">13</span>:<span class="number">32</span> mysql-bin.<span class="number">001956</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1072898197</span> Sep <span class="number">20</span> <span class="number">09</span>:<span class="number">44</span> mysql-bin.<span class="number">001957</span></span><br><span class="line">-rw-r-----. <span class="number">1</span> mysql mysql         <span class="number">190</span> Sep <span class="number">19</span> <span class="number">13</span>:<span class="number">32</span> mysql-bin.index</span><br></pre></td></tr></table></figure>

<h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><p>ä¸ºäº†é¿å…æ•°æ®ä¸¢å¤±ï¼Œéœ€è¦é‡æ–°æ­å»º <code>Slave</code></p>
<blockquote>
<p><strong>Tips</strong>ï¼šä¸è¦ä½¿ç”¨ <code>rm -rf</code> å‘½ä»¤åˆ é™¤ <code>binlog</code> æ—¥å¿—æ–‡ä»¶</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mysql&gt; PURGE MASTER LOGS TO <span class="string">'mysql-bin.001950â€²</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¸»åº“ç©ºé—´é—®é¢˜ï¼Œæ—¥å¿—è¢«æˆªæ–­"><a href="#ä¸»åº“ç©ºé—´é—®é¢˜ï¼Œæ—¥å¿—è¢«æˆªæ–­" class="headerlink" title="ä¸»åº“ç©ºé—´é—®é¢˜ï¼Œæ—¥å¿—è¢«æˆªæ–­"></a>ä¸»åº“ç©ºé—´é—®é¢˜ï¼Œæ—¥å¿—è¢«æˆªæ–­</h2><h3 id="ç°è±¡-1"><a href="#ç°è±¡-1" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mysql&gt; show slave status\G</span><br><span class="line">*************************** <span class="number">1</span>. row ***************************</span><br><span class="line">               Slave_IO_State: </span><br><span class="line">                  Master_Host: <span class="number">10.138</span>.<span class="number">22.10</span></span><br><span class="line">                  Master_User: repluser</span><br><span class="line">                  Master_Port: <span class="number">3306</span></span><br><span class="line">                Connect_Retry: <span class="number">60</span></span><br><span class="line">              Master_Log_File: mysql-bin.<span class="number">006130</span></span><br><span class="line">          Read_Master_Log_Pos: <span class="number">733347710</span></span><br><span class="line">               Relay_Log_File: dzspdb2-relay-bin.<span class="number">014727</span></span><br><span class="line">                Relay_Log_Pos: <span class="number">253</span></span><br><span class="line">        Relay_Master_Log_File: mysql-bin.<span class="number">006130</span></span><br><span class="line">             Slave_IO_Running: No</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">                           .....</span><br><span class="line">        Seconds_Behind_Master: NULL</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: <span class="number">1236</span></span><br><span class="line">                Last_IO_Error: Got fatal error <span class="number">1236</span> from master when reading <span class="keyword">data</span> from binary log: <span class="string">'binlog truncated in the middle of event; consider out of disk space on master; the first event '</span>mysql-bin.<span class="number">006130</span><span class="string">' at 733347710, the last event read from '</span>./mysql-bin.<span class="number">006130</span><span class="string">' at 733347710, the last byte read from '</span>./mysql-bin.<span class="number">006130</span><span class="string">' at 733347840.'</span></span><br><span class="line">               Last_SQL_Errno: <span class="number">0</span></span><br><span class="line">               Last_SQL_Error:</span><br></pre></td></tr></table></figure>

<h3 id="åŸå› -1"><a href="#åŸå› -1" class="headerlink" title="åŸå› "></a>åŸå› </h3><p>è¯¥é”™è¯¯å’Œä¸»åº“çš„ç©ºé—´å’Œ <code>sync_binlog</code> é…ç½®æœ‰å…³ï¼Œå½“ä¸»åº“ <code>sync_binlog = N</code> ä¸ç­‰äº 1 ä¸”ç£ç›˜ç©ºé—´æ»¡æ—¶ï¼ŒMySQL æ¯å†™ N æ¬¡ <code>binlog</code>ï¼Œç³»ç»Ÿæ‰ä¼šåŒæ­¥åˆ°ç£ç›˜ï¼Œä½†æ˜¯ç”±äºå­˜å‚¨æ—¥å¿—çš„ç£ç›˜ç©ºé—´æ»¡è€Œå¯¼è‡´ MySQL æ²¡æœ‰å°†æ—¥å¿—å®Œå…¨å†™å…¥ç£ç›˜ï¼Œ<code>binlog event</code> è¢«æˆªæ–­ï¼Œä»åº“è¯»å–è¯¥ <code>binlog</code> æ—¶å°±ä¼šæŠ¥é”™ <code>binlog truncated in the middle of event</code>ã€‚</p>
<h3 id="è§£å†³-1"><a href="#è§£å†³-1" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><p> åœ¨ä»åº“é‡æ–°æŒ‡å‘åˆ°ä¸»åº“ä¸‹ä¸€ä¸ªå¯ç”¨çš„ <code>binlog</code> å¹¶ä¸”ä»åˆå§‹åŒ–çš„ä½ç½®å¼€å§‹ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">stop slave;</span><br><span class="line">change master to master_log_file = <span class="string">'mysql-bin.006131'</span>, master_log_pos = <span class="number">4</span>;</span><br><span class="line">start slave;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸»ä»æ•°æ®ä¸ä¸€è‡´"><a href="#ä¸»ä»æ•°æ®ä¸ä¸€è‡´" class="headerlink" title="ä¸»ä»æ•°æ®ä¸ä¸€è‡´"></a>ä¸»ä»æ•°æ®ä¸ä¸€è‡´</h2><h3 id="ç°è±¡-2"><a href="#ç°è±¡-2" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mysql&gt; show slave status\G</span><br><span class="line">*************************** <span class="number">1</span>. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: <span class="number">10.138</span>.<span class="number">232.83</span></span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: <span class="number">3306</span></span><br><span class="line">                Connect_Retry: <span class="number">10</span></span><br><span class="line">              Master_Log_File: mysql-bin.<span class="number">001283</span></span><br><span class="line">          Read_Master_Log_Pos: <span class="number">397428472</span></span><br><span class="line">               Relay_Log_File: relay-log.<span class="number">000010</span></span><br><span class="line">                Relay_Log_Pos: <span class="number">661219485</span></span><br><span class="line">        Relay_Master_Log_File: mysql-bin.<span class="number">000528</span></span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: No</span><br><span class="line">                           .....</span><br><span class="line">                   Last_Error: Could not execute Update_rows event on table cosmo-aps.bns_aps_versiontolineinfo; Error writing file <span class="string">'/data/mysql/tmp/MLpTCcJu'</span> (Errcode: <span class="number">28</span> - No space left on device), Error_code: <span class="number">3</span>; Error writing file <span class="string">'mysql-bin'</span> (errno: <span class="number">28</span> - No space left on device), Error_code: <span class="number">1026</span>; handler error HA_ERR_RBR_LOGGING_FAILED; the event<span class="string">'s master log mysql-bin.000528, end_log_pos 674303230</span></span><br><span class="line"><span class="string">                           .....</span></span><br><span class="line"><span class="string">        Seconds_Behind_Master: NULL</span></span><br></pre></td></tr></table></figure>

<h3 id="åŸå› -2"><a href="#åŸå› -2" class="headerlink" title="åŸå› "></a>åŸå› </h3><ul>
<li><code>Master</code> å’Œ <code>Slave</code> æ•°æ®ä¸ä¸€è‡´å¯¼è‡´</li>
<li><code>Slave</code> æœåŠ¡å™¨é‡å¯ï¼Œäº‹åŠ¡å›æ»šé€ æˆ</li>
</ul>
<h3 id="è§£å†³-2"><a href="#è§£å†³-2" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><ul>
<li>æ‰‹åŠ¨è·³è¿‡</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mysql&gt; stop slave ;</span><br><span class="line">mysql&gt; set global sql_slave_skip_counter=<span class="number">1</span>;</span><br><span class="line">mysql&gt; start slave ;</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://huiraoo.github.io/blog/2019/10/19/pt-slave-restart/">pt-slave-restart</a></li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· å®¹ç¾</title>
    <url>/blog/2019/09/04/mysql-disaster/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æ•°æ®æ˜¯ä¼ä¸šçš„ç”Ÿå‘½çº¿ï¼Œ<code>PSI</code> çº¿ä¸Šç³»ç»Ÿæ•°æ®åŸºæœ¬éƒ½å­˜å‚¨åœ¨é’å²›æœ¬åœ°æœºæˆ¿ï¼Œç¼ºå°‘å¼‚åœ°å®¹ç¾èƒ½åŠ›ï¼Œå½“å‡ºç°æœºæˆ¿çº§ç¾éš¾åœºæ™¯ä¸‹ï¼ˆå¦‚ï¼šåœ°éœ‡ã€æµ·å•¸ã€ç«ç¾ç­‰ï¼‰ï¼Œä¸šåŠ¡è¿ç»­æ€§å—åˆ°æå¤§çš„å½±å“ï¼ŒæŸå¤±ä¸å¯ä¼°é‡ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç›®å‰ <code>PSI</code> å·²å…·å¤‡å‰ä¸¤ç±»æ•…éšœåœºæ™¯çš„è¦†ç›–èƒ½åŠ›ï¼Œéœ€è¦æ„å»ºè¦†ç›–ç¬¬ä¸‰ç±»æ•…éšœåœºæ™¯èƒ½åŠ›ï¼Œå…¨æ–¹ä½ä¿éšœä¸šåŠ¡æ•°æ®å®‰å…¨ï¼Œæœ‰å¤‡æ— æ‚£ã€‚</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-09-25-135300.png" alt></p>
<h2 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h2><ul>
<li>ä¿è¯æç«¯åœºæ™¯ä¸‹ä¸šåŠ¡æ•°æ®å¯æ¢å¤</li>
<li><code>RPO</code> &lt; 2 å°æ—¶ï¼Œ<code>RTO</code> &lt; 24 å°æ—¶</li>
</ul>
<h2 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h2><p><strong>è®¾è®¡æ–¹æ¡ˆ</strong>ï¼šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé‡è¦ç³»ç»Ÿç”Ÿäº§æ•°æ®ï¼ˆé’å²›æœ¬åœ°æœºæˆ¿ï¼šç”µä¿¡æœºæˆ¿ã€è”é€šæœºæˆ¿ã€ç§»åŠ¨æœºæˆ¿â€¦ï¼‰åŒæ­¥è‡³çº¢å²›ç¾å¤‡æ•°æ®ä¸­å¿ƒï¼Œç‰¹åˆ«é‡è¦ç³»ç»Ÿæ•°æ®å‹ç¼©å­˜å‚¨ä¸Šä¼ è‡³é˜¿é‡Œäº‘ <code>OSS</code>ã€‚</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-09-25-135600.png" alt></p>
<p><strong>å®æ–½æ–¹æ¡ˆ</strong>ï¼šä»åº“å®ä¾‹å†æ­å»ºä¸€ä¸ªä»å®ä¾‹å½¢æˆçº§è”ç»“æ„ï¼Œå¯¹æ•°æ®è¿›è¡Œå®æ—¶åŒæ­¥ï¼Œä¸»è¦ä¸ºé¿å…å¢åŠ ä¸»åº“è´Ÿè½½ã€‚</p>
<p><strong>å®ä¾‹æ‹“æ‰‘ï¼š</strong></p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-09-25-140100.png" alt></p>
<p><strong>ç³»ç»Ÿç›‘æ§ï¼š</strong></p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-09-25-140200.png" alt></p>
<ul>
<li><p>ä¸»å®ä¾‹ï¼š<code>TDDS_M</code></p>
</li>
<li><p>ä»å®ä¾‹ï¼š<code>TDDS_S</code></p>
</li>
<li><p>ç¾å¤‡å®ä¾‹ï¼š<code>TDDS_D</code></p>
</li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>å®¹å™¨</title>
    <url>/blog/2019/08/28/docker/</url>
    <content><![CDATA[<h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ systemctl start docker  // å¯åŠ¨docker</span><br><span class="line">$ systemctl stop docker   // å…³é—­docker</span><br><span class="line">$ docker restart xxx      // é‡å¯ä¸€ä¸ªå®¹å™¨</span><br><span class="line">$ docker stop xxx         // åœæ­¢ä¸€ä¸ªå®¹å™¨</span><br><span class="line">$ docker rm xxx           // åˆ é™¤ä¸€ä¸ªå®¹å™¨</span><br><span class="line">$ docker rm -f xxx        // å¼ºåˆ¶åˆ é™¤ä¸€ä¸ªå®¹å™¨</span><br><span class="line">$ docker log xxx          // æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span><br><span class="line">$ docker ps -a            // æŸ¥çœ‹å®¹å™¨ä¿¡æ¯</span><br><span class="line">$ docker search xxx       // æŸ¥çœ‹é•œåƒ</span><br></pre></td></tr></table></figure>

<h2 id="å­¦ä¹ èµ„æº"><a href="#å­¦ä¹ èµ„æº" class="headerlink" title="å­¦ä¹ èµ„æº"></a>å­¦ä¹ èµ„æº</h2><p><a href="http://asdfghjkl.xyz/2019/04/25/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90Kubernetes/" target="_blank" rel="noopener">æ·±å…¥å‰–æ Kubernetes</a></p>
]]></content>
      <categories>
        <category>å®¹å™¨</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· ç”¨æˆ·æƒé™</title>
    <url>/blog/2019/08/27/mysql-privilege/</url>
    <content><![CDATA[<table>
<thead>
<tr>
<th>Privilege</th>
<th>Grant Table Column</th>
<th>Context</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_all" target="_blank" rel="noopener"><code>ALL PRIVILEGES</code></a></td>
<td>Synonym for â€œall privilegesâ€</td>
<td>Server administration</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_alter" target="_blank" rel="noopener"><code>ALTER</code></a></td>
<td><code>Alter_priv</code></td>
<td>Tables</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_alter-routine" target="_blank" rel="noopener"><code>ALTER ROUTINE</code></a></td>
<td><code>Alter_routine_priv</code></td>
<td>Stored routines</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_create" target="_blank" rel="noopener"><code>CREATE</code></a></td>
<td><code>Create_priv</code></td>
<td>Databases, tables, or indexes</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_create-routine" target="_blank" rel="noopener"><code>CREATE ROUTINE</code></a></td>
<td><code>Create_routine_priv</code></td>
<td>Stored routines</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_create-tablespace" target="_blank" rel="noopener"><code>CREATE TABLESPACE</code></a></td>
<td><code>Create_tablespace_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_create-temporary-tables" target="_blank" rel="noopener"><code>CREATE TEMPORARY TABLES</code></a></td>
<td><code>Create_tmp_table_priv</code></td>
<td>Tables</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_create-user" target="_blank" rel="noopener"><code>CREATE USER</code></a></td>
<td><code>Create_user_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_create-view" target="_blank" rel="noopener"><code>CREATE VIEW</code></a></td>
<td><code>Create_view_priv</code></td>
<td>Views</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_delete" target="_blank" rel="noopener"><code>DELETE</code></a></td>
<td><code>Delete_priv</code></td>
<td>Tables</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_drop" target="_blank" rel="noopener"><code>DROP</code></a></td>
<td><code>Drop_priv</code></td>
<td>Databases, tables, or views</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_event" target="_blank" rel="noopener"><code>EVENT</code></a></td>
<td><code>Event_priv</code></td>
<td>Databases</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_execute" target="_blank" rel="noopener"><code>EXECUTE</code></a></td>
<td><code>Execute_priv</code></td>
<td>Stored routines</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_file" target="_blank" rel="noopener"><code>FILE</code></a></td>
<td><code>File_priv</code></td>
<td>File access on server host</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_grant-option" target="_blank" rel="noopener"><code>GRANT OPTION</code></a></td>
<td><code>Grant_priv</code></td>
<td>Databases, tables, or stored routines</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_index" target="_blank" rel="noopener"><code>INDEX</code></a></td>
<td><code>Index_priv</code></td>
<td>Tables</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_insert" target="_blank" rel="noopener"><code>INSERT</code></a></td>
<td><code>Insert_priv</code></td>
<td>Tables or columns</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_lock-tables" target="_blank" rel="noopener"><code>LOCK TABLES</code></a></td>
<td><code>Lock_tables_priv</code></td>
<td>Databases</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_process" target="_blank" rel="noopener"><code>PROCESS</code></a></td>
<td><code>Process_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_proxy" target="_blank" rel="noopener"><code>PROXY</code></a></td>
<td>See <code>proxies_priv</code> table</td>
<td>Server administration</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_references" target="_blank" rel="noopener"><code>REFERENCES</code></a></td>
<td><code>References_priv</code></td>
<td>Databases or tables</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_reload" target="_blank" rel="noopener"><code>RELOAD</code></a></td>
<td><code>Reload_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_replication-client" target="_blank" rel="noopener"><code>REPLICATION CLIENT</code></a></td>
<td><code>Repl_client_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_replication-slave" target="_blank" rel="noopener"><code>REPLICATION SLAVE</code></a></td>
<td><code>Repl_slave_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_select" target="_blank" rel="noopener"><code>SELECT</code></a></td>
<td><code>Select_priv</code></td>
<td>Tables or columns</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_show-databases" target="_blank" rel="noopener"><code>SHOW DATABASES</code></a></td>
<td><code>Show_db_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_show-view" target="_blank" rel="noopener"><code>SHOW VIEW</code></a></td>
<td><code>Show_view_priv</code></td>
<td>Views</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_shutdown" target="_blank" rel="noopener"><code>SHUTDOWN</code></a></td>
<td><code>Shutdown_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_super" target="_blank" rel="noopener"><code>SUPER</code></a></td>
<td><code>Super_priv</code></td>
<td>Server administration</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_trigger" target="_blank" rel="noopener"><code>TRIGGER</code></a></td>
<td><code>Trigger_priv</code></td>
<td>Tables</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_update" target="_blank" rel="noopener"><code>UPDATE</code></a></td>
<td><code>Update_priv</code></td>
<td>Tables or columns</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_usage" target="_blank" rel="noopener"><code>USAGE</code></a></td>
<td>Synonym for â€œno privilegesâ€</td>
<td>Server administration</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· ç´¢å¼•</title>
    <url>/blog/2019/08/21/mysql-index/</url>
    <content><![CDATA[<p>åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ•°æ®åº“å’Œæ•°æ®è¡¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> db_test <span class="keyword">default</span> <span class="keyword">charset</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci; </span><br><span class="line"><span class="keyword">use</span> db_test;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> payment (  </span><br><span class="line">    <span class="keyword">id</span>         <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,  </span><br><span class="line">    staff_id  <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,  </span><br><span class="line">    customer_id <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,  </span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨å­˜å‚¨è¿‡ç¨‹æ’å…¥ 1000w è¡Œéšæœºæ•°æ®ï¼ˆè¡¨å¼•æ“å¯ä»¥å…ˆè®¾ç½®ä¸º MyISAMï¼Œç„¶åæ”¹ä¸º InnoDBï¼‰ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> add_payment;  </span><br><span class="line">DELIMITER //</span><br><span class="line">    <span class="keyword">create</span> <span class="keyword">PROCEDURE</span> add_payment(<span class="keyword">in</span> <span class="keyword">num</span> <span class="built_in">INT</span>)</span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">DECLARE</span> <span class="keyword">rowid</span> <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">SET</span> @exesql = <span class="string">'INSERT INTO payment(staff_id, customer_id) values (?, ?)'</span>;</span><br><span class="line">        WHILE rowid &lt; num DO</span><br><span class="line">            <span class="keyword">SET</span> @staff_id = (<span class="number">1</span> + <span class="keyword">FLOOR</span>(<span class="number">5000</span>*<span class="keyword">RAND</span>()) ); </span><br><span class="line">            <span class="keyword">SET</span> @customer_id = (<span class="number">1</span> + <span class="keyword">FLOOR</span>(<span class="number">500000</span>*<span class="keyword">RAND</span>()));</span><br><span class="line">            <span class="keyword">SET</span> <span class="keyword">rowid</span> = <span class="keyword">rowid</span> + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">prepare</span> stmt <span class="keyword">FROM</span> @exesql;</span><br><span class="line">            <span class="keyword">EXECUTE</span> stmt <span class="keyword">USING</span> @staff_id, @customer_id;            </span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">WHILE</span>;</span><br><span class="line">    <span class="keyword">END</span> //</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä½•é€‰æ‹©ç´¢å¼•ï¼Ÿ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">count</span>(<span class="keyword">DISTINCT</span> <span class="keyword">col</span>), <span class="keyword">count</span>(*) <span class="keyword">from</span> t_batch\G;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· é”æœºåˆ¶</title>
    <url>/blog/2019/08/21/mysql-lock/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><strong>é”</strong>ï¼šæ˜¯è®¡ç®—æœºåè°ƒå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸€èµ„æºçš„æœºåˆ¶ã€‚</p>
<p><strong>MySQLé”æœºåˆ¶</strong>ï¼šç›¸å¯¹å…¶ä»–æ•°æ®åº“è€Œè¨€ï¼ŒMySQL çš„é”æœºåˆ¶æ¯”è¾ƒç®€å•ï¼Œå…¶æœ€æ˜¾è‘—çš„ç‰¹ç‚¹æ˜¯ä¸åŒçš„å­˜å‚¨å¼•æ“æ”¯æŒä¸åŒçš„é”æœºåˆ¶ã€‚MyISAM å’Œ MEMORY å­˜å‚¨å¼•æ“é‡‡ç”¨çš„æ˜¯è¡¨çº§é”ï¼ˆtable-level lockingï¼‰ï¼›InnoDB å­˜å‚¨å¼•æ“æ—¢æ”¯æŒè¡Œçº§é”ï¼ˆrow-level lockingï¼‰ï¼Œä¹Ÿæ”¯æŒè¡¨çº§é”ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹æ˜¯é‡‡ç”¨è¡Œçº§é”ã€‚</p>
<p>â‘   è¡¨çº§é”ï¼šå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›ä¸ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€é«˜,å¹¶å‘åº¦æœ€ä½ã€‚  </p>
<p>â‘¡  è¡Œçº§é”ï¼šå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½,å¹¶å‘åº¦ä¹Ÿæœ€é«˜ã€‚</p>
<p>ä»ä¸Šè¿°ç‰¹ç‚¹å¯è§ï¼Œå¾ˆéš¾ç¬¼ç»Ÿåœ°è¯´å“ªç§é”æ›´å¥½ï¼Œåªèƒ½å°±å…·ä½“åº”ç”¨çš„ç‰¹ç‚¹æ¥è¯´å“ªç§é”æ›´åˆé€‚ï¼ä»…ä»é”çš„è§’åº¦æ¥è¯´ï¼šè¡¨çº§é”æ›´é€‚åˆäºä»¥æŸ¥è¯¢ä¸ºä¸»ï¼Œåªæœ‰å°‘é‡æŒ‰ç´¢å¼•æ¡ä»¶æ›´æ–°æ•°æ®çš„åº”ç”¨ï¼Œå¦‚ Web åº”ç”¨ï¼›è€Œè¡Œçº§é”åˆ™æ›´é€‚åˆäºæœ‰å¤§é‡æŒ‰ç´¢å¼•æ¡ä»¶å¹¶å‘æ›´æ–°å°‘é‡ä¸åŒæ•°æ®ï¼ŒåŒæ—¶åˆæœ‰å¹¶å‘æŸ¥è¯¢çš„åº”ç”¨ï¼Œå¦‚ä¸€äº›åœ¨çº¿äº‹åŠ¡å¤„ç†ï¼ˆOLTPï¼‰ç³»ç»Ÿã€‚ç”±äº BDB å·²ç»è¢« InnoDB å–ä»£ï¼Œå³å°†æˆä¸ºå†å²ï¼ˆæ‰€ä»¥ç°åœ¨åŸºæœ¬éƒ½åœ¨ä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“ï¼‰ã€‚</p>
<p>å¦‚ä½•æŸ¥çœ‹è¡¨é”æƒ…å†µï¼Ÿå¯æŸ¥çœ‹ä¸¤ä¸ªå˜é‡ï¼š</p>
<p><strong>Table_locks_immediate</strong>ï¼šç«‹åˆ»è·å¾—è¡¨é”çš„æ¬¡æ•°</p>
<p><strong>Table_locks_waited</strong>ï¼šéœ€è¦ç­‰å¾…è¡¨é”çš„æ¬¡æ•°ï¼Œå¦‚æœç­‰å¾…è¡¨é”çš„æ¬¡æ•°å æ¯”è¾ƒå¤§ï¼Œè¯´æ˜è¡¨é”å¯èƒ½æ˜¯æ½œåœ¨ç“¶é¢ˆã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show status like 'Table_locks%';</span><br><span class="line">+<span class="comment">-----------------------+---------+</span></span><br><span class="line">| Variable_name         | Value   |</span><br><span class="line">+<span class="comment">-----------------------+---------+</span></span><br><span class="line">| Table_locks_immediate | 1789993 |</span><br><span class="line">| Table_locks_waited    | 0       |</span><br><span class="line">+<span class="comment">-----------------------+---------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>è¡¨çº§é”çš„ä¸¤ç§æ¨¡å¼ï¼š</p>
<ul>
<li><p>è¡¨å…±äº«è¯»é”ï¼ˆTable Read Lockï¼‰</p>
</li>
<li><p>è¡¨ç‹¬å å†™é”ï¼ˆTable Write Lockï¼‰</p>
</li>
</ul>
<h3 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h3><p>å¦‚æœ InnoDB_row_lock_waits å’Œ InnoDB_row_lock_time_avg çš„å€¼æ¯”è¾ƒé«˜ï¼Œè¡¨ç¤ºé”äº‰ç”¨æƒ…å†µæ¯”è¾ƒä¸¥é‡ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show status like 'InnoDB_row_lock%';</span><br><span class="line">+<span class="comment">-------------------------------+-------+</span></span><br><span class="line">| Variable_name                 | Value |</span><br><span class="line">+<span class="comment">-------------------------------+-------+</span></span><br><span class="line">| Innodb_row_lock_current_waits | 0     |</span><br><span class="line">| Innodb_row_lock_time          | 0     |</span><br><span class="line">| Innodb_row_lock_time_avg      | 0     |</span><br><span class="line">| Innodb_row_lock_time_max      | 0     |</span><br><span class="line">| Innodb_row_lock_waits         | 0     |</span><br><span class="line">+<span class="comment">-------------------------------+-------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>InnoDB å®ç°äº†ä¸€ä¸‹ä¸¤ç§ç±»å‹çš„è¡Œé”ï¼š  </p>
<ul>
<li>å…±äº«é”(S)ï¼šå…è®¸ä¸€ä¸ªäº‹åŠ¡å»å¤šä¸€è¡Œï¼Œé˜»æ­¢å…¶å®ƒäº‹åŠ¡è·å¾—ç›¸åŒæ•°æ®é›†çš„æ’ä»–é”ã€‚  </li>
<li>æ’ä»–é”(X): å…è®¸è·å¾—æ’ä»–é”çš„äº‹åŠ¡æ›´æ–°æ•°æ®ï¼Œé˜»æ­¢å…¶å®ƒäº‹åŠ¡è·å¾—ç›¸åŒæ•°æ®é›†çš„å…±äº«é”å’Œæ’ä»–å†™é”ã€‚</li>
</ul>
<p>å¦å¤–ï¼Œä¸ºäº†å…è®¸è¡Œé”å’Œè¡¨é”å…±å­˜ï¼Œå®ç°å¤šç²’åº¦é”æœºåˆ¶ï¼ŒInnoDB è¿˜æœ‰ä¸¤ç§å†…éƒ¨ä½¿ç”¨çš„æ„å‘é”ï¼ˆIntention Locksï¼‰ï¼Œè¿™ä¸¤ç§æ„å‘é”éƒ½æ˜¯è¡¨é”ã€‚ï¼ˆæ„Ÿè§‰ä¸MyISAM çš„è¡¨é”æœºåˆ¶ç±»ä¼¼ï¼‰  </p>
<ul>
<li>æ„å‘å…±äº«é”ï¼ˆISï¼‰ï¼šäº‹åŠ¡æ‰“ç®—ç»™æ•°æ®è¡ŒåŠ è¡Œå…±äº«é”ï¼Œäº‹åŠ¡åœ¨ç»™ä¸€ä¸ªæ•°æ®è¡ŒåŠ å…±äº«é”å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„ IS é”ã€‚  </li>
<li>æ„å‘æ’ä»–é”ï¼ˆIXï¼‰ï¼šäº‹åŠ¡æ‰“ç®—ç»™æ•°æ®è¡ŒåŠ è¡Œæ’ä»–é”ï¼Œäº‹åŠ¡åœ¨ç»™ä¸€ä¸ªæ•°æ®è¡ŒåŠ æ’ä»–é”å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„ IX é”ã€‚</li>
</ul>
<p><strong>InnoDBè¡Œé”æ¨¡å¼å…¼å®¹æ€§åˆ—è¡¨</strong>ï¼š</p>
<table>
<thead>
<tr>
<th align="left">è¯·æ±‚é”æ¨¡å¼çŸ©é˜µç»“æœè¡¨ç¤ºæ˜¯å¦å…¼å®¹ å½“å‰é”æ¨¡å¼</th>
<th align="left">X</th>
<th align="left">IX</th>
<th align="left">S</th>
<th align="left">IS</th>
</tr>
</thead>
<tbody><tr>
<td align="left">X</td>
<td align="left">å†²çª</td>
<td align="left">å†²çª</td>
<td align="left">å†²çª</td>
<td align="left">å†²çª</td>
</tr>
<tr>
<td align="left">IX</td>
<td align="left">å†²çª</td>
<td align="left">å…¼å®¹</td>
<td align="left">å†²çª</td>
<td align="left">å…¼å®¹</td>
</tr>
<tr>
<td align="left">S</td>
<td align="left">å†²çª</td>
<td align="left">å†²çª</td>
<td align="left">å…¼å®¹</td>
<td align="left">å…¼å®¹</td>
</tr>
<tr>
<td align="left">IS</td>
<td align="left">å†²çª</td>
<td align="left">å…¼å®¹</td>
<td align="left">å…¼å®¹</td>
<td align="left">å…¼å®¹</td>
</tr>
</tbody></table>
<h3 id="æ­»é”ï¼ˆDeadLock"><a href="#æ­»é”ï¼ˆDeadLock" class="headerlink" title="æ­»é”ï¼ˆDeadLock)"></a>æ­»é”ï¼ˆDeadLock)</h3><h3 id="é¿å…æ­»é”çš„æ–¹æ³•"><a href="#é¿å…æ­»é”çš„æ–¹æ³•" class="headerlink" title="é¿å…æ­»é”çš„æ–¹æ³•"></a><strong>é¿å…æ­»é”çš„æ–¹æ³•</strong></h3><ol>
<li>åœ¨åº”ç”¨ä¸­ï¼Œå¦‚æœä¸åŒçš„ç¨‹åºä¼šå¹¶å‘å­˜å–å¤šä¸ªè¡¨ï¼Œåº”å°½é‡çº¦å®šä»¥ç›¸åŒçš„é¡ºåºæ¥è®¿é—®è¡¨ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§é™ä½äº§ç”Ÿæ­»é”çš„æœºä¼šã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œç”±äºä¸¤ä¸ª session è®¿é—®ä¸¤ä¸ªè¡¨çš„é¡ºåºä¸åŒï¼Œå‘ç”Ÿæ­»é”çš„æœºä¼šå°±éå¸¸é«˜ï¼ä½†å¦‚æœä»¥ç›¸åŒçš„é¡ºåºæ¥è®¿é—®ï¼Œæ­»é”å°±å¯ä»¥é¿å…ã€‚  </li>
<li>åœ¨ç¨‹åºä»¥æ‰¹é‡æ–¹å¼å¤„ç†æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœäº‹å…ˆå¯¹æ•°æ®æ’åºï¼Œä¿è¯æ¯ä¸ªçº¿ç¨‹æŒ‰å›ºå®šçš„é¡ºåºæ¥å¤„ç†è®°å½•ï¼Œä¹Ÿå¯ä»¥å¤§å¤§é™ä½å‡ºç°æ­»é”çš„å¯èƒ½ã€‚  </li>
<li>åœ¨äº‹åŠ¡ä¸­ï¼Œå¦‚æœè¦æ›´æ–°è®°å½•ï¼Œåº”è¯¥ç›´æ¥ç”³è¯·è¶³å¤Ÿçº§åˆ«çš„é”ï¼Œå³æ’ä»–é”ï¼Œè€Œä¸åº”å…ˆç”³è¯·å…±äº«é”ï¼Œæ›´æ–°æ—¶å†ç”³è¯·æ’ä»–é”ï¼Œå› ä¸ºå½“ç”¨æˆ·ç”³è¯·æ’ä»–é”æ—¶ï¼Œå…¶ä»–äº‹åŠ¡å¯èƒ½åˆå·²ç»è·å¾—äº†ç›¸åŒè®°å½•çš„å…±äº«é”ï¼Œä»è€Œé€ æˆé”å†²çªï¼Œç”šè‡³æ­»é”ã€‚  </li>
<li>åœ¨ REPEATABLE-READ éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ç›¸åŒæ¡ä»¶è®°å½•ç”¨ SELECTâ€¦FOR UPDATE åŠ æ’ä»–é”ï¼Œåœ¨æ²¡æœ‰ç¬¦åˆè¯¥æ¡ä»¶è®°å½•æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½ä¼šåŠ é”æˆåŠŸã€‚ç¨‹åºå‘ç°è®°å½•å°šä¸å­˜åœ¨ï¼Œå°±è¯•å›¾æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹éƒ½è¿™ä¹ˆåšï¼Œå°±ä¼šå‡ºç°æ­»é”ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå°†éš”ç¦»çº§åˆ«æ”¹æˆ READ COMMITTEDï¼Œå°±å¯é¿å…é—®é¢˜ã€‚  </li>
<li>å½“éš”ç¦»çº§åˆ«ä¸º READ COMMITTED æ—¶ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹éƒ½å…ˆæ‰§è¡Œ SELECTâ€¦FOR UPDATEï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±æ’å…¥è®°å½•ã€‚æ­¤æ—¶ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ’å…¥æˆåŠŸï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¼šå‡ºç°é”ç­‰å¾…ï¼Œå½“ç¬¬ 1 ä¸ªçº¿ç¨‹æäº¤åï¼Œç¬¬ 2 ä¸ªçº¿ç¨‹ä¼šå› ä¸»é”®é‡å‡ºé”™ï¼Œä½†è™½ç„¶è¿™ä¸ªçº¿ç¨‹å‡ºé”™äº†ï¼Œå´ä¼šè·å¾—ä¸€ä¸ªæ’ä»–é”ï¼è¿™æ—¶å¦‚æœæœ‰ç¬¬ 3 ä¸ªçº¿ç¨‹åˆæ¥ç”³è¯·æ’ä»–é”ï¼Œä¹Ÿä¼šå‡ºç°æ­»é”ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>æ•°æ®ä»“åº“</title>
    <url>/blog/2019/07/31/data-warehouse/</url>
    <content><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p><strong>æ„ä¹‰</strong>ï¼š</p>
<p><img src="/blog/.io//raohui/Pictures/2019-08-28-134124.png" alt></p>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134125.png" alt></p>
<h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><h3 id="æ•°æ®ä¸­å¿ƒ"><a href="#æ•°æ®ä¸­å¿ƒ" class="headerlink" title="æ•°æ®ä¸­å¿ƒ"></a>æ•°æ®ä¸­å¿ƒ</h3><p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134126.png" alt></p>
<ul>
<li><p><strong>DB</strong>ï¼šæ•°æ®æ¥æºï¼Œå¯ä»¥ä¸ºMySQLã€SQLserverã€æ–‡ä»¶æ—¥å¿—ç­‰ã€‚</p>
</li>
<li><p><strong>ETL</strong>ï¼šå°†æ•°æ®ä»æ¥æºè¿ç§»åˆ°ç›®æ ‡çš„å‡ ä¸ªè¿‡ç¨‹ï¼ŒæŠ½å–ã€è½¬æ¢ã€åŠ è½½ä¸‰ä¸ªè¿‡ç¨‹ã€‚</p>
</li>
<li><p><strong>ODS</strong>ï¼šæ“ä½œæ€§æ•°æ®ï¼Œä½œä¸ºæ•°æ®åº“åˆ°æ•°æ®ä»“åº“çš„ä¸€ç§è¿‡æ¸¡ã€‚</p>
</li>
<li><p><strong>DW</strong> ï¼šæ•°æ®ä»“åº“ï¼Œæ•°æ®çš„å½’å®¿ï¼Œè¿™äº›æ•°æ®ä¸€èˆ¬ä¸ä¼šè¢«ä¿®æ”¹ã€‚</p>
</li>
<li><p><strong>DM</strong>ï¼šæ•°æ®é›†å¸‚ï¼Œä»æ•°æ®ä»“åº“ä¸­ç‹¬ç«‹å‡ºæ¥çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œä¹Ÿå¯ç§°ä¸ºéƒ¨é—¨æ•°æ®æˆ–ä¸»é¢˜æ•°æ®ï¼Œé¢å‘åº”ç”¨ã€‚</p>
</li>
</ul>
<h3 id="æ•°æ®åº“-vs-æ•°æ®ä»“åº“"><a href="#æ•°æ®åº“-vs-æ•°æ®ä»“åº“" class="headerlink" title="æ•°æ®åº“ vs æ•°æ®ä»“åº“"></a>æ•°æ®åº“ vs æ•°æ®ä»“åº“</h3><ul>
<li><strong>æ•°æ®åº“ï¼š</strong>ä»»ä½•ç»“æ„åŒ–æ•°æ®é›†åˆï¼Œå…è®¸ç”¨æˆ·è®¿é—®å’Œç®¡ç†æ•°æ®åº“ã€‚</li>
<li><strong>æ•°æ®ä»“åº“</strong>ï¼šé¢å‘ä¸»é¢˜çš„ï¼Œé›†æˆçš„ï¼Œç›¸å¯¹ç¨³å®šçš„ï¼Œåæ˜ å†å²å˜åŒ–çš„æ•°æ®é›†åˆï¼Œç”¨äºæ”¯æŒç®¡ç†å†³ç­–ã€‚</li>
</ul>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134127.png" alt></p>
<p>ç™¾åº¦æ•°æ®ä»“åº“æœåŠ¡ <a href="http://di.baidu.com/product/palo" target="_blank" rel="noopener">Palo</a></p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134128.png" alt></p>
<h2 id="ä¸»æµæ•°æ®ä»“åº“"><a href="#ä¸»æµæ•°æ®ä»“åº“" class="headerlink" title="ä¸»æµæ•°æ®ä»“åº“"></a>ä¸»æµæ•°æ®ä»“åº“</h2><ul>
<li><a href="https://www.teradata.com.cn/" target="_blank" rel="noopener">Teradata</a>ï¼šè¿ç»­ 15 å¹´ Gartner é¢†å¯¼è€…è±¡é™</li>
</ul>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134128.jpg" alt></p>
<ul>
<li><a href="http://hive.apache.org/" target="_blank" rel="noopener">Hive</a>ï¼š</li>
</ul>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134129.jpg" alt></p>
<p>ç¡®åˆ‡åœ°è¯´ï¼ŒHive æ˜¯åŸºäº Hadoop çš„æ•°æ®ä»“åº“å·¥å…·ï¼Œå¯ä»¥å¯¹å­˜å‚¨åœ¨ <strong>HDFS</strong> ä¸Šçš„æ–‡ä»¶æ•°æ®é›†è¿›è¡ŒæŸ¥è¯¢å’Œåˆ†æå¤„ç†ã€‚Hive å¯¹å¤–æä¾›äº†ç±»ä¼¼äº SQL è¯­è¨€çš„æŸ¥è¯¢è¯­è¨€ HiveQLï¼Œåœ¨åšæŸ¥è¯¢æ—¶å°† HQL è¯­å¥è½¬æ¢æˆ <strong>MapReduce</strong> ä»»åŠ¡ï¼Œåœ¨Hadoop å±‚è¿›è¡Œæ‰§è¡Œã€‚</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134130.png" alt></p>
<ul>
<li><p><strong>HDFS</strong>ï¼šHadoop çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨è¿™é‡Œä½œä¸ºæ•°æ®ä»“åº“çš„å­˜å‚¨å±‚ã€‚å›¾ä¸­çš„ Data Node å°±æ˜¯ HDFS çš„ä¼—å¤šå·¥ä½œèŠ‚ç‚¹ã€‚</p>
</li>
<li><p><strong>MapReduce</strong>ï¼šä¸€ç§é’ˆå¯¹æµ·é‡æ•°æ®çš„å¹¶è¡Œè®¡ç®—æ¨¡å‹ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºå¯¹å¤šä¸ªæ•°æ®åˆ†ç‰‡çš„æ•°æ®è½¬æ¢å’Œåˆå¹¶ã€‚</p>
</li>
</ul>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134131.png" alt></p>
<h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><p><strong>1. ä¸»é¢˜æ€§</strong>ï¼šä¸åŒäºä¼ ç»Ÿæ•°æ®åº“å¯¹åº”äºæŸä¸€ä¸ªæˆ–å¤šä¸ªé¡¹ç›®ï¼Œæ•°æ®ä»“åº“æ ¹æ®ä½¿ç”¨è€…å®é™…éœ€æ±‚ï¼Œå°†ä¸åŒæ•°æ®æºçš„æ•°æ®åœ¨ä¸€ä¸ªè¾ƒé«˜çš„æŠ½è±¡å±‚æ¬¡ä¸Šåšæ•´åˆï¼Œæ‰€æœ‰æ•°æ®éƒ½å›´ç»•æŸä¸€<strong>ä¸»é¢˜</strong>æ¥ç»„ç»‡</p>
<p><strong>2. é›†æˆæ€§</strong>ï¼šæ•°æ®ä»“åº“ä¸­å­˜å‚¨çš„æ•°æ®æ˜¯æ¥æºäºå¤šä¸ªæ•°æ®æºçš„é›†æˆï¼ŒåŸå§‹æ•°æ®æ¥è‡ªä¸åŒçš„æ•°æ®æºï¼Œå­˜å‚¨æ–¹å¼å„ä¸ç›¸åŒã€‚è¦æ•´åˆæˆä¸ºæœ€ç»ˆçš„æ•°æ®é›†åˆï¼Œéœ€è¦ä»æ•°æ®æºç»è¿‡ä¸€ç³»åˆ—æŠ½å–ã€æ¸…æ´—ã€è½¬æ¢çš„è¿‡ç¨‹ã€‚</p>
<p><strong>3. ç¨³å®šæ€§</strong>ï¼šæ•°æ®ä»“åº“ä¸­ä¿å­˜çš„æ•°æ®æ˜¯ä¸€ç³»åˆ—å†å²å¿«ç…§ï¼Œä¸å…è®¸è¢«ä¿®æ”¹ã€‚ç”¨æˆ·åªèƒ½é€šè¿‡åˆ†æå·¥å…·è¿›è¡ŒæŸ¥è¯¢å’Œåˆ†æã€‚</p>
<p><strong>4. æ—¶å˜æ€§</strong>ï¼šæ•°æ®ä»“åº“ä¼šå®šæœŸæ¥æ”¶æ–°çš„é›†æˆæ•°æ®ï¼Œååº”å‡ºæœ€æ–°çš„æ•°æ®å˜åŒ–ã€‚è¿™å’Œç‰¹ç‚¹å¹¶ä¸çŸ›ç›¾ã€‚</p>
<p>æ•°æ®ä»“åº“æ¶æ„å›¾</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134132.png" alt></p>
<p><a href="https://bigdata.163yun.com/mammut" target="_blank" rel="noopener">ç½‘æ˜“çŒ›çŠ¸</a></p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134133.png" alt></p>
<p>æ•°æ®ä»“åº“å»ºè®¾</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134134.png" alt></p>
<ul>
<li><a href="https://segmentfault.com/a/1190000012822942" target="_blank" rel="noopener">æ•°æ®ä»“åº“ç®€è¿°</a></li>
<li><a href="https://segmentfault.com/a/1190000017287122" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆå»ºè®¾æ•°æ®ä»“åº“ï¼Ÿ</a></li>
<li><a href="https://segmentfault.com/a/1190000017194045" target="_blank" rel="noopener">å¦‚ä½•æ­å»ºä¼ä¸šæ•°æ®ä»“åº“</a>ï¼Ÿ</li>
<li><a href="https://segmentfault.com/a/1190000019499144" target="_blank" rel="noopener">å®œäººè´·å®è·µ</a></li>
</ul>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
  </entry>
  <entry>
    <title>2019 å¹´ä¹¦å•</title>
    <url>/blog/2019/07/31/mysql-ilearning/</url>
    <content><![CDATA[<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><ul>
<li><p><a href="https://book.douban.com/subject/3354490/" target="_blank" rel="noopener">ã€ŠMySQL å¿…çŸ¥å¿…ä¼šã€‹</a></p>
</li>
<li><p><a href="https://dev.mysql.com/doc/refman/5.7/en/" target="_blank" rel="noopener">ã€ŠMySQL å®˜æ–¹æ‰‹å†Œã€‹</a></p>
</li>
<li><p><a href="https://book.douban.com/subject/30376056/" target="_blank" rel="noopener">ã€ŠMySQL 8 Cookbookï¼ˆä¸­æ–‡ç‰ˆï¼‰ã€‹</a></p>
</li>
<li><p><a href="https://book.douban.com/subject/23008813/" target="_blank" rel="noopener">ã€Šé«˜æ€§èƒ½MySQLï¼ˆç¬¬3ç‰ˆï¼‰ã€‹</a></p>
</li>
<li><p><a href="https://book.douban.com/subject/24708143/" target="_blank" rel="noopener">ã€ŠMySQLæŠ€æœ¯å†…å¹•ï¼šInnoDBå­˜å‚¨å¼•æ“ï¼ˆç¬¬2ç‰ˆï¼‰ã€‹</a></p>
</li>
</ul>
<h2 id="ç¼–ç¨‹"><a href="#ç¼–ç¨‹" class="headerlink" title="ç¼–ç¨‹"></a>ç¼–ç¨‹</h2><ul>
<li><p><a href="https://book.douban.com/subject/3652388/" target="_blank" rel="noopener">ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹</a></p>
</li>
<li><p><a href="https://book.douban.com/subject/5387402/" target="_blank" rel="noopener">ã€Šç¨‹åºå‘˜çš„ä¿®ç‚¼ä¹‹é“ã€‹</a></p>
</li>
<li><p><a href="https://book.douban.com/subject/1477390/" target="_blank" rel="noopener">ã€Šä»£ç å¤§å…¨ã€‹</a></p>
</li>
<li><p><a href="https://book.douban.com/subject/3004255/" target="_blank" rel="noopener">ã€Šç¼–ç¨‹ä¹‹ç¾ã€‹</a></p>
</li>
<li><p><a href="https://book.douban.com/subject/3227098/" target="_blank" rel="noopener">ã€Šç¼–ç¨‹ç ç‘ã€‹</a></p>
</li>
<li><p><a href="https://book.douban.com/subject/4262627/" target="_blank" rel="noopener">ã€Šé‡æ„ã€‹</a></p>
</li>
</ul>
<h2 id="è®¡ç®—æœºåŸºç¡€"><a href="#è®¡ç®—æœºåŸºç¡€" class="headerlink" title="è®¡ç®—æœºåŸºç¡€"></a>è®¡ç®—æœºåŸºç¡€</h2><ul>
<li><a href="https://book.douban.com/subject/1230413/" target="_blank" rel="noopener">ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹</a></li>
<li><a href="https://book.douban.com/subject/24737674/" target="_blank" rel="noopener">ã€Šå›¾è§£TCP/IPã€‹</a> </li>
</ul>
<h2 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h2><ul>
<li><a href="https://book.douban.com/subject/1786387/" target="_blank" rel="noopener">ã€Šå½±å“åŠ›ã€‹</a></li>
<li><a href="https://book.douban.com/subject/6709809/" target="_blank" rel="noopener">ã€Šæš—æ—¶é—´ã€‹</a></li>
</ul>
<h2 id="ä¿®ç‚¼"><a href="#ä¿®ç‚¼" class="headerlink" title="ä¿®ç‚¼"></a>ä¿®ç‚¼</h2><p><strong>å·¥ç¨‹å¸ˆ - é«˜çº§å·¥ç¨‹å¸ˆ - æŠ€æœ¯ä¸“å®¶ - åˆçº§æ¶æ„å¸ˆ - ä¸­çº§æ¶æ„å¸ˆ - é«˜çº§æ¶æ„å¸ˆ</strong></p>
<p><strong>å·¥ç¨‹å¸ˆé˜¶æ®µ</strong>ï¼šåŸºç¡€æŠ€èƒ½ç§¯ç´¯é˜¶æ®µï¼ˆåŸºç¡€çŸ¥è¯†ã€ç¼–ç¨‹è¯­è¨€ã€ç¼–ç¨‹å·¥å…·ï¼‰</p>
<p><strong>é«˜çº§å·¥ç¨‹å¸ˆ</strong>ï¼šç§¯ç´¯æ–¹æ¡ˆè®¾è®¡ç»éªŒå¹¶èƒ½ç‹¬ç«‹å®Œæˆå¼€å‘ï¼ˆéœ€æ±‚è®¾è®¡ã€æ–¹æ¡ˆè®¾è®¡ã€ç¼–ç å®ç°ï¼‰</p>
<p><strong>æŠ€æœ¯ä¸“å®¶</strong>ï¼šæ‹“å±•æŠ€æœ¯å®½åº¦</p>
<p><strong>åˆçº§æ¶æ„å¸ˆ</strong>ï¼šèƒ½å¤Ÿç‹¬ç«‹å®Œæˆä¸€ä¸ªç³»ç»Ÿçš„æ¶æ„è®¾è®¡</p>
<p><strong>ä¸­çº§æ¶æ„å¸ˆ</strong>ï¼šèƒ½å¤Ÿå®Œæˆå¤æ‚ç³»ç»Ÿçš„æ¶æ„è®¾è®¡</p>
<p><strong>é«˜çº§æ¶æ„å¸ˆ</strong>ï¼šåˆ›é€ æ–°çš„æ¶æ„æ¨¡å¼</p>
<p><strong>è½¯ä»¶å‘å¸ƒå…¨æµç¨‹</strong></p>
<ul>
<li>éœ€æ±‚åˆ†æï¼ˆéœ€æ±‚æ¢³ç† =&gt; äº§å“å®šä¹‰ï¼‰</li>
<li>ç³»ç»Ÿè®¾è®¡ï¼ˆå­ç³»ç»Ÿåˆ’åˆ† =&gt; æ¨¡å—å®šä¹‰ï¼‰</li>
<li>æ¨¡å—è®¾è®¡ï¼ˆæ¨¡å—è¯¦ç»†è®¾è®¡ï¼‰</li>
<li>ç¼–ç å®ç°</li>
<li>å•å…ƒæµ‹è¯•</li>
<li>ä»£ç è¯„å®¡</li>
<li>é›†æˆæµ‹è¯•</li>
<li>ç°åº¦å‘å¸ƒ</li>
<li>æ­£å¼å‘å¸ƒ</li>
</ul>
]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· DBA å·¥å…·</title>
    <url>/blog/2019/07/31/mysql-tools/</url>
    <content><![CDATA[<h2 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h2><p><a href="https://www.heidisql.com/" target="_blank" rel="noopener">HeidiSQL</a></p>
<p><a href="https://www.navicat.com.cn/products/navicat-for-mysql" target="_blank" rel="noopener">Navicat</a></p>
<p><a href="http://www.sequelpro.com/" target="_blank" rel="noopener">Sequel Pro</a></p>
<p><a href="http://www.mysql.com/products/workbench/" target="_blank" rel="noopener">MySQL Workbench</a></p>
<h2 id="è¿ç»´"><a href="#è¿ç»´" class="headerlink" title="è¿ç»´"></a>è¿ç»´</h2><p><a href="http://www.percona.com/software/percona-toolkit" target="_blank" rel="noopener">Percona-Toolkit</a></p>
<p><a href="https://huiraoo.github.io/blog/2019/06/18/mysql-xtrabackup/">XtraBackup</a></p>
<h2 id="å‹æµ‹"><a href="#å‹æµ‹" class="headerlink" title="å‹æµ‹"></a>å‹æµ‹</h2><p><a href="https://github.com/akopytov/sysbench" target="_blank" rel="noopener">sysbench</a></p>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/mysqlslap.html" target="_blank" rel="noopener">mysqlslap</a></p>
<p><a href="https://github.com/Percona-Lab/tpcc-mysql" target="_blank" rel="noopener">tpcc-mysql</a></p>
<h2 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h2><p><a href="https://downloads.mysql.com/archives/proxy/" target="_blank" rel="noopener">MySQL Proxy</a></p>
<p><a href="https://github.com/Qihoo360/Atlas" target="_blank" rel="noopener">Atlas</a></p>
<p><a href="http://www.mycat.io/" target="_blank" rel="noopener">Mycat</a></p>
<h2 id="å¯è§†åŒ–"><a href="#å¯è§†åŒ–" class="headerlink" title="å¯è§†åŒ–"></a>å¯è§†åŒ–</h2><p><a href="https://redash.io/" target="_blank" rel="noopener">Redash</a></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· SQL å®¡æ ¸å·¥å…·å¯¹æ¯”</title>
    <url>/blog/2019/07/26/mysql-examine/</url>
    <content><![CDATA[<table>
<thead>
<tr>
<th></th>
<th>SOAR</th>
<th>sqlcheck</th>
<th>pt-query-advisor</th>
<th>SQL Advisor</th>
<th>Inception</th>
<th>sqlautoreview</th>
</tr>
</thead>
<tbody><tr>
<td>å¯å‘å¼å»ºè®®</td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
<td>Ã—</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>ç´¢å¼•å»ºè®®</td>
<td>âˆš</td>
<td>Ã—</td>
<td>Ã—</td>
<td>âˆš</td>
<td>Ã—</td>
<td>âˆš</td>
</tr>
<tr>
<td>æŸ¥è¯¢é‡å†™</td>
<td>âˆš</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
</tr>
<tr>
<td>æ‰§è¡Œè®¡åˆ’å±•ç¤º</td>
<td>âˆš</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
</tr>
<tr>
<td>Profiling</td>
<td>âˆš</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
</tr>
<tr>
<td>Trace</td>
<td>âˆš</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
</tr>
<tr>
<td>SQLåœ¨çº¿æ‰§è¡Œ</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
<td>âˆš</td>
<td>Ã—</td>
</tr>
<tr>
<td>æ•°æ®å¤‡ä»½</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
<td>Ã—</td>
<td>âˆš</td>
<td>Ã—</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· æœ€ä½³å®è·µ</title>
    <url>/blog/2019/07/25/mysql-best-practices/</url>
    <content><![CDATA[<h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><ul>
<li><a href="https://huiraoo.github.io/blog/2019/10/17/mysql-archiver/">MySQL Â· æ•°æ®å½’æ¡£</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/21/mysql-delete-bigtable/">MySQL Â· å¿«é€Ÿåˆ é™¤å¤§è¡¨</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/21/mysql-modify-dbname/">MySQL Â· ä¿®æ”¹æ•°æ®åº“å</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/19/pt-online-schema-change/">MySQL Â· åœ¨çº¿ä¿®æ”¹ç´¢å¼•</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/21/mysql-rollback/">MySQL Â· ä½¿ç”¨ binlog2sql å·¥å…·å¿«é€Ÿå›æ»šè¯¯æ“ä½œ</a></li>
<li><a href="https://huiraoo.github.io/blog/2019/10/22/mysql-migration/">MySQL Â· ä½¿ç”¨ XtraBackup è¿ç§»æ•°æ®åº“</a></li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· ç®€ä»‹</title>
    <url>/blog/2019/07/25/mysql-guide/</url>
    <content><![CDATA[<h2 id="å†å²"><a href="#å†å²" class="headerlink" title="å†å²"></a>å†å²</h2><ul>
<li>1979å¹´ï¼ŒMonty Widenius å†™äº†æœ€åˆçš„ç‰ˆæœ¬</li>
<li>1996å¹´ï¼Œå‘å¸ƒ 1.0 ç‰ˆæœ¬</li>
<li>1995-2000å¹´ï¼ŒMySQL AB æˆç«‹</li>
<li>2000å¹´4æœˆï¼Œé›†æˆ MyISAM å’Œ Replication</li>
<li>2001å¹´ï¼ŒHeikki Tuuri å‘ MySQL å»ºè®®é›†æˆ InnoDB</li>
<li>2005å¹´ï¼Œå‘å¸ƒ 5.0 ç‰ˆæœ¬ï¼ˆæä¾›äº†è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ç­‰åŠŸèƒ½ï¼‰</li>
<li><strong>2008å¹´ï¼ŒMySQL AB è¢« Sun æ”¶è´­ï¼Œå‡ºä»· 10 äº¿ç¾å…ƒ</strong></li>
<li><strong>2009å¹´ï¼Œæ¨å‡º 5.1 ç‰ˆæœ¬ï¼ŒåŒå¹´ 4 æœˆï¼ŒOracle æ”¶è´­ Sun</strong></li>
<li>2010å¹´12æœˆï¼Œæ¨å‡º 5.5 GA ç‰ˆæœ¬ï¼ŒInnoDB æ”¹ä¸ºé»˜è®¤å­˜å‚¨å¼•æ“</li>
<li>2013å¹´2æœˆï¼Œæ¨å‡º 5.6 GA ç‰ˆæœ¬</li>
<li>2015å¹´10æœˆï¼Œæ¨å‡º 5.7 GA ç‰ˆæœ¬</li>
<li>2018å¹´5æœˆï¼Œæ¨å‡º 8.0 GA ç‰ˆæœ¬</li>
</ul>
<h3 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><p><strong>ä¼˜ç‚¹</strong></p>
<ul>
<li>å…è´¹</li>
<li>å¼€æºï¼ˆæºç ã€ç¤¾åŒºå·¥å…·ä¸°å¯Œï¼‰</li>
<li>ç®€å•ï¼ˆéƒ¨ç½²ç®€å•ã€é—¨æ§›ä½ã€ä¸Šæ‰‹å¿«ï¼‰</li>
</ul>
<p><strong>ç¼ºç‚¹</strong></p>
<ul>
<li>ä¼˜åŒ–å™¨å¯¹å¤æ‚ SQL æ”¯æŒä¸å¥½</li>
<li>å¤§è§„æ¨¡é›†ç¾¤æ–¹æ¡ˆä¸æˆç†Ÿï¼Œä¸»è¦æŒ‡ä¸­é—´ä»¶</li>
<li>å¤‡ä»½å’Œæ¢å¤æ–¹æ¡ˆè¿˜æ˜¯æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦ä¾èµ–å¤–éƒ¨ç»„ä»¶</li>
<li>ç¼ºå°‘åˆ†åº“åˆ†è¡¨è§£å†³æ–¹æ¡ˆ</li>
</ul>
<h3 id="åˆ†æ”¯"><a href="#åˆ†æ”¯" class="headerlink" title="åˆ†æ”¯"></a>åˆ†æ”¯</h3><ul>
<li>MySQL ç¤¾åŒºç‰ˆ</li>
<li>Percona</li>
<li>MariaDB</li>
<li>MySQL ä¼ä¸šç‰ˆ</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>MySQL Standard Edition</th>
<th>MySQL Enterprise Edition</th>
<th>MySQL Cluster CGE</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://www.mysql.com/cn/support/" target="_blank" rel="noopener"><strong>Oracle Premier Support</strong></a></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>24x7 Support</td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>Unlimited Support Incidents</td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>Knowledge Base</td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>Maintenance Releases</td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><a href="https://www.mysql.com/cn/support/consultative.html" target="_blank" rel="noopener">MySQL Consultative Support</a></td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><strong>MySQL Features</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.mysql.com/cn/products/enterprise/database/" target="_blank" rel="noopener">MySQL Database Server</a></td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><a href="https://www.mysql.com/cn/products/enterprise/document_store.html" target="_blank" rel="noopener">MySQL Document Store</a></td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><a href="https://www.mysql.com/cn/products/connector/" target="_blank" rel="noopener">MySQL Connectors</a></td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/replication.html" target="_blank" rel="noopener">MySQL Replication</a></td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><a href="https://www.mysql.com/cn/products/enterprise/router.html" target="_blank" rel="noopener">MySQL Router</a></td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/5.7/en/partitioning.html" target="_blank" rel="noopener">MySQL Partitioning</a></td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><strong>MySQL Workbench</strong></td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>Storage Engine: MyISAM</td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>Storage Engine: InnoDB</td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>Storage Engine: NDB</td>
<td></td>
<td></td>
<td>âˆš</td>
</tr>
<tr>
<td><strong>MySQL Enterprise Monitor</strong></td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>MySQL Enterprise Dashboard</td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>MySQL Enterprise Advisors</td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>MySQL Query Analyzer</td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>MySQL Replication Monitor</td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><strong>MySQL Enterprise Backup</strong></td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>Hot backup for InnoDB</td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>Full, Incremental, Partial, Optimistic Backups</td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>Full, Partial, Selective, Hot Selective restore</td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>Encryption and Compression</td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>Point-In-Time-Recovery</td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><strong>MySQL Enterprise Security</strong></td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><a href="https://www.mysql.com/cn/products/enterprise/security.html" target="_blank" rel="noopener">MySQL Enterprise Authentication</a></td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><a href="https://www.mysql.com/cn/products/enterprise/tde.html" target="_blank" rel="noopener">MySQL Enterprise TDE</a></td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><a href="https://www.mysql.com/cn/products/enterprise/encryption.html" target="_blank" rel="noopener">MySQL Enterprise Encryption</a></td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><a href="https://www.mysql.com/cn/products/enterprise/masking.html" target="_blank" rel="noopener">MySQL Enterprise Masking</a></td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><a href="https://www.mysql.com/cn/products/enterprise/firewall.html" target="_blank" rel="noopener">MySQL Enterprise Firewall</a></td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><a href="https://www.mysql.com/cn/products/enterprise/audit.html" target="_blank" rel="noopener">MySQL Enterprise Audit</a></td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><strong>MySQL Enterprise Scalability</strong></td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>Thread Pool</td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><strong>MySQL Enterprise High-Availability</strong></td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>MySQL Group Replication</td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>MySQL InnoDB Cluster</td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td><strong>MySQL Cluster Manager</strong></td>
<td></td>
<td></td>
<td>âˆš</td>
</tr>
<tr>
<td>Configuration &amp; Provisioning</td>
<td></td>
<td></td>
<td>âˆš</td>
</tr>
<tr>
<td>Automatic Scaling</td>
<td></td>
<td></td>
<td>âˆš</td>
</tr>
<tr>
<td>Management &amp; Monitoring</td>
<td></td>
<td></td>
<td>âˆš</td>
</tr>
<tr>
<td><a href="https://www.mysql.com/cn/products/cluster/" target="_blank" rel="noopener">MySQL Cluster Geo-Replication</a></td>
<td></td>
<td></td>
<td>âˆš</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· åˆ†åº“åˆ†è¡¨</title>
    <url>/blog/2019/07/24/mysql-split/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å½“æ•°æ®åº“çš„æ•°æ®é‡éå¸¸å¤§æ—¶ï¼Œ<strong>æ°´å¹³åˆ‡åˆ†</strong>å’Œ<strong>å‚ç›´æ‹†åˆ†</strong>æ˜¯ä¸¤ç§å¸¸è§çš„é™ä½æ•°æ®åº“å¤§å°ï¼Œæå‡æ€§èƒ½çš„æ–¹æ³•ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">user</span><br><span class="line">(</span><br><span class="line">uid bigint,</span><br><span class="line">name varchar(16),</span><br><span class="line">pass varchar(16),</span><br><span class="line">age int,</span><br><span class="line">sex tinyint,</span><br><span class="line">flag tinyint,</span><br><span class="line">sign varchar(64),</span><br><span class="line">intro varchar(256)</span><br><span class="line">â€¦);</span><br></pre></td></tr></table></figure>

<p><strong>æ°´å¹³åˆ‡åˆ†</strong>ï¼šä»¥æŸä¸ªå­—æ®µä¸ºä¾æ®ï¼ˆä¾‹å¦‚ <code>uid</code>ï¼‰ï¼ŒæŒ‰ç…§ä¸€å®šè§„åˆ™ï¼ˆä¾‹å¦‚å–æ¨¡ï¼‰ï¼Œå°†ä¸€ä¸ªåº“ï¼ˆè¡¨ï¼‰ä¸Šçš„æ•°æ®æ‹†åˆ†åˆ°å¤šä¸ªåº“ï¼ˆè¡¨ï¼‰ä¸Šï¼Œä»¥é™ä½å•åº“ï¼ˆè¡¨ï¼‰å¤§å°ï¼Œè¾¾åˆ°æå‡æ€§èƒ½çš„ç›®çš„çš„æ–¹æ³•ï¼Œæ°´å¹³åˆ‡åˆ†åï¼Œå„ä¸ªåº“ï¼ˆè¡¨ï¼‰çš„ç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>æ¯ä¸ªåº“ï¼ˆè¡¨ï¼‰çš„<strong>ç»“æ„</strong>éƒ½ä¸€æ ·</li>
<li>æ¯ä¸ªåº“ï¼ˆè¡¨ï¼‰çš„<strong>æ•°æ®</strong>éƒ½ä¸ä¸€æ ·ï¼Œæ²¡æœ‰äº¤é›†</li>
<li>æ‰€æœ‰åº“ï¼ˆè¡¨ï¼‰çš„å¹¶é›†æ˜¯å…¨é‡æ•°æ®</li>
</ul>
<p><strong>å‚ç›´æ‹†åˆ†</strong>ï¼šå°†ä¸€ä¸ªå±æ€§è¾ƒå¤šï¼Œä¸€è¡Œæ•°æ®è¾ƒå¤§çš„è¡¨ï¼Œå°†ä¸åŒçš„å±æ€§æ‹†åˆ†åˆ°ä¸åŒçš„è¡¨ä¸­ï¼Œä»¥é™ä½å•åº“ï¼ˆè¡¨ï¼‰å¤§å°ï¼Œè¾¾åˆ°æå‡æ€§èƒ½çš„ç›®çš„çš„æ–¹æ³•ï¼Œå‚ç›´åˆ‡åˆ†åï¼Œå„ä¸ªåº“ï¼ˆè¡¨ï¼‰çš„ç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>æ¯ä¸ªåº“ï¼ˆè¡¨ï¼‰çš„<strong>ç»“æ„</strong>éƒ½ä¸ä¸€æ ·</li>
<li>ä¸€èˆ¬æ¥è¯´ï¼Œæ¯ä¸ªåº“ï¼ˆè¡¨ï¼‰çš„<strong>å±æ€§</strong>è‡³å°‘æœ‰ä¸€åˆ—äº¤é›†ï¼Œä¸€èˆ¬æ˜¯ä¸»é”®</li>
<li>æ‰€æœ‰åº“ï¼ˆè¡¨ï¼‰çš„å¹¶é›†æ˜¯å…¨é‡æ•°æ®</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">user_base</span><br><span class="line">(</span><br><span class="line">uid bigint,</span><br><span class="line">name varchar(16),</span><br><span class="line">pass varchar(16),</span><br><span class="line">age int,</span><br><span class="line">sex tinyint,</span><br><span class="line">flag tinyint,</span><br><span class="line">â€¦);</span><br><span class="line"></span><br><span class="line">user_ext</span><br><span class="line">(</span><br><span class="line">uid bigint,</span><br><span class="line">sign varchar(64),</span><br><span class="line">intro varchar(256)</span><br><span class="line">â€¦);</span><br></pre></td></tr></table></figure>

<p><strong>æ‹†åˆ†åŸåˆ™</strong>ï¼š</p>
<p>â‘   å°†é•¿åº¦è¾ƒçŸ­ï¼Œè®¿é—®é¢‘ç‡è¾ƒé«˜çš„å±æ€§å°½é‡æ”¾åœ¨ä¸€ä¸ªè¡¨é‡Œï¼Œè¿™ä¸ªè¡¨æš‚ä¸”ç§°ä¸º<strong>ä¸»è¡¨</strong>ã€‚</p>
<p>â‘¡  å°†å­—æ®µè¾ƒé•¿ï¼Œè®¿é—®é¢‘ç‡è¾ƒä½çš„å±æ€§å°½é‡æ”¾åœ¨ä¸€ä¸ªè¡¨é‡Œï¼Œè¿™ä¸ªè¡¨æš‚ä¸”ç§°ä¸º<strong>æ‰©å±•è¡¨ã€‚</strong></p>
<h2 id="åŸåˆ™"><a href="#åŸåˆ™" class="headerlink" title="åŸåˆ™"></a>åŸåˆ™</h2><ul>
<li>åŸåˆ™é›¶ï¼šèƒ½ä¸åˆ†å°±ä¸åˆ†</li>
<li>åŸåˆ™ä¸€ï¼šæ•°æ®é‡å¤ªå¤§ï¼Œæ­£å¸¸çš„è¿ç»´å½±å“æ­£å¸¸çš„ä¸šåŠ¡è®¿é—®</li>
<li>åŸåˆ™äºŒï¼šè¡¨è®¾è®¡ä¸åˆç†ï¼Œéœ€è¦å¯¹æŸäº›å­—æ®µè¿›è¡Œå‚ç›´æ‹†åˆ†</li>
<li>åŸåˆ™ä¸‰ï¼šæŸäº›æ•°æ®è¡¨å‡ºç°äº†æ— ç©·å¢é•¿çš„æƒ…å†µ</li>
<li>åŸåˆ™å››ï¼šå®‰å…¨æ€§å’Œå¯ç”¨æ€§çš„è€ƒè™‘</li>
<li>åŸåˆ™äº”ï¼šä¸šåŠ¡è€¦åˆæ€§è€ƒè™‘</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>â‘   <strong>æ°´å¹³æ‹†åˆ†</strong>å’Œ<strong>å‚ç›´æ‹†åˆ†</strong>éƒ½æ˜¯é™ä½æ•°æ®é‡å¤§å°ï¼Œæå‡æ•°æ®åº“æ€§èƒ½çš„å¸¸è§æ‰‹æ®µ</p>
<p>â‘¡  æµé‡å¤§æ•°æ®é‡å¤§æ—¶ï¼Œ<strong>æ•°æ®è®¿é—®è¦æœ‰ service å±‚</strong>ï¼Œå¹¶ä¸” service å±‚ä¸è¦é€šè¿‡ <code>join</code> æ¥è·å–ä¸»è¡¨å’Œæ‰©å±•è¡¨çš„å±æ€§</p>
<p>â‘¢  <strong>å‚ç›´æ‹†åˆ†çš„ä¾æ®</strong>ï¼Œå°½é‡æŠŠé•¿åº¦è¾ƒçŸ­ï¼Œè®¿é—®é¢‘ç‡è¾ƒé«˜çš„å±æ€§æ”¾åœ¨ä¸»è¡¨é‡Œ</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· å¤‡ä»½æ¢å¤</title>
    <url>/blog/2019/07/24/mysql-backup/</url>
    <content><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>ç‰©ç†å¤‡ä»½ï¼šç›´æ¥å¤‡ä»½æ•°æ®åº“çš„æ•°æ®æ–‡ä»¶ï¼Œé€‚ç”¨äºå¤§æ•°æ®é‡ï¼Œéœ€è¦å¿«é€Ÿæ¢å¤çš„æ•°æ®åº“ã€‚</p>
<p>é€»è¾‘å¤‡ä»½ï¼šå¤‡ä»½æ•°æ®åº“ä¸­æ•°æ®ç»“æ„å’Œå†…å®¹çš„SQLè¯­å¥ï¼Œé€‚ç”¨äºè¾ƒå°æ•°æ®é‡æˆ–æ˜¯è·¨ç‰ˆæœ¬çš„æ•°æ®åº“å¤‡ä»½æ¢å¤ã€‚</p>
<p>ç›®å‰å¤‡ä»½æ–¹å¼çš„å‡ ä¸ªçº¬åº¦ï¼š</p>
<ul>
<li>å…¨é‡å¤‡ä»½ VS å¢é‡å¤‡ä»½</li>
<li>çƒ­å¤‡ VS å†·å¤‡</li>
<li>ç‰©ç†å¤‡ä»½ VS é€»è¾‘å¤‡ä»½</li>
<li>å»¶æ—¶å¤‡ä»½</li>
<li>å…¨é‡binlogå¤‡ä»½</li>
</ul>
<p>å»ºè®®æ–¹å¼ï¼š</p>
<ul>
<li>çƒ­å¤‡ï¼‹ç‰©ç†å¤‡ä»½</li>
<li>æ ¸å¿ƒä¸šåŠ¡ï¼šå»¶æ—¶å¤‡ä»½ï¼‹é€»è¾‘å¤‡ä»½</li>
<li>å…¨é‡binlogå¤‡ä»½</li>
</ul>
<p>ä¸»è¦åšçš„å‡ ç‚¹ï¼š</p>
<ul>
<li>å¤‡ä»½ç­–ç•¥é›†ä¸­å¼è°ƒåº¦ç®¡ç†</li>
<li>xtrabackupçƒ­å¤‡</li>
<li>å¤‡ä»½ç»“æœç»Ÿè®¡åˆ†æ</li>
<li>å¤‡ä»½æ•°æ®ä¸€è‡´æ€§æ ¡éªŒ</li>
<li>é‡‡ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨å¤‡ä»½</li>
</ul>
<p>å¤‡ä»½ç³»ç»Ÿé‡‡ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸåŸå› ï¼š</p>
<ul>
<li>è§£å†³å­˜å‚¨åˆ†é…çš„é—®é¢˜</li>
<li>è§£å†³å­˜å‚¨NFSå¤‡ä»½æ•ˆç‡ä½ä¸‹é—®é¢˜</li>
<li>å­˜å‚¨é›†ä¸­å¼ç®¡ç†</li>
<li>æ•°æ®å¯é æ€§æ›´å¥½</li>
</ul>
<h2 id="å¤‡ä»½æ–¹æ¡ˆ"><a href="#å¤‡ä»½æ–¹æ¡ˆ" class="headerlink" title="å¤‡ä»½æ–¹æ¡ˆ"></a>å¤‡ä»½æ–¹æ¡ˆ</h2><ul>
<li>mysqldump</li>
<li>XtraBackup</li>
</ul>
<h2 id="æ¢å¤å®è·µ"><a href="#æ¢å¤å®è·µ" class="headerlink" title="æ¢å¤å®è·µ"></a>æ¢å¤å®è·µ</h2><p><strong>å…³äºå¤‡ä»½ï¼Œbinlogå¤‡ä»½è‡ªç„¶ä¸ç”¨è¯´äº†ï¼Œç‰©ç†å¤‡ä»½æœ‰å¾ˆå¤šæ–¹å¼ï¼Œæœ‰æ²¡æœ‰æ¨èçš„ä¸€ç§ï¼Œé€»è¾‘å¤‡ä»½åœ¨é‡å¤§çš„æ—¶å€™æ¢å¤é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œä¸€èˆ¬ç”¨åœ¨ä»€ä¹ˆåœºæ™¯ï¼Ÿ</strong></p>
<p>ç‰©ç†å¤‡ä»½é‡‡ç”¨xtrabackupçƒ­å¤‡æ–¹æ¡ˆæ¯”è¾ƒå¥½ã€‚é€»è¾‘å¤‡ä»½ä¸€èˆ¬ç”¨åœ¨å•è¡¨æ¢å¤æ•ˆæœä¼šéå¸¸å¥½ã€‚æ¯”å¦‚ä½ åˆ äº†ä¸€ä¸ª2Gè¡¨ï¼Œä½†ä½ æ€»æ•°æ®é‡2Tï¼Œç”¨ç‰©ç†å¤‡ä»½å°±ä¼šè¦æ…¢äº†ï¼Œé€»è¾‘å¤‡ä»½å°±éå¸¸æœ‰ç”¨äº†ã€‚</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· å¼€å‘è§„èŒƒ</title>
    <url>/blog/2019/07/23/mysql-rules/</url>
    <content><![CDATA[<h2 id="åº“è¡¨è§„èŒƒ"><a href="#åº“è¡¨è§„èŒƒ" class="headerlink" title="åº“è¡¨è§„èŒƒ"></a>åº“è¡¨è§„èŒƒ</h2><ul>
<li><p>å­˜å‚¨å¼•æ“å¿…é¡»ä½¿ç”¨ <code>InnoDB</code></p>
</li>
<li><p>åº“åã€è¡¨åã€å­—æ®µåå¿…é¡»ç”¨å°å†™ï¼Œé‡‡ç”¨ä¸‹åˆ’çº¿åˆ†éš”</p>
</li>
<li><p>è¡¨å­—ç¬¦é›†é»˜è®¤ä½¿ç”¨ <code>utf8</code>ï¼Œå¿…è¦æ—¶å€™ä½¿ç”¨ <code>utf8mb4</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  é€šç”¨ï¼Œæ— ä¹±ç é£é™©ï¼Œæ±‰å­—<span class="number">3</span>å­—èŠ‚ï¼Œè‹±æ–‡<span class="number">1</span>å­—èŠ‚</span><br><span class="line">â‘¡ utf8mb4æ˜¯utf8çš„è¶…é›†ï¼Œå­˜å‚¨<span class="number">4</span>å­—èŠ‚ï¼Œä¾‹å¦‚ï¼šè¡¨æƒ…ç¬¦å·æ—¶ä½¿ç”¨å®ƒ</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¦æ­¢ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ã€è§†å›¾ã€è§¦å‘å™¨ã€äº‹ä»¶</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  å¯¹æ•°æ®åº“æ€§èƒ½å½±å“è¾ƒå¤§ï¼Œèƒ½è®©ç«™ç‚¹å±‚å’ŒæœåŠ¡å±‚å¹²çš„äº‹æƒ…ï¼Œä¸è¦äº¤åˆ°æ•°æ®åº“å±‚</span><br><span class="line">â‘¡ éš¾ä»¥è°ƒè¯•å’Œæ‰©å±•ï¼Œæ›´æ²¡æœ‰ç§»æ¤æ€§</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨å¤§æ–‡ä»¶</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  ä¾‹å¦‚ç…§ç‰‡ï¼Œå¯ä»¥å°†å¤§æ–‡ä»¶å­˜å‚¨åœ¨å¯¹è±¡å­˜å‚¨ç³»ç»Ÿï¼Œæ•°æ®åº“ä¸­å­˜å‚¨è·¯å¾„</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¦æ­¢ä½¿ç”¨ <code>text</code>ã€<code>blob</code> ç±»å‹</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  ä¼šæµªè´¹æ›´å¤šçš„ç£ç›˜å’Œå†…å­˜ç©ºé—´ï¼Œéå¿…è¦çš„å¤§é‡çš„å¤§å­—æ®µæŸ¥è¯¢ä¼šæ·˜æ±°æ‰çƒ­æ•°æ®ï¼Œå¯¼è‡´å†…å­˜å‘½ä¸­ç‡æ€¥å‰§é™ä½ï¼Œå½±å“æ•°æ®åº“æ€§èƒ½</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ ¹æ®ä¸šåŠ¡åŒºåˆ†ä½¿ç”¨ <code>tinyint</code>ï¼ˆ1 byteï¼‰ã€<code>smallint</code>ï¼ˆ2 byteï¼‰ã€<code>int</code>ï¼ˆ4 byteï¼‰ã€<code>bigint</code>ï¼ˆ8 byteï¼‰</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  åˆé€‚çš„å­—ç¬¦å­˜å‚¨é•¿åº¦ï¼Œä¸ä½†èŠ‚çº¦æ•°æ®åº“è¡¨ç©ºé—´ï¼ŒèŠ‚çº¦ç´¢å¼•å­˜å‚¨ï¼Œæ›´é‡è¦çš„æ˜¯æå‡æ£€ç´¢é€Ÿåº¦</span><br><span class="line">â‘¡ æ•´æ•°ç±»å‹æŒ‡å®šæ˜¾ç¤ºå®½åº¦ï¼Œä¾‹å¦‚ï¼šint(M)å¯¹å¤§å¤šæ•°åº”ç”¨æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œä»–ä¸ä¼šé™åˆ¶å€¼çš„åˆæ³•èŒƒå›´ï¼Œå¯¹äºå­˜å‚¨å’Œè®¡ç®—æ¥è¯´ï¼Œint(<span class="number">1</span>)å’Œint(<span class="number">20</span>)æ˜¯ç›¸åŒçš„</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>å¯¹è±¡</th>
<th>å¹´é¾„åŒºé—´</th>
<th>ç±»å‹</th>
<th>èŒƒå›´</th>
<th>å­—èŠ‚</th>
</tr>
</thead>
<tbody><tr>
<td>äºº</td>
<td>150å²ä¹‹å†…</td>
<td>unsigned tinyint</td>
<td>0ï½255</td>
<td>1</td>
</tr>
<tr>
<td>é¾Ÿ</td>
<td>æ•°ç™¾å²</td>
<td>unsigned smallint</td>
<td>0ï½65535</td>
<td>2</td>
</tr>
<tr>
<td>æé¾™åŒ–çŸ³</td>
<td>æ•°åƒä¸‡å²</td>
<td>unsigned int</td>
<td>0ï½4294967295</td>
<td>4</td>
</tr>
<tr>
<td>å¤ªé˜³</td>
<td>çº¦50äº¿å¹´</td>
<td>unsigned bigint</td>
<td>0ï½2^64-1</td>
<td>8</td>
</tr>
</tbody></table>
</li>
<li><p>æ ¹æ®ä¸šåŠ¡åŒºåˆ†ä½¿ç”¨ <code>char</code>ã€<code>varchar</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  å­—æ®µé•¿åº¦å›ºå®šï¼Œæˆ–è€…é•¿åº¦è¿‘ä¼¼çš„ä¸šåŠ¡åœºæ™¯ï¼Œé€‚åˆä½¿ç”¨charï¼Œèƒ½å¤Ÿå‡å°‘ç¢ç‰‡ï¼ŒæŸ¥è¯¢æ€§èƒ½é«˜</span><br><span class="line">â‘¡ å­—æ®µé•¿åº¦ç›¸å·®è¾ƒå¤§ï¼Œæˆ–è€…æ›´æ–°è¾ƒå°‘çš„ä¸šåŠ¡åœºæ™¯ï¼Œé€‚åˆä½¿ç”¨varcharï¼ŒèŠ‚çœç£ç›˜ç©ºé—´</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ ¹æ®ä¸šåŠ¡åŒºåˆ†ä½¿ç”¨ <code>datetime</code>ã€<code>timestamp</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  å‰è€…å ç”¨<span class="number">8</span>ä¸ªå­—èŠ‚ï¼Œåè€…å ç”¨<span class="number">4</span>ä¸ªå­—èŠ‚ï¼Œå­˜å‚¨å¹´ä½¿ç”¨YEARï¼Œå­˜å‚¨æ—¥æœŸä½¿ç”¨DATEï¼Œå­˜å‚¨æ—¶é—´ä½¿ç”¨datetime</span><br></pre></td></tr></table></figure>
</li>
<li><p>å°æ•°ç±»å‹ä½¿ç”¨ <code>decimal</code>ï¼Œç¦æ­¢ä½¿ç”¨ <code>float</code> å’Œ <code>double</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  floatå’Œdoubleåœ¨å­˜å‚¨çš„æ—¶å€™ï¼Œå­˜åœ¨ç²¾åº¦æŸå¤±çš„é—®é¢˜ï¼Œå¾ˆå¯èƒ½åœ¨å€¼çš„æ¯”è¾ƒæ—¶ï¼Œå¾—åˆ°ä¸æ­£ç¡®çš„ç»“æœ</span><br><span class="line">â‘¡ decimal(M,D)ï¼Œå¦‚æœM&gt;Dï¼Œå ç”¨å­—èŠ‚M+<span class="number">2</span>ï¼Œå¦åˆ™ä¸ºD+<span class="number">2</span>ï¼ŒMæ˜¯æ•°å­—æœ€å¤§ä½æ•°ï¼ŒDæ˜¯å°æ•°ç‚¹å³ä¾§æ•°å­—ä¸ªæ•°</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¡¨å¿…é¡»æœ‰ä¸»é”®ï¼Œæ¨èä½¿ç”¨ <code>unsigned</code> æ•´æ•°ä¸ºä¸»é”®</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  åˆ é™¤æ— ä¸»é”®çš„è¡¨ï¼Œå¦‚æœæ˜¯rowæ¨¡å¼çš„ä¸»ä»æ¶æ„ï¼Œä»åº“ä¼šæŒ‚ä½</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ›å»ºæ˜¯å¦æ¦‚å¿µå­—æ®µï¼Œå¿…é¡»ä½¿ç”¨ <code>is_xxx</code> çš„æ–¹å¼å‘½åï¼Œæ•°æ®ç±»å‹æ˜¯ <code>unsigned tinyint</code>ï¼ˆ 1è¡¨ç¤ºæ˜¯ï¼Œ0è¡¨ç¤ºå¦ï¼‰</p>
</li>
<li><p>è¡¨å¿…å¤‡ä¸‰å­—æ®µï¼š<code>id</code>ï¼Œ<code>gmt_create</code>ï¼Œ<code>gmt_modified</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  idå¿…ä¸ºä¸»é”®ï¼Œç±»å‹ä¸ºunsigned bigintï¼Œå•è¡¨æ—¶è‡ªå¢ï¼Œæ­¥é•¿ä¸º<span class="number">1</span></span><br><span class="line">â‘¡ gmt_create, gmt_modifiedç±»å‹å‡ä¸ºdatetimeï¼Œå‰è€…ç°åœ¨æ—¶è¡¨ç¤ºä¸»åŠ¨åˆ›å»ºï¼Œåè€…è¿‡å»åˆ†è¯è¡¨ç¤ºè¢«åŠ¨æ›´æ–°</span><br></pre></td></tr></table></figure>
</li>
<li><p>å­—æ®µå®šä¹‰å¿…é¡»ä¸º <code>NOT NULL</code> ï¼Œå¹¶è®¾é»˜è®¤å€¼</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  NULLåˆ—ä½¿ç”¨ç´¢å¼•ï¼Œä¼šå½±å“ä¼˜åŒ–å™¨é€‰æ‹©æ‰§è¡Œè®¡åˆ’ï¼Œå¾ˆéš¾ä¼˜åŒ–</span><br><span class="line">â‘¡ NULLåªèƒ½é‡‡ç”¨IS NULLæˆ–è€…IS NOT NULLï¼Œè€Œåœ¨ä½¿ç”¨=ã€!=ã€<span class="keyword">in</span>ã€not <span class="keyword">in</span>æ—¶æœ‰å¤§å‘</span><br><span class="line">â‘¢ æ•°å€¼é»˜è®¤å€¼è®¾ç½®ä¸º<span class="number">0</span>ï¼Œå­—ç¬¦ä¸²é»˜è®¤å€¼è®¾ç½®ä¸º<span class="string">''</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨ <code>unsigned int</code> å­˜å‚¨ <code>IPv4</code>ï¼Œä¸è¦ç”¨ <code>char(15)</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œchar(<span class="number">15</span>)å æ®<span class="number">16</span>ä¸ªå­—èŠ‚ï¼Œunsigned intåªéœ€è¦<span class="number">4</span>ä¸ªå­—èŠ‚</span><br><span class="line">â‘¡ intå‹åœ¨é€»è¾‘è¿ç®—ä¸Šï¼Œæ¯”charé€Ÿåº¦å¿«</span><br><span class="line">â‘¢ ipå’Œæ•°å­—è½¬æ¢ï¼Œå‡½æ•°ç®—æ³•ï¼šinet_aton()å’Œinet_ntoa()</span><br><span class="line"></span><br><span class="line">mysql&gt; select inet_aton(<span class="string">'192.168.1.200'</span>);</span><br><span class="line">+----------------------------+</span><br><span class="line">| inet_aton(<span class="string">'192.168.1.200'</span>) |</span><br><span class="line">+----------------------------+</span><br><span class="line">|                 <span class="number">3232235976</span> |</span><br><span class="line">+----------------------------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select inet_ntoa(<span class="string">'3232235976'</span>);</span><br><span class="line">+-------------------------+</span><br><span class="line">| inet_ntoa(<span class="string">'3232235976'</span>) |</span><br><span class="line">+-------------------------+</span><br><span class="line">| <span class="number">192.168</span>.<span class="number">1.200</span>           |</span><br><span class="line">+-------------------------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨ <code>varchar(20)</code> å­˜å‚¨æ‰‹æœºå·ï¼Œä¸è¦ä½¿ç”¨æ•´æ•°</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  ç‰µæ‰¯åˆ°å›½å®¶ä»£å·ï¼Œå¯èƒ½å‡ºç°+/-/()ç­‰å­—ç¬¦ï¼Œä¾‹å¦‚+<span class="number">86</span></span><br><span class="line">â‘¡ æ‰‹æœºå·ä¸ä¼šç”¨æ¥åšæ•°å­¦è¿ç®—</span><br><span class="line">â‘¢ varcharå¯ä»¥æ¨¡ç³ŠæŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼šlike <span class="string">'138%'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ§åˆ¶å•è¡¨æ•°æ®é‡ï¼Œå•è¡¨æ•°æ®æ§åˆ¶åœ¨<strong>åƒä¸‡çº§</strong></p>
</li>
<li><p>æµ‹è¯•ã€å¼€å‘ã€çº¿ä¸Šæ•°æ®åº“ç¯å¢ƒå¿…é¡»éš”ç¦»</p>
</li>
<li><p>æ•°æ®è¡¨ã€æ•°æ®å­—æ®µè¦æœ‰ä¸­æ–‡æ³¨é‡Š</p>
</li>
</ul>
<h2 id="SQLè§„èŒƒ"><a href="#SQLè§„èŒƒ" class="headerlink" title="SQLè§„èŒƒ"></a>SQLè§„èŒƒ</h2><ul>
<li><p>ç¦æ­¢ä½¿ç”¨ <code>select *</code>ï¼Œåªè·å–å¿…è¦å­—æ®µ</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  select*ä¼šå¢åŠ cpu/io/å†…å­˜/å¸¦å®½çš„æ¶ˆè€—</span><br><span class="line">â‘¡ æŒ‡å®šå­—æ®µèƒ½æœ‰æ•ˆåˆ©ç”¨ç´¢å¼•è¦†ç›–</span><br><span class="line">â‘¢ æŒ‡å®šå­—æ®µæŸ¥è¯¢ï¼Œåœ¨è¡¨ç»“æ„å˜æ›´æ—¶ï¼Œèƒ½ä¿è¯å¯¹åº”ç”¨ç¨‹åºæ— å½±å“</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¦æ­¢åœ¨ <code>where</code> æ¡ä»¶åˆ—ä½¿ç”¨å‡½æ•°æˆ–è€…è¡¨è¾¾å¼</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  å¯¼è‡´ä¸èƒ½å‘½ä¸­ç´¢å¼•ï¼Œå…¨è¡¨æ‰«æ</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¦æ­¢è´Ÿå‘æŸ¥è¯¢ï¼Œä»¥åŠ <code>%</code> å¼€å¤´çš„æ¨¡ç³ŠæŸ¥è¯¢</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  è´Ÿå‘æŸ¥è¯¢æ¡ä»¶ï¼šNOTã€!=ã€&lt;&gt;ã€!&lt;ã€!&gt;ã€NOT <span class="keyword">IN</span>ã€NOT LIKEç­‰ï¼Œä¼šå¯¼è‡´å…¨è¡¨æ‰«æ</span><br><span class="line">â‘¡ %å¼€å¤´çš„æ¨¡ç³ŠæŸ¥è¯¢ï¼Œä¼šå¯¼è‡´å…¨è¡¨æ‰«æ</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸å¾—ä½¿ç”¨å¤–é”®ä¸çº§è”ï¼Œä¸€åˆ‡å¤–é”®æ¦‚å¿µå¿…é¡»åœ¨åº”ç”¨å±‚è§£å†³</p>
</li>
<li><p><code>count(*)</code> ä¼šç»Ÿè®¡å€¼ä¸º <code>null</code> çš„è¡Œï¼Œè€Œ <code>count(åˆ—å)</code> ä¸ä¼šç»Ÿè®¡æ­¤åˆ—ä¸º <code>null</code> å€¼çš„è¡Œ</p>
</li>
<li><p>æ•°æ®è®¢æ­£ï¼ˆ<code>delete</code>ã€<code>update</code> æ“ä½œï¼‰æ—¶ï¼Œè¦å…ˆ <code>select</code>ï¼Œé¿å…å‡ºç°è¯¯åˆ é™¤ï¼Œç¡®è®¤æ— è¯¯æ‰èƒ½æ‰§è¡Œæ›´æ–°è¯­å¥</p>
</li>
<li><p>æ¨èä½¿ç”¨ <code>truncate</code>ï¼Œé€Ÿåº¦æ¯” <code>delete</code> å¿«ï¼Œä¸”ä½¿ç”¨çš„ç³»ç»Ÿå’Œäº‹åŠ¡æ—¥å¿—èµ„æºå°‘</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  truncate tableåœ¨åŠŸèƒ½ä¸Šä¸ä¸å¸¦whereå­å¥çš„deleteè¯­å¥ç›¸åŒ</span><br><span class="line">â‘¡ truncateæ— äº‹åŠ¡ä¸”ä¸è§¦å‘triggerï¼Œæœ‰å¯èƒ½é€ æˆäº‹æ•…</span><br></pre></td></tr></table></figure>
</li>
<li><p>é¿å… <code>in</code> æ“ä½œï¼Œè‹¥å®åœ¨é¿å…ä¸äº†ï¼Œéœ€è¦ä»”ç»†è¯„ä¼° <code>in</code> åè¾¹çš„é›†åˆå…ƒç´ æ•°é‡ï¼Œæ§åˆ¶åœ¨ <code>1000</code> ä¸ªä¹‹å†…</p>
</li>
<li><p>æ¨è <code>or</code> æ”¹å†™ä¸º <code>union</code></p>
</li>
</ul>
<h2 id="ç´¢å¼•è§„èŒƒ"><a href="#ç´¢å¼•è§„èŒƒ" class="headerlink" title="ç´¢å¼•è§„èŒƒ"></a>ç´¢å¼•è§„èŒƒ</h2><ul>
<li><p>å”¯ä¸€ç´¢å¼•ä½¿ç”¨ <code>uniq_[å­—æ®µå]</code> æ¥å‘½åï¼Œéå”¯ä¸€ç´¢å¼•ä½¿ç”¨ <code>idx_[å­—æ®µå]</code> æ¥å‘½å</p>
</li>
<li><p>å•å¼ è¡¨ç´¢å¼•æ•°é‡å»ºè®®æ§åˆ¶åœ¨ <code>5</code> ä¸ªä»¥å†…</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  é«˜å¹¶å‘ä¸šåŠ¡ï¼Œå¤ªå¤šç´¢å¼•ä¼šå½±å“å†™æ€§èƒ½</span><br><span class="line">â‘¡ ç”Ÿæˆæ‰§è¡Œè®¡åˆ’æ—¶ï¼Œå¦‚æœç´¢å¼•å¤ªå¤šï¼Œä¼šé™ä½æ€§èƒ½ï¼Œå¹¶å¯èƒ½å¯¼è‡´MySQLé€‰æ‹©ä¸åˆ°æœ€ä¼˜ç´¢å¼•</span><br><span class="line">â‘¢ å¼‚å¸¸å¤æ‚çš„æŸ¥è¯¢éœ€æ±‚ï¼Œå¯ä»¥é€‰æ‹©ESç­‰æ›´ä¸ºé€‚åˆçš„æ–¹å¼å­˜å‚¨</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¶…è¿‡ä¸‰ä¸ªè¡¨ç¦æ­¢ <code>join</code>ï¼Œéœ€è¦ <code>join</code> çš„å­—æ®µï¼Œæ•°æ®ç±»å‹å¿…é¡»ç»å¯¹ä¸€è‡´ï¼Œå¤šè¡¨å…³è”æŸ¥è¯¢æ—¶ï¼Œç¡®ä¿è¢«å…³è”çš„å­—æ®µéœ€è¦æœ‰ç´¢å¼•</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  è¸©è¿‡å› ä¸ºjoinå­—æ®µç±»å‹ä¸ä¸€è‡´ï¼Œè€Œå¯¼è‡´å…¨è¡¨æ‰«æçš„å‘</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¦æ­¢åœ¨æ›´æ–°ååˆ†é¢‘ç¹ï¼ŒåŒºåˆ†åº¦ä¸é«˜çš„å­—æ®µå»ºç«‹ç´¢å¼•</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  æ›´æ–°ä¼šå˜æ›´B+æ ‘ï¼Œæ›´æ–°é¢‘ç¹çš„å­—æ®µå»ºç«‹ç´¢å¼•ä¼šå¤§å¤§é™ä½æ•°æ®åº“æ€§èƒ½</span><br><span class="line">â‘¡ åŒºåˆ†åº¦ï¼šcount(distinct left(åˆ—å, ç´¢å¼•é•¿åº¦))/count(*)</span><br><span class="line">â‘¢ æ€§åˆ«ä¸é€‚åˆå»ºç´¢å¼•</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç†è§£ç»„åˆç´¢å¼•æœ€å·¦å‰ç¼€åŸåˆ™ï¼Œé¿å…é‡å¤å»ºç´¢å¼•ï¼Œå¦‚æœå»ºäº† <code>(a,b,c)</code>ï¼Œç›¸å½“äºå»ºäº† <code>(a)</code>ï¼Œ<code>(a,b)</code>ï¼Œ<code>(a,b,c)</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  ç¤ºä¾‹ï¼šwhere a=? and b=? order by c; ç´¢å¼•ï¼ša_b_c</span><br><span class="line">â‘¡ å­˜åœ¨éç­‰å·å’Œç­‰å·æ··åˆåˆ¤æ–­æ¡ä»¶æ—¶ï¼Œåœ¨å»ºç´¢å¼•æ—¶æŠŠç­‰å·æ¡ä»¶çš„åˆ—å‰ç½®ã€‚å¦‚ï¼šwhere a&gt;? and b=? é‚£ä¹ˆå³ä½¿açš„åŒºåˆ†åº¦æ›´é«˜ï¼Œä¹Ÿå¿…é¡»æŠŠbæ”¾åœ¨ç´¢å¼•çš„æœ€å‰åˆ—</span><br></pre></td></tr></table></figure>
</li>
<li><p>é¿å…å› å­—æ®µç±»å‹ä¸åŒé€ æˆçš„éšå¼è½¬æ¢ï¼Œå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</p>
</li>
<li><p>SQLæ€§èƒ½ä¼˜åŒ–çš„ç›®æ ‡ï¼šè‡³å°‘è¦è¾¾åˆ° <code>range</code> çº§åˆ«ï¼Œè¦æ±‚æ˜¯ <code>ref</code> çº§åˆ«ï¼Œå¦‚æœå¯ä»¥æ˜¯ <code>consts</code> æœ€å¥½</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è§£è¯»ï¼š</span><br><span class="line">â‘  constså•è¡¨ä¸­æœ€å¤šåªæœ‰ä¸€ä¸ªåŒ¹é…è¡Œï¼ˆä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•ï¼‰ï¼Œåœ¨ä¼˜åŒ–é˜¶æ®µå³å¯è¯»å–åˆ°æ•°æ®</span><br><span class="line">â‘¡ refæŒ‡çš„æ˜¯ä½¿ç”¨æ™®é€šçš„ç´¢å¼•ï¼ˆnormal indexï¼‰</span><br><span class="line">â‘¢ rangeå¯¹ç´¢å¼•è¿›è¡ŒèŒƒå›´æ£€ç´¢</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p><strong>å‚è€ƒ</strong></p>
</blockquote>
<p>ã€Š<a href="https://mp.weixin.qq.com/s/YfCORbcCX1hymXBCrZbAZg" target="_blank" rel="noopener"><strong>58åˆ°å®¶ Â· MySQLå†›è§„</strong></a>ã€‹</p>
<p>ã€Š<a href="https://www.cntofu.com/book/78/p3c-gitbook/" target="_blank" rel="noopener"><strong>é˜¿é‡Œå·´å·´ Â· Javaå¼€å‘æ‰‹å†Œ</strong></a>ã€‹</p>
<p>â€‹    </p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· åŸºæœ¬åŸç†</title>
    <url>/blog/2019/07/23/mysql-principle/</url>
    <content><![CDATA[<h2 id="ä½“ç³»æ¶æ„"><a href="#ä½“ç³»æ¶æ„" class="headerlink" title="ä½“ç³»æ¶æ„"></a>ä½“ç³»æ¶æ„</h2><p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134135.png" alt></p>
<p><img src="http://ww4.sinaimg.cn/large/006tNc79ly1g5te8biz9hj30ne0fj404.jpg" alt="img"></p>
<h2 id="æ•°æ®å­˜å‚¨"><a href="#æ•°æ®å­˜å‚¨" class="headerlink" title="æ•°æ®å­˜å‚¨"></a>æ•°æ®å­˜å‚¨</h2><h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><p><code>InnoDB</code> å­˜å‚¨å¼•æ“å¯å°†æ‰€æœ‰æ•°æ®å­˜æ”¾äº <code>ibdata*</code> çš„å…±äº«è¡¨ç©ºé—´ï¼Œä¹Ÿå¯å°†æ¯å¼ è¡¨å­˜æ”¾äºç‹¬ç«‹çš„ <code>.ibd</code> æ–‡ä»¶çš„ç‹¬ç«‹è¡¨ç©ºé—´ã€‚å…±äº«è¡¨ç©ºé—´ä»¥åŠç‹¬ç«‹è¡¨ç©ºé—´éƒ½æ˜¯é’ˆå¯¹æ•°æ®çš„å­˜å‚¨æ–¹å¼è€Œè¨€çš„ã€‚</p>
<p><strong>å…±äº«è¡¨ç©ºé—´:</strong>  æŸä¸€ä¸ªæ•°æ®åº“çš„æ‰€æœ‰çš„è¡¨æ•°æ®ï¼Œç´¢å¼•æ–‡ä»¶å…¨éƒ¨æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œé»˜è®¤è¿™ä¸ªå…±äº«è¡¨ç©ºé—´çš„æ–‡ä»¶è·¯å¾„åœ¨ <code>data</code> ç›®å½•ä¸‹ï¼Œ é»˜è®¤çš„æ–‡ä»¶åä¸º <code>ibdata1</code>ï¼Œåˆå§‹åŒ–ä¸º <code>10M</code>ã€‚</p>
<p><strong>ç‹¬ç«‹è¡¨ç©ºé—´:</strong>  æ¯ä¸€ä¸ªè¡¨éƒ½å°†ä¼šç”Ÿæˆä»¥ç‹¬ç«‹çš„æ–‡ä»¶æ–¹å¼æ¥è¿›è¡Œå­˜å‚¨ï¼Œæ¯ä¸€ä¸ªè¡¨éƒ½æœ‰ä¸€ä¸ª <code>.frm</code> è¡¨æè¿°æ–‡ä»¶ï¼Œè¿˜æœ‰ä¸€ä¸ª <code>.ibd</code> æ–‡ä»¶ã€‚ å…¶ä¸­è¿™ä¸ªæ–‡ä»¶åŒ…æ‹¬äº†å•ç‹¬ä¸€ä¸ªè¡¨çš„æ•°æ®å†…å®¹ä»¥åŠç´¢å¼•å†…å®¹ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒçš„å­˜å‚¨ä½ç½®ä¹Ÿæ˜¯åœ¨è¡¨çš„ä½ç½®ä¹‹ä¸­ã€‚</p>
<h3 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><p><strong>å…±äº«è¡¨ç©ºé—´</strong></p>
<p><strong>ä¼˜ç‚¹ï¼š</strong>å¯ä»¥å°†è¡¨ç©ºé—´åˆ†æˆå¤šä¸ªæ–‡ä»¶å­˜æ”¾åˆ°å„ä¸ªç£ç›˜ä¸Šï¼ˆè¡¨ç©ºé—´æ–‡ä»¶å¤§å°ä¸å—è¡¨å¤§å°çš„é™åˆ¶ï¼Œå¦‚ä¸€ä¸ªè¡¨å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„æ–‡ä»¶ä¸Šï¼‰ï¼Œæ•°æ®å’Œæ–‡ä»¶æ”¾åœ¨ä¸€èµ·æ–¹ä¾¿ç®¡ç†ã€‚</p>
<p><strong>ç¼ºç‚¹</strong>ï¼šæ‰€æœ‰çš„æ•°æ®å’Œç´¢å¼•å­˜æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè™½ç„¶å¯ä»¥æŠŠä¸€ä¸ªå¤§æ–‡ä»¶åˆ†æˆå¤šä¸ªå°æ–‡ä»¶ï¼Œä½†æ˜¯å¤šä¸ªè¡¨åŠç´¢å¼•åœ¨è¡¨ç©ºé—´ä¸­æ··åˆå­˜å‚¨ï¼Œè¿™æ ·å¯¹äºä¸€ä¸ªè¡¨åšäº†å¤§é‡åˆ é™¤æ“ä½œåè¡¨ç©ºé—´ä¸­å°†ä¼šæœ‰å¤§é‡çš„ç©ºéš™ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç»Ÿè®¡åˆ†æè¿™ç±»åº”ç”¨æœ€ä¸é€‚åˆç”¨å…±äº«è¡¨ç©ºé—´ã€‚</p>
<p><strong>ç‹¬ç«‹è¡¨ç©ºé—´</strong>ï¼šåœ¨é…ç½®æ–‡ä»¶ï¼ˆ<code>my.cnf</code>ï¼‰ä¸­è®¾ç½® <code>innodb_file_per_table</code></p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>æ¯ä¸ªè¡¨éƒ½æœ‰è‡ªå·²ç‹¬ç«‹çš„è¡¨ç©ºé—´ã€‚</li>
<li>æ¯ä¸ªè¡¨çš„æ•°æ®å’Œç´¢å¼•éƒ½ä¼šå­˜åœ¨è‡ªå·²çš„è¡¨ç©ºé—´ä¸­ã€‚</li>
<li>å¯ä»¥å®ç°å•è¡¨åœ¨ä¸åŒçš„æ•°æ®åº“ä¸­ç§»åŠ¨ã€‚</li>
<li>ç©ºé—´å¯ä»¥å›æ”¶ï¼ˆé™¤ drop table æ“ä½œå¤„ï¼Œè¡¨ç©ºä¸èƒ½è‡ªå·²å›æ”¶ï¼‰ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹</strong></p>
<ul>
<li>å•è¡¨å¢åŠ è¿‡å¤§ï¼Œå¦‚è¶…è¿‡100Gã€‚</li>
<li>ç›¸æ¯”è¾ƒä¹‹ä¸‹ï¼Œä½¿ç”¨ç‹¬å è¡¨ç©ºé—´çš„æ•ˆç‡ä»¥åŠæ€§èƒ½ä¼šæ›´é«˜ä¸€ç‚¹ã€‚</li>
</ul>
<h3 id="å‚æ•°è¯¦è§£"><a href="#å‚æ•°è¯¦è§£" class="headerlink" title="å‚æ•°è¯¦è§£"></a>å‚æ•°è¯¦è§£</h3><table>
<thead>
<tr>
<th>Command-Line Format</th>
<th><code>--innodb_file_per_table</code></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>System Variable</td>
<td>Name</td>
<td><code>innodb_file_per_table</code></td>
</tr>
<tr>
<td>Variable Scope</td>
<td>Global</td>
<td></td>
</tr>
<tr>
<td>Dynamic Variable</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td><strong>Permitted Values (&lt;= 5.6.5)</strong></td>
<td>Type</td>
<td><code>boolean</code></td>
</tr>
<tr>
<td>Default</td>
<td><code>OFF</code></td>
<td></td>
</tr>
<tr>
<td><strong>Permitted Values (&gt;= 5.6.6)</strong></td>
<td>Type</td>
<td><code>boolean</code></td>
</tr>
<tr>
<td>Default</td>
<td><code>ON</code></td>
<td></td>
</tr>
</tbody></table>
<p>ä¿®æ”¹ InnoDB æ•°æ®å­˜å‚¨æ–¹å¼ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; set global innodb_file_per_table =ON;  </span><br><span class="line">mysql&gt; show variables like '%per_table%';  </span><br><span class="line">+<span class="comment">-----------------------+-------+  </span></span><br><span class="line">| Variable_name         | Value |  </span><br><span class="line">+<span class="comment">-----------------------+-------+  </span></span><br><span class="line">| innodb_file_per_table | ON    |  </span><br><span class="line">+<span class="comment">-----------------------+-------+</span></span><br></pre></td></tr></table></figure>

<p>æƒ³è¦å°†å…±äº«è¡¨ç©ºé—´è½¬åŒ–ä¸ºç‹¬ç«‹è¡¨ç©ºé—´æœ‰ä¸¤ç§æ–¹æ³•ï¼š    </p>
<ol>
<li><p>å…ˆé€»è¾‘å¤‡ä»½ï¼Œç„¶åä¿®æ”¹é…ç½®æ–‡ä»¶ <code>my.cnf</code> ä¸­çš„å‚æ•° <code>innodb_file_per_table</code> å‚æ•°ä¸º <code>1</code>ï¼Œé‡å¯æœåŠ¡åå°†é€»è¾‘å¤‡ä»½å¯¼å…¥å³å¯ã€‚    </p>
</li>
<li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ <code>my.cnf</code> ä¸­çš„å‚æ•° <code>innodb_file_per_table</code> å‚æ•°ä¸º <code>1</code>ï¼Œé‡å¯æœåŠ¡åå°†éœ€è¦ä¿®æ”¹çš„æ‰€æœ‰ <code>innodb</code> è¡¨éƒ½æ‰§è¡Œä¸€éï¼š<code>alter table table_name engine=innodb;</code> ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ä¿®æ”¹åï¼ŒåŸæ¥åº“ä¸­çš„è¡¨ä¸­çš„æ•°æ®ä¼šç»§ç»­å­˜æ”¾äº <code>ibdata1</code> ä¸­ï¼Œæ–°å»ºçš„è¡¨æ‰ä¼šä½¿ç”¨ç‹¬ç«‹è¡¨ç©ºé—´ã€‚</p>
</li>
</ol>
<h3 id="æ“ä½œå®æˆ˜"><a href="#æ“ä½œå®æˆ˜" class="headerlink" title="æ“ä½œå®æˆ˜"></a>æ“ä½œå®æˆ˜</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯¼å‡ºæ‰€æœ‰æ•°æ®</span></span><br><span class="line">mysqldump -u &lt;user&gt; -p &lt;password&gt; --all-databases --master-data=<span class="number">2</span> --single-transaction &gt; backup.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰æ•°æ®åº“ </span></span><br><span class="line">drop database database_N</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢MySQLæœåŠ¡</span></span><br><span class="line">service mysql stop  / service mariadb stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æ–‡ä»¶ ibdata1, ib_logfile0, ib_logfile1</span></span><br><span class="line">rm -rf xxx</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹MySQLé…ç½®æ–‡ä»¶/etc/my.cnfï¼Œå¢åŠ æˆ–ä¿®æ”¹å¦‚ä¸‹ï¼š</span></span><br><span class="line">[mysqld]</span><br><span class="line">innodb_file_per_table=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯MySQLæœåŠ¡</span></span><br><span class="line">service mysql start</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥å¤‡ä»½æ•°æ®</span></span><br><span class="line">mysql -u &lt;user&gt; -p &lt;password&gt; &lt; backup.sql</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>æµ…è°ˆæ•°æ®åº“è®¾è®¡</title>
    <url>/blog/2019/07/22/db-design/</url>
    <content><![CDATA[<h2 id="æ•°æ®åº“è®¾è®¡"><a href="#æ•°æ®åº“è®¾è®¡" class="headerlink" title="æ•°æ®åº“è®¾è®¡"></a>æ•°æ®åº“è®¾è®¡</h2><p><strong>è®¾è®¡åŸåˆ™</strong>ï¼šåœ¨æ•°æ®å†—ä½™å’Œå¤„ç†é€Ÿåº¦ä¹‹é—´æ‰¾åˆ°åˆé€‚çš„å¹³è¡¡ç‚¹ã€‚</p>
<ul>
<li><p>æ•°æ®åº“è¡¨ä¸ªæ•°è¶Šå°‘è¶Šå¥½ã€‚</p>
</li>
<li><p>è¡¨ä¸­ç»„åˆä¸»é”®çš„å­—æ®µä¸ªæ•°è¶Šå°‘è¶Šå¥½ã€‚ä¸»é”®çš„ä½œç”¨ï¼Œä¸€æ˜¯å»ºä¸»é”®ç´¢å¼•ï¼ŒäºŒæ˜¯åšä¸ºå­è¡¨çš„å¤–é”®ï¼Œæ‰€ä»¥ç»„åˆä¸»é”®çš„å­—æ®µä¸ªæ•°å°‘äº†ï¼Œä¸ä»…èŠ‚çœäº†è¿è¡Œæ—¶é—´ï¼Œè€Œä¸”èŠ‚çœäº†ç´¢å¼•å­˜å‚¨ç©ºé—´ã€‚</p>
</li>
<li><p>3ï¼‰ä¸€ä¸ªè¡¨ä¸­çš„å­—æ®µä¸ªæ•°è¶Šå°‘è¶Šå¥½ã€‚</p>
</li>
</ul>
<p><strong>è®¾è®¡æ¨¡å¼</strong></p>
<ul>
<li><p>é€»è¾‘è®¾è®¡ï¼šæ ¹æ®æ•°æ®å®ä½“ä¹‹é—´çš„é€»è¾‘å…³ç³»å¯¹è¡¨è¿›è¡Œè®¾è®¡ã€‚</p>
</li>
<li><p>ç‰©ç†è®¾è®¡ï¼šæ ¹æ®æ‰€ä½¿ç”¨çš„æ•°æ®åº“ç‰¹ç‚¹è¿›è¡Œè¡¨ç»“æ„è®¾è®¡ã€‚</p>
</li>
</ul>
<p><strong>èŒƒå¼è®¾è®¡</strong></p>
<ul>
<li><strong>ç¬¬ä¸€èŒƒå¼</strong>ï¼šæ˜¯å¯¹å±æ€§çš„åŸå­æ€§çº¦æŸï¼Œè¦æ±‚å±æ€§å…·æœ‰åŸå­æ€§ï¼Œä¸å¯å†åˆ†è§£ã€‚</li>
<li><strong>ç¬¬äºŒèŒƒå¼</strong>ï¼šæ˜¯å¯¹è®°å½•çš„æƒŸä¸€æ€§çº¦æŸï¼Œè¦æ±‚è®°å½•æœ‰æƒŸä¸€æ ‡è¯†ï¼Œå³å®ä½“çš„æƒŸä¸€æ€§ã€‚</li>
<li><strong>ç¬¬ä¸‰èŒƒå¼</strong>ï¼šæ˜¯å¯¹å­—æ®µå†—ä½™æ€§çš„çº¦æŸï¼Œå³ä»»ä½•å­—æ®µä¸èƒ½ç”±å…¶ä»–å­—æ®µæ´¾ç”Ÿå‡ºæ¥ï¼Œå®ƒè¦æ±‚å­—æ®µæ²¡æœ‰å†—ä½™ã€‚</li>
</ul>
<p>åŸºæœ¬è¡¨åŠå…¶å­—æ®µä¹‹é—´çš„å…³ç³»ï¼Œåº”å°½é‡æ»¡è¶³ç¬¬ä¸‰èŒƒå¼ã€‚ä½†æ˜¯ï¼Œæ»¡è¶³ç¬¬ä¸‰èŒƒå¼çš„æ•°æ®åº“è®¾è®¡ï¼Œå¾€å¾€ä¸æ˜¯æœ€å¥½çš„è®¾è®¡ã€‚ä¸ºäº†æé«˜æ•°æ®åº“çš„è¿è¡Œæ•ˆç‡ï¼Œå¸¸å¸¸éœ€è¦é™ä½èŒƒå¼æ ‡å‡†ï¼Œé€‚å½“å¢åŠ å†—ä½™ï¼Œè¾¾åˆ°ä»¥ç©ºé—´æ¢æ—¶é—´çš„ç›®çš„ã€‚</p>
<h3 id="é€»è¾‘è®¾è®¡"><a href="#é€»è¾‘è®¾è®¡" class="headerlink" title="é€»è¾‘è®¾è®¡"></a>é€»è¾‘è®¾è®¡</h3><p>E-R æ¨¡å‹å›¾ï¼šç»“æ„æ¸…æ™°ã€å…³è”ç®€æ´ã€å®ä½“ä¸ªæ•°é€‚ä¸­ã€å±æ€§åˆ†é…åˆç†ã€æ²¡æœ‰ä½çº§å†—ä½™</p>
<h3 id="ç‰©ç†è®¾è®¡"><a href="#ç‰©ç†è®¾è®¡" class="headerlink" title="ç‰©ç†è®¾è®¡"></a>ç‰©ç†è®¾è®¡</h3><h4 id="æ•°æ®åº“ç±»å‹"><a href="#æ•°æ®åº“ç±»å‹" class="headerlink" title="æ•°æ®åº“ç±»å‹"></a>æ•°æ®åº“ç±»å‹</h4><table>
<thead>
<tr>
<th>æ•°æ®åº“ç±»å‹</th>
<th>æˆæœ¬</th>
<th>å¼€å‘è¯­è¨€</th>
<th>æ”¯æŒç³»ç»Ÿ</th>
<th>ä¸šåŠ¡åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td>Oracle</td>
<td>å•†ä¸šå‹</td>
<td>phpï¼Œjavaï¼Œpythonç­‰</td>
<td>windows/liunxç³»ç»Ÿ</td>
<td>ä¼ä¸šçº§</td>
</tr>
<tr>
<td>SQLServer</td>
<td>å•†ä¸šå‹</td>
<td>.NETï¼ŒC#ç­‰</td>
<td>åªæ”¯æŒwindowsç³»ç»Ÿ</td>
<td>ä¼ä¸šçº§</td>
</tr>
<tr>
<td>MySQL</td>
<td>å¼€æºå‹</td>
<td>phpï¼Œjavaï¼Œpythonç­‰</td>
<td>windows/liunxç³»ç»Ÿ</td>
<td>ä¸­å°å‹</td>
</tr>
<tr>
<td>PgSQL</td>
<td>å¼€æºå‹</td>
<td>phpï¼Œjavaï¼Œpythonç­‰</td>
<td>windows/liunxç³»ç»Ÿ</td>
<td>ä¸­å°å‹</td>
</tr>
</tbody></table>
<h4 id="å­˜å‚¨å¼•æ“"><a href="#å­˜å‚¨å¼•æ“" class="headerlink" title="å­˜å‚¨å¼•æ“"></a>å­˜å‚¨å¼•æ“</h4><table>
<thead>
<tr>
<th>å­˜å‚¨å¼•æ“</th>
<th>ç´¢å¼•</th>
<th>äº‹åŠ¡</th>
<th>é”ç²’åº¦</th>
<th>ä¸»è¦åº”ç”¨</th>
<th>å¿Œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>MyISAM</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒå¹¶å‘æ’å…¥çš„è¡¨çº§é”</td>
<td>selectï¼Œinserté«˜è´Ÿè½½</td>
<td>è¯»å†™å¹¶ç”¨</td>
</tr>
<tr>
<td>InnoDB</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒMVCCçš„è¡Œçº§é”</td>
<td>äº‹åŠ¡å¤„ç†</td>
<td>æ— </td>
</tr>
<tr>
<td>MEMORY</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>è¡¨é”</td>
<td>ä¸­é—´è®¡ç®—ï¼Œé™æ€æ•°æ®</td>
<td>å¤§å‹æ•°æ®é›†ï¼ŒæŒä¹…æ€§å­˜å‚¨</td>
</tr>
<tr>
<td>Archive</td>
<td>ä¸æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>è¡Œçº§é”</td>
<td>æ—¥å¿—è®°å½•ï¼Œèšåˆåˆ†æï¼Œåªæ”¯æŒselectï¼Œinsertæ“ä½œ</td>
<td>éšæœºè¯»å–ï¼Œåˆ é™¤</td>
</tr>
</tbody></table>
<h4 id="å­—æ®µé€‰æ‹©"><a href="#å­—æ®µé€‰æ‹©" class="headerlink" title="å­—æ®µé€‰æ‹©"></a>å­—æ®µé€‰æ‹©</h4><p><strong>char</strong> vs <strong>varchar</strong> </p>
<ul>
<li><p>charï¼šé€‚ç”¨äºæ•°æ®é•¿åº¦å·®ä¸å¤šä¸€è‡´ï¼Œæ³¢åŠ¨è¾ƒå°ï¼Œæœ€å¤§æ•°æ®é•¿åº¦å°äº50å­—èŠ‚ã€‚</p>
</li>
<li><p>varcharï¼šé€‚ç”¨äºæ•°æ®é•¿åº¦å˜åŒ–è¾ƒå¤§ï¼Œä¸èƒ½é¢„çŸ¥å…¶å…·ä½“é•¿åº¦çš„æ•°æ®ã€‚</p>
</li>
</ul>
<p><strong>decimal</strong> vs <strong>float</strong> </p>
<ul>
<li><p>decimalï¼šç”¨äºå­˜å‚¨ç²¾ç¡®æ•°æ®ï¼Œç²¾åº¦æœ€é«˜ï¼Œä½†æ˜¯å ç”¨ç©ºé—´å¾ˆå¤§ã€‚</p>
</li>
<li><p>floatï¼šç”¨äºå­˜å‚¨éç²¾ç¡®æ•°æ®ï¼Œä¼šä¸¢å¤±æ•°æ®ç²¾åº¦ï¼Œå ç”¨ç©ºé—´æ¯” decimal å°ã€‚</p>
</li>
</ul>
<p><strong>int</strong> vs <strong>timestamp</strong> vs <strong>datetime</strong> </p>
<table>
<thead>
<tr>
<th>å­—æ®µç±»å‹</th>
<th>å­˜å‚¨ç©ºé—´</th>
</tr>
</thead>
<tbody><tr>
<td>TINYINT</td>
<td>1 å­—èŠ‚</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>2 å­—èŠ‚</td>
</tr>
<tr>
<td>MEDIUMINY</td>
<td>3 å­—èŠ‚</td>
</tr>
<tr>
<td>INT</td>
<td>4 å­—èŠ‚</td>
</tr>
<tr>
<td>BINGINT</td>
<td>8 å­—èŠ‚</td>
</tr>
<tr>
<td>DATE</td>
<td>3 å­—èŠ‚</td>
</tr>
<tr>
<td>DATETIME</td>
<td>8 å­—èŠ‚</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>4 å­—èŠ‚</td>
</tr>
<tr>
<td>CHAR(M)</td>
<td>M å­—èŠ‚ï¼Œ1 &lt;= M &lt;= 255</td>
</tr>
<tr>
<td>VARCHAR(M)</td>
<td>L+1 å­—èŠ‚ï¼Œåœ¨æ­¤ L &lt;= M å’Œ  1 &lt;=M &lt;= 255</td>
</tr>
<tr>
<td>FLOAT</td>
<td>4 å­—èŠ‚</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>8 å­—èŠ‚</td>
</tr>
<tr>
<td>DECIMAL</td>
<td>å¯¹ DECIMAL(M,D) ï¼Œå¦‚æœ M&gt;Dï¼Œä¸º M+2 å¦åˆ™ä¸º D+2</td>
</tr>
</tbody></table>
<p>æŸ¥è¯¢é€Ÿåº¦ä»å¿«åˆ°æ…¢å¦‚ä¸‹ï¼šbigint &gt; date &gt; timestamp &gt; time &gt; datetime</p>
<h4 id="ä¸»é”®ä¸å¤–é”®"><a href="#ä¸»é”®ä¸å¤–é”®" class="headerlink" title="ä¸»é”®ä¸å¤–é”®"></a>ä¸»é”®ä¸å¤–é”®</h4><p>ä¸»é”®æ˜¯å®ä½“çš„é«˜åº¦æŠ½è±¡ï¼Œä¸»é”®ä¸å¤–é”®çš„é…å¯¹ï¼Œè¡¨ç¤ºå®ä½“ä¹‹é—´çš„è¿æ¥</p>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· å¼€å‘</title>
    <url>/blog/2019/07/22/mysql-develop/</url>
    <content><![CDATA[<h2 id="ç™¾ä¸‡çº§æ•°æ®é‡"><a href="#ç™¾ä¸‡çº§æ•°æ®é‡" class="headerlink" title="ç™¾ä¸‡çº§æ•°æ®é‡"></a>ç™¾ä¸‡çº§æ•°æ®é‡</h2><p>è¿™ä¸ªé˜¶æ®µçš„æ€§èƒ½é—®é¢˜å¼€å§‹æ˜¾éœ²ï¼Œä¼˜åŒ–å‡ ä¹æ˜¯æœ€é‡è¦çš„ï¼Œå› ä¸ºåˆ°åæœŸåƒä¸‡çº§ï¼Œç”šè‡³äº¿çº§åˆ«çš„é˜¶æ®µï¼Œæ•°æ®åº“å‡ ä¹æ— æ³•åŠ¨å¼¹ï¼Œå¯è°ƒæ•´æ€§å¾ˆä½ã€‚</p>
<p><strong>å­—æ®µä¼˜åŒ–</strong></p>
<ul>
<li>è¡¨å­—æ®µ not nullï¼Œå› ä¸º null å€¼å¾ˆéš¾æŸ¥è¯¢ä¼˜åŒ–ä¸”å ç”¨é¢å¤–çš„ç´¢å¼•ç©ºé—´ï¼Œæ¨èé»˜è®¤æ•°å­— 0</li>
<li>æ•°æ®çŠ¶æ€ç±»å‹çš„å­—æ®µï¼Œæ¯”å¦‚ status, type ç­‰ï¼Œå°½é‡ä¸è¦å®šä¹‰è´Ÿæ•°ï¼Œå¦‚ -1ã€‚å› ä¸ºè¿™æ ·å¯ä»¥åŠ ä¸Š UNSIGNEDï¼Œæ•°å€¼å®¹é‡å°±ä¼šæ‰©å¤§ä¸€å€</li>
<li>å¯ä»¥çš„è¯ç”¨ TINYINTã€SMALLINT ç­‰ä»£æ›¿ INTï¼Œå°½é‡ä¸ä½¿ç”¨ BIGINTï¼Œå› ä¸ºå çš„ç©ºé—´æ›´å°</li>
<li>å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µä¼šæ¯”æ•°å­—ç±»å‹å çš„ç©ºé—´æ›´å¤§ï¼Œæ‰€ä»¥å°½é‡ç”¨æ•´å‹ä»£æ›¿å­—ç¬¦ä¸²ï¼Œå¾ˆå¤šåœºæ™¯æ˜¯å¯ä»¥é€šè¿‡ç¼–ç é€»è¾‘æ¥å®ç°ç”¨æ•´å‹ä»£æ›¿çš„</li>
<li>å­—ç¬¦ä¸²ç±»å‹é•¿åº¦ä¸è¦éšæ„è®¾ç½®ï¼Œä¿è¯æ»¡è¶³ä¸šåŠ¡çš„å‰æä¸‹å°½é‡å°</li>
<li>ç”¨æ•´å‹æ¥å­˜ IP</li>
<li>å•è¡¨ä¸è¦æœ‰å¤ªå¤šå­—æ®µï¼Œå»ºè®®åœ¨20ä»¥å†…</li>
<li>ä¸ºèƒ½é¢„è§çš„å­—æ®µæå‰é¢„ç•™ï¼Œå› ä¸ºæ•°æ®é‡è¶Šå¤§ï¼Œä¿®æ”¹æ•°æ®ç»“æ„è¶Šè€—æ—¶</li>
</ul>
<p><strong>ç´¢å¼•ä¼˜åŒ–</strong></p>
<p>ç´¢å¼•ï¼Œç©ºé—´æ¢æ—¶é—´çš„ä¼˜åŒ–ç­–ç•¥ï¼ŒåŸºæœ¬ä¸Šæ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾è®¡å¥½ç´¢å¼•ï¼Œè¶³ä»¥åº”ä»˜ç™¾ä¸‡çº§çš„æ•°æ®é‡ï¼Œå…»æˆä½¿ç”¨ <strong>explain</strong> çš„ä¹ æƒ¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ—¢ä¸èƒ½ç»å¤§å¤šæ•°éƒ½ç›¸åŒï¼Œåˆä¸èƒ½åªæœ‰æå°‘æ•°ç›¸åŒ</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸€ä¸ªå¸¸è¯†ï¼šç´¢å¼•å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œç´¢å¼•æ˜¯ä¼šé™ä½æ•°æ®å†™å…¥æ€§èƒ½çš„ã€‚</li>
<li>ç´¢å¼•å­—æ®µé•¿åº¦å°½é‡çŸ­ï¼Œè¿™æ ·èƒ½å¤ŸèŠ‚çœå¤§é‡ç´¢å¼•ç©ºé—´ã€‚</li>
<li>å–æ¶ˆå¤–é”®ï¼Œå¯äº¤ç”±ç¨‹åºæ¥çº¦æŸï¼Œæ€§èƒ½æ›´å¥½ã€‚</li>
<li>å¤åˆç´¢å¼•çš„åŒ¹é…æœ€å·¦åˆ—è§„åˆ™ï¼Œç´¢å¼•çš„é¡ºåºå’ŒæŸ¥è¯¢æ¡ä»¶ä¿æŒä¸€è‡´ï¼Œå°½é‡å»é™¤æ²¡å¿…è¦çš„å•åˆ—ç´¢å¼•ã€‚</li>
<li>å€¼åˆ†å¸ƒè¾ƒå°‘çš„å­—æ®µï¼ˆä¸é‡å¤çš„è¾ƒå°‘ï¼‰ä¸é€‚åˆå»ºç´¢å¼•ï¼Œæ¯”å¦‚åƒæ€§åˆ«è¿™ç§åªæœ‰ä¸¤ä¸‰ä¸ªå€¼çš„æƒ…å†µå­—æ®µå»ºç«‹ç´¢å¼•æ„ä¹‰ä¸å¤§ã€‚</li>
<li>éœ€è¦æ’åºçš„å­—æ®µå»ºè®®åŠ ä¸Šç´¢å¼•ï¼Œå› ä¸ºç´¢å¼•æ˜¯ä¼šæ’åºçš„ï¼Œèƒ½æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚</li>
<li>å­—ç¬¦ä¸²å­—æ®µä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œä¸ä½¿ç”¨å…¨å­—æ®µç´¢å¼•ï¼Œå¯å¤§å¹…å‡å°ç´¢å¼•ç©ºé—´ã€‚</li>
</ul>
<p><strong>sqlä¼˜åŒ–</strong></p>
<ul>
<li><p>æŸ¥è¯¢ä¸ä½¿ç”¨ select *ï¼Œå°½é‡æŸ¥è¯¢å¸¦ç´¢å¼•çš„å­—æ®µï¼Œé¿å…å›è¡¨</p>
</li>
<li><p>å°½é‡ä½¿ç”¨ limit å¯¹æŸ¥è¯¢æ•°é‡è¿›è¡Œé™åˆ¶</p>
</li>
<li><p>æŸ¥è¯¢å­—æ®µå°½é‡è½åœ¨ç´¢å¼•ä¸Šï¼Œå°¤å…¶æ˜¯å¤åˆç´¢å¼•ï¼Œé¡ºåºå¾ˆé‡è¦</p>
</li>
<li><p>æ‹†åˆ†å¤§çš„ delete / insert æ“ä½œï¼Œä¸€æ–¹é¢ä¼šé”è¡¨ï¼Œå½±å“å…¶ä»–ä¸šåŠ¡æ“ä½œï¼Œè¿˜æœ‰ä¸€æ–¹é¢æ˜¯ MySQL å¯¹ sql é•¿åº¦ä¹Ÿæ˜¯æœ‰é™åˆ¶çš„</p>
</li>
<li><p>ä¸å»ºè®®ä½¿ç”¨ MySQL çš„å‡½æ•°ï¼Œè®¡ç®—ç­‰ï¼Œå¯å…ˆç”±ç¨‹åºå¤„ç†ï¼Œä»ä¸Šé¢æçš„ä¸€äº›ç‚¹ä¼šå‘ç°ï¼Œèƒ½äº¤ç”±ç¨‹åºå¤„ç†çš„å°½é‡ä¸è¦æŠŠå‹åŠ›è½¬è‡³æ•°æ®åº“ä¸Š</p>
</li>
<li><p>æŸ¥è¯¢ countï¼Œæ€§èƒ½ï¼šcount(1) = count(*) &gt; count(ä¸»é”®) &gt; count(å…¶ä»–å­—æ®µ)</p>
</li>
<li><p>æŸ¥è¯¢æ“ä½œç¬¦èƒ½ç”¨ between åˆ™ä¸ç”¨ inï¼Œèƒ½ç”¨ in åˆ™ä¸ç”¨ or</p>
</li>
<li><p>é¿å…ä½¿ç”¨ != æˆ–ï¼œï¼ã€IS NULL æˆ– IS NOT NULLã€IN ï¼ŒNOT INç­‰è¿™æ ·çš„æ“ä½œç¬¦ï¼Œå› ä¸ºè¿™äº›æŸ¥è¯¢æ— æ³•ä½¿ç”¨ç´¢å¼•</p>
</li>
<li><p>sql å°½é‡ç®€å•ï¼Œå°‘ç”¨ joinï¼Œä¸å»ºè®®ä¸¤ä¸ª join ä»¥ä¸Šã€‚</p>
</li>
</ul>
<h2 id="åƒä¸‡çº§æ•°æ®é‡"><a href="#åƒä¸‡çº§æ•°æ®é‡" class="headerlink" title="åƒä¸‡çº§æ•°æ®é‡"></a>åƒä¸‡çº§æ•°æ®é‡</h2><p>åˆ°äº†è¿™ä¸ªé˜¶æ®µçš„æ•°æ®é‡ï¼Œæ•°æ®æœ¬èº«å·²ç»æœ‰å¾ˆå¤§çš„ä»·å€¼äº†ï¼Œæ•°æ®é™¤äº†æ»¡è¶³å¸¸è§„ä¸šåŠ¡éœ€æ±‚å¤–ï¼Œè¿˜ä¼šæœ‰ä¸€äº›æ•°æ®åˆ†æçš„éœ€æ±‚ã€‚è€Œè¿™ä¸ªæ—¶å€™æ•°æ®å¯å˜åŠ¨æ€§ä¸é«˜ï¼ŒåŸºæœ¬ä¸Šä¸ä¼šè€ƒè™‘ä¿®æ”¹åŸæœ‰ç»“æ„ï¼Œä¸€èˆ¬ä¼šè€ƒè™‘ä»åˆ†åŒºï¼Œåˆ†è¡¨ï¼Œåˆ†åº“ä¸‰æ–¹é¢åšä¼˜åŒ–ã€‚</p>
<p><strong>åˆ†åŒº</strong></p>
<p>åˆ†åŒºæ˜¯æ ¹æ®ä¸€å®šçš„è§„åˆ™ï¼Œæ•°æ®åº“æŠŠä¸€ä¸ªè¡¨åˆ†è§£æˆå¤šä¸ªæ›´å°çš„ã€æ›´å®¹æ˜“ç®¡ç†çš„éƒ¨åˆ†ï¼Œæ˜¯ä¸€ç§æ°´å¹³åˆ’åˆ†ã€‚å¯¹åº”ç”¨æ¥è¯´æ˜¯å®Œå…¨é€æ˜çš„ï¼Œä¸å½±å“åº”ç”¨çš„ä¸šåŠ¡é€»è¾‘ï¼Œå³ä¸ç”¨ä¿®æ”¹ä»£ç ã€‚å› æ­¤èƒ½å­˜æ›´å¤šçš„æ•°æ®ï¼ŒæŸ¥è¯¢ï¼Œåˆ é™¤ä¹Ÿæ”¯æŒæŒ‰åˆ†åŒºæ¥æ“ä½œï¼Œä»è€Œè¾¾åˆ°ä¼˜åŒ–çš„ç›®çš„ã€‚å¦‚æœæœ‰è€ƒè™‘åˆ†åŒºï¼Œå¯ä»¥æå‰åšå‡†å¤‡ï¼Œé¿å…ä¸‹åˆ—ä¸€äº›é™åˆ¶ï¼š</p>
<ul>
<li>ä¸€ä¸ªè¡¨æœ€å¤šåªèƒ½æœ‰1024ä¸ªåˆ†åŒºï¼ˆmysql5.6ä¹‹åæ”¯æŒ8192ä¸ªåˆ†åŒºï¼‰ã€‚</li>
<li>å¦‚æœåˆ†åŒºå­—æ®µä¸­æœ‰ä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•åˆ—ï¼Œé‚£ä¹ˆæ‰€æœ‰ä¸»é”®åˆ—å’Œå”¯ä¸€ç´¢å¼•åˆ—éƒ½å¿…é¡»åŒ…å«è¿›æ¥ï¼Œå¦‚æœè¡¨ä¸­æœ‰ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ï¼Œé‚£ä¹ˆåˆ†åŒºé”®å¿…é¡»æ˜¯ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ã€‚</li>
<li>åˆ†åŒºè¡¨ä¸­æ— æ³•ä½¿ç”¨å¤–é”®çº¦æŸã€‚</li>
<li>NULLå€¼ä¼šä½¿åˆ†åŒºè¿‡æ»¤æ— æ•ˆã€‚</li>
<li>ç›®å‰mysqlä¸æ”¯æŒç©ºé—´ç±»å‹å’Œä¸´æ—¶è¡¨ç±»å‹è¿›è¡Œåˆ†åŒºã€‚ä¸æ”¯æŒå…¨æ–‡ç´¢å¼•ã€‚</li>
<li>æ‰€æœ‰åˆ†åŒºå¿…é¡»ä½¿ç”¨ç›¸åŒçš„å­˜å‚¨å¼•æ“ã€‚</li>
</ul>
<p>åˆ†åŒºå¯æŒ‰ä»¥ä¸‹å››ç§ç±»å‹åˆ†åŒºï¼š</p>
<ul>
<li>RANGEè¡¨åˆ†åŒºï¼šèŒƒå›´è¡¨åˆ†åŒºï¼ŒæŒ‰ç…§ä¸€å®šçš„èŒƒå›´å€¼æ¥ç¡®å®šæ¯ä¸ªåˆ†åŒºåŒ…å«çš„æ•°æ®;</li>
<li>LISTè¡¨åˆ†åŒºï¼šåˆ—è¡¨è¡¨åˆ†åŒºï¼ŒæŒ‰ç…§ä¸€ä¸ªä¸€ä¸ªç¡®å®šçš„å€¼æ¥ç¡®å®šæ¯ä¸ªåˆ†åŒºåŒ…å«çš„æ•°æ®;</li>
<li>HASHè¡¨åˆ†åŒºï¼šå“ˆå¸Œè¡¨åˆ†åŒºï¼ŒæŒ‰ç…§ä¸€ä¸ªè‡ªå®šä¹‰çš„å‡½æ•°è¿”å›å€¼æ¥ç¡®å®šæ¯ä¸ªåˆ†åŒºåŒ…å«çš„æ•°æ®;</li>
<li>KEYè¡¨åˆ†åŒº ï¼škeyè¡¨åˆ†åŒºï¼Œä¸å“ˆå¸Œè¡¨åˆ†åŒºç±»ä¼¼ï¼Œåªæ˜¯ç”¨MySQLè‡ªå·±çš„HASHå‡½æ•°æ¥ç¡®å®šæ¯ä¸ªåˆ†åŒºåŒ…å«çš„æ•°æ®ã€‚</li>
</ul>
<p><strong>åˆ†è¡¨</strong></p>
<p>åˆ†è¡¨åˆ†æ°´å¹³åˆ†è¡¨å’Œå‚ç›´åˆ†è¡¨ã€‚</p>
<p>æ°´å¹³åˆ†è¡¨å³æ‹†åˆ†æˆæ•°æ®ç»“æ„ç›¸åŒçš„å„ä¸ªå°è¡¨ï¼Œå¦‚æ‹†åˆ†æˆ table<em>1, table</em>2â€¦ï¼Œä»è€Œç¼“è§£æ•°æ®åº“è¯»å†™å‹åŠ›ã€‚</p>
<p>å‚ç›´åˆ†è¡¨å³å°†ä¸€äº›å­—æ®µåˆ†å‡ºå»å½¢æˆä¸€ä¸ªæ–°è¡¨ï¼Œå„ä¸ªè¡¨æ•°æ®ç»“æ„ä¸ç›¸åŒï¼Œå¯ä»¥ä¼˜åŒ–é«˜å¹¶å‘ä¸‹é”è¡¨çš„æƒ…å†µã€‚</p>
<p>å¯æƒ³è€ŒçŸ¥ï¼Œåˆ†è¡¨çš„è¯ï¼Œç¨‹åºçš„é€»è¾‘æ˜¯éœ€è¦åšä¿®æ”¹çš„ï¼Œæ‰€ä»¥ï¼Œä¸€èˆ¬æ˜¯åœ¨é¡¹ç›®åˆæœŸæ—¶ï¼Œé¢„è§åˆ°å¤§æ•°æ®é‡çš„æƒ…å†µï¼Œæ‰ä¼šè€ƒè™‘åˆ†è¡¨ã€‚åæœŸé˜¶æ®µä¸å»ºè®®åˆ†è¡¨ï¼Œæˆæœ¬å¾ˆå¤§</p>
<p><strong>åˆ†åº“</strong></p>
<p>åˆ†åº“ä¸€èˆ¬æ˜¯ä¸»ä»æ¨¡å¼ï¼Œä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨ä¸»èŠ‚ç‚¹å¤åˆ¶åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªä»èŠ‚ç‚¹å¤šä¸ªæ•°æ®åº“ï¼Œä¸»åº“è´Ÿè´£å†™æ“ä½œï¼Œä»åº“è´Ÿè´£è¯»æ“ä½œï¼Œä»è€Œè¾¾åˆ°ä¸»ä»åˆ†ç¦»ï¼Œé«˜å¯ç”¨ï¼Œæ•°æ®å¤‡ä»½ç­‰ä¼˜åŒ–ç›®çš„ã€‚</p>
<p>å½“ç„¶ï¼Œä¸»ä»æ¨¡å¼ä¹Ÿä¼šæœ‰ä¸€äº›ç¼ºé™·ï¼Œä¸»ä»åŒæ­¥å»¶è¿Ÿï¼Œbinlog æ–‡ä»¶å¤ªå¤§å¯¼è‡´çš„é—®é¢˜ç­‰ç­‰ï¼Œè¿™é‡Œä¸ç»†è®²ï¼ˆç¬”è€…ä¹Ÿå­¦ä¸åŠ¨äº†ï¼‰ã€‚</p>
<h2 id="äº¿çº§æ•°æ®é‡"><a href="#äº¿çº§æ•°æ®é‡" class="headerlink" title="äº¿çº§æ•°æ®é‡"></a>äº¿çº§æ•°æ®é‡</h2><p>ç†è®ºä¸Šï¼ŒMySQL ç»å¯¹æ˜¯å¯ä»¥æ”¯æ’‘è¿™ä¸ªçº§åˆ«æ•°æ®çš„ï¼Œä½†æ˜¯ç°åœ¨å¤§éƒ¨åˆ†å…¬å¸æ•°æ®åº“æ€§èƒ½æ°´å¹³å®Œå…¨å–å†³äºå¼€å‘äººå‘˜èƒ½åŠ›ã€‚å½“ç„¶ä¸€äº›å…¬å¸æœ‰ DBA æŠŠå…³ï¼Œå¦‚æ²¡æœ‰ä¸Šè¿°çš„ä¼˜åŒ–ä¹ æƒ¯ï¼Œå¤§å¤šæƒ…å†µåˆ°è¿™ä¸ªé˜¶æ®µï¼ŒMySQL æ•°æ®åº“æ€§èƒ½å·²ç»æ¥è¿‘å´©æºƒä¸´ç•Œç‚¹ï¼Œç”šè‡³æœ‰äº›éƒ½åˆ°ä¸äº†è¿™ä¸ªé˜¶æ®µã€‚</p>
<p>æŠ€æœ¯é€‰å‹</p>
<p>å¦‚ä½•å†™ä¼˜è´¨çš„ SQLï¼Ÿ</p>
<p>SQL å®¡æ ¸</p>
<p>ç´¢å¼•è®¾è®¡</p>
<p>å¦‚ä½•åœ¨ä¸€ä¸ªå¤§è¡¨æ·»åŠ ç´¢å¼•ï¼Ÿ</p>
<p>æ˜¯å¦éœ€è¦äº§å“åŒ–ï¼Ÿ</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· å¤åˆ¶</title>
    <url>/blog/2019/07/18/mysql-duplicate/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>MySQL çš„å¤åˆ¶åŠŸèƒ½æ˜¯æ„å»ºåŸºäºå¤§è§„æ¨¡ã€é«˜æ€§èƒ½åº”ç”¨çš„åŸºç¡€ï¼ŒåŒæ—¶ä¹Ÿæ˜¯é«˜å¯ç”¨æ€§ã€å¯æ‰©å±•æ€§ã€ç¾éš¾æ¢å¤ã€å¤‡ä»½ä»¥åŠæ•°æ®ä»“åº“ç­‰å·¥ä½œçš„åŸºç¡€ã€‚</p>
<p><strong>å¤åˆ¶èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p>
<p>å¤åˆ¶è§£å†³çš„åŸºæœ¬é—®é¢˜ï¼šæ˜¯è®©ä¸€å°æœåŠ¡å™¨çš„æ•°æ®ä¸å…¶ä»–æœåŠ¡å™¨ä¿æŒåŒæ­¥ã€‚å…¶ä»–æ‰©å±•åŠŸèƒ½ï¼š</p>
<ul>
<li>æ•°æ®åˆ†å¸ƒï¼šå¤åˆ¶çš„å¼€é”€å¾ˆå°ï¼Œé€šå¸¸ä¸ä¼šå¯¹å¸¦å®½é€ æˆå¾ˆå¤§çš„å‹åŠ›ï¼Œå¯ä»¥é€šè¿‡è¿œç¨‹å¤åˆ¶æ¥æ„å»ºä¸åŒçš„æ•°æ®ä¸­å¿ƒã€‚</li>
<li>è´Ÿè½½å‡è¡¡ï¼šé€šè¿‡å¤åˆ¶å¯ä»¥å°†è¯»æ“ä½œåˆ†å¸ƒåˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œè¯»å†™åˆ†ç¦»ã€‚</li>
<li>å¤‡ä»½ï¼šå¯¹å¤‡ä»½æ¥è¯´ï¼Œå¤åˆ¶æ˜¯ä¸€é¡¹å¾ˆæœ‰æ„ä¹‰çš„æŠ€æœ¯è¡¥å……ï¼Œä½†å¤åˆ¶æ—¢ä¸æ˜¯å¤‡ä»½ä¹Ÿä¸èƒ½å¤Ÿå–ä»£å¤‡ä»½ã€‚</li>
<li>é«˜å¯ç”¨æ€§å’Œæ•…éšœåˆ‡æ¢ï¼šå¤åˆ¶èƒ½é¿å… MySQL å•ç‚¹å¤±è´¥ï¼Œè®¾è®¡è‰¯å¥½çš„æ•…éšœåˆ‡æ¢ç³»ç»Ÿèƒ½æ˜¾è‘—åœ°ç¼©çŸ­å®•æœºæ—¶é—´ã€‚</li>
</ul>
<h2 id="å¤åˆ¶åŸç†"><a href="#å¤åˆ¶åŸç†" class="headerlink" title="å¤åˆ¶åŸç†"></a>å¤åˆ¶åŸç†</h2><p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134142.png" alt></p>
<p>ï¼ˆ1ï¼‰ä¸»åº“æŠŠæ•°æ®æ›´æ”¹è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆ<em>Binary Log</em>ï¼‰ã€‚</p>
<p>ï¼ˆ2ï¼‰å¤‡åº“å°†ä¸»åº“çš„æ—¥å¿—å¤åˆ¶åˆ°è‡ªå·±çš„ä¸­ç»§æ—¥å¿—ï¼ˆ<em>Relay Log</em>ï¼‰ã€‚</p>
<p>ï¼ˆ3ï¼‰å¤‡åº“è¯»å–ä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†å…¶é‡æ”¾åˆ°å¤‡åº“æ•°æ®ä¹‹ä¸Šã€‚</p>
<p>è¿™ç§æ¶æ„æœ‰ä¸€ä¸ªç¼ºé™·ï¼šåœ¨ä¸»åº“ä¸Šå¹¶å‘è¿è¡Œçš„æŸ¥è¯¢åœ¨å¤‡åº“åªèƒ½ä¸²è¡ŒåŒ–æ‰§è¡Œï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ª SQL çº¿ç¨‹æ¥é‡æ”¾ä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œè¿™æ˜¯å¾ˆå¤šå·¥ä½œè´Ÿè½½çš„æ€§èƒ½ç“¶é¢ˆæ‰€åœ¨ã€‚</p>
<h3 id="å¤åˆ¶æ–¹å¼"><a href="#å¤åˆ¶æ–¹å¼" class="headerlink" title="å¤åˆ¶æ–¹å¼"></a>å¤åˆ¶æ–¹å¼</h3><p>MySQLæ”¯æŒä¸¤ç§å¤åˆ¶æ–¹å¼ï¼šåŸºäºè¡Œçš„å¤åˆ¶ï¼ˆMySQL 5.1ç‰ˆæœ¬æ”¯æŒï¼‰å’ŒåŸºäºè¯­å¥çš„å¤åˆ¶ï¼ˆMySQL 3.23ç‰ˆæœ¬æ”¯æŒï¼‰ï¼Œè¿™ä¸¤ç§å¤åˆ¶æ–¹å¼éƒ½æ˜¯é€šè¿‡åœ¨ä¸»åº“ä¸Šè®°å½•äºŒè¿›åˆ¶æ—¥å¿—ã€åœ¨å¤‡åº“é‡æ”¾æ—¥å¿—çš„æ–¹å¼æ¥å®ç°å¼‚æ­¥çš„æ•°æ®å¤åˆ¶ã€‚</p>
<p>MySQL å¤åˆ¶å¤§éƒ¨åˆ†æ˜¯å‘åå…¼å®¹çš„ï¼Œå¯¹äºå°ç‰ˆæœ¬å·çš„å‡çº§ï¼Œé€šå¸¸ä¹Ÿæ˜¯å…¼å®¹çš„ã€‚</p>
<h3 id="å¤åˆ¶æ–‡ä»¶"><a href="#å¤åˆ¶æ–‡ä»¶" class="headerlink" title="å¤åˆ¶æ–‡ä»¶"></a>å¤åˆ¶æ–‡ä»¶</h3><p><code>mysql-bin.index</code>ï¼šäºŒè¿›åˆ¶æ—¥å¿—çš„ç´¢å¼•æ–‡ä»¶ï¼Œå¼€å¯äºŒè¿›åˆ¶æ—¥å¿—æ—¶å°±ä¼šäº§ç”Ÿï¼Œè¯¥æ–‡ä»¶è®°å½•ç£ç›˜ä¸Šçš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼Œæ¯ä¸€è¡ŒåŒ…å«äº†äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–‡ä»¶åã€‚MySQL ä¾èµ–è¿™ä¸ªæ–‡ä»¶ï¼Œé™¤éåœ¨è¿™ä¸ªæ–‡ä»¶é‡Œæœ‰è®°å½•ï¼Œå¦åˆ™è¯†åˆ«ä¸äº†äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@ptdsmapp04 mysql]# cat mysql-bin.index</span><br><span class="line">/data/mysql/mysql-bin.000014</span><br><span class="line">/data/mysql/mysql-bin.000015</span><br><span class="line">/data/mysql/mysql-bin.000016</span><br></pre></td></tr></table></figure>

<p><code>relay-log.index</code>ï¼šä¸­ç»§æ—¥å¿—çš„ç´¢å¼•æ–‡ä»¶ï¼Œå’Œ mysql-bin.index ä½œç”¨ç±»ä¼¼ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@ptdsmapp04 mysql]# cat relay-log.index</span><br><span class="line">./relay-log.000016</span><br><span class="line">./relay-log.000017</span><br></pre></td></tr></table></figure>

<p><code>master.info</code>ï¼šè¿™ä¸ªæ–‡ä»¶ç”¨äºä¿å­˜å¤‡åº“è¿æ¥åˆ°ä¸»åº“æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œæ ¼å¼ä¸ºçº¯æ–‡æœ¬ï¼ˆæ¯è¡Œä¸€ä¸ªå€¼ï¼‰ã€‚æ­¤æ–‡ä»¶ä¸èƒ½åˆ é™¤ï¼Œå¦åˆ™å¤‡åº“åœ¨é‡å¯åæ— æ³•è¿æ¥åˆ°ä¸»åº“ã€‚è¿™ä¸ªæ–‡ä»¶ä»¥æ–‡æœ¬çš„æ–¹å¼è®°å½•äº†å¤åˆ¶ç”¨æˆ·çš„å¯†ç ï¼Œæ‰€ä»¥è¦æ³¨æ„æ­¤æ–‡ä»¶çš„æƒé™æ§åˆ¶ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@ptdsmapp04 mysql]# cat master.info </span><br><span class="line">25</span><br><span class="line">mysql-binlog.000234</span><br><span class="line">933317366</span><br><span class="line">10.133.0.51</span><br><span class="line">repl</span><br><span class="line">Changeme_123</span><br><span class="line">3306</span><br><span class="line">60</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">0</span><br><span class="line">30.000</span><br><span class="line"></span><br><span class="line">0</span><br><span class="line">e1db90f2-fce1-11e8-86d2-005056b1d631</span><br><span class="line">86400</span><br><span class="line"></span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<p><code>relay-log.info</code>ï¼šè¿™ä¸ªæ–‡ä»¶åŒ…å«äº†å½“å‰å¤‡åº“å¤åˆ¶çš„äºŒè¿›åˆ¶æ—¥å¿—å’Œä¸­ç»§æ—¥å¿—åæ ‡ï¼ŒåŒæ ·ä¹Ÿä¸èƒ½åˆ é™¤è¿™ä¸ªæ–‡ä»¶ï¼Œå¦åˆ™åœ¨å¤‡åº“é‡å¯åå°†æ— æ³•ä»å“ªä¸ªä½ç½®å¼€å§‹å¤åˆ¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´é‡æ”¾å·²ç»æ‰§è¡Œè¿‡çš„è¯­å¥ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@ptdsmapp04 mysql]# cat relay-log.info </span><br><span class="line">7</span><br><span class="line">./relay-log.000017</span><br><span class="line">933317585</span><br><span class="line">mysql-binlog.000234</span><br><span class="line">933317366</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®å¤åˆ¶"><a href="#é…ç½®å¤åˆ¶" class="headerlink" title="é…ç½®å¤åˆ¶"></a>é…ç½®å¤åˆ¶</h2><p>åˆ†ä¸ºä¸‰æ­¥ï¼š</p>
<ul>
<li>æ¯å°æœåŠ¡å™¨ä¸Šåˆ›å»ºå¤åˆ¶ç”¨æˆ·</li>
<li>é…ç½®ä¸»åº“å’Œå¤‡åº“</li>
<li>é€šçŸ¥å¤‡åº“è¿æ¥åˆ°ä¸»åº“å¹¶ä»ä¸»åº“å¤åˆ¶æ•°æ®</li>
</ul>
<h3 id="åˆ›å»ºå¤åˆ¶ç”¨æˆ·"><a href="#åˆ›å»ºå¤åˆ¶ç”¨æˆ·" class="headerlink" title="åˆ›å»ºå¤åˆ¶ç”¨æˆ·"></a>åˆ›å»ºå¤åˆ¶ç”¨æˆ·</h3><p>ä¸»åº“å’Œå¤‡åº“éƒ½åˆ›å»ºè¯¥ç”¨æˆ·ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">REPLICATION</span> <span class="keyword">SLAVE</span>, <span class="keyword">REPLICATION</span> <span class="keyword">CLIENT</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'repl'</span>@<span class="string">'x.x.x.%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'Changeme_123'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®ä¸»åº“å’Œå¤‡åº“"><a href="#é…ç½®ä¸»åº“å’Œå¤‡åº“" class="headerlink" title="é…ç½®ä¸»åº“å’Œå¤‡åº“"></a>é…ç½®ä¸»åº“å’Œå¤‡åº“</h3><blockquote>
<p>ä¸»åº“ <code>my.cnf</code> æ–‡ä»¶</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">server_id</span>         <span class="string">=</span> <span class="number">10</span></span><br><span class="line"><span class="string">log_bin</span>           <span class="string">=</span> <span class="string">mysql-bin</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¤‡åº“ <code>my.cnf</code> æ–‡ä»¶</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">server_id</span>         <span class="string">=</span> <span class="number">20</span></span><br><span class="line"><span class="string">log_bin</span>           <span class="string">=</span> <span class="string">mysql-bin</span></span><br><span class="line"><span class="string">sync_binlog</span>       <span class="string">=</span> <span class="number">0</span></span><br><span class="line"><span class="string">relay_log</span>         <span class="string">=</span> <span class="string">relay-log</span></span><br><span class="line"><span class="string">read_only</span>         <span class="string">=</span> <span class="number">1</span></span><br><span class="line"><span class="string">log_slave_updates</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"><span class="string">innodb_flush_log_at_trx_commit</span> <span class="string">=</span> <span class="number">2</span></span><br><span class="line"><span class="string">skip_slave_start</span></span><br></pre></td></tr></table></figure>

<p><strong>Tips</strong>ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œéœ€è¦é‡å¯ mysqld æœåŠ¡ç”Ÿæ•ˆ</p>
<h3 id="åŒæ­¥ä¸»å¤‡æ•°æ®å¹¶å¯åŠ¨å¤åˆ¶"><a href="#åŒæ­¥ä¸»å¤‡æ•°æ®å¹¶å¯åŠ¨å¤åˆ¶" class="headerlink" title="åŒæ­¥ä¸»å¤‡æ•°æ®å¹¶å¯åŠ¨å¤åˆ¶"></a>åŒæ­¥ä¸»å¤‡æ•°æ®å¹¶å¯åŠ¨å¤åˆ¶</h3><p>ï¼ˆ1ï¼‰å…‹éš†æ•°æ®åˆ°å¤‡åº“</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¸»åº“å…¨å±€åªè¯»é”ï¼š</span><br><span class="line">flush tables with read lock;</span><br><span class="line"></span><br><span class="line">å¤‡ä»½ä¸»åº“ï¼š</span><br><span class="line">mysqldump -uroot -pHaier@123 -A --triggers --routines --events --single-transaction --master-data=2 &gt; master.sql</span><br><span class="line"></span><br><span class="line">ä¼ åˆ°ä»åº“ï¼š</span><br><span class="line">scp master.sql haieradmin@x.x.x.x:/tmp</span><br><span class="line"></span><br><span class="line">ä»åº“å¯¼å…¥æ•°æ®ï¼š</span><br><span class="line">mysql -uroot -p&apos;xx&apos; &lt; master.sql</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰é…ç½®å¤åˆ¶å…³ç³»</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CHANGE MASTER TO</span><br><span class="line">MASTER_HOST=&apos;10.133.0.51&apos;,</span><br><span class="line">MASTER_USER=&apos;repl&apos;,</span><br><span class="line">MASTER_PASSWORD=&apos;Changeme_123&apos;,</span><br><span class="line">MASTER_PORT=3306,</span><br><span class="line">MASTER_LOG_FILE=&apos;mysql-binlog.000232&apos;,</span><br><span class="line">MASTER_LOG_POS=3108253;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰å¯åŠ¨å¤åˆ¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">start slave;</span><br><span class="line">mysql&gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 10.133.0.51</span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-binlog.000234</span><br><span class="line">          Read_Master_Log_Pos: 744390811</span><br><span class="line">               Relay_Log_File: relay-log.000017</span><br><span class="line">                Relay_Log_Pos: 744391030</span><br><span class="line">        Relay_Master_Log_File: mysql-binlog.000234</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">                            ...</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 744390811</span><br><span class="line">                            ...</span><br><span class="line">        Seconds_Behind_Master: 0</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ4ï¼‰æ£€æŸ¥å¤åˆ¶çº¿ç¨‹</p>
<p>ä¸»åº“ä¸Šå¯ä»¥çœ‹åˆ°ç”±å¤‡åº“ I/O çº¿ç¨‹å‘ä¸»åº“å‘èµ·çš„è¿æ¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; show processlist\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">     Id: 1257405</span><br><span class="line">   User: repl</span><br><span class="line">   Host: 10.133.0.52:46102</span><br><span class="line">     db: NULL</span><br><span class="line">Command: Binlog Dump</span><br><span class="line">   Time: 79824</span><br><span class="line">  State: Master has sent all binlog to slave; waiting for more updates</span><br><span class="line">   Info: NULL</span><br></pre></td></tr></table></figure>

<p>å¤‡åº“ä¸Šä¹Ÿå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªæ˜¯ I/O çº¿ç¨‹ï¼Œä¸€ä¸ªæ˜¯ SQL çº¿ç¨‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; show processlist\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">     Id: 55</span><br><span class="line">   User: system user</span><br><span class="line">   Host: </span><br><span class="line">     db: NULL</span><br><span class="line">Command: Connect</span><br><span class="line">   Time: 79927</span><br><span class="line">  State: Waiting for master to send event</span><br><span class="line">   Info: NULL</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">     Id: 56</span><br><span class="line">   User: system user</span><br><span class="line">   Host: </span><br><span class="line">     db: NULL</span><br><span class="line">Command: Connect</span><br><span class="line">   Time: 3681</span><br><span class="line">  State: Slave has read all relay log; waiting for more updates</span><br><span class="line">   Info: NULL</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ5ï¼‰ä¸»åº“è§£é”</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">unlock tables;</span><br></pre></td></tr></table></figure>

<h2 id="å‚æ•°è¯¦è§£"><a href="#å‚æ•°è¯¦è§£" class="headerlink" title="å‚æ•°è¯¦è§£"></a>å‚æ•°è¯¦è§£</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 10.133.0.51</span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-binlog.000234</span><br><span class="line">          Read_Master_Log_Pos: 744390811</span><br><span class="line">               Relay_Log_File: relay-log.000017</span><br><span class="line">                Relay_Log_Pos: 744391030</span><br><span class="line">        Relay_Master_Log_File: mysql-binlog.000234</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 744390811</span><br><span class="line">          ...</span><br><span class="line">        Seconds_Behind_Master: 0</span><br></pre></td></tr></table></figure>

<p><strong>Slave_IO_Runningï¼šYes</strong>ï¼Œä»åº“ I/O çº¿ç¨‹è´Ÿè´£è¯·æ±‚å’Œæ¥æ”¶ä¸»åº“ä¼ é€’çš„ bin-log ä¿¡æ¯</p>
<p><strong>Slave_SQL_Runningï¼šYes</strong>ï¼Œä»åº“ SQL çº¿ç¨‹è´Ÿè´£é‡æ”¾ relay-log ä¿¡æ¯</p>
<ul>
<li><p><code>Master_Log_File</code>ï¼šå½“å‰ä¸»åº“çš„ bin-log æ—¥å¿—æ–‡ä»¶å</p>
</li>
<li><p><code>Read_Master_Log_Pos</code>ï¼šæ­£åœ¨è¯»å–ä¸»åº“å½“å‰ bin-log ä¸­ position ä½ç½®</p>
</li>
<li><p><code>Exec_Master_Log_Pos</code>ï¼šæ‰§è¡Œåˆ°ä¸»åº“ bin-log ä¸­ position ä½ç½®</p>
</li>
<li><p><code>Relay_Log_File</code>ï¼š</p>
</li>
<li><p><code>Relay_Log_Pos</code>ï¼š</p>
</li>
<li><p><code>Relay_Master_Log_File</code>ï¼š</p>
</li>
<li><p><code>Seconds_Behind_Master</code>ï¼š</p>
</li>
</ul>
<p>Master_Log_File = Relay_Master_Log_Fileï¼ŒRead_Master_Log_Pos = Exec_Master_Log_Posï¼šè¯´æ˜ä»åº“æ— å»¶è¿Ÿ</p>
<h3 id="ä¸»ä»å»¶æ—¶é—®é¢˜"><a href="#ä¸»ä»å»¶æ—¶é—®é¢˜" class="headerlink" title="ä¸»ä»å»¶æ—¶é—®é¢˜"></a>ä¸»ä»å»¶æ—¶é—®é¢˜</h3><p>åŸå› ï¼šä¸€èˆ¬éƒ½ä¼šåšè¯»å†™åˆ†ç¦»ï¼Œå…¶å®ä»åº“å‹åŠ›åè€Œæ¯”ä¸»åº“å¤§ï¼ä»åº“è¯»å†™å‹åŠ›å¤§éå¸¸å®¹æ˜“å¯¼è‡´å»¶æ—¶ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>é¦–å…ˆå®šä½å»¶æ—¶ç“¶é¢ˆ</li>
<li>å¦‚æœæ˜¯IOå‹åŠ›ï¼Œå¯ä»¥é€šè¿‡å‡çº§ç¡¬ä»¶è§£å†³ï¼Œæ¯”å¦‚æ›¿æ¢SSDç­‰</li>
<li>å¦‚æœIOå’ŒCPUéƒ½ä¸æ˜¯ç“¶é¢ˆï¼Œéå¸¸æœ‰å¯èƒ½æ˜¯SQLå•çº¿ç¨‹é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆå¯ä»¥è€ƒè™‘åˆšæ‰æåˆ°çš„å¹¶è¡Œå¤åˆ¶æ–¹æ¡ˆ</li>
<li>å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘shardingæ‹†åˆ†æ–¹æ¡ˆ</li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· å®‰è£…</title>
    <url>/blog/2019/07/17/mysql-install/</url>
    <content><![CDATA[<h2 id="MySQL-5-7"><a href="#MySQL-5-7" class="headerlink" title="MySQL 5.7"></a>MySQL 5.7</h2><h3 id="åˆ›å»º-mysql-ç”¨æˆ·"><a href="#åˆ›å»º-mysql-ç”¨æˆ·" class="headerlink" title="åˆ›å»º mysql ç”¨æˆ·"></a>åˆ›å»º <code>mysql</code> ç”¨æˆ·</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line">useradd -g mysql mysql -s /sbin/nologin</span><br></pre></td></tr></table></figure>

<h3 id="ä¸‹è½½äºŒè¿›åˆ¶åŒ…"><a href="#ä¸‹è½½äºŒè¿›åˆ¶åŒ…" class="headerlink" title="ä¸‹è½½äºŒè¿›åˆ¶åŒ…"></a>ä¸‹è½½äºŒè¿›åˆ¶åŒ…</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">wget http://devops-files.oss-cn-qingdao.aliyuncs.com/mysql-<span class="number">5.7</span>.<span class="number">23</span>-linux-glibc2.<span class="number">12</span>-x86_64.tar.gz</span><br><span class="line">tar -zxvf mysql-<span class="number">5.7</span>.<span class="number">23</span>-linux-glibc2.<span class="number">12</span>-x86_64.tar.gz -C /usr/local/</span><br><span class="line">ln -s /usr/local/mysql-<span class="number">5.7</span>.<span class="number">23</span>-linux-glibc2.<span class="number">12</span>-x86_64.tar.gz /usr/local/mysql</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®æ–‡ä»¶-my-cnf"><a href="#é…ç½®æ–‡ä»¶-my-cnf" class="headerlink" title="é…ç½®æ–‡ä»¶ my.cnf"></a>é…ç½®æ–‡ä»¶ <code>my.cnf</code></h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">[client]</span></span><br><span class="line"><span class="string">port</span>                      <span class="string">=</span> <span class="number">3306</span></span><br><span class="line"><span class="string">socket</span>                    <span class="string">=</span> <span class="string">/data/mysql/mysql.sock</span></span><br><span class="line"></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string">port</span>                      <span class="string">=</span> <span class="number">3306</span></span><br><span class="line"><span class="string">socket</span>                    <span class="string">=</span> <span class="string">/data/mysql/mysql.sock</span></span><br><span class="line"><span class="string">pid_file</span>                  <span class="string">=</span> <span class="string">/data/mysql/mysql.pid</span></span><br><span class="line"><span class="string">basedir</span>                   <span class="string">=</span> <span class="string">/usr/local/mysql</span></span><br><span class="line"><span class="string">datadir</span>                   <span class="string">=</span> <span class="string">/data/mysql</span></span><br><span class="line"><span class="string">character_set_server</span>      <span class="string">=</span> <span class="string">utf8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># LOG</span></span><br><span class="line"><span class="string">slow_query_log</span>            <span class="string">=</span> <span class="number">1</span></span><br><span class="line"><span class="string">long_query_time</span>           <span class="string">=</span> <span class="number">3</span></span><br><span class="line"><span class="string">log_error</span>                 <span class="string">=</span> <span class="string">/data/mysql/error.log</span></span><br><span class="line"><span class="string">slow_query_log_file</span>       <span class="string">=</span> <span class="string">/data/mysql/slow.log</span></span><br><span class="line"><span class="string">log_queries_not_using_indexes</span>  <span class="string">=</span> <span class="number">1</span></span><br><span class="line"><span class="string">sync_binlog</span>                    <span class="string">=</span> <span class="number">0</span></span><br><span class="line"><span class="string">innodb_flush_log_at_trx_commit</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># INNODB</span></span><br><span class="line"><span class="string">innodb_buffer_pool_size</span>   <span class="string">=</span> <span class="number">10240</span><span class="string">M</span></span><br><span class="line"><span class="string">innodb_buffer_pool_instances</span> <span class="string">=</span> <span class="number">4</span></span><br><span class="line"><span class="string">innodb_data_home_dir</span>      <span class="string">=</span> <span class="string">/data/mysql</span></span><br><span class="line"><span class="string">innodb_log_file_size</span>      <span class="string">=</span> <span class="number">1</span><span class="string">G</span></span><br><span class="line"><span class="string">innodb_data_file_path</span>     <span class="string">=</span> <span class="attr">ibdata1:1G:autoextend</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># OTHER</span></span><br><span class="line"><span class="string">max_connections</span>           <span class="string">=</span> <span class="number">3000</span></span><br><span class="line"><span class="string">back_log</span>                  <span class="string">=</span> <span class="number">1024</span></span><br><span class="line"><span class="string">interactive_timeout</span>       <span class="string">=</span> <span class="number">600</span></span><br><span class="line"><span class="string">wait_timeout</span>              <span class="string">=</span> <span class="number">600</span></span><br><span class="line"><span class="string">lower_case_table_names</span>    <span class="string">=</span> <span class="number">1</span></span><br><span class="line"><span class="string">log_timestamps</span>            <span class="string">=</span> <span class="string">SYSTEM</span></span><br><span class="line"><span class="string">max_allowed_packet</span>        <span class="string">=</span> <span class="number">32</span><span class="string">M</span></span><br><span class="line"><span class="string">sort_buffer_size</span>          <span class="string">=</span> <span class="number">4</span><span class="string">M</span></span><br><span class="line"><span class="string">join_buffer_size</span>          <span class="string">=</span> <span class="number">4</span><span class="string">M</span></span><br><span class="line"><span class="string">tmp_table_size</span>            <span class="string">=</span> <span class="number">32</span><span class="string">M</span></span><br><span class="line"><span class="string">explicit_defaults_for_timestamp</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"><span class="string">skip-ssl</span></span><br><span class="line"><span class="string">skip-name-resolve</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># REPLICATION</span></span><br><span class="line"><span class="string">server-id</span>                 <span class="string">=</span> <span class="number">3306100</span></span><br><span class="line"><span class="string">log-bin</span>                   <span class="string">=</span> <span class="string">/data/mysql/mysql-bin</span></span><br><span class="line"><span class="string">max_binlog_size</span>           <span class="string">=</span> <span class="number">1</span><span class="string">G</span></span><br><span class="line"><span class="string">binlog-format</span>             <span class="string">=</span> <span class="string">row</span></span><br><span class="line"><span class="string">expire_logs_days</span>          <span class="string">=</span> <span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="string">[mysqldump]</span></span><br><span class="line"><span class="string">quick</span></span><br><span class="line"><span class="string">max_allowed_packet</span>        <span class="string">=</span> <span class="number">32</span><span class="string">M</span></span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºæ•°æ®ç›®å½•"><a href="#åˆ›å»ºæ•°æ®ç›®å½•" class="headerlink" title="åˆ›å»ºæ•°æ®ç›®å½•"></a>åˆ›å»ºæ•°æ®ç›®å½•</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">mkdir -p /<span class="keyword">data</span>/mysql</span><br><span class="line">chown -R mysql:mysql /usr/local/mysql</span><br><span class="line">chown -R mysql:mysql /<span class="keyword">data</span>/mysql</span><br></pre></td></tr></table></figure>

<h3 id="åˆå§‹åŒ–-amp-å¯åŠ¨"><a href="#åˆå§‹åŒ–-amp-å¯åŠ¨" class="headerlink" title="åˆå§‹åŒ– &amp; å¯åŠ¨"></a>åˆå§‹åŒ– &amp; å¯åŠ¨</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">/usr/local/mysql/bin/mysqld --defaults-file=/etc/my.cnf --user=mysql --initialize</span><br><span class="line">/usr/local/mysql/bin/mysqld_safe --defaults-file=/etc/my.cnf --user=mysql <span class="number">2</span>&gt;&amp;<span class="number">1</span>&gt; /dev/null &amp;</span><br></pre></td></tr></table></figure>

<h3 id="å¼€å¯-3306-ç«¯å£"><a href="#å¼€å¯-3306-ç«¯å£" class="headerlink" title="å¼€å¯ 3306 ç«¯å£"></a>å¼€å¯ 3306 ç«¯å£</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=<span class="number">3306</span>/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<h3 id="è®¾ç½®å¼€æœºè‡ªå¯åŠ¨"><a href="#è®¾ç½®å¼€æœºè‡ªå¯åŠ¨" class="headerlink" title="è®¾ç½®å¼€æœºè‡ªå¯åŠ¨"></a>è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">cd /usr/local/mysql/bin</span><br><span class="line">cp mysql mysqladmin mysqlbinlog mysqld mysqld_safe mysqldump /usr/bin/</span><br><span class="line"></span><br><span class="line">vi /usr/local/mysql/support-files/mysql.server <span class="comment"># mysqld_pid_file_path=/data/mysql/mysql.pid</span></span><br><span class="line">cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line">chmod +x /etc/init.d/mysqld</span><br><span class="line">chkconfig --add mysqld</span><br><span class="line">chkconfig mysqld on</span><br><span class="line">chkconfig --list</span><br></pre></td></tr></table></figure>

<h3 id="è®¾ç½®ç”¨æˆ·"><a href="#è®¾ç½®ç”¨æˆ·" class="headerlink" title="è®¾ç½®ç”¨æˆ·"></a>è®¾ç½®ç”¨æˆ·</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line">$ cat /data/mysql/error.log | grep password</span><br><span class="line"></span><br><span class="line"><span class="comment"># rootè´¦å·</span></span><br><span class="line">mysql&gt; SET PASSWORD = 'xx';</span><br><span class="line">mysql&gt; ALTER USER 'root'@'localhost' PASSWORD EXPIRE NEVER;</span><br><span class="line"></span><br><span class="line"><span class="comment"># sreè´¦å·</span></span><br><span class="line">mysql&gt; CREATE USER 'sre'@'%' IDENTIFIED BY PASSWORD 'xx';</span><br><span class="line">mysql&gt; GRANT all privileges on *.* to 'sre'@'%' WITH GRANT OPTION;</span><br><span class="line"></span><br><span class="line"><span class="comment"># hdmè´¦å·</span></span><br><span class="line">mysql&gt; CREATE USER 'hdm'@'%' IDENTIFIED BY PASSWORD 'xx';</span><br><span class="line">mysql&gt; GRANT SELECT, SHOW DATABASES, PROCESS, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'hdm'@'%';</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">mysql&gt; select user,host,authentication_string from mysql.user;</span><br></pre></td></tr></table></figure>

<h2 id="MySQL-5-6"><a href="#MySQL-5-6" class="headerlink" title="MySQL 5.6"></a>MySQL 5.6</h2><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">/usr/local/mysql/scripts/mysql_install_db --basedir=/usr/local/mysql --defaults-file=/etc/my.cnf --user=mysql</span><br></pre></td></tr></table></figure>

<h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ /usr/local/mysql/bin/mysqld_safe --defaults-file=/etc/my.cnf --user=mysql <span class="number">2</span>&gt;&amp;<span class="number">1</span> &gt; /dev/null &amp;</span><br></pre></td></tr></table></figure>

<h3 id="è®¾ç½®ç”¨æˆ·-1"><a href="#è®¾ç½®ç”¨æˆ·-1" class="headerlink" title="è®¾ç½®ç”¨æˆ·"></a>è®¾ç½®ç”¨æˆ·</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql</span><br><span class="line">mysql&gt; update mysql.user set password=password('xx') where user='root';</span><br><span class="line">mysql&gt; delete from mysql.user where user!='root' or host!='localhost';</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">mysql&gt; select user,host,password from mysql.user;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸»å¤‡æ¨¡å¼"><a href="#ä¸»å¤‡æ¨¡å¼" class="headerlink" title="ä¸»å¤‡æ¨¡å¼"></a>ä¸»å¤‡æ¨¡å¼</h2><h3 id="æ–°æ­å»ºä¸»å¤‡"><a href="#æ–°æ­å»ºä¸»å¤‡" class="headerlink" title="æ–°æ­å»ºä¸»å¤‡"></a>æ–°æ­å»ºä¸»å¤‡</h3><h4 id="åˆ›å»ºç”¨æˆ·"><a href="#åˆ›å»ºç”¨æˆ·" class="headerlink" title="åˆ›å»ºç”¨æˆ·"></a>åˆ›å»ºç”¨æˆ·</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">REPLICATION</span> <span class="keyword">SLAVE</span>, <span class="keyword">REPLICATION</span> <span class="keyword">CLIENT</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'repl'</span>@<span class="string">'x.x.x.%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'xx'</span>;</span><br></pre></td></tr></table></figure>

<h4 id="ä¿®æ”¹é…ç½®"><a href="#ä¿®æ”¹é…ç½®" class="headerlink" title="ä¿®æ”¹é…ç½®"></a>ä¿®æ”¹é…ç½®</h4><ul>
<li>ä¸»åº“ <code>my.cnf</code> æ–‡ä»¶</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">server_id</span>         <span class="string">=</span> <span class="number">3306100</span></span><br><span class="line"><span class="string">log_bin</span>           <span class="string">=</span> <span class="string">mysql-bin</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å¤‡åº“ <code>my.cnf</code> æ–‡ä»¶</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">server_id</span>         <span class="string">=</span> <span class="number">3306101</span></span><br><span class="line"><span class="string">log_bin</span>           <span class="string">=</span> <span class="string">mysql-bin</span></span><br><span class="line"><span class="string">relay_log</span>         <span class="string">=</span> <span class="string">relay-log</span></span><br><span class="line"><span class="string">read_only</span>         <span class="string">=</span> <span class="number">1</span></span><br><span class="line"><span class="string">log_slave_updates</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"><span class="string">innodb_flush_log_at_trx_commit</span> <span class="string">=</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Tips</strong>ï¼šä¿®æ”¹é…ç½®ï¼Œéœ€è¦é‡å¯ <code>mysqld</code> æœåŠ¡ç”Ÿæ•ˆ</p>
</blockquote>
<ul>
<li>è¿ç§»ä¸»åº“æ•°æ®è‡³ä»åº“</li>
</ul>
<ul>
<li>å¯åŠ¨å¤åˆ¶</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸»åº“æŸ¥çœ‹æ—¥å¿—å’Œä½ç½®</span></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+<span class="comment">------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+<span class="comment">------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line">| mysql-bin.000002 |     3778 |              |                  |                   |</span><br><span class="line">+<span class="comment">------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»åº“å¼€å¯å¤åˆ¶</span></span><br><span class="line"><span class="keyword">CHANGE</span> <span class="keyword">MASTER</span> <span class="keyword">TO</span></span><br><span class="line">MASTER_HOST=<span class="string">'x.x.x.x'</span>,</span><br><span class="line">MASTER_USER=<span class="string">'repl'</span>,</span><br><span class="line">MASTER_PASSWORD=<span class="string">'xx'</span>,</span><br><span class="line">MASTER_PORT=<span class="number">3306</span>,</span><br><span class="line">MASTER_LOG_FILE=<span class="string">'mysql-bin.000002'</span>,</span><br><span class="line">MASTER_LOG_POS=<span class="number">3778</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯</span></span><br><span class="line">mysql&gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 10.138.98.179</span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000002</span><br><span class="line">          Read_Master_Log_Pos: 3778</span><br><span class="line">               Relay_Log_File: relay-log.000002</span><br><span class="line">                Relay_Log_Pos: 1621</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">            ...</span><br></pre></td></tr></table></figure>

<h3 id="å•ä¸»æ–°å¢å¤‡"><a href="#å•ä¸»æ–°å¢å¤‡" class="headerlink" title="å•ä¸»æ–°å¢å¤‡"></a>å•ä¸»æ–°å¢å¤‡</h3><ul>
<li>ä¸»ä»åº“æœåŠ¡å™¨ï¼Œ<a href="https://huiraoo.github.io/blog/2019/06/18/mysql-xtrabackup/"><strong>å®‰è£… XtraBackup</strong></a></li>
</ul>
<ul>
<li><p><a href="https://huiraoo.github.io/blog/2019/07/08/linux-ssh/"><strong>é…ç½®ä¸»ä»äº’ä¿¡</strong></a></p>
</li>
<li><p>å¤‡ä»½ä¸»åº“</p>
</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ innobackupex --defaults-file=/etc/my.cnf --user=<span class="string">'xx'</span> --password=<span class="string">'xx'</span> --no-timestamp /<span class="keyword">data</span>/backup</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¼ è¾“åˆ°ä»åº“</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ scp -r /<span class="keyword">data</span>/backup/* root@x.x.x.x:/<span class="keyword">data</span>/backup</span><br></pre></td></tr></table></figure>

<ul>
<li>æ¢å¤æ•°æ®åˆ°ä»åº“</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ mysqladmin -uroot -p<span class="string">'xx'</span> shutdown</span><br><span class="line">$ innobackupex --apply-log /<span class="keyword">data</span>/backup</span><br><span class="line">$ mv mysql mysql_bak</span><br><span class="line">$ mkdir mysql</span><br><span class="line">$ innobackupex --copy-back /<span class="keyword">data</span>/backup</span><br><span class="line">$ chown -R mysql:mysql mysql</span><br><span class="line">$ /usr/local/mysql/bin/mysqld_safe --defaults-file=/etc/my.cnf --user=mysql &gt;/dev/null &amp;</span><br></pre></td></tr></table></figure>

<ul>
<li>å»ºç«‹å¤åˆ¶å…³ç³»</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$ cat xtrabackup_binlog_info</span><br><span class="line">mysql-binlog.000297	900834433</span><br><span class="line"></span><br><span class="line"><span class="keyword">CHANGE</span> <span class="keyword">MASTER</span> <span class="keyword">TO</span> </span><br><span class="line">MASTER_HOST=<span class="string">'x.x.x.x'</span>,</span><br><span class="line">MASTER_USER=<span class="string">'repl'</span>,</span><br><span class="line">MASTER_PASSWORD=<span class="string">'xx'</span>,</span><br><span class="line">MASTER_PORT=<span class="number">3306</span>,</span><br><span class="line">MASTER_LOG_FILE=<span class="string">'mysql-binlog.000297'</span>, </span><br><span class="line">MASTER_LOG_POS=<span class="number">900834433</span>,</span><br><span class="line">MASTER_CONNECT_RETRY=<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">slave</span>;</span><br></pre></td></tr></table></figure>

<h2 id="å¯åœ"><a href="#å¯åœ" class="headerlink" title="å¯åœ"></a>å¯åœ</h2><h3 id="åœæ­¢"><a href="#åœæ­¢" class="headerlink" title="åœæ­¢"></a>åœæ­¢</h3><ul>
<li>ä½¿ç”¨ <code>init.d</code>ï¼Œ<code>mysqld</code> è„šæœ¬æ¥è‡ªäº <code>/usr/local/mysql/support-files/mysql.server</code></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ /etc/init.d/mysqld stop</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨ <code>mysqladmin</code></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ mysqladmin -u<span class="string">'xx'</span> -p<span class="string">'xx'</span> shutdown</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨ <code>service</code></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ systemctl stop mysqld</span><br><span class="line">$ service mysqld stop</span><br></pre></td></tr></table></figure>

<h3 id="å¯åŠ¨-1"><a href="#å¯åŠ¨-1" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><ul>
<li>ä½¿ç”¨ <code>init.d</code></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ /etc/init.d/mysqld start</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨ <code>mysqld_safe</code></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ mysqld_safe --defaults-file=/etc/my.cnf --user=mysql &amp;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨ <code>service</code></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ systemctl start mysqld</span><br><span class="line">$ service mysqld start</span><br></pre></td></tr></table></figure>

<h3 id="å·¥å…·å‘½ä»¤"><a href="#å·¥å…·å‘½ä»¤" class="headerlink" title="å·¥å…·å‘½ä»¤"></a>å·¥å…·å‘½ä»¤</h3><ul>
<li><p><strong>mysql</strong>ï¼š<code>MySQL</code> å®¢æˆ·ç«¯è®¿é—®ç®¡ç†å·¥å…·ã€‚</p>
</li>
<li><p><strong>mysqld</strong>ï¼šè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å°±ä»£è¡¨ç€ <code>MySQL</code> æœåŠ¡å™¨ç¨‹åºï¼Œè¿è¡Œè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å°±å¯ä»¥ç›´æ¥å¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨è¿›ç¨‹ã€‚</p>
</li>
<li><p><strong>mysqld</strong> å¯åŠ¨é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§ï¼š</p>
</li>
<li><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">/etc/my.cnf -&gt; /etc/mysql/my.cnf -&gt; /usr/etc/my.cnf -&gt; ~/.my.cnf</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>mysqld_safe</strong>ï¼šæ˜¯ä¸€ä¸ªå¯åŠ¨è„šæœ¬ï¼Œå®ƒä¼šé—´æ¥çš„è°ƒç”¨ <code>mysqld</code>ï¼Œè€Œä¸”è¿˜é¡ºä¾¿å¯åŠ¨äº†å¦å¤–ä¸€ä¸ªç›‘æ§è¿›ç¨‹ï¼Œè¿™ä¸ªç›‘æ§è¿›ç¨‹åœ¨æœåŠ¡å™¨è¿›ç¨‹æŒ‚äº†çš„æ—¶å€™ï¼Œå¯ä»¥å¸®åŠ©é‡å¯å®ƒã€‚ä½¿ç”¨ <code>mysqld_safe</code> å¯åŠ¨ <code>mysqld</code> æ—¶ï¼Œ<code>mysqld_safe</code> å¯ä»¥ä½¿ç”¨å‚æ•°é€‰é¡¹ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨å…¶ä»–é…ç½®æ–‡ä»¶ï¼Œç›¸å½“äº <code>mysqld_safe</code> æŠŠå‚æ•°ä¼ é€’ç»™ <code>mysqld</code>ã€‚</p>
</li>
<li><p><strong>mysql.server</strong>ï¼šä¹Ÿæ˜¯ä¸€ä¸ªå¯åŠ¨è„šæœ¬ï¼Œä¸»è¦ä½œç”¨å°±æ˜¯ä¸ºäº†æ–¹ä¾¿å¯åŠ¨å’Œå…³é—­ <code>mysqld</code> æœåŠ¡ï¼Œåªèƒ½ä½¿ç”¨é»˜è®¤çš„ <code>/etc/my.cnf</code> é…ç½®æ–‡ä»¶ï¼Œ<code>mysql.server</code> è°ƒç”¨ <code>mysqld_safe</code>ï¼Œç„¶å <code>mysql_safe</code> è°ƒç”¨äº† <code>mysqld</code>ã€‚</p>
</li>
</ul>
<h3 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h3><p><strong>ç°è±¡</strong>ï¼šä½¿ç”¨ <code>mysqld_safe</code> å¯åŠ¨å¤±è´¥ï¼Œå¯åŠ¨é”™è¯¯æ—¥å¿—æœªè®°å½• <code>error.log</code>ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Starting MySQL. ERROR! The server quit without updating PID file (/usr/local/mysql/data/COSMOPlat-WMS-App01.pid)</span><br></pre></td></tr></table></figure>

<p><strong>åŸå› </strong>ï¼šç»æ£€æŸ¥å‘ç°ï¼Œæ•°æ®åº“å®‰è£…æ—¶æ˜¯ä»¥ <code>haieradmin</code> ç”¨æˆ·å¯åŠ¨ï¼Œé»˜è®¤ä½¿ç”¨ <code>mysql</code> ç”¨æˆ·å¯åŠ¨ï¼Œå¯åŠ¨å¤±è´¥ã€‚</p>
<p><strong>è§£å†³</strong>ï¼šä½¿ç”¨ <code>haieradmin</code> ç”¨æˆ·å¯åŠ¨æˆåŠŸã€‚</p>
<blockquote>
<p>Tipsï¼šåœ¨æ“ä½œç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œéœ€è¦å…ˆæ‹·è´ <code>mysqld</code> è¿›ç¨‹ä¿¡æ¯ï¼Œä»¥å…å¯åœå¤±è´¥ã€‚</p>
</blockquote>
<h2 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ###########################################################################</span></span><br><span class="line"><span class="comment"># MySQLå®‰è£…åŒ…åå­—ä¸ºmysql-5.7.23-el7-x86_64.tar.gzï¼Œä½ç½®æ”¾åœ¨/usr/local/</span></span><br><span class="line"><span class="comment"># ###########################################################################</span></span><br><span class="line"></span><br><span class="line">cmd=<span class="variable">$2</span>    <span class="comment"># start or stop or status or install</span></span><br><span class="line">inst=<span class="variable">$4</span></span><br><span class="line"></span><br><span class="line">service_startup_timeout=<span class="number">30</span></span><br><span class="line"></span><br><span class="line">log_failure_msg() &#123;</span><br><span class="line">    echo <span class="string">" ERROR! $@"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">log_success_msg() &#123;</span><br><span class="line">    echo <span class="string">" SUCCESS! $@"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case `echo <span class="string">"testing\c"</span>`,`echo -n testing` <span class="keyword">in</span></span><br><span class="line">    *c*,-n*) echo_n=   echo_c=     ;;</span><br><span class="line">    *c*,*)   echo_n=-n echo_c=     ;;</span><br><span class="line">    *)       echo_n=   echo_c=<span class="string">'\c'</span> ;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">wait_for_pid () &#123;</span><br><span class="line">  verb=<span class="string">"<span class="variable">$1</span>"</span>           <span class="comment"># created | removed</span></span><br><span class="line">  pid=<span class="string">"<span class="variable">$2</span>"</span>            <span class="comment"># process ID of the program operating on the pid-file</span></span><br><span class="line">  pid_file_path=<span class="string">"<span class="variable">$3</span>"</span>  <span class="comment"># path to the PID file.</span></span><br><span class="line"></span><br><span class="line">  i=<span class="number">0</span></span><br><span class="line">  avoid_race_condition=<span class="string">"by checking again"</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> test <span class="variable">$i</span> <span class="nomarkup">-ne</span> <span class="variable">$service_startup_timeout</span> ; <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">    case <span class="string">"<span class="variable">$verb</span>"</span> <span class="keyword">in</span></span><br><span class="line">      <span class="string">'created'</span>)</span><br><span class="line">        <span class="comment"># wait for a PID-file to pop into existence.</span></span><br><span class="line">        test -s <span class="string">"<span class="variable">$pid_file_path</span>"</span> &amp;&amp; i=<span class="string">''</span> &amp;&amp; <span class="keyword">break</span></span><br><span class="line">        ;;</span><br><span class="line">      <span class="string">'removed'</span>)</span><br><span class="line">        <span class="comment"># wait for this PID-file to disappear</span></span><br><span class="line">        test ! -s <span class="string">"<span class="variable">$pid_file_path</span>"</span> &amp;&amp; i=<span class="string">''</span> &amp;&amp; <span class="keyword">break</span></span><br><span class="line">        ;;</span><br><span class="line">      *)</span><br><span class="line">        echo <span class="string">"wait_for_pid () usage: wait_for_pid created|removed pid pid_file_path"</span></span><br><span class="line">        <span class="keyword">exit</span> <span class="number">1</span></span><br><span class="line">        ;;</span><br><span class="line">    esac</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> test -n <span class="string">"<span class="variable">$pid</span>"</span>; then</span><br><span class="line">      <span class="keyword">if</span> kill -<span class="number">0</span> <span class="string">"<span class="variable">$pid</span>"</span> <span class="number">2</span>&gt;/dev/null; then</span><br><span class="line">        :</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span> test -n <span class="string">"<span class="variable">$avoid_race_condition</span>"</span>; then</span><br><span class="line">          avoid_race_condition=<span class="string">""</span></span><br><span class="line">          <span class="keyword">continue</span></span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        log_failure_msg <span class="string">"The server quit without updating PID file (<span class="variable">$pid_file_path</span>)."</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">      fi</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    echo <span class="variable">$echo_n</span> <span class="string">".<span class="variable">$echo_c</span>"</span></span><br><span class="line">    i=`expr <span class="variable">$i</span> + <span class="number">1</span>`</span><br><span class="line">    sleep <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  done</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> test -z <span class="string">"<span class="variable">$i</span>"</span> ; then</span><br><span class="line">    log_success_msg</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    log_failure_msg</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ############################################################################################</span></span><br><span class="line"><span class="comment"># æ”¯æŒMySQLç‰ˆæœ¬ï¼š5.6/5.7ï¼ŒCentOS 6ç³»ç»Ÿå»ºè®®å®‰è£…MySQL 5.6ç‰ˆæœ¬ï¼›CentOS 7ç³»ç»Ÿå»ºè®®å®‰è£…MySQL 5.7ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment"># æ”¯æŒMySQLæ¨¡å¼ï¼šå•æœº/ä¸»ä»</span></span><br><span class="line"><span class="comment"># #############################################################################################</span></span><br><span class="line"></span><br><span class="line">install_mysql() &#123;</span><br><span class="line"></span><br><span class="line">    echo <span class="variable">$echo_n</span> <span class="string">"Installing MySQL..."</span></span><br><span class="line"></span><br><span class="line">    local basedir=<span class="string">"/usr/local/mysql"</span></span><br><span class="line">    local datadir=<span class="string">"/data/mysql"</span></span><br><span class="line">    local defaults_file=<span class="string">"/etc/my.cnf"</span></span><br><span class="line">    local sock_file=<span class="string">"<span class="variable">$datadir</span>/mysql.sock"</span></span><br><span class="line">    local pid_file=<span class="string">"<span class="variable">$datadir</span>/mysql.pid"</span></span><br><span class="line">    local array=($&#123;inst//@/ &#125;)</span><br><span class="line">    local port=$&#123;array[<span class="number">1</span>]&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ›å»ºMySQLç”¨æˆ·ï¼ŒæŒ‡å®šMySQLæ‰€åœ¨çš„ç”¨æˆ·ç»„</span></span><br><span class="line">    groupadd mysql &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    useradd -g mysql mysql -s /sbin/nologin &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è§£å‹MySQLè½¯ä»¶åŒ…ï¼Œå¹¶å¯¹mysqlç›®å½•æˆæƒ</span></span><br><span class="line">    cd /usr/local</span><br><span class="line">    tar -zxvf mysql-<span class="number">5.7</span>.<span class="number">23</span>-el7-x86_64.tar.gz &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    ln -s mysql-<span class="number">5.7</span>.<span class="number">23</span>-el7-x86_64 mysql</span><br><span class="line">    chown mysql:mysql -R mysql</span><br><span class="line">    chown mysql:mysql -R mysql-<span class="number">5.7</span>.<span class="number">23</span>-el7-x86_64</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ›å»ºæ•°æ®ç›®å½•</span></span><br><span class="line">    mkdir -p <span class="variable">$datadir</span></span><br><span class="line">    chown mysql:mysql -R <span class="variable">$datadir</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–æ•°æ®åº“</span></span><br><span class="line">    cd /usr/local/mysql/bin</span><br><span class="line">    ./mysqld --defaults-file=<span class="string">"<span class="variable">$defaults_file</span>"</span> --basedir=<span class="string">"<span class="variable">$basedir</span>"</span> --datadir=<span class="string">"<span class="variable">$datadir</span>"</span> --user=mysql --initialize-insecure &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯åŠ¨æ•°æ®åº“</span></span><br><span class="line">    ./mysqld_safe --defaults-file=<span class="string">"<span class="variable">$defaults_file</span>"</span> --pid-file=<span class="string">"<span class="variable">$pid_file</span>"</span> --user=mysql &gt;/dev/null &amp;</span><br><span class="line">    wait_for_pid created <span class="string">"$!"</span> <span class="string">"<span class="variable">$pid_file</span>"</span>; return_value=$?</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰“å¼€é˜²ç«å¢™ç«¯å£</span></span><br><span class="line">    firewall-cmd --permanent --zone=public --add-port=<span class="number">3306</span>/tcp &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    firewall-cmd --reload &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    cp mysql* /usr/bin &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    <span class="comment"># mv /usr/local/mysql_tool /usr/bin &gt;/dev/null 2&gt;&amp;1</span></span><br><span class="line">    mysql -S <span class="variable">$sock_file</span> mysql -e <span class="string">"SET PASSWORD = 'xx';ALTER USER 'root'@'localhost' PASSWORD EXPIRE NEVER;flush privileges;"</span></span><br><span class="line">    mysql -S <span class="variable">$sock_file</span> mysql -e <span class="string">"SET PASSWORD = 'xx';ALTER USER 'hdm'@'%' PASSWORD EXPIRE NEVER;flush privileges;"</span></span><br><span class="line">    mysql -S <span class="variable">$sock_file</span> mysql -e <span class="string">"SET PASSWORD = 'xx';ALTER USER 'sre'@'%' PASSWORD EXPIRE NEVER;flush privileges;"</span></span><br><span class="line">    <span class="keyword">exit</span> <span class="variable">$return_value</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case <span class="string">"<span class="variable">$cmd</span>"</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">'install'</span>) install_mysql ;;</span><br><span class="line">    <span class="string">'uninstall'</span>) mysql_uninstall ;;</span><br><span class="line">    <span class="string">'start'</span>) mysql_start ;;</span><br><span class="line">    <span class="string">'stop'</span>) mysql_stop ;;</span><br><span class="line">    <span class="string">'restart'</span>) mysql_restart ;;</span><br><span class="line">    <span class="string">'config'</span>) mysql_config ;;</span><br><span class="line">    <span class="string">'monitor'</span>) mysql_monitor ;;</span><br><span class="line">*)</span><br><span class="line">    <span class="comment"># usage</span></span><br><span class="line">    basename=`basename <span class="string">"<span class="variable">$0</span>"</span>`</span><br><span class="line">    echo <span class="string">"Usage: <span class="variable">$basename</span> -cmd &#123;start|stop|restart|install|uninstall|status|monitor&#125; -inst &#123;instance name&#125; [ MySQL tool options ]"</span></span><br><span class="line">    <span class="keyword">exit</span> <span class="number">1</span></span><br><span class="line">    ;;</span><br><span class="line">esac</span><br><span class="line"><span class="keyword">exit</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· æ¡ˆä¾‹é›†é”¦</title>
    <url>/blog/2019/07/15/mysql-cases/</url>
    <content><![CDATA[<h2 id="ç³»åˆ—"><a href="#ç³»åˆ—" class="headerlink" title="ç³»åˆ—"></a>ç³»åˆ—</h2><ul>
<li>MySQL Â· æ¡ˆä¾‹åˆ†æ Â· ä¸»ä»å¤åˆ¶ä¸­æ–­</li>
<li>MySQL Â· æ¡ˆä¾‹åˆ†æ Â· ç£ç›˜ç©ºé—´ä¸è¶³</li>
<li>MySQL Â· æ¡ˆä¾‹åˆ†æ Â· information_schema.tables ä¸ count(*) æŸ¥è¯¢æ•°ä¸ä¸€è‡´</li>
</ul>
<h2 id="æ•°æ®åº“è¿æ¥å¤±è´¥"><a href="#æ•°æ®åº“è¿æ¥å¤±è´¥" class="headerlink" title="æ•°æ®åº“è¿æ¥å¤±è´¥"></a>æ•°æ®åº“è¿æ¥å¤±è´¥</h2><h3 id="é—®é¢˜ç°è±¡"><a href="#é—®é¢˜ç°è±¡" class="headerlink" title="é—®é¢˜ç°è±¡"></a>é—®é¢˜ç°è±¡</h3><p>é¡¹ç›®ç»ç†ç«æ€¥ç«ç‡çš„åé¦ˆï¼Œè¯´æ•°æ®åº“è¿æ¥ä¸ä¸Šäº†ï¼Œè¯·æ±‚æ’æŸ¥é—®é¢˜åŸå› ã€‚</p>
<h3 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><ul>
<li><p>æµ‹è¯• <code>Navicate</code> æ˜¯å¦èƒ½å¤Ÿè¿ä¸Šæ•°æ®åº“ ï¼Ÿ</p>
</li>
<li><p>ç™»å½•æœåŠ¡å™¨ï¼ŒæŸ¥çœ‹ <code>mysqld</code> è¿›ç¨‹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœè¿›ç¨‹ä¸å­˜åœ¨ï¼Œå¯èƒ½æ˜¯æœåŠ¡å™¨æ–­ç”µå¯¼è‡´è¿›ç¨‹æœªè‡ªå¯åŠ¨ã€‚</p>
</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ ssh -p <span class="number">2222</span> <span class="number">01510886</span>@<span class="number">10.138</span>.<span class="number">16.192</span></span><br><span class="line"></span><br><span class="line">$ ps -ef | grep mysqld</span><br><span class="line">root      <span class="number">64511</span>  <span class="number">64440</span>  <span class="number">0</span> <span class="number">10</span>:<span class="number">27</span> pts/<span class="number">2</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> grep --color=auto mysqld</span><br><span class="line">root      <span class="number">79355</span>      <span class="number">1</span>  <span class="number">0</span> Aug31 ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> /bin/sh /usr/local/mysql/bin/mysqld_safe --datadir=/<span class="keyword">data</span>/mysql --pid-file=/<span class="keyword">data</span>/mysql/mysql.pid</span><br><span class="line">mysql     <span class="number">79981</span>  <span class="number">79355</span> <span class="number">99</span> Aug31 ?        <span class="number">2</span>-<span class="number">01</span>:<span class="number">38</span>:<span class="number">14</span> /usr/local/mysql/bin/mysqld --basedir=/usr/local/mysql --datadir=/<span class="keyword">data</span>/mysql --plugin-dir=/usr/local/mysql/lib/plugin --user=mysql --log-error=/<span class="keyword">data</span>/mysql/error.log --pid-file=/<span class="keyword">data</span>/mysql/mysql.pid --socket=/<span class="keyword">data</span>/mysql/mysql.sock --port=<span class="number">3306</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ç™»å½• <code>mysql</code>ï¼ŒæŸ¥çœ‹çº¿ç¨‹çŠ¶æ€ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰é”å ç”¨ï¼Œæˆ–è€…çº¿ç¨‹å¤§é‡é˜»å¡æƒ…å†µã€‚</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ mysql -S /<span class="keyword">data</span>/mysql/mysql.sock -usre -p<span class="string">'sre@@p$i'</span></span><br><span class="line">mysql&gt; show processlist;</span><br></pre></td></tr></table></figure>

<h3 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h3><ul>
<li>å¦‚æœæ˜¯ç¬¬ä¸€ç§åŸå› ï¼Œå¯åŠ¨ <code>mysql</code> è¿›ç¨‹</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ cd /etc/init.d</span><br><span class="line">$ ./mysqld stop/start</span><br><span class="line"></span><br><span class="line">$ cd /usr/local/mysql/support-files</span><br><span class="line">$ ./mysql.server stop/start</span><br></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœæ˜¯ç¬¬äºŒç§åŸå› ï¼Œåˆ é™¤æ­£åœ¨æ‰§è¡Œçš„é”è¡¨çº¿ç¨‹</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ€æ‰IDä¸º1çš„çº¿ç¨‹, å…³é—­è¿æ¥</span><br><span class="line">kill id; </span><br><span class="line"></span><br><span class="line"># æŸ¥è¯¢å‡ºæ—¶é—´å¤§äº10çš„çº¿ç¨‹, å¤åˆ¶æŸ¥è¯¢ç»“æœï¼Œæ‰¹é‡æ‰§è¡Œ</span><br><span class="line">select concat(&apos;kill &apos;, id, &apos;;&apos;) from information_schema.processlist where time &gt; 10;</span><br></pre></td></tr></table></figure>

<h2 id="å¤‡ä»½å¤±è´¥"><a href="#å¤‡ä»½å¤±è´¥" class="headerlink" title="å¤‡ä»½å¤±è´¥"></a>å¤‡ä»½å¤±è´¥</h2><h3 id="ç°è±¡æè¿°"><a href="#ç°è±¡æè¿°" class="headerlink" title="ç°è±¡æè¿°"></a>ç°è±¡æè¿°</h3><p>æ®å¤‡ä»½ä¾›åº”å•†åæ˜ ï¼Œæ˜¨å¤©æ™šä¸Š 22:00 <code>XXç³»ç»Ÿ</code>ï¼Œä»åº“å¤‡ä»½å¤±è´¥ï¼Œä½¿ç”¨çš„å¤‡ä»½å·¥å…·æ˜¯ <code>mysqldump</code>ï¼Œè¯·æ±‚ååŠ©å®šä½å¤‡ä»½å¤±è´¥åŸå› ã€‚</p>
<h3 id="åŸå› åˆ†æ-1"><a href="#åŸå› åˆ†æ-1" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p>ï¼ˆ1ï¼‰æ£€æŸ¥ä»åº“ä¸¤ä¸ªçº¿ç¨‹ <code>Slave_IO_Running</code> å’Œ <code>Slave_SQL_Running</code> å‡æ˜¯ <strong>Yes</strong>ï¼Œè¯´æ˜ä¸»ä»å¤åˆ¶é“¾è·¯æ­£å¸¸ï¼Œä½†æ˜¯ <code>Seconds_Behind_Master</code> ä¸æ–­å¢å¤§ï¼Œä¸”ä¸»ä»æ•°æ®å»¶è¿Ÿæœ‰ä¸æ–­æ‰©å¤§çš„è¶‹åŠ¿ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 10.133.0.51</span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-binlog.000232</span><br><span class="line">          Read_Master_Log_Pos: 3108253</span><br><span class="line">               Relay_Log_File: relay-log.000004</span><br><span class="line">                Relay_Log_Pos: 169851605</span><br><span class="line">        Relay_Master_Log_File: mysql-binlog.000229</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 169851386</span><br><span class="line">              Relay_Log_Space: 3270427001</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 42302</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">              ....</span><br><span class="line">       </span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰æ£€æŸ¥å½“å‰æ•°æ®åº“çº¿ç¨‹çŠ¶æ€ï¼Œæœªå‘ç°æœ‰æ˜æ˜¾å¼‚å¸¸ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; show processlist;</span><br><span class="line">+-------+-------------+-------------------+--------------------+---------+--------+----------------------------------+--------------------------------+</span><br><span class="line">| Id    | User        | Host              | db                 | Command | Time   | State                            | Info                           |</span><br><span class="line">+-------+-------------+-------------------+--------------------+---------+--------+----------------------------------+--------------------------------+</span><br><span class="line">|     1 | system user |                   | NULL               | Connect | 172777 | Waiting for master to send event | NULL                           |</span><br><span class="line">|     2 | system user |                   | NULL               | Connect | 678456 | Reading event from the relay log | NULL                           |</span><br><span class="line">|  4345 | cvbak       | localhost         | NULL               | Query   | 130546 | Waiting for table flush          | FLUSH /*!40101 LOCAL */ TABLES |</span><br><span class="line">| 17662 | root        | localhost         | NULL               | Query   |      0 | starting                         | show processlist               |</span><br><span class="line">| 17671 | hdm         | 10.133.0.52:37170 | information_schema | Sleep   |      1 |                                  | NULL                           |</span><br><span class="line">+-------+-------------+-------------------+--------------------+---------+--------+----------------------------------+--------------------------------+</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰æ£€æŸ¥å½“å‰æ­£åœ¨ä½¿ç”¨çš„è¡¨ï¼š<code>show open tables where In_use=1;</code> å‘ç°æœ‰ä¸€å¼ è¡¨ä¸€ç›´å¤„äº <code>In_use</code> çŠ¶æ€ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show open tables where In_use=1;</span><br><span class="line">+<span class="comment">----------+---------------------------+--------+-------------+</span></span><br><span class="line">| Database | Table                     | In_use | Name_locked |</span><br><span class="line">+<span class="comment">----------+---------------------------+--------+-------------+</span></span><br><span class="line">| tdmetl   | odsepg_zrfc_zco_zzfymx_sw |      1 |           0 |</span><br><span class="line">+<span class="comment">----------+---------------------------+--------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ4ï¼‰æ ¹æ® <code>Relay_Log_Pos</code> è§£æ <code>relay-log.000004</code>ï¼ŒæŸ¥çœ‹å½“æ—¶æ­£åœ¨æ‰§è¡Œçš„æ“ä½œæ˜¯ <code>Delete_rows</code>ï¼Œæ“ä½œçš„è¡¨æ˜¯ <code>tdmetl</code>.<code>odsepg_zrfc_zco_zzfymx_sw</code>ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># mysqlbinlog -vv --base64-output=decode-rows relay-log.000004 --start-position=169851605 | more</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># at 169851605</span></span><br><span class="line"><span class="comment">#190718  4:02:58 server id 3306100  end_log_pos 169851451 CRC32 0x6683bf99 	Anonymous_GTID	last_committed=1831	sequence_number=1832	rbr_</span></span><br><span class="line"><span class="string">only=yes</span></span><br><span class="line"><span class="string">/*!50718</span> <span class="string">SET</span> <span class="string">TRANSACTION</span> <span class="string">ISOLATION</span> <span class="string">LEVEL</span> <span class="string">READ</span> <span class="string">COMMITTED*//*!*/;</span></span><br><span class="line"><span class="string">SET</span> <span class="string">@@SESSION.GTID_NEXT=</span> <span class="string">'ANONYMOUS'</span><span class="string">/*!*/;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># at 169851670</span></span><br><span class="line"><span class="comment">#190718  4:02:58 server id 3306100  end_log_pos 169851525 CRC32 0x9d910e5d 	Query	thread_id=1254417	exec_time=0	error_code=0</span></span><br><span class="line"><span class="string">SET</span> <span class="string">TIMESTAMP=1563393778/*!*/;</span></span><br><span class="line"><span class="string">SET</span> <span class="string">@@session.pseudo_thread_id=1254417/*!*/;</span></span><br><span class="line"><span class="string">SET</span> <span class="string">@@session.foreign_key_checks=1,</span> <span class="string">@@session.sql_auto_is_null=0,</span> <span class="string">@@session.unique_checks=1,</span> <span class="string">@@session.autocommit=1/*!*/;</span></span><br><span class="line"><span class="string">SET</span> <span class="string">@@session.sql_mode=1436549128/*!*/;</span></span><br><span class="line"><span class="string">SET</span> <span class="string">@@session.auto_increment_increment=1,</span> <span class="string">@@session.auto_increment_offset=1/*!*/;</span></span><br><span class="line"><span class="string">/*!\C</span> <span class="string">utf8</span> <span class="string">*//*!*/;</span></span><br><span class="line"><span class="string">SET</span> <span class="string">@@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=33/*!*/;</span></span><br><span class="line"><span class="string">SET</span> <span class="string">@@session.lc_time_names=0/*!*/;</span></span><br><span class="line"><span class="string">SET</span> <span class="string">@@session.collation_database=DEFAULT/*!*/;</span></span><br><span class="line"><span class="string">BEGIN</span></span><br><span class="line"><span class="string">/*!*/;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># at 169851744</span></span><br><span class="line"><span class="comment">#190718  4:02:58 server id 3306100  end_log_pos 169851626 CRC32 0x6b8bbd2d 	Table_map: `tdmetl`.`odsepg_zrfc_zco_zzfymx_sw` mapped to number 170</span></span><br><span class="line"><span class="number">018</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># at 169851845</span></span><br><span class="line"><span class="comment">#190718  4:02:58 server id 3306100  end_log_pos 169859832 CRC32 0x338e105a 	Delete_rows: table id 170018</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ5ï¼‰æ£€æŸ¥è¡¨ç»“æ„ï¼Œå‘ç°è¯¥è¡¨æ•°æ®é‡å¾ˆå¤§ä¸”æ— ä¸»é”®ã€‚ç”±æ­¤åŸºæœ¬ç¡®å®šå…¶é—®é¢˜æ ¹æœ¬åŸå› ï¼š<strong>å¯¹æ— ä¸»é”®çš„è¡¨è¿›è¡Œåˆ é™¤æˆ–è€…æ›´æ–°ï¼Œå¯¼è‡´ä»åº“å¤¯ä½</strong>ã€‚è¯¥è¡¨æ•°æ®é‡ï¼š77961221æ¡ã€‚</p>
<p><img src="http://ww2.sinaimg.cn/large/006y8mN6ly1g6873jkiw5j30yf0gigpp.jpg" alt="image-20190822092437992"></p>
<h3 id="è§£å†³æ–¹æ³•-1"><a href="#è§£å†³æ–¹æ³•-1" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¡¨æ·»åŠ è‡ªå¢ä¸»é”®ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">'xxxx'</span> <span class="keyword">ADD</span> <span class="keyword">id</span> <span class="built_in">int</span> <span class="keyword">UNSIGNED</span> primary <span class="keyword">key</span> AUTO_INCREMENT;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰å¤§è¡¨åˆ é™¤ä½¿ç”¨ <code>truncate</code> å‘½ä»¤ã€‚</p>
<h3 id="å»ºè®®"><a href="#å»ºè®®" class="headerlink" title="å»ºè®®"></a>å»ºè®®</h3><ul>
<li>é¿å…æ—  <code>where</code> æ¡ä»¶çš„ <code>delete</code> æˆ– <code>update</code> æ“ä½œå¤§è¡¨ï¼Œå¦‚æœéœ€è¦å…¨è¡¨åˆ é™¤ï¼Œä½¿ç”¨ <code>truncate</code> æ“ä½œã€‚</li>
<li>åœ¨ <code>binlog row</code> æ¨¡å¼ä¸‹è¡¨ç»“æ„æœ€å¥½èƒ½æœ‰ä¸»é”®ã€‚</li>
</ul>
<h2 id="ä¸»ä»å¤åˆ¶ä¸­æ–­"><a href="#ä¸»ä»å¤åˆ¶ä¸­æ–­" class="headerlink" title="ä¸»ä»å¤åˆ¶ä¸­æ–­"></a>ä¸»ä»å¤åˆ¶ä¸­æ–­</h2><h3 id="é—®é¢˜ç°è±¡-1"><a href="#é—®é¢˜ç°è±¡-1" class="headerlink" title="é—®é¢˜ç°è±¡"></a>é—®é¢˜ç°è±¡</h3><p>ç›‘æ§ç³»ç»Ÿï¼Œæ£€æµ‹åˆ°<code>xxé¡¹ç›®</code>ä¸»ä»å¤åˆ¶ä¸­æ–­ï¼Œå¹¶å‘é€äº†å‘Šè­¦</p>
<h3 id="åŸå› åˆ†æ-2"><a href="#åŸå› åˆ†æ-2" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p>1ï¼‰ç™»å½•æ‰€æŠ¥å‘Šè­¦æ•°æ®åº“ï¼ŒæŸ¥çœ‹å¤åˆ¶çŠ¶æ€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh haieradmin@10.138.8.216</span><br><span class="line">ssh root@10.159.37.148</span><br><span class="line">ssh haieradmin@10.159.44.168</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 10.133.8.96</span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.002660</span><br><span class="line">          Read_Master_Log_Pos: 343075905</span><br><span class="line">               Relay_Log_File: relay-log-bin.003429</span><br><span class="line">                Relay_Log_Pos: 555</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.001741</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: No</span><br></pre></td></tr></table></figure>

<p>ç»æ£€æŸ¥ <code>Slave_SQL_Running</code> ä¸º <strong>No</strong>ï¼ŒåŸå› ä¸€èˆ¬éƒ½å¾ˆæ˜æ˜¾ï¼Œè®°å½•åœ¨ <code>Last_Error</code>ï¼Œæ ¹æ®æŠ¥é”™åŸå› é€‰æ‹©åˆé€‚åœ°è§£å†³æ–¹æ³•ï¼Œæœ€å¸¸ç”¨çš„è§£å†³åŠæ³•æ˜¯è·³è¿‡è¿™ä¸€æ¡æ­£åœ¨æ‰§è¡Œçš„ SQLã€‚</p>
<h3 id="è§£å†³æ–¹æ³•-2"><a href="#è§£å†³æ–¹æ³•-2" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰ç™»é™† <code>10.133.0.53</code></p>
<p>ï¼ˆ2ï¼‰æ‰§è¡Œä¸‹é¢æ“ä½œ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">pt-slave-restart -h 'x.x.x.x' -u'xx' -p'xx' -P 3306</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸€èˆ¬æ˜¯äº‹åŠ¡å›æ»šé€ æˆçš„</span></span><br><span class="line"><span class="keyword">stop</span> <span class="keyword">slave</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">GLOBAL</span> SQL_SLAVE_SKIP_COUNTER=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">slave</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show slave status\G</span><br><span class="line">************************* 1. row ***************************</span><br><span class="line">               Slave_IO_State: </span><br><span class="line">                  Master_Host: 10.135.22.70</span><br><span class="line">                  Master_User: repluser</span><br><span class="line">                  Master_Port: 3308</span><br><span class="line">                Connect_Retry: 10</span><br><span class="line">              Master_Log_File: mysql-bin.001935</span><br><span class="line">          Read_Master_Log_Pos: 6587</span><br><span class="line">               Relay_Log_File: relay-log.001487</span><br><span class="line">                Relay_Log_Pos: 4</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.001935</span><br><span class="line">             Slave_IO_Running: No</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: test.%</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 6587</span><br><span class="line">              Relay_Log_Space: 107</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: NULL</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 1236</span><br><span class="line">                Last_IO_Error: Got fatal error 1236 from master when reading data from binary log: 'Could not find first log file name in binary log index file'</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 1</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Slave_IO_Running: No</span><br><span class="line">Slave_SQL_Running: Yes</span><br><span class="line">Last_IO_Error: Got fatal error 1236 from master when reading data from binary log: 'Could not find first log file name in binary log index file'</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[root@hop02 mzjh]<span class="comment"># ll | grep mysql-bin</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1073742013</span> Sep <span class="number">12</span> <span class="number">14</span>:<span class="number">55</span> mysql-bin.<span class="number">001948</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1073742073</span> Sep <span class="number">13</span> <span class="number">11</span>:<span class="number">53</span> mysql-bin.<span class="number">001949</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1073742120</span> Sep <span class="number">14</span> <span class="number">08</span>:<span class="number">39</span> mysql-bin.<span class="number">001950</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1073859355</span> Sep <span class="number">15</span> <span class="number">06</span>:<span class="number">21</span> mysql-bin.<span class="number">001951</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1074054892</span> Sep <span class="number">16</span> <span class="number">06</span>:<span class="number">18</span> mysql-bin.<span class="number">001952</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1075243641</span> Sep <span class="number">17</span> <span class="number">06</span>:<span class="number">18</span> mysql-bin.<span class="number">001953</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1074801420</span> Sep <span class="number">18</span> <span class="number">06</span>:<span class="number">16</span> mysql-bin.<span class="number">001954</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1075257243</span> Sep <span class="number">19</span> <span class="number">06</span>:<span class="number">16</span> mysql-bin.<span class="number">001955</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql   <span class="number">619405162</span> Sep <span class="number">19</span> <span class="number">13</span>:<span class="number">32</span> mysql-bin.<span class="number">001956</span></span><br><span class="line">-rw-rw----. <span class="number">1</span> mysql mysql  <span class="number">1072898197</span> Sep <span class="number">20</span> <span class="number">09</span>:<span class="number">44</span> mysql-bin.<span class="number">001957</span></span><br><span class="line">-rw-r-----. <span class="number">1</span> mysql mysql         <span class="number">190</span> Sep <span class="number">19</span> <span class="number">13</span>:<span class="number">32</span> mysql-bin.index</span><br></pre></td></tr></table></figure>

<p>ä»åº“åœ¨ä¸»åº“æ‰¾ä¸åˆ° binlog æ–‡ä»¶</p>
<p><strong>åŸå› </strong></p>
<p>è¯¥é”™è¯¯å‘ç”Ÿåœ¨ä»åº“çš„ioè¿›ç¨‹ä»ä¸»åº“æ‹‰å–æ—¥å¿—æ—¶ï¼Œå‘ç°ä¸»åº“çš„mysql_bin.indexæ–‡ä»¶ä¸­ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¸å­˜åœ¨ã€‚å‡ºç°æ­¤ç±»æŠ¥é”™å¯èƒ½æ˜¯ç”±äºä½ çš„slave ç”±äºæŸç§åŸå› åœæ­¢äº†å¥½é•¿ä¸€æ®µæ˜¯æ—¶é—´ï¼Œå½“ä½ é‡å¯slave å¤åˆ¶çš„æ—¶å€™ï¼Œåœ¨ä¸»åº“ä¸Šæ‰¾ä¸åˆ°ç›¸åº”çš„binlog ,ä¼šæŠ¥æ­¤ç±»é”™è¯¯ã€‚æˆ–è€…æ˜¯ç”±äºæŸäº›è®¾ç½®ä¸»åº“ä¸Šçš„binlogè¢«åˆ é™¤äº†ï¼Œå¯¼è‡´ä»åº“è·å–ä¸åˆ°å¯¹åº”çš„binglog fileã€‚</p>
<h2 id="ä¸»ä»å¤åˆ¶å»¶è¿Ÿ"><a href="#ä¸»ä»å¤åˆ¶å»¶è¿Ÿ" class="headerlink" title="ä¸»ä»å¤åˆ¶å»¶è¿Ÿ"></a>ä¸»ä»å¤åˆ¶å»¶è¿Ÿ</h2><h3 id="é£é™©"><a href="#é£é™©" class="headerlink" title="é£é™©"></a>é£é™©</h3><ul>
<li>å¤‡åº“å¤åˆ¶å¤¯ä½ï¼Œä¼šå¯¼è‡´å¤‡ä»½å¤±è´¥ï¼ˆflush tables with read lock 900s è¶…æ—¶ï¼‰</li>
<li>ä»¥ Slave ä¸ºåŸºå‡†è¿›è¡Œçš„å¤‡ä»½ï¼Œæ•°æ®ä¸æ˜¯æœ€æ–°çš„æœ‰å»¶è¿Ÿ</li>
<li>å¼‚å¸¸æƒ…å†µä¸‹ï¼Œä¸»ä» HA æ— æ³•åˆ‡æ¢ï¼ŒHA éœ€è¦æ£€æŸ¥æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå»¶è¿Ÿæ—¶ä¸»å¤‡ä¸ä¸€è‡´</li>
</ul>
<h3 id="åœºæ™¯-amp-è§£å†³æ–¹æ³•"><a href="#åœºæ™¯-amp-è§£å†³æ–¹æ³•" class="headerlink" title="åœºæ™¯ &amp; è§£å†³æ–¹æ³•"></a>åœºæ™¯ &amp; è§£å†³æ–¹æ³•</h3><ul>
<li>æ— ä¸»é”®ã€æ— ç´¢å¼•æˆ–ç´¢å¼•åŒºåˆ†åº¦ä¸é«˜</li>
</ul>
<p><strong>ç°è±¡</strong>ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">show slave statusï¼Œ æ˜¾ç¤ºpositionä¸€ç›´æ²¡æœ‰å˜</span><br><span class="line">show open tables where In_use=<span class="number">1</span>ï¼Œ æ˜¾ç¤ºæŸä¸ªè¡¨ä¸€ç›´æ˜¯in_useä¸º <span class="number">1</span></span><br><span class="line">show create tableï¼ŒæŸ¥çœ‹è¡¨ç»“æ„å¯ä»¥çœ‹åˆ°æ— ä¸»é”®ï¼Œæˆ–è€…æ— ä»»ä½•ç´¢å¼•ï¼Œæˆ–è€…ç´¢å¼•åŒºåˆ†åº¦å¾ˆå·®</span><br></pre></td></tr></table></figure>

<p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰¾åˆ°è¡¨åŒºåˆ†åº¦æ¯”è¾ƒé«˜çš„å‡ ä¸ªå­—æ®µ, å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•åˆ¤æ–­ï¼š</span></span><br><span class="line">select count(*) from xx;</span><br><span class="line">select count(*) from (select distinct xx from xxx) t;</span><br><span class="line">å¦‚æœ<span class="number">2</span>ä¸ªæŸ¥è¯¢count(*)çš„ç»“æœå·®ä¸å¤šï¼Œè¯´æ˜å¯ä»¥å¯¹è¿™äº›å­—æ®µåŠ ç´¢å¼•</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤‡åº“ stop slave;</span></span><br><span class="line">å¯èƒ½ä¼šæ‰§è¡Œæ¯”è¾ƒä¹…ï¼Œå› ä¸ºéœ€è¦å›æ»šäº‹åŠ¡ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤‡åº“</span></span><br><span class="line">set sql_log_bin=<span class="number">0</span>;</span><br><span class="line">alter table xx add key xx(xx);</span><br><span class="line">alter table <span class="string">'xxxx'</span> add id int(<span class="number">10</span>) unsigned primary key AUTO_INCREMENT;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤‡åº“ start slave</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸»åº“ä¸Šæœ‰å¤§äº‹åŠ¡ï¼Œå¯¼è‡´ä»åº“å»¶æ—¶</li>
</ul>
<p><strong>ç°è±¡</strong>ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">è§£æbinlogæ–‡ä»¶ï¼Œå‘ç°ä¸€ç›´æ‰“å°çš„æ˜¯Write_rows</span></span><br></pre></td></tr></table></figure>

<p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">äº‹å‰é˜²èŒƒï¼šä¸å¼€å‘æ²Ÿé€šï¼Œå¢åŠ ç¼“å­˜ï¼Œå¼‚æ­¥å†™å…¥æ•°æ®åº“,å‡å°‘ä¸šåŠ¡ç›´æ¥å¯¹dbçš„å¤§äº‹åŠ¡å†™å…¥</span></span><br><span class="line"><span class="string">äº‹ä¸­è¡¥æ•‘ï¼šè°ƒæ•´æ•°æ®åº“ä¸­ioç›¸å…³çš„å‚æ•°æ¯”å¦‚innodb_flush_log_at_trx_commitå’Œsync_binlogï¼Œæˆ–è€…æ‰“å¼€å¹¶è¡Œå¤åˆ¶åŠŸèƒ½</span></span><br></pre></td></tr></table></figure>

<ul>
<li>åº“å†™å…¥é¢‘ç¹ï¼Œä»åº“å‹åŠ›è·Ÿä¸ä¸Šå¯¼è‡´å»¶æ—¶</li>
</ul>
<p><strong>ç°è±¡</strong>ï¼š</p>
<p>æ­¤ç±»åŸå› çš„ä¸»è¦ç°è±¡æ˜¯æ•°æ®åº“çš„ <code>IUD</code> æ“ä½œéå¸¸å¤šï¼Œ<code>slave</code> ç”±äº <code>sql_thread</code> å•çº¿ç¨‹çš„åŸå› è¿½ä¸ä¸Šä¸»åº“ã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">a.</span> <span class="string">å‡çº§ä»åº“çš„ç¡¬ä»¶é…ç½®ï¼Œæ¯”å¦‚</span> <span class="string">ssd,fio</span></span><br><span class="line"><span class="string">b.</span> <span class="string">ä½¿ç”¨@ä¸å¥‡çš„é¢„çƒ­å·¥å…·</span> <span class="bullet">-relay</span> <span class="string">fetch</span></span><br><span class="line"><span class="string">åœ¨å¤‡åº“sqlçº¿ç¨‹æ‰§è¡Œæ›´æ–°ä¹‹å‰ï¼Œé¢„å…ˆå°†ç›¸åº”çš„æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­,å¹¶ä¸èƒ½æé«˜sql_threadçº¿ç¨‹æ‰§è¡Œsqlçš„èƒ½åŠ›ï¼Œ</span> <span class="string">ä¹Ÿä¸èƒ½åŠ å¿«io_threadçº¿ç¨‹è¯»å–æ—¥å¿—çš„é€Ÿåº¦ã€‚</span></span><br><span class="line"><span class="string">c.</span> <span class="string">ä½¿ç”¨å¤šçº¿ç¨‹å¤åˆ¶</span> <span class="string">é˜¿é‡ŒMySQLå›¢é˜Ÿå®ç°çš„æ–¹æ¡ˆ</span> <span class="bullet">--</span> <span class="string">åŸºäºè¡Œçš„å¹¶è¡Œå¤åˆ¶ã€‚</span></span><br><span class="line"><span class="string">è¯¥æ–¹æ¡ˆå…è®¸å¯¹åŒä¸€å¼ è¡¨è¿›è¡Œä¿®æ”¹çš„ä¸¤ä¸ªäº‹åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œåªè¦è¿™ä¸¤ä¸ªäº‹åŠ¡ä¿®æ”¹äº†è¡¨ä¸­çš„ä¸åŒçš„è¡Œã€‚</span></span><br><span class="line"><span class="string">è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥è¾¾åˆ°äº‹åŠ¡é—´æ›´é«˜çš„å¹¶å‘åº¦ï¼Œä½†æ˜¯å±€é™æ˜¯å¿…é¡»ä½¿ç”¨Rowæ ¼å¼çš„binlogã€‚</span></span><br><span class="line"><span class="string">å› ä¸ºåªæœ‰ä½¿ç”¨Rowæ ¼å¼çš„binlogæ‰å¯ä»¥çŸ¥é“ä¸€ä¸ªäº‹åŠ¡æ‰€ä¿®æ”¹çš„è¡Œçš„èŒƒå›´ï¼Œè€Œä½¿ç”¨Statementæ ¼å¼çš„binlogåªèƒ½çŸ¥é“ä¿®æ”¹çš„è¡¨å¯¹è±¡ã€‚</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å¤§é‡ <code>myisam</code> è¡¨ï¼Œåœ¨å¤‡ä»½æ—¶å¯¼è‡´ <code>slave</code> å»¶æ—¶</li>
</ul>
<p><strong>ç°è±¡</strong>ï¼š</p>
<p>ç”±äº <code>xtrabackup</code> å·¥å…·å¤‡ä»½åˆ°æœ€åä¼šæ‰§è¡Œ <code>flash tables with read lock</code>ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œé”è¡¨ä»¥ä¾¿è¿›è¡Œä¸€è‡´æ€§å¤‡ä»½ï¼Œç„¶åå¯¹äº <code>myisam</code> é”è¡¨ï¼Œä¼šé˜»ç¢ <code>salve_sql_thread</code> è¿è¡Œè¿›è€Œå¯¼è‡´å¤¯ä½ã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p>
<p>ä¿®æ”¹è¡¨ç»“æ„ä¸º <code>InnoDB</code> å­˜å‚¨å¼•æ“çš„è¡¨</p>
<h2 id="è¡¨ç¢ç‰‡"><a href="#è¡¨ç¢ç‰‡" class="headerlink" title="è¡¨ç¢ç‰‡"></a>è¡¨ç¢ç‰‡</h2><p>è¡¨ç¢ç‰‡æ˜¯ <code>MySQL</code> è¿ç»´è¿‡ç¨‹ä¸­æ¯”è¾ƒå¸¸è§çš„é—®é¢˜ï¼Œç¢ç‰‡çš„å­˜åœ¨ååˆ†å½±å“æ•°æ®åº“çš„æ€§èƒ½ã€‚</p>
<h3 id="åˆ¤æ–­æ–¹æ³•"><a href="#åˆ¤æ–­æ–¹æ³•" class="headerlink" title="åˆ¤æ–­æ–¹æ³•"></a>åˆ¤æ–­æ–¹æ³•</h3><p>MySQL çš„ç¢ç‰‡æ˜¯å¦äº§ç”Ÿï¼Œé€šè¿‡æŸ¥çœ‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">show table status from table_name\G;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‘½ä»¤ä¸­ <code>Data_free</code> å­—æ®µï¼Œå¦‚æœè¯¥å­—æ®µä¸ä¸º 0ï¼Œåˆ™äº§ç”Ÿäº†æ•°æ®ç¢ç‰‡ã€‚</p>
<h3 id="äº§ç”ŸåŸå› "><a href="#äº§ç”ŸåŸå› " class="headerlink" title="äº§ç”ŸåŸå› "></a>äº§ç”ŸåŸå› </h3><p><strong>1. ç»å¸¸è¿›è¡Œ delete æ“ä½œ</strong></p>
<p>ç»å¸¸è¿›è¡Œ <code>delete</code> æ“ä½œï¼Œäº§ç”Ÿç©ºç™½ç©ºé—´ï¼Œå¦‚æœè¿›è¡Œæ–°çš„æ’å…¥æ“ä½œï¼ŒMySQL å°†å°è¯•åˆ©ç”¨è¿™äº›ç•™ç©ºçš„åŒºåŸŸï¼Œä½†ä»ç„¶æ— æ³•å°†å…¶å½»åº•å ç”¨ï¼Œä¹…è€Œä¹…ä¹‹å°±äº§ç”Ÿäº†ç¢ç‰‡ï¼›</p>
<p><strong>2. update æ›´æ–°</strong></p>
<p><code>update</code> æ›´æ–°å¯å˜é•¿åº¦çš„å­—æ®µ(ä¾‹å¦‚ï¼š<code>varchar</code> ç±»å‹)ï¼Œå°†é•¿çš„å­—ç¬¦ä¸²æ›´æ–°æˆçŸ­çš„ã€‚ä¹‹å‰å­˜å‚¨çš„å†…å®¹é•¿ï¼Œåæ¥å­˜å‚¨æ˜¯çŸ­çš„ï¼Œå³ä½¿åæ¥æ’å…¥æ–°æ•°æ®ï¼Œé‚£ä¹ˆæœ‰ä¸€äº›ç©ºç™½åŒºåŸŸè¿˜æ˜¯æ²¡èƒ½æœ‰æ•ˆåˆ©ç”¨çš„ã€‚</p>
<h3 id="äº§ç”Ÿå½±å“"><a href="#äº§ç”Ÿå½±å“" class="headerlink" title="äº§ç”Ÿå½±å“"></a>äº§ç”Ÿå½±å“</h3><ol>
<li><p>ç”±äºç¢ç‰‡ç©ºé—´æ˜¯ä¸è¿ç»­çš„ï¼Œå¯¼è‡´è¿™äº›ç©ºé—´ä¸èƒ½å……åˆ†è¢«åˆ©ç”¨ï¼›</p>
</li>
<li><p>ç”±äºç¢ç‰‡çš„å­˜åœ¨ï¼Œå¯¼è‡´æ•°æ®åº“çš„ç£ç›˜ <code>I/O</code> æ“ä½œå˜æˆç¦»æ•£éšæœºè¯»å†™ï¼ŒåŠ é‡äº†ç£ç›˜ <code>I/O</code> çš„è´Ÿæ‹…ã€‚</p>
</li>
</ol>
<h3 id="æ¸…ç†åŠæ³•"><a href="#æ¸…ç†åŠæ³•" class="headerlink" title="æ¸…ç†åŠæ³•"></a>æ¸…ç†åŠæ³•</h3><ul>
<li><p>MyISAMï¼š<code>optimize table</code> è¡¨åï¼›ï¼ˆOPTIMIZE å¯ä»¥æ•´ç†æ•°æ®æ–‡ä»¶ï¼Œå¹¶é‡æ’ç´¢å¼•ï¼‰</p>
</li>
<li><p>InnoDBï¼š</p>
<p>ï¼ˆ1ï¼‰é‡å»ºè¡¨å­˜å‚¨å¼•æ“ï¼š<code>ALTER TABLE tablename ENGINE = InnoDB;</code></p>
<p>ï¼ˆ2ï¼‰è¿›è¡Œä¸€æ¬¡æ•°æ®çš„å¯¼å…¥å¯¼å‡º</p>
</li>
</ul>
<p><strong>ç¢ç‰‡æ¸…ç†çš„æ€§èƒ½å¯¹æ¯”ï¼š</strong></p>
<p>å¼•ç”¨æˆ‘ä¹‹å‰ä¸€ä¸ªç”Ÿäº§åº“çš„æ•°æ®ï¼Œå¯¹æ¯”ä¸€ä¸‹æ¸…ç†å‰åçš„ SQL æ‰§è¡Œé€Ÿåº¦å·®å¼‚ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">select</span> <span class="string">count(*)</span> <span class="string">from</span> <span class="string">test.twitter_11;</span></span><br><span class="line"><span class="string">ä¿®æ”¹å‰ï¼š1</span> <span class="string">row</span> <span class="string">in</span> <span class="string">set</span> <span class="string">(7.37</span> <span class="string">sec)</span></span><br><span class="line"><span class="string">ä¿®æ”¹åï¼š1</span> <span class="string">row</span> <span class="string">in</span> <span class="string">set</span> <span class="string">(1.28</span> <span class="string">sec)</span></span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>é€šè¿‡å¯¹æ¯”ï¼Œå¯ä»¥çœ‹åˆ°ç¢ç‰‡æ¸…ç†å‰åï¼ŒèŠ‚çœäº†å¾ˆå¤šç©ºé—´ï¼ŒSQLæ‰§è¡Œæ•ˆç‡æ›´å¿«ã€‚æ‰€ä»¥ï¼Œ<strong>åœ¨æ—¥å¸¸è¿ç»´å·¥ä½œä¸­ï¼Œåº”è¯¥å¯¹è¡¨ç¢ç‰‡è¿›è¡Œå®šæœŸæ¸…ç†ï¼Œä¿è¯æ•°æ®åº“æœ‰ç¨³å®šçš„æ€§èƒ½ã€‚</strong></p>
<h2 id="è§¦å‘å™¨åˆ›å»ºå¤±è´¥"><a href="#è§¦å‘å™¨åˆ›å»ºå¤±è´¥" class="headerlink" title="è§¦å‘å™¨åˆ›å»ºå¤±è´¥"></a>è§¦å‘å™¨åˆ›å»ºå¤±è´¥</h2><h3 id="é—®é¢˜ç°è±¡-2"><a href="#é—®é¢˜ç°è±¡-2" class="headerlink" title="é—®é¢˜ç°è±¡"></a>é—®é¢˜ç°è±¡</h3><p>åˆ›å»ºè§¦å‘å™¨ï¼ŒæŠ¥é”™æç¤ºâ€1419â€</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">ERROR</span> <span class="number">1419</span> <span class="string">(HY000):</span> <span class="string">You</span> <span class="string">do</span> <span class="string">not</span> <span class="string">have</span> <span class="string">the</span> <span class="string">SUPER</span> <span class="string">privilege</span> <span class="string">and</span></span><br><span class="line"><span class="string">binary</span> <span class="string">logging</span> <span class="string">is</span> <span class="string">enabled</span> <span class="string">(you</span> <span class="string">*might*</span> <span class="string">want</span> <span class="string">to</span> <span class="string">use</span> <span class="string">the</span> <span class="string">less</span> <span class="string">safe</span> <span class="string">log_bin_trust_routine_creators</span> <span class="string">variable)</span></span><br></pre></td></tr></table></figure>

<h3 id="åŸå› åˆ†æ-3"><a href="#åŸå› åˆ†æ-3" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p>æœ‰äº›æ“ä½œè¦ç¦æ­¢æ‰å¯¹ SUPER æƒé™çš„è¦æ±‚ï¼Œè¦å¤„ç†å¯ä»¥è®¾ç½® <code>log_bin_trust_routine_creators</code> å…¨å±€ç³»ç»Ÿå˜é‡ä¸º <code>1</code>ï¼Œé»˜è®¤åœ°ï¼Œè¿™ä¸ªå˜é‡å€¼ä¸º <code>0</code>ã€‚</p>
<h3 id="è§£å†³æ–¹æ³•-3"><a href="#è§£å†³æ–¹æ³•-3" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h3><p>ç›´æ¥åœ¨æ•°æ®åº“è¿›è¡Œä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥åœ¨å¯åŠ¨æœåŠ¡å™¨ä¹‹æ—¶ç”¨ <code>--log-bin-trust-routine-creators</code> é€‰é¡¹æ¥è®¾ç½®å…è®¸è¿™ä¸ªå˜é‡ã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; SET GLOBAL log_bin_trust_routine_creators = 1;</span><br></pre></td></tr></table></figure>

<h2 id="åˆ é™¤çº¿ç¨‹"><a href="#åˆ é™¤çº¿ç¨‹" class="headerlink" title="åˆ é™¤çº¿ç¨‹"></a>åˆ é™¤çº¿ç¨‹</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/sh</span><br><span class="line">while :</span><br><span class="line">do</span><br><span class="line">  n=`mysqladmin processlist -h 127.0.0.1 -uroot -pHaier@123|grep -i sleep |wc -l`</span><br><span class="line">  date=`date +%Y%m%d\[%H:%M:%S]`</span><br><span class="line">  echo $n</span><br><span class="line"></span><br><span class="line">  if [ "$n" -gt 10 ]</span><br><span class="line">  then</span><br><span class="line">  for i in `mysqladmin processlist -h 127.0.0.1 -uroot -pHaier@123|grep -i Query |awk '&#123;print $2&#125;'`</span><br><span class="line">  do</span><br><span class="line">     mysqladmin -h 127.0.0.1 -uroot -pHaier@123 kill $i</span><br><span class="line">  done</span><br><span class="line">  echo "sleep is too many I killed it " &gt;&gt; /data/sleep.log</span><br><span class="line">  echo "$date : $n" &gt;&gt; /data/sleep.log</span><br><span class="line">  fi</span><br><span class="line">  sleep 1</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· æ„å»ºçŸ¥è¯†ä½“ç³»</title>
    <url>/blog/2019/07/12/mysql-cookbook/</url>
    <content><![CDATA[<h2 id="InnoDB-å­˜å‚¨å¼•æ“æ¶æ„"><a href="#InnoDB-å­˜å‚¨å¼•æ“æ¶æ„" class="headerlink" title="InnoDB å­˜å‚¨å¼•æ“æ¶æ„"></a>InnoDB å­˜å‚¨å¼•æ“æ¶æ„</h2><p><img src="http://ww4.sinaimg.cn/large/006tNc79ly1g5tdauxzpzj313i0u0qag.jpg" alt></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>å›½äº§æ•°æ®åº“çš„æ¼”è¿›å†å²</title>
    <url>/blog/2019/07/12/db-evolution/</url>
    <content><![CDATA[<h2 id="1949-1979"><a href="#1949-1979" class="headerlink" title="1949-1979"></a><strong>1949-1979</strong></h2><ul>
<li>1956å¹´ï¼Œå‘¨æ©æ¥æ€»ç†äº²è‡ªé¢†å¯¼äº†â€œç§‘å­¦æŠ€æœ¯å‘å±•åäºŒå¹´è§„åˆ’â€ï¼Œæ ‡å¿—ç€æˆ‘å›½è®¡ç®—æœºäº‹ä¸šçš„å¼€å§‹ã€‚</li>
</ul>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134141.jpg" alt="ä¸­å›½ä»¿åˆ¶å‰è‹è”å¤§å‹æœº"></p>
<ul>
<li>éšååå¹´åŠ¨ä¹±ï¼Œä¸­å›½è®¡ç®—æœºå’Œæ•°æ®åº“çš„ç ”ç©¶åŸºæœ¬åœæ»æˆä¸ºç©ºç™½ã€‚</li>
<li>70å¹´ä»£æœ«ï¼Œå…³ç³»å‹æ•°æ®åº“çš„æ¦‚å¿µåˆšåˆšå…´èµ·ï¼Œ1975å¹´å¾®è½¯æˆç«‹ï¼Œ1977å¹´ Oracle æˆç«‹ï¼ˆ70å¹´ä»£æ˜¯ç¾å›½çš„é»„é‡‘å¹´ä»£ï¼‰ã€‚OLTP è”æœºäº¤æ˜“å¤„ç†ä¹Ÿç§°ä¸ºé¢å‘äº¤æ˜“çš„å¤„ç†è¿‡ç¨‹è®©æ•°æ®åº“å˜å¾—é‡è¦èµ·æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´è®¡ç®—æœºä¸ä½†æ‰¿æ‹…çš„æ˜¯ç»“æœçš„çº¯è®¡ç®—ï¼Œç°åœ¨è¦å®æ—¶æ‰¿æ‹…äº¤æ˜“è¿‡ç¨‹å’Œç»“æœè®°å½•ã€‚</li>
</ul>
<h2 id="1979-1989"><a href="#1979-1989" class="headerlink" title="1979-1989"></a><strong>1979-1989</strong></h2><ul>
<li><p>1977å¹´ï¼Œä¸­å›½äººæ°‘å¤§å­¦è¨å¸ˆç…Šæ•™æˆå’Œç‹çŠæ•™æˆç¼–è‘—ã€Šæ•°æ®åº“ç³»ç»Ÿæ¦‚è®ºã€‹ï¼Œå¹¶å¬å¼€æ•°æ®åº“å¹´ä¼šã€‚</p>
</li>
<li><p>80å¹´ä»£ï¼Œä¸­ç¾æ­£å¼å»ºäº¤ï¼Œä¸­å›½ä¿¡æ¯æŠ€æœ¯å»ºè®¾å¼€å§‹å’Œä¸–ç•Œå¼€å§‹æ¥è½¨ã€‚è‡ªåŠ¨åŒ–è¿˜æ²¡ä¸Šé©¬ï¼Œä¿¡æ¯åŒ–æ›´æ˜¯éš¾å¯»è¸ªè¿¹ï¼Œåœ¨æ•°æ®åº“çš„ç ”å‘å’ŒæŠ•å…¥ä¸Šï¼Œé çš„æ˜¯é›¶æ˜Ÿçš„ç§‘ç ”åŠ›é‡å’Œèµ„é‡‘ã€‚è¿™ä¸ªæ—¶æœŸï¼Œäº§ã€å­¦ã€ç ”æ˜¯ä¸‰æ¡å¹³è¡Œçº¿ã€‚</p>
</li>
</ul>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134142.jpg" alt="ä¸»æµå…³ç³»å‹æ•°æ®åº“å®¶è°±å›¾"></p>
<h2 id="1989-1999"><a href="#1989-1999" class="headerlink" title="1989-1999"></a><strong>1989-1999</strong></h2><ul>
<li>80å¹´ä»£ä»¥ç ”ç©¶æ‰€å’Œå¤§å­¦ä¸ºä¸»çš„å›½å®¶æŠ•å…¥ï¼Œé‚£ä¹ˆåœ¨90å¹´ä»£äº§å‡ºè¿™æ ·å‡ å®¶å›½äº§æ•°æ®åº“å…¬å¸</li>
</ul>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134143.png" alt="90å¹´ä»£863ç ”ç©¶è®¡åˆ’"></p>
<h2 id="1999-2009"><a href="#1999-2009" class="headerlink" title="1999-2009"></a><strong>1999-2009</strong></h2><p>90å¹´ä»£ï¼Œæ”¹é©å¼€æ”¾æ€èµ·çš„çƒ­æ½®ï¼Œå¼€å§‹äº†å¤–èµ„å’Œä¸­å›½å¸‚åœºåˆä½œçš„é»„é‡‘åå¹´ï¼Œå¤–èµ„åœ¨æˆ‘å›½ç©ºå‰å‘å±•é˜¶æ®µï¼ŒOracle å’Œ DB2 æ¨ªæ‰«å¸‚åœºæ‰€æœ‰äº§å“ã€‚åœ¨ä¸­å›½æ•°æ®åº“å…¬å¸åˆšåˆšæˆç«‹æƒ³å¼€å‘äº§å“è¿½èµ¶ Oracle çš„æ—¶å€™ï¼Œå¸‚åœºçš„éœ€æ±‚å·²ç»è¿¸å‘å‡ºæ¥ï¼Œå›½äº§äº§å“æ¥ä¸ä½ï¼Œæ‰€ä»¥å¸‚åœºå°±æ˜¯ Oracle çš„å¤©ä¸‹äº†ã€‚è¿™æ ·å‡ºç°äº†æ­»å¾ªç¯ï¼š</p>
<ul>
<li>äº§å“åˆæœŸéœ€è¦ä¸æ–­çš„è¯•é”™å’ŒéªŒè¯çš„æœºä¼šã€‚</li>
<li>å®¢æˆ·æ²¡æœ‰æ—¶é—´å’ŒåŠæ³•é™ªç€è¯•é”™å’Œæˆé•¿ã€‚</li>
<li>æ²¡æœ‰å®¢æˆ·ï¼Œç”Ÿæ€å°±æ›´å·®ï¼Œæ›´æ²¡æœ‰åŠæ³•è¿›è¡Œäº§å“çš„æŠ•å…¥å’Œè¿­ä»£ã€‚</li>
</ul>
<h2 id="2009-2019"><a href="#2009-2019" class="headerlink" title="2009-2019"></a>2009-2019</h2><p>äº’è”ç½‘å´›èµ·çš„è¿™åå¹´ï¼Œå›½å†…æ•°æ®åº“å‚å•†ï¼š</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134144.png" alt="db"></p>
<p><strong>å»IOE</strong>ï¼šIBM å°å‹æœºã€Oracle æ•°æ®åº“ã€EMC å­˜å‚¨è®¾å¤‡</p>
<p><strong>å–ä»£å“</strong>ï¼šX86 æœåŠ¡å™¨ã€MySQL æ•°æ®åº“ã€åˆ†å¸ƒå¼å­˜å‚¨</p>
<blockquote>
<p>IBMå¤§å‹æœºï¼šIBM Zç³»åˆ—ï¼Œç›®å‰å¸‚åœºæ— æ€§èƒ½ç›¸å½“æ›¿ä»£å“ï¼Œå›½å®¶æ°‘ç”Ÿã€é“¶è¡Œç”µä¿¡ç­‰å…³é”®æ ¸å¿ƒä¸šåŠ¡</p>
</blockquote>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134144.jpg" alt="big"></p>
<blockquote>
<p>å°å‹æœºï¼šUNIX æœåŠ¡å™¨ï¼ŒIBM çš„ POWER å¤„ç†å™¨ + AIX æ“ä½œç³»ç»Ÿï¼ŒRASï¼ˆReliabilityï¼Œ Availabilityï¼ŒServiceability é«˜å¯é æ€§ã€é«˜å¯ç”¨æ€§ã€é«˜æœåŠ¡æ€§ï¼‰ç‰¹æ€§ã€‚è§£å†³æ–¹æ¡ˆä»å¤„ç†å™¨åˆ°å¹³å°ã€æ“ä½œç³»ç»Ÿã€ä¸­é—´ä»¶ï¼Œå†åˆ°åº”ç”¨è½¯ä»¶ï¼Œéƒ½å‡ºäºè‡ªå®¶é—¨ä¸‹ã€‚å¥½å¤„å°±æ˜¯å„å±‚æ¬¡ä¹‹é—´èƒ½æœ‰ä¸€ä¸ªè¾ƒå¥½çš„ä¼˜åŒ–å’Œé…åˆï¼Œè®©ç”¨æˆ·åœ¨ä»é‡‡è´­åˆ°éƒ¨ç½²ã€å†åˆ°åº”ç”¨å’Œç»´æŠ¤çš„è¿‡ç¨‹ä¸­æ— éœ€è‡ªå·±å¤ªè¿‡æ“å¿ƒã€‚åè¿‡æ¥è¯´ï¼Œè¿™ç§æ¨¡å¼ä½¿å¾—ç”¨æˆ·å®¹æ˜“è¢«å‚å•†é”å®šï¼Œåç»­ITç³»ç»Ÿé‡‡è´­ã€ç»´æŠ¤å’Œåº”ç”¨ï¼Œå…¨éƒ¨å¤„äºè¢«å„æ–­åçš„å¼±åŠ¿åœ°ä½ï¼Œé‡‡è´­åçš„ç»´æŠ¤å’Œæ›´æ–°ä¹Ÿåªèƒ½è¢«åŠ¨æ¥å—ã€‚</p>
</blockquote>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134145.png" alt="small"></p>
<blockquote>
<p>x86 æœåŠ¡å™¨ï¼šæˆæœ¬ä½ã€æ˜“æ‰©å±•ã€æ˜“ç»´æŠ¤æ›´æ–°</p>
</blockquote>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134145.jpg" alt="x86"></p>
<ul>
<li>ARM æ¶æ„ï¼šå¹¿æ³›é€‚ç”¨äºç§»åŠ¨ç«¯ï¼Œä¼˜ç‚¹æ˜¯ä½åŠŸè€—ã€‚</li>
<li>x86 æ¶æ„ï¼šå¹¿æ³›ç”¨äº PC ç«¯ï¼Œä¾¿å®œã€æ˜“æ‰©å±•ã€æ˜“é›†æˆç¬¬ä¸‰æ–¹è½¯ä»¶ã€‚</li>
</ul>
<p><strong>ä¸­å›½ IT ä¿¡æ¯æŠ€æœ¯çš„å´›èµ·</strong></p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134146.jpg" alt="itä¿¡æ¯æŠ€æœ¯"></p>
<p><strong>å›½å†…å·¥ä¸šçº§åº”ç”¨è½¯ä»¶å‘å±•</strong></p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134148.jpg" alt="itä¿¡æ¯æŠ€æœ¯"></p>
<p><strong>æœåŠ¡å™¨æ¼”è¿›</strong></p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134149.jpg" alt="æœåŠ¡å™¨"></p>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
  </entry>
  <entry>
    <title>MySQL Â· æ€§èƒ½è°ƒä¼˜</title>
    <url>/blog/2019/07/11/mysql-tuning/</url>
    <content><![CDATA[<h2 id="SQL-ä¼˜åŒ–"><a href="#SQL-ä¼˜åŒ–" class="headerlink" title="SQL ä¼˜åŒ–"></a>SQL ä¼˜åŒ–</h2><ul>
<li><p>å®šä½ä½æ•ˆç‡çš„SQLè¯­å¥ - æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚</p>
</li>
<li><p>é€šè¿‡<code>explain</code>äº†è§£SQLçš„æ‰§è¡Œè®¡åˆ’ã€‚</p>
<ul>
<li><p><code>select_type</code>ï¼šæŸ¥è¯¢ç±»å‹ï¼ˆSIMPLE - ç®€å•æŸ¥è¯¢ã€PRIMARY - ä¸»æŸ¥è¯¢ã€UNION - å¹¶é›†ã€SUBQUERY - å­æŸ¥è¯¢ï¼‰ã€‚</p>
</li>
<li><p><code>table</code>ï¼šè¾“å‡ºç»“æœé›†çš„è¡¨ã€‚</p>
</li>
<li><p><code>type</code>ï¼šè®¿é—®ç±»å‹ï¼ˆALL - å…¨è¡¨æŸ¥è¯¢æ€§èƒ½æœ€å·®ã€indexã€rangeã€refã€eq_refã€constã€NULLï¼‰ã€‚</p>
</li>
<li><p><code>possible_keys</code>ï¼šæŸ¥è¯¢æ—¶å¯èƒ½ç”¨åˆ°çš„ç´¢å¼•ã€‚</p>
</li>
<li><p><code>key</code>ï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚</p>
</li>
<li><p><code>key_len</code>ï¼šç´¢å¼•å­—æ®µçš„é•¿åº¦ã€‚</p>
</li>
<li><p><code>rows</code>ï¼šæ‰«æçš„è¡Œæ•°ï¼Œè¡Œæ•°è¶Šå°‘è‚¯å®šæ€§èƒ½è¶Šå¥½ã€‚</p>
</li>
<li><p><code>extra</code>ï¼šé¢å¤–ä¿¡æ¯ã€‚</p>
</li>
</ul>
</li>
<li><p>é€šè¿‡ <code>show profiles</code> å’Œ <code>show profile for query</code> åˆ†æSQLã€‚</p>
</li>
<li><p>ä¼˜åŒ– CRUD æ“ä½œ</p>
<ul>
<li>ä¼˜åŒ– <code>insert</code> è¯­å¥</li>
<li>ä¼˜åŒ– <code>order by</code> è¯­å¥</li>
<li>ä¼˜åŒ– <code>group by</code> è¯­å¥</li>
<li>ä¼˜åŒ– <code>join</code> è¯­å¥</li>
<li>ä¼˜åŒ– <code>or</code> è¯­å¥</li>
<li>ä¼˜åŒ–åˆ†é¡µ</li>
</ul>
</li>
<li><p><strong>pt-query-digest</strong></p>
</li>
<li><p><strong>explain</strong></p>
</li>
<li><p><strong>show profiling</strong></p>
</li>
</ul>
<h2 id="é…ç½®ä¼˜åŒ–"><a href="#é…ç½®ä¼˜åŒ–" class="headerlink" title="é…ç½®ä¼˜åŒ–"></a>é…ç½®ä¼˜åŒ–</h2><ol>
<li>è°ƒæ•´max_connections</li>
<li>è°ƒæ•´back_log</li>
<li>è°ƒæ•´table_open_cache</li>
<li>è°ƒæ•´thread_cache_size</li>
<li>è°ƒæ•´innodb_lock_wait_timeout</li>
<li>è°ƒæ•´<code>innodb_buffer_pool_size</code>ï¼šInnoDBæ•°æ®å’Œç´¢å¼•çš„å†…å­˜ç¼“å†²åŒºå¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œè¿™ä¸ªå€¼è®¾ç½®å¾—è¶Šé«˜ï¼Œè®¿é—®è¡¨æ•°æ®éœ€è¦è¿›è¡Œçš„ç£ç›˜I/Oæ“ä½œå°±è¶Šå°‘ï¼Œå¦‚æœå¯èƒ½ç”šè‡³å¯ä»¥å°†è¯¥å€¼è®¾ç½®ä¸ºç‰©ç†å†…å­˜å¤§å°çš„80%ã€‚</li>
</ol>
<h2 id="æ¶æ„ä¼˜åŒ–"><a href="#æ¶æ„ä¼˜åŒ–" class="headerlink" title="æ¶æ„ä¼˜åŒ–"></a>æ¶æ„ä¼˜åŒ–</h2><ul>
<li>åˆ†åº“åˆ†è¡¨ï¼ˆæ°´å¹³æ‹†åˆ†/å‚ç›´æ‹†åˆ†ï¼‰</li>
<li>è¯»å†™åˆ†ç¦»</li>
</ul>
<h2 id="SQLæ˜¯æ€æ ·æ‰§è¡Œçš„-ï¼Ÿ"><a href="#SQLæ˜¯æ€æ ·æ‰§è¡Œçš„-ï¼Ÿ" class="headerlink" title="SQLæ˜¯æ€æ ·æ‰§è¡Œçš„ ï¼Ÿ"></a>SQLæ˜¯æ€æ ·æ‰§è¡Œçš„ ï¼Ÿ</h2><p>MySQL æ˜¯å…¸å‹çš„ <code>C/S</code> æ¶æ„ï¼Œå³ <code>Client/Server</code> æ¶æ„ï¼ŒæœåŠ¡å™¨ç«¯ç¨‹åºä½¿ç”¨çš„ <code>mysqld</code>ã€‚æ•´ä½“çš„æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://ww3.sinaimg.cn/large/006y8mN6ly1g6ap6gn423j30p00dc40x.jpg" alt="img"></p>
<p>MySQL ç”±ä¸‰å±‚ç»„æˆï¼š</p>
<p>1ï¼‰è¿æ¥å±‚ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å»ºç«‹è¿æ¥ï¼Œå®¢æˆ·ç«¯å‘é€ <code>SQL</code> è‡³æœåŠ¡å™¨ç«¯ï¼›</p>
<p>2ï¼‰SQL å±‚ï¼šå¯¹ <code>SQL</code> è¯­å¥è¿›è¡ŒæŸ¥è¯¢å¤„ç†ï¼›</p>
<p>3ï¼‰å­˜å‚¨å¼•æ“å±‚ï¼šä¸æ•°æ®åº“æ–‡ä»¶æ‰“äº¤é“ï¼Œè´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œè¯»å–ã€‚</p>
<p>SQLå±‚çš„ç»“æ„ï¼š</p>
<p><img src="http://ww2.sinaimg.cn/large/006tNc79ly1g64xrbwlygj30k004b0sp.jpg" alt="img"></p>
<ul>
<li><strong>è¿æ¥å™¨</strong>ï¼šå®¢æˆ·ç«¯ä¸ Server å»ºç«‹è¿æ¥ï¼Œå¹¶å‘é€ SQL è‡³ Serverï¼ˆ<strong>å»ºç«‹è¿æ¥</strong>ï¼Œ<strong>ç”¨æˆ·éªŒè¯</strong>ï¼Œ<strong>ç®¡ç†è¿æ¥</strong>ï¼‰</li>
<li><strong>æŸ¥è¯¢ç¼“å­˜</strong>ï¼šServer å¦‚æœåœ¨æŸ¥è¯¢ç¼“å­˜ä¸­å‘ç°äº†è¿™æ¡ SQL è¯­å¥ï¼Œå°±ä¼šç›´æ¥å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼›å¦‚æœæ²¡æœ‰ï¼Œå°±è¿›å…¥åˆ°è§£æå™¨é˜¶æ®µã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå› ä¸ºæŸ¥è¯¢ç¼“å­˜å¾€å¾€æ•ˆç‡ä¸é«˜ï¼Œæ‰€ä»¥åœ¨ MySQL8.0 ä¹‹åå°±æŠ›å¼ƒäº†è¿™ä¸ªåŠŸèƒ½ã€‚ï¼ˆ<strong>å‘½ä¸­è¿”å›</strong>ï¼Œ<strong>æœªå‘½ä¸­æ›´æ–°ç¼“å­˜</strong>ï¼‰</li>
<li><strong>è§£æå™¨</strong>ï¼šå¯¹ SQL è¯­å¥è¿›è¡Œè¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æï¼ˆ<strong>è¯­æ³•åˆ†æ</strong>ï¼Œ<strong>è¯­ä¹‰åˆ†æ</strong>ï¼‰</li>
<li><strong>ä¼˜åŒ–å™¨</strong>ï¼šåœ¨ä¼˜åŒ–å™¨ä¸­ä¼šç¡®å®š SQL è¯­å¥çš„æ‰§è¡Œè·¯å¾„ï¼Œæ¯”å¦‚æ˜¯æ ¹æ®å…¨è¡¨æ£€ç´¢ï¼Œè¿˜æ˜¯æ ¹æ®ç´¢å¼•æ¥æ£€ç´¢ç­‰ï¼ˆ<strong>é€‰æ‹©ç´¢å¼•</strong>ï¼Œ<strong>ç”Ÿæˆæ‰§è¡Œè®¡åˆ’</strong>ï¼‰</li>
<li><strong>æ‰§è¡Œå™¨</strong>ï¼šåœ¨æ‰§è¡Œä¹‹å‰éœ€è¦åˆ¤æ–­è¯¥ç”¨æˆ·æ˜¯å¦å…·å¤‡æƒé™ï¼Œå¦‚æœå…·å¤‡æƒé™å°±æ‰§è¡Œ SQL æŸ¥è¯¢å¹¶è¿”å›ç»“æœã€‚ï¼ˆ<strong>éªŒè¯æƒé™</strong>ï¼Œ<strong>è¿”å›ç»“æœ</strong>ï¼‰</li>
</ul>
<p><img src="http://ww1.sinaimg.cn/large/006tNc79ly1g61nat9jo2j31400u0tpc.jpg" alt="img"></p>
<p>SQL è¯­å¥åœ¨ MySQL ä¸­çš„æµç¨‹æ˜¯ï¼šSQL è¯­å¥ â†’ ç¼“å­˜æŸ¥è¯¢ â†’ è§£æå™¨ â†’ ä¼˜åŒ–å™¨ â†’ æ‰§è¡Œå™¨</p>
<p>è¯¦ç»†æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/006tNc79ly1g64togewmoj30m80ieq5a.jpg" alt="img"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ä¸¾ä¾‹ï¼š</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="è¿æ¥å™¨"><a href="#è¿æ¥å™¨" class="headerlink" title="è¿æ¥å™¨"></a>è¿æ¥å™¨</h3><p>è´Ÿè´£ä¸å®¢æˆ·ç«¯å»ºç«‹è¿æ¥ã€éªŒè¯æƒé™ã€ç®¡ç†è¿æ¥ã€‚ä¸€æ¡ SQL è¯­å¥ä»å®¢æˆ·ç«¯ä¼ è¿‡æ¥é¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ªè¿æ¥ï¼Œç”¨ <code>username</code> å’Œ <code>password</code> è®¤è¯èº«ä»½ï¼Œè¿æ¥å®Œæˆåå¦‚æœæ²¡æœ‰å…¶ä»–æ“ä½œä¾¿å¤„äº <code>Sleep</code> çŠ¶æ€ï¼Œé»˜è®¤ <code>8h</code> è‡ªåŠ¨æ–­å¼€ç©ºé—²è¿æ¥ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è¿æ¥å‘½ä»¤ï¼š</span><br><span class="line">mysql -h<span class="variable">$ip</span> -P<span class="variable">$port</span> -u<span class="variable">$user</span> -p</span><br><span class="line"></span><br><span class="line">ç¯èŠ‚ï¼š</span><br><span class="line"><span class="number">1</span>ï¼‰TCPæ¡æ‰‹ï¼Œå»ºç«‹è¿æ¥</span><br><span class="line"><span class="number">2</span>ï¼‰è®¤è¯èº«ä»½</span><br><span class="line"><span class="number">3</span>ï¼‰è·å–æƒé™</span><br></pre></td></tr></table></figure>

<p><strong>é•¿è¿æ¥</strong>ï¼šæŒç»­ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥å¤„ç†è¯·æ±‚ï¼Œç»´æŒé•¿è¿æ¥éœ€è¦æ¶ˆè€—å†…å­˜ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">åŸºæœ¬æ­¥éª¤ï¼šå»ºç«‹è¿æ¥ -&gt; æ•°æ®ä¼ è¾“...ï¼ˆä¿æŒè¿æ¥ï¼‰â€¦ æ•°æ®ä¼ è¾“ -&gt; å…³é—­è¿æ¥</span><br><span class="line">ä¼˜ç‚¹ï¼šçœå»è¾ƒå¤šTCPå»ºç«‹å’Œå…³é—­çš„æ“ä½œï¼Œå‡å°‘æµªè´¹ï¼ŒèŠ‚çº¦æ—¶é—´</span><br><span class="line">é€‚åˆåœºæ™¯ï¼šæ“ä½œé¢‘ç¹ï¼Œç‚¹å¯¹ç‚¹çš„é€šè®¯ï¼Œä¸”è¿æ¥æ•°ä¸èƒ½å¤ªå¤šã€‚ä¾‹å¦‚ï¼šæ•°æ®åº“çš„è¿æ¥ç”¨é•¿è¿æ¥</span><br></pre></td></tr></table></figure>

<p><strong>çŸ­è¿æ¥</strong>ï¼šä¸€ä¸ªè¿æ¥ä»…æ‰§è¡Œå‡ æ¬¡åä¾¿æ–­å¼€ï¼Œç„¶åé‡æ–°å»ºç«‹è¿æ¥ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">åŸºæœ¬æ­¥éª¤ï¼šå»ºç«‹è¿æ¥ -&gt; æ•°æ®ä¼ è¾“ -&gt; å…³é—­è¿æ¥</span><br><span class="line">ä¼˜ç‚¹ï¼šç®¡ç†èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œå­˜åœ¨çš„è¿æ¥éƒ½æ˜¯æœ‰ç”¨çš„è¿æ¥ï¼Œä¸éœ€è¦é¢å¤–çš„æ§åˆ¶æ‰‹æ®µ</span><br><span class="line">é€‚åˆåœºæ™¯ï¼šå¹¶å‘é‡å¤§ï¼Œä½†æ¯ä¸ªç”¨æˆ·æ— éœ€é¢‘ç¹æ“ä½œæƒ…å†µä¸‹éœ€ç”¨çŸ­è¿æ¥å¥½ã€‚ä¾‹å¦‚ï¼šweb ç½‘ç«™</span><br></pre></td></tr></table></figure>

<p><strong>è¿æ¥æ± </strong>ï¼šæ˜¯ä¸€äº›ç½‘ç»œä»£ç†æœåŠ¡æˆ–åº”ç”¨æœåŠ¡å™¨çš„ç‰¹æ€§ï¼Œè¢«æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯å…±äº«ä½¿ç”¨ï¼Œè¿æ¥æ± å¯ä»¥åŠ é€Ÿè¿æ¥ï¼Œä¹Ÿå¯ä»¥å‡å°‘è¿æ¥ï¼Œé™ä½æœåŠ¡å™¨è´Ÿè½½ã€‚</p>
<p><strong>çº¿ç¨‹æ± </strong>ï¼šMySQL æ¯ä¸ªè¿æ¥éƒ½åˆ†é…ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼Œçº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯éƒ½æœ‰ä¸€å®šçš„å¼€é”€ï¼Œå½“çº¿ç¨‹è¿‡å¤šéƒ½å¤„äºæ´»è·ƒçŠ¶æ€ï¼Œä¼šå¯¼è‡´é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»è€Œé€ æˆå·¨å¤§çš„å¼€é”€ï¼Œå¤§é‡çŸ­æŸ¥è¯¢çš„ä¸šåŠ¡åœºæ™¯æ¨èä½¿ç”¨çº¿ç¨‹æ± ã€‚</p>
<h3 id="æŸ¥è¯¢ç¼“å­˜"><a href="#æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="æŸ¥è¯¢ç¼“å­˜"></a>æŸ¥è¯¢ç¼“å­˜</h3><p>å»ºç«‹è¿æ¥åï¼ŒMySQL åœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶ä¼šå…ˆå¯¹æŸ¥è¯¢ç¼“å­˜è¿›è¡ŒæŸ¥è¯¢ï¼Œä¹‹å‰æ‰§è¡Œè¿‡çš„è¯­å¥ä¼šä»¥ <code>key-value</code> å½¢å¼è¢«ç›´æ¥ç¼“å­˜åœ¨å†…å­˜å½“ä¸­ï¼Œ <code>key</code> æ˜¯è¯­å¥ã€<code>value</code> æ˜¯æŸ¥è¯¢ç»“æœï¼ŒæŸ¥è¯¢åæœ‰ 2 ç§ç»“æœï¼š</p>
<ul>
<li>æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ï¼šç›´æ¥è¿”å›ç»“æœï¼ˆæ•ˆç‡å¾ˆé«˜ï¼‰</li>
<li>æŸ¥è¯¢ç¼“å­˜æœªå‘½ä¸­ï¼š ç»§ç»­æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆåï¼Œç»“æœä¼šè¢«å­˜å…¥æŸ¥è¯¢ç¼“å­˜ä¸­</li>
</ul>
<p>æŸ¥è¯¢ç¼“å­˜é»˜è®¤æ˜¯å…³é—­çš„ï¼Œç”± <code>query_cache_type</code> å’Œ <code>query_cache_size</code> ä¸¤ä¸ªå‚æ•°æ§åˆ¶ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">query_cache_typeï¼šå¦æ‰“å¼€æŸ¥è¯¢ç¼“å­˜ï¼Œå¯ä»¥è®¾ç½®ä¸ºOFFã€ONå’ŒDEMANDï¼ŒDEMANDè¡¨ç¤ºåªæœ‰åœ¨æŸ¥è¯¢è¯­å¥ä¸­æ˜ç¡®å†™æ˜SQL_CACHEçš„è¯­å¥æ‰ä¼šæ”¾å…¥æŸ¥è¯¢ç¼“å­˜</span><br><span class="line">query_cache_sizeï¼šæŸ¥è¯¢ç¼“å­˜ä½¿ç”¨çš„æ€»å†…å­˜ç©ºé—´</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¤‡æ³¨ï¼š<strong>ç”Ÿäº§ç¯å¢ƒä¸æ¨èä½¿ç”¨æŸ¥è¯¢ç¼“å­˜</strong>ï¼Œå› ä¸ºåªè¦æœ‰å¯¹è¡¨æ•°æ®æ›´æ–°ï¼Œè¡¨ä¸Šçš„æ‰€æœ‰ç¼“å­˜éƒ½ä¼šæ¸…ç©ºç„¶åé‡æ–°åˆ›å»ºç¼“å­˜ã€‚æŸ¥è¯¢ç¼“å­˜é€‚åˆæœ‰å¤§é‡ç›¸åŒæŸ¥è¯¢çš„åº”ç”¨ï¼Œä¸é€‚åˆæœ‰å¤§é‡æ•°æ®æ›´æ–°çš„åº”ç”¨ï¼ŒMySQL 8.0 ç›´æ¥å°†æŸ¥è¯¢ç¼“å­˜åŠŸèƒ½åˆ æ‰äº†ï¼Œå¯ä»¥ä½¿ç”¨ <code>select SQL_CACHE * from user where id = 1</code> æŒ‰éœ€ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚</p>
</blockquote>
<h3 id="åˆ†æå™¨"><a href="#åˆ†æå™¨" class="headerlink" title="åˆ†æå™¨"></a>åˆ†æå™¨</h3><p>å…ˆåšè¯æ³•åˆ†æï¼Œåˆ†æ SQL è¯­å¥ä¸­çš„å…³é”®å­—ï¼Œç”Ÿæˆå¯¹åº”çš„è§£ææ ‘ï¼Œç„¶ååšè¯­æ³•åˆ†æï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">'xx'</span> <span class="keyword">FROM</span> <span class="string">'xx'</span> <span class="keyword">WHERE</span> <span class="string">'xx'</span></span><br></pre></td></tr></table></figure>

<h3 id="ä¼˜åŒ–å™¨"><a href="#ä¼˜åŒ–å™¨" class="headerlink" title="ä¼˜åŒ–å™¨"></a>ä¼˜åŒ–å™¨</h3><p>åœ¨è¡¨ä¸­æœ‰å¤šä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œç”±ä¼˜åŒ–å™¨å†³å®šä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼Œæˆ–è€…å¤šè¡¨å…³è”ï¼ˆjoinï¼‰çš„æ—¶å€™å†³å®šè¿æ¥é¡ºåºï¼Œ<strong>é€‰æ‹©æ•ˆç‡é«˜ã€ä»£ä»·å°çš„æ–¹æ¡ˆï¼Œç”Ÿæˆæ‰§è¡Œè®¡åˆ’</strong>ã€‚</p>
<p>ä¼˜åŒ–å™¨æœ‰ä¸¤ç±»ï¼šåŸºäºè§„åˆ™çš„ä¼˜åŒ–å™¨ (Rule-Based Optimizerï¼Œ<strong>RBO</strong>) å’ŒåŸºäºä»£ä»·çš„ä¼˜åŒ–å™¨ (Cost-Based Optimizerï¼Œ<strong>CBO</strong>)ã€‚åŸºäºä»£ä»·çš„ä¼˜åŒ–å™¨ï¼Œæ˜¯æ ¹æ®ä¼˜åŒ–è§„åˆ™å¯¹å…³ç³»è¡¨è¾¾å¼è¿›è¡Œè½¬æ¢ï¼Œè¿™é‡Œçš„è½¬æ¢æ˜¯è¯´ä¸€ä¸ªå…³ç³»è¡¨è¾¾å¼ç»è¿‡ä¼˜åŒ–è§„åˆ™åä¼šç”Ÿæˆå¦å¤–ä¸€ä¸ªå…³ç³»è¡¨è¾¾å¼ï¼ŒåŒæ—¶åŸæœ‰è¡¨è¾¾å¼ä¹Ÿä¼šä¿ç•™ï¼Œç»è¿‡ä¸€ç³»åˆ—è½¬æ¢åä¼šç”Ÿæˆå¤šä¸ªæ‰§è¡Œè®¡åˆ’ï¼Œç„¶å CBO ä¼šæ ¹æ®ç»Ÿè®¡ä¿¡æ¯å’Œä»£ä»·æ¨¡å‹ (Cost Model) è®¡ç®—æ¯ä¸ªæ‰§è¡Œè®¡åˆ’çš„ Costï¼Œä»ä¸­æŒ‘é€‰ Cost æœ€å°çš„æ‰§è¡Œè®¡åˆ’ã€‚ç”±ä¸Šå¯çŸ¥ï¼ŒCBO ä¸­æœ‰ä¸¤ä¸ªä¾èµ–ï¼šç»Ÿè®¡ä¿¡æ¯å’Œä»£ä»·æ¨¡å‹ï¼Œç»Ÿè®¡ä¿¡æ¯çš„å‡†ç¡®ä¸å¦ã€ä»£ä»·æ¨¡å‹çš„åˆç†ä¸å¦éƒ½ä¼šå½±å“ CBO é€‰æ‹©æœ€ä¼˜è®¡åˆ’ã€‚</p>
<h3 id="æ‰§è¡Œå™¨"><a href="#æ‰§è¡Œå™¨" class="headerlink" title="æ‰§è¡Œå™¨"></a>æ‰§è¡Œå™¨</h3><p>å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œå…ˆéªŒè¯æ˜¯å¦æœ‰è¯»å†™æƒé™ï¼Œæ²¡æœ‰åˆ™è¿”å›æƒé™é”™è¯¯ï¼Œæœ‰çš„è¯è°ƒç”¨å­˜å‚¨å¼•æ“ API æ¥å£è·å–æ‰§è¡Œç»“æœé›†ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<h2 id="SQL-è¯­å¥çš„æ‰§è¡Œæ—¶é—´åˆ†æ"><a href="#SQL-è¯­å¥çš„æ‰§è¡Œæ—¶é—´åˆ†æ" class="headerlink" title="SQL è¯­å¥çš„æ‰§è¡Œæ—¶é—´åˆ†æ"></a>SQL è¯­å¥çš„æ‰§è¡Œæ—¶é—´åˆ†æ</h2><p>å·¥å…·ï¼šé€šè¿‡ MySQL <strong>profiling</strong> æ¥åˆ†æèµ„æºä½¿ç”¨æƒ…å†µã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; select @@profiling;</span><br></pre></td></tr></table></figure>

<p>profiling = 0 ä»£è¡¨å…³é—­ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ profiling æ‰“å¼€ï¼Œå³è®¾ç½®ä¸º 1ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; set profiling=1;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œä»»ä½•ä¸€ä¸ªæŸ¥è¯¢ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from students;</span><br><span class="line">mysql&gt; show profileï¼›</span><br><span class="line">mysql&gt; show profile for query 2;  # æŸ¥è¯¢æŒ‡å®šçš„ Query ID</span><br></pre></td></tr></table></figure>

<p><img src="http://ww2.sinaimg.cn/large/006y8mN6ly1g6apont0v2j30y50u04lx.jpg" alt="img"></p>
<h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><h3 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h3><p>åœ¨ MySQL ä¸­ï¼Œå½“æ•°æ®é‡å¢é•¿çš„ç‰¹åˆ«å¤§çš„æ—¶å€™å°±éœ€è¦ç”¨åˆ°ç´¢å¼•æ¥ä¼˜åŒ– SQL è¯­å¥ï¼Œä½¿ç”¨ <code>Explain</code> æ¥æŸ¥çœ‹ SQL è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œæ˜¯ä¼˜åŒ– SQL æœ€æœ‰æ•ˆåœ°çš„ä¸€ç§æ‰‹æ®µã€‚</p>
<h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><p><strong>è¯­æ³•</strong>ï¼š<code>explain + SQL</code></p>
<p><strong>ç¤ºä¾‹</strong>ï¼š<code>explain select * from customer</code></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain select * from customer;</span><br><span class="line">+<span class="comment">----+-------------+----------+------+---------------+------+---------+------+--------+</span></span><br><span class="line">| id | select_type | table    | type | possible_keys | key  | key_len | ref  | rows   | </span><br><span class="line">+<span class="comment">----+-------------+----------+------+---------------+------+---------+------+--------+</span></span><br><span class="line">|  1 | SIMPLE      | customer | ALL  | NULL          | NULL | NULL    | NULL | 936161 |       </span><br><span class="line">+<span class="comment">----+-------------+----------+------+---------------+------+---------+------+--------+</span></span><br><span class="line">1 row in <span class="keyword">set</span></span><br></pre></td></tr></table></figure>

<h3 id="å‚æ•°ä»‹ç»"><a href="#å‚æ•°ä»‹ç»" class="headerlink" title="å‚æ•°ä»‹ç»"></a>å‚æ•°ä»‹ç»</h3><h4 id="id"><a href="#id" class="headerlink" title="id"></a>id</h4><p><strong>å«ä¹‰</strong>ï¼šSELECT æ ‡è¯†ç¬¦ï¼ŒSQL æ‰§è¡Œé¡ºåºçš„æ ‡è¯†ã€‚</p>
<p><strong>ä¸‰ç§æƒ…å†µ</strong>ï¼š</p>
<ul>
<li><p><code>id</code> ç›¸åŒï¼Œæ‰§è¡Œé¡ºåºç”±ä¸Šè‡³ä¸‹ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain select t2.* from t1,t2,t3 where t1.id = t2.id and t1.id = t3.id and t1.other_column = '';</span><br><span class="line">+<span class="comment">----+-------------+-------+--------+---------------+---------+---------+---------------+------+-------------+</span></span><br><span class="line">| id | select_type | table | type   | possible_keys | key     | key_len | ref           | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+--------+---------------+---------+---------+---------------+------+-------------+</span></span><br><span class="line">| 1  | SIMPLE      | t1    | ALL    | PRIMARY       | NULL    | NULL    | NULL          | 5    | Using where |</span><br><span class="line">| 1  | SIMPLE      | t2    | eq_ref | PRIMARY       | PRIMARY | 4       | test_db.t1.id | 1    |             |</span><br><span class="line">| 1  | SIMPLE      | t3    | eq_ref | PRIMARY       | PRIMARY | 4       | test_db.t1.id | 1    | Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+--------+---------------+---------+---------+---------------+------+-------------+</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>id</code> ä¸åŒï¼Œå¦‚æœæ˜¯å­æŸ¥è¯¢ï¼Œ<code>id</code> çš„åºå·ä¼šé€’å¢ï¼Œ<code>id</code> å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain select t2.* from t2 where id = (select id from t1 where id = (select t3.id from t3 where t3.other_column = ''));</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+-------+------+-------------+</span></span><br><span class="line">| id | select_type | table | type  | possible_keys | key     | key_len | ref   | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+-------+------+-------------+</span></span><br><span class="line">| 1  | PRIMARY     | t2    | const | PRIMARY       | PRIMARY | 4       | const | 1    |             |</span><br><span class="line">| 2  | SUBQUERY    | t1    | const | PRIMARY       | PRIMARY | 4       |       | 1    | Using index |</span><br><span class="line">| 3  | SUBQUERY    | t3    | ALL   | NULL          | NULL    | NULL    | NULL  | 5    | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+-------+------+-------------+</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>id</code> æœ‰ç›¸åŒä¹Ÿæœ‰ä¸åŒï¼Œ<code>id</code> å€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œï¼›<code>id</code> ç›¸åŒï¼Œåˆ™è®¤ä¸ºæ˜¯ä¸€ç»„ï¼Œä»ä¸Šå¾€ä¸‹é¡ºåºæ‰§è¡Œã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain select t2.* from t2 where id = (select id from t1 where id = (select t3.id from t3 where t3.other_column = ''));</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+-------+------+-------------+</span></span><br><span class="line">| id | select_type | table | type  | possible_keys | key     | key_len | ref   | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+-------+------+-------------+</span></span><br><span class="line">| 1  | PRIMARY     | t2    | const | PRIMARY       | PRIMARY | 4       | const | 1    |             |</span><br><span class="line">| 2  | SUBQUERY    | t1    | const | PRIMARY       | PRIMARY | 4       |       | 1    | Using index |</span><br><span class="line">| 3  | SUBQUERY    | t3    | ALL   | NULL          | NULL    | NULL    | NULL  | 5    | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+-------+------+-------------+</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h4><p><strong>å«ä¹‰</strong>ï¼šæŸ¥è¯¢ç±»å‹ï¼Œä¸»è¦ç”¨äºåŒºåˆ«æ™®é€šæŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰å¤æ‚æŸ¥è¯¢ã€‚</p>
<p><strong>å…­ç§ç±»å‹</strong>ï¼š</p>
<ul>
<li><strong>SIMPLE</strong>ï¼šç®€å•çš„ <code>select</code> æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸­ä¸åŒ…å«å­æŸ¥è¯¢æˆ–è€… <code>union</code> è”åˆæŸ¥è¯¢ã€‚</li>
<li><strong>PRIMARY</strong>ï¼šæŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­éƒ¨åˆ†ï¼Œæœ€å¤–å±‚æŸ¥è¯¢åˆ™è¢«æ ‡è®°ä¸º <code>PRIMARY</code>ã€‚</li>
<li><strong>SUBQUERY</strong>ï¼šåœ¨ <code>select</code>æˆ– <code>where</code> åˆ—è¡¨ä¸­åŒ…å«äº†å­æŸ¥è¯¢ã€‚</li>
<li><strong>DERIVED</strong>ï¼šåœ¨ <code>from</code> åˆ—è¡¨ä¸­åŒ…å«çš„å­æŸ¥è¯¢è¢«æ ‡è®°ä¸º <code>DERIVED</code>ï¼ˆè¡ç”Ÿï¼‰ï¼ŒMySQL ä¼šé€’å½’æ‰§è¡Œè¿™äº›å­æŸ¥è¯¢ï¼ŒæŠŠç»“æœæ”¾åœ¨ä¸´æ—¶è¡¨é‡Œã€‚</li>
<li><strong>UNION</strong>ï¼šè‹¥ç¬¬äºŒä¸ª <code>select</code> å‡ºç°åœ¨ <code>union</code> ä¹‹åï¼Œåˆ™è¢«æ ‡è®°ä¸º <code>union</code>ï¼›è‹¥ <code>union</code> åŒ…å«åœ¨ <code>from</code> å­—å¥çš„æŸ¥è¯¢ä¸­ï¼Œå¤–å±‚ <code>select</code> å°†è¢«æ ‡è®°ä¸º <code>DERIVED</code>ã€‚</li>
<li><strong>UNION RESULT</strong>ï¼šä¸¤ç§ <code>union</code> è¯­å¥çš„åˆå¹¶ã€‚</li>
</ul>
<h4 id="table"><a href="#table" class="headerlink" title="table"></a>table</h4><p><strong>å«ä¹‰</strong>ï¼šæŸ¥è¯¢æ¶‰åŠçš„è¡¨æˆ–è€…è¡ç”Ÿè¡¨ã€‚</p>
<h4 id="type"><a href="#type" class="headerlink" title="type"></a>type</h4><p><strong>å«ä¹‰</strong>ï¼šæ˜¾ç¤ºè¿æ¥ä½¿ç”¨çš„ç±»å‹ã€‚å¸¸è§çš„æœ‰7ç§ï¼Œä»æœ€å¥½åˆ°æœ€å·®æ’åºï¼š<strong>system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; all</strong>ï¼ˆ<strong>å…¨è¡¨æ‰«æ</strong>ï¼‰ï¼Œä¸€èˆ¬æ¥è¯´ <strong>è‡³å°‘è¾¾åˆ° range çº§åˆ«ï¼Œæœ€å¥½è¾¾åˆ° ref</strong>ã€‚</p>
<p><strong>ä¸ƒç§ç±»å‹</strong>ï¼š</p>
<ul>
<li><p><strong>system</strong>ï¼šè¡¨åªæœ‰ä¸€è¡Œè®°å½•ï¼Œè¿™æ˜¯ <code>const</code> ç±»å‹çš„ç‰¹ä¾‹ï¼Œåªèƒ½ç”¨äº <code>myisam</code> å’Œ <code>memory</code> è¡¨ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</p>
</li>
<li><p><strong>const</strong>ï¼šè¡¨ç¤ºé€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±æ‰¾åˆ°äº†ï¼Œ<code>const</code> ç”¨äº <code>primary key</code> æˆ–è€… <code>unique</code> ç´¢å¼•ï¼Œå› ä¸ºåªåŒ¹é…ä¸€è¡Œæ•°æ®ï¼Œæ‰€ä»¥å¾ˆå¿«ï¼Œå¦‚å°†ä¸»é”®ç½®äº <code>where</code> åˆ—è¡¨ä¸­ï¼ŒMySQL å°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡ã€‚</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain select * from (select * from t1 where id =1) d1;</span><br><span class="line">+<span class="comment">----+-------------+------------+--------+---------------+---------+---------+------+----</span></span><br><span class="line">| id | select_type | table      | type   | possible_keys | key     | key_len | ref  | rows | Extra |</span><br><span class="line">+<span class="comment">----+-------------+------------+--------+---------------+---------+---------+------+----</span></span><br><span class="line">|  1 | PRIMARY     | &lt;derived2&gt; | system | NULL          | NULL    | NULL    | NULL |    1 |       |</span><br><span class="line">|  2 | DERIVED     | t1         | const  | PRIMARY       | PRIMARY | 4       |      |    1 |       |</span><br><span class="line">+<span class="comment">----+-------------+------------+--------+---------------+---------+---------+------+----</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>eq_ref</strong>ï¼šå”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œå¯¹äºæ¯ä¸ªç´¢å¼•é”®ï¼Œè¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•ä¸ä¹‹åŒ¹é…ï¼Œå¸¸è§äºä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æ‰«æã€‚</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain select * from t1,t2 where t1.id = t2.id;</span><br><span class="line">+<span class="comment">----+-------------+-------+--------+---------------+---------+---------+---------------</span></span><br><span class="line">| id | select_type | table | type   | possible_keys | key     | key_len | ref           | rows | Extra |</span><br><span class="line">+<span class="comment">----+-------------+-------+--------+---------------+---------+---------+---------------</span></span><br><span class="line">|  1 | SIMPLE      | t1    | ALL    | PRIMARY       | NULL    | NULL    | NULL          |    5 |       |</span><br><span class="line">|  1 | SIMPLE      | t2    | eq_ref | PRIMARY       | PRIMARY | 4       | test_db.t1.id |    1 |       |</span><br><span class="line">+<span class="comment">----+-------------+-------+--------+---------------+---------+---------+---------------</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>ref</strong>ï¼šéå”¯ä¸€ç´¢å¼•æˆ–è€…ä¸»é”®æ‰«æï¼Œæˆ–è€…ä½¿ç”¨äº†<strong>æœ€å·¦å‰ç¼€è§„åˆ™</strong>ç´¢å¼•çš„æŸ¥è¯¢ï¼Œå®ƒè¿”å›åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„æ‰€æœ‰è¡Œï¼Œç„¶è€Œå®ƒå¯èƒ½ä¼šæ‰¾åˆ°å¤šä¸ªç¬¦åˆæ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥å®ƒåº”è¯¥å±äºæŸ¥æ‰¾å’Œæ‰«æçš„æ··åˆä½“ã€‚</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; create index idx_name on t1(name);</span><br><span class="line">mysql&gt; explain select * from t1 where name ='Tim';</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+-------+------+------</span></span><br><span class="line">| id | select_type | table | type | possible_keys | key  | key_len | ref   | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+-------+------+------</span></span><br><span class="line">|  1 | SIMPLE      | t1    | ref  | idx_name          | idx_name  | 92      | const |    1 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+-------+------+------</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>range</strong>ï¼šåªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œï¼Œä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥é€‰æ‹©è¡Œã€‚<code>key</code>åˆ—æ˜¾ç¤ºä½¿ç”¨äº†å“ªä¸ªç´¢å¼•ï¼Œä¸€èˆ¬å°±æ˜¯åœ¨ä½ çš„ <code>where</code>è¯­å¥ä¸­å‡ºç°äº† <code>between</code>ã€<code>&lt;&gt;</code>ã€<code>in</code> ç­‰æŸ¥è¯¢ã€‚è¿™ç§èŒƒå›´æ‰«æç´¢å¼•æ¯”å…¨è¡¨æ‰«æè¦å¥½ï¼Œå› ä¸ºå®ƒåªéœ€è¦å¼€å§‹äºç´¢å¼•çš„æŸä¸€ç‚¹ï¼Œè€Œç»“æŸäºå¦ä¸€ç‚¹ï¼Œä¸ç”¨æ‰«æå…¨éƒ¨ç´¢å¼•ã€‚</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain select * from t1 where id between 2 and 5;</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+------+------+---</span></span><br><span class="line">| id | select_type | table | type  | possible_keys | key     | key_len | ref  | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+------+------+---</span></span><br><span class="line">|  1 | SIMPLE      | t1    | range | PRIMARY       | PRIMARY | 4       | NULL |    3 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+------+------+---</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>index</strong>ï¼šè¡¨ç¤ºå…¨ç´¢å¼•æ‰«æ (full index scan)ï¼Œ<code>index</code> ä¸ <code>all</code> åŒºåˆ«ä¸º <code>index</code> ç±»å‹åªæ‰«ææ‰€æœ‰çš„ç´¢å¼•ä¸æ‰«ææ•°æ®ï¼Œé€šå¸¸æ¯” <code>all</code> å¿«ï¼Œå› ä¸ºç´¢å¼•æ–‡ä»¶é€šå¸¸æ¯”æ•°æ®æ–‡ä»¶å°ã€‚</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain select id from t1;</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+------+------+---</span></span><br><span class="line">| id | select_type | table | type  | possible_keys | key     | key_len | ref  | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+------+------+---</span></span><br><span class="line">|  1 | SIMPLE      | t1    | index | NULL          | PRIMARY | 4       | NULL |    6 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+------+------+---</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>all</strong>ï¼šè¡¨ç¤ºå…¨è¡¨æ‰«æï¼Œè¿™ä¸ªç±»å‹çš„æŸ¥è¯¢æ˜¯æ€§èƒ½æœ€å·®çš„æŸ¥è¯¢ä¹‹ä¸€ã€‚é€šå¸¸æ¥è¯´ï¼ŒæŸ¥è¯¢ä¸åº”è¯¥å‡ºç° <code>all</code> ç±»å‹çš„æŸ¥è¯¢, å› ä¸ºè¿™æ ·çš„æŸ¥è¯¢åœ¨æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹ï¼Œå¯¹æ•°æ®åº“çš„æ€§èƒ½æ˜¯å·¨å¤§çš„ç¾éš¾ã€‚</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain select * from t2 where other_column = '';</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+-------</span></span><br><span class="line">| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+-------</span></span><br><span class="line">|  1 | SIMPLE      | t2    | ALL  | NULL          | NULL | NULL    | NULL |    5 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+-------</span></span><br></pre></td></tr></table></figure>

<h4 id="possible-keys"><a href="#possible-keys" class="headerlink" title="possible_keys"></a>possible_keys</h4><p><strong>å«ä¹‰</strong>ï¼šæ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸­çš„ç´¢å¼•ã€‚æŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢å®é™…ä½¿ç”¨ã€‚</p>
<h4 id="key"><a href="#key" class="headerlink" title="key"></a>key</h4><p><strong>å«ä¹‰</strong>ï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚å¦‚æœä¸º <code>NULL</code>ï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œ<code>key</code> å‚æ•°å¯ä»¥ä½œä¸ºä½¿ç”¨äº†ç´¢å¼•çš„åˆ¤æ–­æ ‡å‡†ã€‚</p>
<h4 id="key-len"><a href="#key-len" class="headerlink" title="key_len"></a>key_len</h4><p><strong>å«ä¹‰</strong>ï¼šä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ã€‚<code>key_len</code> æ˜¾ç¤ºçš„å€¼ä¸ºç´¢å¼•å­—æ®µçš„æœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ã€‚åœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½ã€‚</p>
<h4 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h4><p><strong>å«ä¹‰</strong>ï¼šæ˜¾ç¤ºç´¢å¼•çš„å“ªä¸€åˆ—è¢«ä½¿ç”¨äº†ï¼Œå¦‚æœå¯èƒ½çš„è¯æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œå“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼ã€‚</p>
<h4 id="rows"><a href="#rows" class="headerlink" title="rows"></a>rows</h4><p><strong>å«ä¹‰</strong>ï¼šæ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯åŠç´¢å¼•é€‰ç”¨æƒ…å†µï¼Œå¤§è‡´ä¼°ç®—å‡ºæ‰¾åˆ°æ‰€éœ€çš„è®°å½•æ‰€éœ€è¦è¯»å–çš„è¡Œæ•°ï¼Œå½“ç„¶è¶Šå°è¶Šå¥½ã€‚</p>
<blockquote>
<p>Tipsï¼šexplain ç»“æœä¸­ï¼Œjoin çš„æŸ¥è¯¢ä»£ä»·å¯ä»¥ç”¨ä¾æ¬¡è¿ä¹˜ rows ä¼°ç®—ã€‚</p>
</blockquote>
<h4 id="Extra"><a href="#Extra" class="headerlink" title="Extra"></a>Extra</h4><p><strong>å«ä¹‰</strong>ï¼šé™„åŠ ä¿¡æ¯ï¼Œæä¾›äº†ä¸æ“ä½œæœ‰å…³è”çš„ä¿¡æ¯ã€‚</p>
<p><strong>ä¸‰ç§ç±»å‹</strong>ï¼š</p>
<ul>
<li><strong>Using filesort</strong>ï¼šæ¯”è¾ƒå±é™©ã€‚è¯´æ˜ MySQL ä¼šå¯¹æ•°æ®ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨çš„ç´¢å¼•æ’åºï¼Œè€Œä¸æ˜¯æŒ‰ç…§è¡¨å†…çš„ç´¢å¼•é¡ºåºè¿›è¡Œè¯»å–ã€‚MySQL ä¸­æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆçš„æ’åºæ“ä½œç§°ä¹‹ä¸ºæ–‡ä»¶æ’åºï¼Œéœ€è¦è¿›è¡Œé¢å¤–çš„æ­¥éª¤æ¥å‘ç°å¦‚ä½•å¯¹è¿”å›çš„è¡Œæ’åºã€‚</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain select other_column from t1 where other_column = 'A' order by other_column3;</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+-------+------+---------</span></span><br><span class="line">| id | select_type | table | type | possible_keys | key  | key_len | ref   | rows | Extra                       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+-------+------+---------</span></span><br><span class="line">|  1 | SIMPLE      | t1    | ref  | idx           | idx  | 92      | const |    1 | Using where; Using filesort |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+-------+------+---------</span></span><br></pre></td></tr></table></figure>

<p>ä¼˜åŒ–æ¡ˆä¾‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; create index u_idx2 on t1(other_column,other_column2,other_column3);</span><br><span class="line">mysql&gt; explain select other_column from t1 where other_column = 'A' order by other_column2,other_column3;</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+--------+---------+-------+------+-------</span></span><br><span class="line">| id | select_type | table | type | possible_keys | key    | key_len | ref   | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+--------+---------+-------+------+-------</span></span><br><span class="line">|  1 | SIMPLE      | t1    | ref  | idx,u_idx2    | u_idx2 | 92      | const |    1 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+--------+---------+-------+------+-------</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Using temporary</strong>ï¼šæ¯”è¾ƒå±é™©ï¼Œä½¿ç”¨äº†ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´ç»“æœã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨å¯¹ä¸åŒçš„åˆ—é›†è¿›è¡Œ <code>ORDER BY</code> ä¸Šå’Œ <code>GROUP BY</code> ä¸Šï¼Œæ‹–æ…¢äº†æŸ¥è¯¢é€Ÿåº¦ã€‚</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain select other_column from t1 where other_column in ('A','B','C') group by other_column3;</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+--------+---------+------+------+-------</span></span><br><span class="line">| id | select_type | table | type  | possible_keys | key    | key_len | ref  | rows | Extra                                                     |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+--------+---------+------+------+-------</span></span><br><span class="line">|  1 | SIMPLE      | t1    | range | idx,u_idx2    | u_idx2 | 92      | NULL |    3 | Using where; Using index; Using temporary; Using filesort |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+--------+---------+------+------+-------</span></span><br></pre></td></tr></table></figure>

<p>ä¼˜åŒ–æ¡ˆä¾‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain select other_column from t1 where other_column in ('A','B','C') group by other_column,other_column2;</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+--------+---------+------+------+-------</span></span><br><span class="line">| id | select_type | table | type  | possible_keys | key    | key_len | ref  | rows | Extra                    |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+--------+---------+------+------+-------</span></span><br><span class="line">|  1 | SIMPLE      | t1    | range | idx,u_idx2    | u_idx2 | 92      | NULL |    3 | Using where; Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+--------+---------+------+------+-------</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>Using index</strong>ï¼šè¡¨ç¤ºç›¸åº”çš„ <code>select</code> æ“ä½œä¸­ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œé¿å…è®¿é—®äº†è¡¨çš„æ•°æ®è¡Œï¼Œæ•ˆç‡ä¸é”™ã€‚å¦‚æœåŒæ—¶å‡ºç° <code>using where</code>ï¼Œè¡¨æ˜ç´¢å¼•è¢«ç”¨æ¥æ‰§è¡Œç´¢å¼•é”®å€¼çš„æŸ¥æ‰¾ï¼›å¦‚æœæ²¡æœ‰åŒæ—¶å‡ºç° <code>using where</code>ï¼Œè¡¨æ˜ç´¢å¼•ç”¨æ¥è¯»å–æ•°æ®è€Œéæ‰§è¡ŒæŸ¥æ‰¾åŠ¨ä½œã€‚</p>
<p><strong>è¦†ç›–ç´¢å¼•</strong>ï¼š å°±æ˜¯ <code>select</code> çš„æ•°æ®åˆ—åªç”¨ä»ç´¢å¼•ä¸­å°±èƒ½å¤Ÿå–å¾—ï¼Œä¸å¿…è¯»å–æ•°æ®è¡Œï¼ŒMySQL å¯ä»¥åˆ©ç”¨ç´¢å¼•è¿”å› <code>select</code> åˆ—è¡¨ä¸­çš„å­—æ®µï¼Œè€Œä¸å¿…æ ¹æ®ç´¢å¼•å†æ¬¡è¯»å–æ•°æ®æ–‡ä»¶ï¼Œæ¢å¥è¯è¯´æŸ¥è¯¢åˆ—è¦è¢«æ‰€å»ºçš„ç´¢å¼•è¦†ç›–ã€‚æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¦ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œä¸€å®šè¦æ³¨æ„ <code>select</code> åˆ—è¡¨ä¸­åªè¯»å–å‡ºéœ€è¦çš„åˆ—ï¼Œè€Œä¸æ˜¯ <code>select *</code>ï¼Œå› ä¸ºå¦‚æœå°†æ‰€æœ‰å­—æ®µä¸€èµ·åšç´¢å¼•ä¼šå¯¼è‡´ç´¢å¼•æ–‡ä»¶è¿‡å¤§ï¼Œé™ä½æŸ¥è¯¢æ€§èƒ½ã€‚</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain select other_column from t1 where other_column in ('A','B','C') group by other_column,other_column2;</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+--------+---------+------+------+-------</span></span><br><span class="line">| id | select_type | table | type  | possible_keys | key    | key_len | ref  | rows | Extra                    |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+--------+---------+------+------+-------</span></span><br><span class="line">|  1 | SIMPLE      | t1    | range | idx,u_idx2    | u_idx2 | 92      | NULL |    3 | Using where; Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+--------+---------+------+------+-------</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain select other_column,other_column2,other_column3 from t1;</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+--------+---------+------+------+-------</span></span><br><span class="line">| id | select_type | table | type  | possible_keys | key    | key_len | ref  | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+--------+---------+------+------+-------</span></span><br><span class="line">|  1 | SIMPLE      | t1    | index | NULL          | u_idx2 | 276     | NULL |    6 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+--------+---------+------+------+-------</span></span><br></pre></td></tr></table></figure>

<p>Tips: åœ¨ show table status ç»“æœä¸­çœ‹åˆ°çš„ Rows ç”¨äºè¡¨ç¤ºè¡¨çš„å½“å‰è¡Œæ•°ã€‚å¯¹äº MyISAM è¡¨è¿™æ˜¯ä¸€ä¸ªç²¾ç¡®å€¼ï¼Œä½†å¯¹InnoDB è¿™æ˜¯ä¸ªä¼°ç®—å€¼ã€‚</p>
<h2 id="SQLè°ƒä¼˜"><a href="#SQLè°ƒä¼˜" class="headerlink" title="SQLè°ƒä¼˜"></a>SQLè°ƒä¼˜</h2><p>INSERT æ€§èƒ½ï¼šMySQL ç”¨å•æ¡ INSERT è¯­å¥å¤„ç†å¤šä¸ªæ’å…¥æ¯”ä½¿ç”¨å¤šæ¡ INSERT è¯­å¥å¿«ã€‚</p>
<p>ä»è¡¨ä¸­åˆ é™¤æ‰€æœ‰è¡Œï¼Œä¸è¦ä½¿ç”¨ DELETE ï¼Œå»ºè®®ä½¿ç”¨ TRUNCATE TABLE è¯­å¥ã€‚TRUNCATE å®é™…æ˜¯åˆ é™¤åŸæ¥çš„è¡¨å¹¶é‡æ–°åˆ›å»ºä¸€ä¸ªè¡¨ï¼Œè€Œä¸æ˜¯é€è¡Œåˆ é™¤è¡¨ä¸­çš„æ•°æ®ã€‚</p>
<h2 id="ç´¢å¼•è°ƒä¼˜"><a href="#ç´¢å¼•è°ƒä¼˜" class="headerlink" title="ç´¢å¼•è°ƒä¼˜"></a>ç´¢å¼•è°ƒä¼˜</h2><p><strong>æµ‹è¯•ç¯å¢ƒ</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`t1`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t1`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`other_column`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`other_column2`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`other_column3`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`idx`</span> (<span class="string">`other_column`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`u_idx`</span> (<span class="string">`other_column2`</span>,<span class="string">`other_column3`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`u_idx2`</span> (<span class="string">`other_column`</span>,<span class="string">`other_column2`</span>,<span class="string">`other_column3`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=MyISAM AUTO_INCREMENT=<span class="number">7</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">------</span></span><br><span class="line"><span class="comment">-- Records of t1</span></span><br><span class="line"><span class="comment">------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t1`</span> <span class="keyword">VALUES</span> (<span class="string">'1'</span>, <span class="string">'A'</span>, <span class="string">'D'</span>, <span class="string">'L'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t1`</span> <span class="keyword">VALUES</span> (<span class="string">'2'</span>, <span class="string">'B'</span>, <span class="string">'E'</span>, <span class="string">'M'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t1`</span> <span class="keyword">VALUES</span> (<span class="string">'3'</span>, <span class="string">'C'</span>, <span class="string">''</span>, <span class="string">'N'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t1`</span> <span class="keyword">VALUES</span> (<span class="string">'4'</span>, <span class="string">''</span>, <span class="string">'F'</span>, <span class="string">''</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t1`</span> <span class="keyword">VALUES</span> (<span class="string">'5'</span>, <span class="string">'F'</span>, <span class="string">'G'</span>, <span class="string">'O'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t1`</span> <span class="keyword">VALUES</span> (<span class="string">'6'</span>, <span class="string">'A'</span>, <span class="string">'H'</span>, <span class="string">'P'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">------</span></span><br><span class="line"><span class="comment">-- Table structure for t2</span></span><br><span class="line"><span class="comment">------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`t2`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t2`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`other_column`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`idx`</span> (<span class="string">`other_column`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=MyISAM AUTO_INCREMENT=<span class="number">6</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">------</span></span><br><span class="line"><span class="comment">-- Records of t2</span></span><br><span class="line"><span class="comment">------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t2`</span> <span class="keyword">VALUES</span> (<span class="string">'1'</span>, <span class="string">'C'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t2`</span> <span class="keyword">VALUES</span> (<span class="string">'2'</span>, <span class="string">'D'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t2`</span> <span class="keyword">VALUES</span> (<span class="string">'3'</span>, <span class="string">'E'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t2`</span> <span class="keyword">VALUES</span> (<span class="string">'4'</span>, <span class="string">''</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t2`</span> <span class="keyword">VALUES</span> (<span class="string">'5'</span>, <span class="string">'G'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">------</span></span><br><span class="line"><span class="comment">-- Table structure for t3</span></span><br><span class="line"><span class="comment">------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`t3`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t3`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`other_column`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=MyISAM AUTO_INCREMENT=<span class="number">6</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">------</span></span><br><span class="line"><span class="comment">-- Records of t3</span></span><br><span class="line"><span class="comment">------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t3`</span> <span class="keyword">VALUES</span> (<span class="string">'1'</span>, <span class="string">'F'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t3`</span> <span class="keyword">VALUES</span> (<span class="string">'2'</span>, <span class="string">'G'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t3`</span> <span class="keyword">VALUES</span> (<span class="string">'3'</span>, <span class="string">'H'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t3`</span> <span class="keyword">VALUES</span> (<span class="string">'4'</span>, <span class="string">''</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t3`</span> <span class="keyword">VALUES</span> (<span class="string">'5'</span>, <span class="string">'I'</span>);</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>å‰ç«¯å­¦ä¹ ç¬”è®°</title>
    <url>/blog/2019/07/10/front/</url>
    <content><![CDATA[<h2 id="å­¦ä¹ è·¯å¾„"><a href="#å­¦ä¹ è·¯å¾„" class="headerlink" title="å­¦ä¹ è·¯å¾„"></a>å­¦ä¹ è·¯å¾„</h2><p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134136.png" alt="å‰ç«¯æŠ€èƒ½å›¾è°±"></p>
<h2 id="å¦‚ä½•æ­å»º-ä¸€ä¸ª-vue-é¡¹ç›®ï¼Ÿ"><a href="#å¦‚ä½•æ­å»º-ä¸€ä¸ª-vue-é¡¹ç›®ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ­å»º ä¸€ä¸ª vue é¡¹ç›®ï¼Ÿ"></a>å¦‚ä½•æ­å»º ä¸€ä¸ª vue é¡¹ç›®ï¼Ÿ</h2><h3 id="å®‰è£…-node-ç¯å¢ƒ"><a href="#å®‰è£…-node-ç¯å¢ƒ" class="headerlink" title="å®‰è£… node ç¯å¢ƒ"></a>å®‰è£… node ç¯å¢ƒ</h3><blockquote>
<p>ä¸‹è½½ <a href="http://nodejs.cn/download/" target="_blank" rel="noopener">Node.js</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span> node -v</span><br><span class="line">v10.15.3</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> npm -v</span><br><span class="line">6.10.0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å®‰è£…æ·˜å®é•œåƒï¼Œæé«˜æ•ˆç‡</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span> npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line">C:\Users\01510886\AppData\Roaming\npm\cnpm -&gt; C:\Users\01510886\AppData\Roaming\npm\node_modules\cnpm\bin\cnpm</span><br><span class="line">+cnpm@6.1.0</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span> cnpm -v</span><br><span class="line">cnpm@6.1.0 (C:\Users\01510886\AppData\Roaming\npm\node_modules\cnpm\lib\parse_argv.js)</span><br><span class="line">npm@6.10.0 (C:\Users\01510886\AppData\Roaming\npm\node_modules\cnpm\node_modules\npm\lib\npm.js)</span><br><span class="line">node@10.15.3 (D:\software\nodejs\node.exe)</span><br><span class="line">npminstall@3.22.1 (C:\Users\01510886\AppData\Roaming\npm\node_modules\cnpm\node_modules\npminstall\lib\index.js)</span><br><span class="line">prefix=C:\Users\01510886\AppData\Roaming\npm</span><br><span class="line">win32 x64 6.1.7601</span><br><span class="line">registry=https://r.npm.taobao.org</span><br></pre></td></tr></table></figure>

<h3 id="æ­å»º-vue-é¡¹ç›®ç¯å¢ƒ"><a href="#æ­å»º-vue-é¡¹ç›®ç¯å¢ƒ" class="headerlink" title="æ­å»º vue é¡¹ç›®ç¯å¢ƒ"></a>æ­å»º vue é¡¹ç›®ç¯å¢ƒ</h3><blockquote>
<p>å®‰è£… vue-cli</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span> npm install --global vue-cli</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> vue list</span><br><span class="line">  Available official templates:</span><br><span class="line">  â˜…  browserify - A full-featured Browserify + vueify setup with hot-reload, linting &amp; unit testing.</span><br><span class="line">  â˜…  browserify-simple - A simple Browserify + vueify setup for quick prototyping.</span><br><span class="line">  â˜…  pwa - PWA template for vue-cli based on the webpack template</span><br><span class="line">  â˜…  simple - The simplest possible Vue setup in a single HTML file</span><br><span class="line">  â˜…  webpack - A full-featured Webpack + vue-loader setup with hot reload, linting, testing &amp; css extraction.</span><br><span class="line">  â˜…  webpack-simple - A simple Webpack + vue-loader setup for quick prototyping.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆ›å»ºä¸€ä¸ªåŸºäº webpack æ¨¡æ¿çš„æ–°é¡¹ç›®</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ vue init webpack vue-test</span><br><span class="line"></span><br><span class="line">? Project name (vue-test)</span><br><span class="line">? Project name vue-test</span><br><span class="line">? Project description (A Vue.js project)</span><br><span class="line">? Project description A Vue.js project</span><br><span class="line">? Author (raohui &lt;raohui@haier.com&gt;)</span><br><span class="line">? Author raohui &lt;raohui@haier.com&gt;</span><br><span class="line">? Vue build standalone</span><br><span class="line">? Install vue-router? (Y/n) Y</span><br><span class="line">? Install vue-router? Yes</span><br><span class="line">? Use ESLint to lint your code? (Y/n) n</span><br><span class="line">? Use ESLint to lint your code? No</span><br><span class="line">? Set up unit tests (Y/n) n</span><br><span class="line">? Set up unit tests No</span><br><span class="line">? Setup e2e tests with Nightwatch? (Y/n) n</span><br><span class="line">? Setup e2e tests with Nightwatch? No</span><br><span class="line">? Should we run `npm install` <span class="keyword">for</span> you after the project has been created? (recom</span><br><span class="line">? Should we run `npm install` <span class="keyword">for</span> you after the project has been created? (recom</span><br><span class="line">mended) npm</span><br><span class="line"></span><br><span class="line">   vue-cli Â· Generated <span class="string">"vue-test"</span>.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Installing project dependencies ...</span></span><br><span class="line"><span class="comment"># ========================</span></span><br><span class="line"></span><br><span class="line">npm WARN deprecated extract-text-webpack-plugin@<span class="number">3.0</span>.<span class="number">2</span>: Deprecated. Please use https://github.com/webpack-contrib/mini-css-extract-plugin</span><br><span class="line">npm WARN deprecated browserslist@<span class="number">2.11</span>.<span class="number">3</span>: Browserslist <span class="number">2</span> could fail on reading Browserslist &gt;<span class="number">3.0</span> config used <span class="keyword">in</span> other tools.</span><br><span class="line">npm WARN deprecated bfj-node4@<span class="number">5.3</span>.<span class="number">1</span>: <span class="keyword">Switch</span> to the `bfj` package <span class="keyword">for</span> fixes and new features!</span><br><span class="line">npm WARN deprecated flatten@<span class="number">1.0</span>.<span class="number">2</span>: I wrote this module a very long time ago; you should use something else.</span><br><span class="line">npm WARN deprecated browserslist@<span class="number">1.7</span>.<span class="number">7</span>: Browserslist <span class="number">2</span> could fail on reading Browserslist &gt;<span class="number">3.0</span> config used <span class="keyword">in</span> other tools.</span><br><span class="line"></span><br><span class="line">&gt; core-js@<span class="number">2.6</span>.<span class="number">9</span> postinstall D:\vue\vue-test\node_modules\core-js</span><br><span class="line">&gt; node scripts/postinstall || echo <span class="string">"ignore"</span></span><br><span class="line"></span><br><span class="line">Thank you <span class="keyword">for</span> using core-js ( https://github.com/zloirock/core-js ) <span class="keyword">for</span> polyfilling JavaScript standard library!</span><br><span class="line"></span><br><span class="line">The project needs your help! Please consider supporting of core-js on Open Collective or Patreon:</span><br><span class="line">&gt; https://opencollective.com/core-js</span><br><span class="line">&gt; https://www.patreon.com/zloirock</span><br><span class="line"></span><br><span class="line">Also, the author of core-js ( https://github.com/zloirock ) is looking <span class="keyword">for</span> a good job -)</span><br><span class="line"></span><br><span class="line">&gt; uglifyjs-webpack-plugin@<span class="number">0.4</span>.<span class="number">6</span> postinstall D:\vue\vue-test\node_modules\webpack\node_modules\uglifyjs-webpack-plugin</span><br><span class="line">&gt; node lib/post_install.js</span><br><span class="line"></span><br><span class="line">npm notice created a lockfile as package-lock.json. You should commit this file.</span><br><span class="line">npm WARN ajv-keywords@<span class="number">3.4</span>.<span class="number">1</span> requires a peer of ajv@^<span class="number">6.9</span>.<span class="number">1</span> but none is installed. You must install peer dependencies yourself.</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@<span class="number">1.2</span>.<span class="number">9</span> (node_modules\fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform <span class="keyword">for</span> fsevents@<span class="number">1.2</span>.<span class="number">9</span>: wanted &#123;<span class="string">"os"</span>:<span class="string">"darwin"</span>,<span class="string">"arch"</span>:<span class="string">"any"</span>&#125; (current: &#123;<span class="string">"os"</span>:<span class="string">"win32"</span>,<span class="string">"arch"</span>:<span class="string">"x64"</span>&#125;)</span><br><span class="line"></span><br><span class="line">added <span class="number">1208</span> packages from <span class="number">669</span> contributors and audited <span class="number">11766</span> packages <span class="keyword">in</span> <span class="number">196.113</span>s</span><br><span class="line">found <span class="number">10</span> vulnerabilities (<span class="number">6</span> moderate, <span class="number">4</span> high)</span><br><span class="line">  run `npm audit fix` to fix them, or `npm audit` <span class="keyword">for</span> details</span><br><span class="line"></span><br><span class="line"><span class="comment"># Project initialization finished!</span></span><br><span class="line"><span class="comment"># ========================</span></span><br><span class="line"></span><br><span class="line">To get started:</span><br><span class="line"></span><br><span class="line">  cd vue-test</span><br><span class="line">  npm run dev</span><br><span class="line"></span><br><span class="line">Documentation can be found at https://vuejs-templates.github.io/webpack</span><br><span class="line"></span><br><span class="line">tips:</span><br><span class="line">npm install -g npm ï¼ˆå‡çº§npmè‡³æœ€æ–°ç‰ˆæœ¬ï¼‰</span><br><span class="line">npm cache clean --force  (å‡ºç°æŠ¥é”™å¯æ¸…é™¤ç¼“å­˜)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¯åŠ¨é¡¹ç›®</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ cd vue-test</span><br><span class="line">$ npm run dev</span><br><span class="line"></span><br><span class="line">&gt; vue-test@<span class="number">1.0</span>.<span class="number">0</span> dev D:\vue\vue-test</span><br><span class="line">&gt; webpack-dev-server --inline --progress --config build/webpack.dev.conf.js</span><br><span class="line"></span><br><span class="line"> <span class="number">13</span>% building modules <span class="number">26</span>/<span class="number">33</span> modules <span class="number">7</span> active ...ue-test\src\components\HelloWorld.vue&#123; parser: <span class="string">"babylon"</span> &#125; is deprecated; we now treat it as &#123; parser: <span class="string">"babel"</span> &#125;.</span><br><span class="line"> <span class="number">95</span>% emitting DONE  Compiled successfully <span class="keyword">in</span> <span class="number">11954</span>ms14:<span class="number">06</span>:<span class="number">01</span></span><br><span class="line"></span><br><span class="line"> I  Your application is running here: http://localhost:<span class="number">8080</span></span><br></pre></td></tr></table></figure>

<h3 id="vue-é¡¹ç›®ç›®å½•è§£æ"><a href="#vue-é¡¹ç›®ç›®å½•è§£æ" class="headerlink" title="vue é¡¹ç›®ç›®å½•è§£æ"></a>vue é¡¹ç›®ç›®å½•è§£æ</h3><p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-134137.png" alt="vue"></p>
<ul>
<li><p><strong>build</strong>ï¼šæ„å»ºè„šæœ¬ç›®å½•</p>
</li>
<li><p><strong>config</strong>ï¼šé¡¹ç›®é…ç½®ç›®å½•</p>
</li>
<li><p><strong>node_modules</strong>ï¼šnpm åŠ è½½çš„é¡¹ç›®ä¾èµ–ç›®å½•</p>
</li>
<li><p><strong>src</strong>ï¼šå¼€å‘ç›®å½•ï¼ŒåŸºæœ¬ä¸Šè¦åšçš„äº‹æƒ…éƒ½é›†ä¸­åœ¨è¿™ä¸ªç›®å½•ï¼Œé‡Œé¢åŒ…å«å‡ ä¸ªç›®å½•å’Œæ–‡ä»¶ï¼š</p>
<ul>
<li><p>assetsï¼šèµ„æºç›®å½•ï¼Œæ”¾ç½®ä¸€äº›å›¾ç‰‡æˆ–è€…å…¬å…± jsã€å…¬å…± cssï¼Œè¿™é‡Œçš„èµ„æºä¼šè¢« webpack æ„å»º</p>
</li>
<li><p>componentsï¼šç»„ä»¶ç›®å½•ï¼Œæˆ‘ä»¬å†™çš„ç»„ä»¶å°±æ”¾åœ¨è¿™ä¸ªç›®å½•é‡Œé¢</p>
</li>
<li><p>routerï¼šå‰ç«¯è·¯ç”±ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®çš„è·¯ç”±è·¯å¾„å†™åœ¨ index.js é‡Œé¢</p>
</li>
<li><p>App.vueï¼šæ ¹ç»„ä»¶</p>
</li>
<li><p>main.jsï¼šå…¥å£ js æ–‡ä»¶</p>
</li>
</ul>
</li>
<li><p><strong>static</strong>ï¼šé™æ€èµ„æºç›®å½•ï¼Œå¦‚å›¾ç‰‡ã€å­—ä½“ç­‰ï¼Œä¸ä¼šè¢« webpack æ„å»º</p>
</li>
<li><p><strong>index.html</strong>ï¼šé¦–é¡µå…¥å£æ–‡ä»¶ï¼Œå¯ä»¥æ·»åŠ ä¸€äº› meta ä¿¡æ¯ç­‰</p>
</li>
<li><p><strong>package.json</strong>ï¼šnpm åŒ…é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†é¡¹ç›®çš„ npm è„šæœ¬ï¼Œä¾èµ–åŒ…ç­‰ä¿¡æ¯</p>
</li>
</ul>
<h3 id="å¼€å‘-Frist-vue-é¡¹ç›®"><a href="#å¼€å‘-Frist-vue-é¡¹ç›®" class="headerlink" title="å¼€å‘ Frist.vue é¡¹ç›®"></a>å¼€å‘ Frist.vue é¡¹ç›®</h3><ul>
<li>components ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª views ç›®å½•ï¼Œå¹¶æ–°å»ºç»„ä»¶ First.vue</li>
<li>router ç›®å½•ä¸‹çš„ index.js é…ç½®è·¯ç”±è·¯å¾„</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> HelloWorld <span class="keyword">from</span> <span class="string">'@/components/HelloWorld'</span></span><br><span class="line"><span class="keyword">import</span> First <span class="keyword">from</span> <span class="string">'@/components/views/First'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Router)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line"></span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/'</span>,</span><br><span class="line">      name: <span class="string">'HelloWorld'</span>,</span><br><span class="line">      component: HelloWorld</span><br><span class="line">    &#125;,&#123;</span><br><span class="line">      path: <span class="string">'/first'</span>,</span><br><span class="line">      name: <span class="string">'First'</span>,</span><br><span class="line">      component: First</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>First.vue æ–‡ä»¶ template å†™ htmlï¼Œscript å†™ jsï¼Œstyle å†™ css</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;first-app&quot;&gt;</span><br><span class="line">        &#123;&#123;msg&#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    name: &quot;First&quot;,</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            msg: &quot;Welcome to FirstApp&quot;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="http://localhost:8080/#/firstï¼ŒæŸ¥çœ‹é¡µé¢æ•ˆæœ" target="_blank" rel="noopener">http://localhost:8080/#/firstï¼ŒæŸ¥çœ‹é¡µé¢æ•ˆæœ</a></li>
</ul>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Vue</tag>
        <tag>Element</tag>
      </tags>
  </entry>
  <entry>
    <title>SSH</title>
    <url>/blog/2019/07/08/linux-ssh/</url>
    <content><![CDATA[<h2 id="SSH-åè®®"><a href="#SSH-åè®®" class="headerlink" title="SSH åè®®"></a>SSH åè®®</h2><h3 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h3><p><a href="https://www.ssh.com/" target="_blank" rel="noopener"><strong>SSH</strong></a>ï¼ˆSecure Shell Protocolï¼Œå®‰å…¨å¤–å£³åè®®ï¼‰ï¼Œæ˜¯å»ºç«‹åœ¨åº”ç”¨å±‚å’Œä¼ è¾“å±‚åŸºç¡€ä¸Šçš„ <strong>ä¸€ç§åŠ å¯†çš„ç½‘ç»œå®‰å…¨ä¼ è¾“åè®®</strong>ã€‚</p>
<p><img src="http://ww2.sinaimg.cn/large/006y8mN6ly1g679gryzmvj30i609ftc4.jpg" alt="img"></p>
<h3 id="OpenSSH"><a href="#OpenSSH" class="headerlink" title="OpenSSH"></a>OpenSSH</h3><p><a href="http://www.openssh.com/" target="_blank" rel="noopener"><strong>OpenSSH</strong></a>ï¼šæ˜¯åŸºäº <a href="https://baike.baidu.com/item/SSH" target="_blank" rel="noopener">SSH</a> åè®®å®ç°ä½¿ç”¨æœ€å¹¿æ³›çš„ <strong>å…è´¹å¼€æºè½¯ä»¶</strong>ã€‚</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>å®‰å…¨å¯é </li>
<li>ä¾¿æ·</li>
</ul>
<p><strong><a href="http://www.openssh.com/" target="_blank" rel="noopener">OpenSSH</a> å¥—ä»¶å·¥å…·</strong>ï¼š</p>
<p><strong>ssh</strong>ï¼šè¿œç¨‹ç™»å½•</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">è¯­æ³•ï¼šssh</span> <span class="string">[-l</span> <span class="string">login_name]</span> <span class="string">[-p</span> <span class="string">port]</span> <span class="string">[user@host]</span></span><br><span class="line"></span><br><span class="line"><span class="string">ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="string">ssh</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.11</span>                       <span class="comment"># ä¸æŒ‡å®šç”¨æˆ·ï¼Œé»˜è®¤ä½¿ç”¨å½“å‰å®¿ä¸»ç”¨æˆ·çš„ç”¨æˆ·åç™»å½•</span></span><br><span class="line"><span class="string">ssh</span> <span class="string">root@192.168.0.11</span>                  <span class="comment"># æŒ‡å®šç”¨æˆ·ç™»å½•</span></span><br><span class="line"><span class="string">ssh</span> <span class="string">root@192.168.0.11</span> <span class="bullet">-p</span> <span class="number">2222</span>          <span class="comment"># æŒ‡å®šç«¯å£ï¼Œé»˜è®¤ç«¯å£22</span></span><br><span class="line"><span class="string">ssh</span> <span class="string">root@192.168.0.11</span> <span class="string">"ls /usr/local"</span>  <span class="comment"># è¿œç¨‹ç™»å½•åæ‰§è¡ŒæŸå‘½ä»¤</span></span><br><span class="line"></span><br><span class="line"><span class="string">å¤‡æ³¨ï¼šé…ç½®æ–‡ä»¶/etc/ssh/sshd_configï¼Œä¿®æ”¹sshç™»å½•ç«¯å£å’Œç¦æ­¢rootç™»å½•ï¼Œå¯ä»¥é˜²æ­¢è¢«ç«¯å£æ‰«æ</span></span><br></pre></td></tr></table></figure>

<p><strong>sshd</strong>ï¼šæœåŠ¡ç«¯è¿›ç¨‹æœåŠ¡</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">æœåŠ¡ç«¯ä¿®æ”¹æ–‡ä»¶é…ç½®ï¼švim</span> <span class="string">/etc/ssh/sshd_config</span> </span><br><span class="line"><span class="string">é…ç½®å®Œæˆä¹‹åè¦é‡å¯æœåŠ¡ï¼šsystemctl</span> <span class="string">restart</span> <span class="string">sshd.service</span></span><br></pre></td></tr></table></figure>

<p><strong>scp</strong>ï¼šSecure Copyï¼Œè¿œç¨‹å®‰å…¨æ‹·è´æ–‡ä»¶å’Œç›®å½•ï¼ˆåŠ å¯†ï¼‰</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">è¯­æ³•ï¼šscp</span> <span class="string">[-P</span> <span class="string">port]</span> <span class="string">[file|folder]</span> <span class="string">[user@host]:[remote_folder]</span></span><br><span class="line"></span><br><span class="line"><span class="string">ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="string">scp</span> <span class="string">mysql.sh</span> <span class="string">user@host:/tmp</span>      <span class="comment"># æœ¬åœ°æ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹ç›®å½•</span></span><br><span class="line"><span class="string">scp</span> <span class="bullet">-r</span> <span class="string">mysqldata</span> <span class="string">user@host:/tmp</span>  <span class="comment"># æœ¬åœ°ç›®å½•æ‹·è´åˆ°è¿œç¨‹ç›®å½•</span></span><br><span class="line"><span class="string">scp</span> <span class="string">root@host:/tmp</span> <span class="string">file</span>          <span class="comment"># æ–‡ä»¶ä¸‹è½½</span></span><br><span class="line"><span class="string">scp</span> <span class="bullet">-P</span> <span class="number">10022</span> <span class="string">/usr/local/src/mysql-5.7.23-el7-x86_64.tar.gz</span> <span class="string">root@10.200.62.4:/tmp</span></span><br></pre></td></tr></table></figure>

<p><strong>sftp</strong>ï¼šSecure File Transfer Protocolï¼Œå®‰å…¨æ–‡ä»¶ä¼ è¾“å‘½ä»¤è¡Œå·¥å…·ï¼Œä½¿ç”¨æ–¹å¼å’Œ <code>ftp</code> ç±»ä¼¼ï¼Œä½†å®ƒä½¿ç”¨ <code>SSH</code> ä½œä¸ºåº•å±‚ä¼ è¾“åè®®ï¼Œå®‰å…¨æ€§æ¯” <code>ftp</code> å¥½å¾ˆå¤šã€‚</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">è¯­æ³•ï¼šsftp</span> <span class="bullet">-oPort=&lt;port&gt;</span> <span class="string">&lt;user&gt;@&lt;host&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="string">å¸¸ç”¨å‘½ä»¤ï¼š</span></span><br><span class="line"><span class="string">help/?ï¼šæ‰“å°å¸®åŠ©ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="string">pwdï¼šæŸ¥çœ‹è¿œç¨‹æœåŠ¡å™¨å½“å‰ç›®å½•</span></span><br><span class="line"><span class="string">cd</span> <span class="string">&lt;dir&gt;ï¼šå°†è¿œç¨‹æœåŠ¡å™¨çš„å½“å‰ç›®å½•æ›´æ”¹ä¸º&lt;dir&gt;</span></span><br><span class="line"><span class="string">lsï¼šæ˜¾ç¤ºè¿œç¨‹æœåŠ¡å™¨ä¸Šå½“å‰ç›®å½•çš„æ–‡ä»¶å</span></span><br><span class="line"><span class="string">ls</span> <span class="bullet">-lï¼šæ˜¾ç¤ºè¿œç¨‹æœåŠ¡å™¨ä¸Šå½“å‰ç›®å½•çš„æ–‡ä»¶è¯¦ç»†åˆ—è¡¨</span></span><br><span class="line"><span class="string">get</span> <span class="string">&lt;file&gt;ï¼šä¸‹è½½æŒ‡å®šæ–‡ä»¶</span> <span class="string">&lt;file&gt;</span></span><br><span class="line"><span class="string">put</span> <span class="string">&lt;file&gt;ï¼šä¸Šä¼ æŒ‡å®šæ–‡ä»¶&lt;file&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="string">ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="string">[iteblog@www.iteblog.com</span> <span class="string">~]$</span> <span class="string">sftp</span> <span class="bullet">-oPort=22</span> <span class="string">iteblog@sftp.iteblog.com</span></span><br><span class="line"><span class="string">Connecting</span> <span class="string">to</span> <span class="string">sftp.iteblog.com...</span></span><br><span class="line"><span class="string">iteblog@sftp.iteblog.com's</span> <span class="attr">password:</span> </span><br><span class="line"><span class="string">sftp&gt;</span> <span class="string">ls</span> <span class="string">/</span></span><br><span class="line"><span class="string">/iteblog.txt</span>  </span><br><span class="line"><span class="string">sftp&gt;</span> <span class="string">ls</span> <span class="bullet">-l</span> <span class="string">/iteblog.txt</span></span><br><span class="line"><span class="bullet">-</span><span class="string">rw-r--r--</span>    <span class="number">2</span> <span class="number">50049</span>    <span class="number">50049</span>        <span class="number">4096</span> <span class="string">Jun</span> <span class="number">21</span> <span class="number">03</span><span class="string">:23</span> <span class="string">/iteblog.txt</span></span><br><span class="line"><span class="string">sftp&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>FileZilla</code> è¿æ¥ <code>SFTP</code> æœåŠ¡å™¨ï¼šä¸»æœº IP åœ°å€ã€ç”¨æˆ·åã€å¯†ç ã€ç«¯å£ï¼Œç«¯å£é»˜è®¤ä¸º <code>22</code>ã€‚</p>
<p><img src="http://ww2.sinaimg.cn/large/006y8mN6ly1g6797j8u3kj30ng0l9400.jpg" alt="img"></p>
<p><strong>ssh-keygen</strong>ï¼šç”Ÿæˆå¯†é’¥çš„å·¥å…·</p>
<ul>
<li><code>-t</code>ï¼šæŒ‡å®šç”Ÿæˆå¯†é’¥ç±»å‹ï¼ˆ<code>rsa</code>ã€<code>dsa</code> ç­‰ï¼‰</li>
<li><code>-P</code>ï¼šæŒ‡å®š å¯†è¯­ï¼Œç”¨äºç¡®ä¿ç§é’¥çš„å®‰å…¨</li>
<li><code>-f</code>ï¼šæŒ‡å®šå­˜æ”¾å¯†é’¥çš„æ–‡ä»¶ï¼ˆå…¬é’¥æ–‡ä»¶é»˜è®¤å’Œç§é’¥åŒç›®å½•ä¸‹ï¼Œä¸åŒçš„æ˜¯å­˜æ”¾å…¬é’¥çš„æ–‡ä»¶åéœ€è¦åŠ ä¸Šåç¼€ .pubï¼‰</li>
<li><code>-C</code> ç”¨æ¥æ·»åŠ æ³¨é‡Š</li>
</ul>
<p><code>~/.ssh</code> ç›®å½•ä¸‹æœ‰å››ä¸ªæ–‡ä»¶ï¼š</p>
<ul>
<li><code>id_rsa</code>ï¼šç§é’¥æ–‡ä»¶</li>
<li><code>id_rsa.pub</code>ï¼šå…¬é’¥æ–‡ä»¶</li>
<li><code>authorized_keys</code>ï¼šä¿å­˜å·²æˆæƒçš„å®¢æˆ·ç«¯å…¬é’¥</li>
<li><code>known_hosts</code>ï¼šä¿å­˜å·²è®¤è¯çš„è¿œç¨‹ä¸»æœº ID</li>
</ul>
<p><img src="http://ww2.sinaimg.cn/large/006y8mN6ly1g67aallbz9j30ip0d4gm2.jpg" alt="img"></p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸€å°ä¸»æœºå¯èƒ½æ—¢æ˜¯ Clientï¼Œä¹Ÿæ˜¯ Serverã€‚æ‰€ä»¥ä¼šåŒæ—¶æ‹¥æœ‰ authorized_keys å’Œ known_hostsã€‚</p>
</blockquote>
<h2 id="SSH-å·¥ä½œåŸç†"><a href="#SSH-å·¥ä½œåŸç†" class="headerlink" title="SSH å·¥ä½œåŸç†"></a>SSH å·¥ä½œåŸç†</h2><h3 id="å¯¹ç§°åŠ å¯†ä¸éå¯¹ç§°åŠ å¯†"><a href="#å¯¹ç§°åŠ å¯†ä¸éå¯¹ç§°åŠ å¯†" class="headerlink" title="å¯¹ç§°åŠ å¯†ä¸éå¯¹ç§°åŠ å¯†"></a>å¯¹ç§°åŠ å¯†ä¸éå¯¹ç§°åŠ å¯†</h3><h4 id="å¯¹ç§°åŠ å¯†"><a href="#å¯¹ç§°åŠ å¯†" class="headerlink" title="å¯¹ç§°åŠ å¯†"></a>å¯¹ç§°åŠ å¯†</h4><p><strong>å«ä¹‰</strong>ï¼šåŠ å¯†ä¸è§£å¯†ä½¿ç”¨åŒä¸€å¥—ç§˜é’¥ã€‚</p>
<p><strong>é—®é¢˜</strong>ï¼šè€ƒè™‘åˆ°æ•°é‡åºå¤§çš„ Client ç«¯ï¼Œå¾ˆéš¾ä¿è¯å¯†é’¥ä¸è¢«æ³„éœ²ï¼Œå¦‚ä½•å®‰å…¨çš„ä¿å­˜å¯†é’¥ ï¼Ÿ</p>
<p><img src="http://ww3.sinaimg.cn/large/006y8mN6ly1g679ssfaapj30l805agls.jpg" alt="img"></p>
<p><img src="http://ww1.sinaimg.cn/large/006y8mN6ly1g679t6uz1wj30l805bdfr.jpg" alt="img"></p>
<h4 id="éå¯¹ç§°åŠ å¯†"><a href="#éå¯¹ç§°åŠ å¯†" class="headerlink" title="éå¯¹ç§°åŠ å¯†"></a>éå¯¹ç§°åŠ å¯†</h4><p><strong>å«ä¹‰</strong>ï¼šåŠ å¯†ä¸è§£å†³å¯†ç ä¸åŒï¼Œå­˜åœ¨ä¸¤ä¸ªå¯†é’¥ï¼Œ<strong>â€œå…¬é’¥â€</strong> å’Œ <strong>â€œç§é’¥â€</strong>ã€‚</p>
<blockquote>
<p>ä¸¤ä¸ªå¯†é’¥çš„ç‰¹æ€§ï¼šå…¬é’¥åŠ å¯†åçš„å¯†æ–‡ï¼Œåªèƒ½é€šè¿‡å¯¹åº”çš„ç§é’¥è¿›è¡Œè§£å¯†ï¼Œè€Œé€šè¿‡å…¬é’¥æ¨ç†å‡ºç§é’¥çš„å¯èƒ½æ€§å¾®ä¹å…¶å¾®ã€‚</p>
</blockquote>
<p><img src="http://ww4.sinaimg.cn/large/006y8mN6ly1g679yam73pj30ft0f2t9b.jpg" alt="img"></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">è¿œç¨‹</span> <span class="string">Server</span> <span class="string">æ”¶åˆ°</span> <span class="string">Client</span> <span class="string">ç«¯ç”¨æˆ·</span> <span class="string">TopGun</span> <span class="string">çš„ç™»å½•è¯·æ±‚ï¼ŒServer</span> <span class="string">æŠŠè‡ªå·±çš„å…¬é’¥å‘ç»™ç”¨æˆ·ã€‚</span></span><br><span class="line"><span class="string">Client</span> <span class="string">ä½¿ç”¨è¿™ä¸ªå…¬é’¥ï¼Œå°†å¯†ç è¿›è¡ŒåŠ å¯†ã€‚</span></span><br><span class="line"><span class="string">Client</span> <span class="string">å°†åŠ å¯†çš„å¯†ç å‘é€ç»™</span> <span class="string">Serverç«¯ã€‚</span></span><br><span class="line"><span class="string">è¿œç¨‹</span> <span class="string">Server</span> <span class="string">ç”¨è‡ªå·±çš„ç§é’¥ï¼Œè§£å¯†ç™»å½•å¯†ç ï¼Œç„¶åéªŒè¯å…¶åˆæ³•æ€§ã€‚</span></span><br><span class="line"><span class="string">è‹¥éªŒè¯ç»“æœï¼Œç»™</span> <span class="string">Client</span> <span class="string">ç›¸åº”çš„å“åº”ã€‚</span></span><br></pre></td></tr></table></figure>

<h3 id="å›¾è§£å…¬é’¥ä¸ç§é’¥"><a href="#å›¾è§£å…¬é’¥ä¸ç§é’¥" class="headerlink" title="å›¾è§£å…¬é’¥ä¸ç§é’¥"></a>å›¾è§£å…¬é’¥ä¸ç§é’¥</h3><p><strong>å…¬é’¥</strong>ï¼šå¯ä»¥é€šè¿‡ç½‘ç»œä¼ è¾“ï¼Œåˆ«äººå¯ä»¥éšæ„æˆªè·çš„å¯†é’¥ã€‚</p>
<p><strong>ç§é’¥</strong>ï¼šä¸èƒ½é€šè¿‡ç½‘ç»œè¿›è¡Œä¼ è¾“ï¼Œä¹Ÿé˜²æ­¢åˆ«äººæˆªè·çš„å¯†é’¥ã€‚</p>
<p><strong>äº¤äº’è¿‡ç¨‹</strong>ï¼š</p>
<p>ï¼ˆ1ï¼‰é²å‹ƒæœ‰ä¸¤æŠŠé’¥åŒ™ï¼Œä¸€æŠŠæ˜¯å…¬é’¥ï¼Œå¦ä¸€æŠŠæ˜¯ç§é’¥ã€‚</p>
<p><img src="http://ww3.sinaimg.cn/large/006y8mN6ly1g67d4qd12bj30fa08n0ss.jpg" alt="PubKey1"></p>
<p>ï¼ˆ2ï¼‰é²å‹ƒæŠŠå…¬é’¥é€ç»™ä»–çš„æœ‹å‹ä»¬ â€“ å¸•è’‚ã€é“æ ¼ã€è‹çŠæ¯äººä¸€æŠŠ</p>
<p><img src="http://ww2.sinaimg.cn/large/006y8mN6ly1g67d7hmtayj30go07pq35.jpg" alt="PubKey2"></p>
<p>ï¼ˆ3ï¼‰è‹çŠè¦ç»™é²å‹ƒå†™ä¸€å°ä¿å¯†çš„ä¿¡ï¼Œå¥¹å†™å®Œåç”¨é²å‹ƒçš„å…¬é’¥åŠ å¯†ï¼Œå°±å¯ä»¥è¾¾åˆ°ä¿å¯†çš„æ•ˆæœã€‚</p>
<p><img src="http://ww1.sinaimg.cn/large/006y8mN6ly1g67d7j9fh9j30go06vglp.jpg" alt="PubKey3"></p>
<p>ï¼ˆ4ï¼‰é²å‹ƒæ”¶ä¿¡åï¼Œç”¨ç§é’¥è§£å¯†ï¼Œå°±çœ‹åˆ°äº†ä¿¡ä»¶å†…å®¹ã€‚è¿™é‡Œè¦å¼ºè°ƒçš„æ˜¯ï¼Œåªè¦é²å‹ƒçš„ç§é’¥ä¸æ³„éœ²ï¼Œè¿™å°ä¿¡å°±æ˜¯å®‰å…¨çš„ï¼Œå³ä½¿è½åœ¨åˆ«äººæ‰‹é‡Œï¼Œä¹Ÿæ— æ³•è§£å¯†ã€‚</p>
<p><img src="http://ww4.sinaimg.cn/large/006y8mN6ly1g67d8c1zbkj30go07o0su.jpg" alt="PubKey4"></p>
<p>ï¼ˆ5ï¼‰é²å‹ƒç»™è‹çŠå›ä¿¡ï¼Œå†³å®šé‡‡ç”¨â€æ•°å­—ç­¾åâ€ã€‚ä»–å†™å®Œåå…ˆç”¨ <code>Hash</code> å‡½æ•°ï¼Œç”Ÿæˆä¿¡ä»¶çš„æ‘˜è¦ï¼ˆdigestï¼‰ã€‚ </p>
<p><img src="http://ww4.sinaimg.cn/large/006y8mN6ly1g67d8o5r1gj30fa083q32.jpg" alt="PubKey5"></p>
<p>ï¼ˆ6ï¼‰ç„¶åï¼Œé²å‹ƒä½¿ç”¨ç§é’¥ï¼Œå¯¹è¿™ä¸ªæ‘˜è¦åŠ å¯†ï¼Œç”Ÿæˆâ€æ•°å­—ç­¾åâ€ï¼ˆsignatureï¼‰ã€‚</p>
<p><img src="http://ww3.sinaimg.cn/large/006y8mN6ly1g67d8zicuyj30fa06t3yd.jpg" alt="PubKey6"></p>
<p>ï¼ˆ7ï¼‰é²å‹ƒå°†è¿™ä¸ªç­¾åï¼Œé™„åœ¨ä¿¡ä»¶ä¸‹é¢ï¼Œä¸€èµ·å‘ç»™è‹çŠã€‚</p>
<p><img src="http://ww2.sinaimg.cn/large/006y8mN6ly1g67d9eeclrj30fa08g0sv.jpg" alt="PubKey7"></p>
<p>ï¼ˆ8ï¼‰è‹çŠæ”¶ä¿¡åï¼Œå–ä¸‹æ•°å­—ç­¾åï¼Œç”¨é²å‹ƒçš„å…¬é’¥è§£å¯†ï¼Œå¾—åˆ°ä¿¡ä»¶çš„æ‘˜è¦ã€‚ç”±æ­¤è¯æ˜ï¼Œè¿™å°ä¿¡ç¡®å®æ˜¯é²å‹ƒå‘å‡ºçš„ã€‚</p>
<p><img src="http://ww2.sinaimg.cn/large/006y8mN6ly1g67daaqp9rj30fa04qt8k.jpg" alt="PubKey8"> </p>
<p>ï¼ˆ9ï¼‰è‹çŠå†å¯¹ä¿¡ä»¶æœ¬èº«ä½¿ç”¨ <code>Hash</code> å‡½æ•°ï¼Œå°†å¾—åˆ°çš„ç»“æœï¼Œä¸ä¸Šä¸€æ­¥å¾—åˆ°çš„æ‘˜è¦è¿›è¡Œå¯¹æ¯”ã€‚å¦‚æœä¸¤è€…ä¸€è‡´ï¼Œå°±è¯æ˜è¿™å°ä¿¡æœªè¢«ä¿®æ”¹è¿‡ã€‚ </p>
<p><img src="http://ww1.sinaimg.cn/large/006y8mN6ly1g67datch4wj30fa088aa9.jpg" alt="PubKey9"></p>
<p>ï¼ˆ10ï¼‰å¤æ‚çš„æƒ…å†µå‡ºç°äº†ï¼Œé“æ ¼æƒ³æ¬ºéª—è‹çŠï¼Œä»–å·å·ä½¿ç”¨äº†è‹çŠçš„ç”µè„‘ï¼Œç”¨è‡ªå·±çš„å…¬é’¥æ¢èµ°äº†é²å‹ƒçš„å…¬é’¥ã€‚æ­¤æ—¶ï¼Œè‹çŠå®é™…æ‹¥æœ‰çš„æ˜¯é“æ ¼çš„å…¬é’¥ï¼Œä½†æ˜¯è¿˜ä»¥ä¸ºè¿™æ˜¯é²å‹ƒçš„å…¬é’¥ã€‚å› æ­¤ï¼Œé“æ ¼å°±å¯ä»¥å†’å……é²å‹ƒï¼Œç”¨è‡ªå·±çš„ç§é’¥åšæˆâ€æ•°å­—ç­¾åâ€ï¼Œå†™ä¿¡ç»™è‹çŠï¼Œè®©è‹çŠç”¨å‡çš„é²å‹ƒå…¬é’¥è¿›è¡Œè§£å¯†ã€‚</p>
<p><img src="http://ww1.sinaimg.cn/large/006y8mN6ly1g67dbdl39tj30fa07kaa4.jpg" alt="PubKey10"></p>
<p>ï¼ˆ11ï¼‰åæ¥ï¼Œè‹çŠæ„Ÿè§‰ä¸å¯¹åŠ²ï¼Œå‘ç°è‡ªå·±æ— æ³•ç¡®å®šå…¬é’¥æ˜¯å¦çœŸçš„å±äºé²å‹ƒã€‚å¥¹æƒ³åˆ°äº†ä¸€ä¸ªåŠæ³•ï¼Œè¦æ±‚é²å‹ƒå»æ‰¾â€è¯ä¹¦ä¸­å¿ƒâ€ï¼ˆCertificate Authorityï¼Œç®€ç§° CAï¼‰ï¼Œä¸ºå…¬é’¥åšè®¤è¯ã€‚è¯ä¹¦ä¸­å¿ƒç”¨è‡ªå·±çš„ç§é’¥ï¼Œå¯¹é²å‹ƒçš„å…¬é’¥å’Œä¸€äº›ç›¸å…³ä¿¡æ¯ä¸€èµ·åŠ å¯†ï¼Œç”Ÿæˆâ€æ•°å­—è¯ä¹¦â€ï¼ˆDigital Certificateï¼‰ã€‚</p>
<p><img src="http://ww1.sinaimg.cn/large/006y8mN6ly1g67dbuly0kj30i20bvt8u.jpg" alt="PubKey11"></p>
<p>ï¼ˆ12ï¼‰é²å‹ƒæ‹¿åˆ°æ•°å­—è¯ä¹¦ä»¥åï¼Œå°±å¯ä»¥æ”¾å¿ƒäº†ã€‚ä»¥åå†ç»™è‹çŠå†™ä¿¡ï¼Œåªè¦åœ¨ç­¾åçš„åŒæ—¶ï¼Œå†é™„ä¸Šæ•°å­—è¯ä¹¦å°±è¡Œäº†ã€‚ </p>
<p><img src="http://ww4.sinaimg.cn/large/006y8mN6ly1g67dcfjhntj30f90bywex.jpg" alt="PubKey12"></p>
<p>ï¼ˆ13ï¼‰è‹çŠæ”¶ä¿¡åï¼Œç”¨ CA çš„å…¬é’¥è§£å¼€æ•°å­—è¯ä¹¦ï¼Œå°±å¯ä»¥æ‹¿åˆ°é²å‹ƒçœŸå®çš„å…¬é’¥äº†ï¼Œç„¶åå°±èƒ½è¯æ˜â€æ•°å­—ç­¾åâ€æ˜¯å¦çœŸçš„æ˜¯é²å‹ƒç­¾çš„ã€‚ </p>
<p><img src="http://ww2.sinaimg.cn/large/006y8mN6ly1g67dcphc58j30fa09wdfv.jpg" alt="PubKey13"></p>
<h3 id="ä¸¤ç§å®‰å…¨éªŒè¯æ–¹å¼"><a href="#ä¸¤ç§å®‰å…¨éªŒè¯æ–¹å¼" class="headerlink" title="ä¸¤ç§å®‰å…¨éªŒè¯æ–¹å¼"></a>ä¸¤ç§å®‰å…¨éªŒè¯æ–¹å¼</h3><h4 id="åŸºäºå£ä»¤çš„å®‰å…¨éªŒè¯ï¼ˆç”¨æˆ·å-å¯†ç ï¼‰"><a href="#åŸºäºå£ä»¤çš„å®‰å…¨éªŒè¯ï¼ˆç”¨æˆ·å-å¯†ç ï¼‰" class="headerlink" title="åŸºäºå£ä»¤çš„å®‰å…¨éªŒè¯ï¼ˆç”¨æˆ·å/å¯†ç ï¼‰"></a>åŸºäºå£ä»¤çš„å®‰å…¨éªŒè¯ï¼ˆç”¨æˆ·å/å¯†ç ï¼‰</h4><ul>
<li>å®¢æˆ·ç«¯å‘é€ç™»å½•è¯·æ±‚ <code>ssh user@host</code>ï¼›</li>
<li>æœåŠ¡å™¨æ¥å—è¯·æ±‚ï¼Œå°†æœåŠ¡å™¨çš„å…¬é’¥ <code>id_rsa.pub</code> å‘é€ç»™å®¢æˆ·ç«¯ï¼›</li>
<li>å®¢æˆ·ç«¯è¾“å…¥å¯†ç ï¼Œå¯†ç ä½¿ç”¨ <code>id_rsa.pub</code> åŠ å¯†åå‘é€ç»™æœåŠ¡å™¨ï¼ˆæ•æ„Ÿä¿¡æ¯å®‰å…¨ä¼ è¾“ï¼‰ï¼›</li>
<li>æœåŠ¡å™¨æ¥å—åŠ å¯†åçš„å¯†ç ï¼Œä½¿ç”¨æœåŠ¡å™¨ç§é’¥ <code>id_rsa</code> è§£å¯†ï¼ŒåŒ¹é…è®¤è¯å¯†ç æ˜¯å¦åˆæ³•ï¼ˆå¦‚æœåˆæ³•ï¼ç™»å½•æˆåŠŸï¼‰ï¼›</li>
<li>å®¢æˆ·ç«¯ç”Ÿæˆä¼šè¯æ•°æ®åŠ å¯† <code>sess_key</code>ï¼Œä½¿ç”¨ <code>id_rsa.pub</code> åŠ å¯†åä¼ è¾“ç»™æœåŠ¡å™¨ï¼ˆä¼šè¯å¯†é’¥ï¼‰ï¼›</li>
<li>æœåŠ¡å™¨è·å–åˆ°åä½¿ç”¨ <code>id_rsa</code> è§£å¯†ï¼Œå¾—åˆ° <code>sess_key</code>ï¼›</li>
<li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šè¿‡ <code>sess_key</code> è¿›è¡Œä¼šè¯æ•°æ®å®‰å…¨ä¼ è¾“ã€‚</li>
</ul>
<h4 id="åŸºäºå¯†é’¥çš„å®‰å…¨éªŒè¯"><a href="#åŸºäºå¯†é’¥çš„å®‰å…¨éªŒè¯" class="headerlink" title="åŸºäºå¯†é’¥çš„å®‰å…¨éªŒè¯"></a>åŸºäºå¯†é’¥çš„å®‰å…¨éªŒè¯</h4><p>ç®€å•åœ°è¯´ï¼Œå°±æ˜¯å®¢æˆ·ç«¯è‡ªå·±ç”Ÿæˆå…¬é’¥ç§é’¥ï¼ˆé€šå¸¸é‡‡ç”¨ <code>ssh-keygen</code> ç¨‹åºç”Ÿæˆï¼‰ï¼Œç„¶åå°†å…¬é’¥ä»¥æŸç§æ–¹å¼ï¼ˆé€šå¸¸æ˜¯æ‰‹åŠ¨æ·»åŠ ï¼‰ä¿å­˜åˆ°æœåŠ¡å™¨ <code>~/.ssh/authorized_keys</code> æ–‡ä»¶ä¸­ï¼Œä»¥åæœåŠ¡å™¨éƒ½ä¼šæ¥å—å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„ç»è¿‡ä¼šè¯å¯†é’¥åŠ å¯†è¿‡çš„å…¬é’¥ï¼Œç„¶åè§£å¯†å¾—åˆ°å…¬é’¥ä¹‹åå’Œæœ¬åœ° <code>authorized_keys</code> é…ç½®çš„å…¬é’¥æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœæ˜¯åˆ™å…è®¸ç™»é™†ã€‚</p>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><ul>
<li><code>SSH</code> æ˜¯å®‰å…¨çš„åŠ å¯†åè®®ï¼Œç”¨äºè¿œç¨‹è¿æ¥ <code>Linux</code> æœåŠ¡å™¨ï¼›</li>
<li><code>SSH</code> çš„é»˜è®¤ç«¯å£æ˜¯ <code>22</code>ï¼Œå®‰å…¨åè®®ç‰ˆæœ¬æ˜¯ <code>SSH2</code>ï¼›</li>
<li><code>SSH</code> æœåŠ¡å™¨ç«¯ä¸»è¦åŒ…å«2ä¸ªæœåŠ¡åŠŸèƒ½ <code>SSH</code> è¿æ¥å’Œ <code>SFTP</code> æœåŠ¡å™¨ï¼›</li>
<li><code>SSH</code> å®¢æˆ·ç«¯åŒ…å« <code>ssh</code> è¿æ¥å‘½ä»¤å’Œè¿œç¨‹æ‹·è´ <code>scp</code> å‘½ä»¤ç­‰ã€‚</li>
</ul>
<h2 id="SSH-å®è·µ"><a href="#SSH-å®è·µ" class="headerlink" title="SSH å®è·µ"></a>SSH å®è·µ</h2><h3 id="è®¾ç½®å…å¯†ç™»å½•"><a href="#è®¾ç½®å…å¯†ç™»å½•" class="headerlink" title="è®¾ç½®å…å¯†ç™»å½•"></a>è®¾ç½®å…å¯†ç™»å½•</h3><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p><img src="http://ww3.sinaimg.cn/large/006y8mN6ly1g67a12hm04j30rs0jcjtl.jpg" alt="img"></p>
<p><strong>è®¤è¯æµç¨‹</strong>ï¼š</p>
<ul>
<li><code>Client</code> å°†è‡ªå·±çš„å…¬é’¥å­˜æ”¾åœ¨ <code>Server</code> ä¸Šï¼Œè¿½åŠ åœ¨æ–‡ä»¶ <code>authorized_keys</code> ä¸­ã€‚</li>
<li><code>Server</code> ç«¯æ¥æ”¶åˆ° <code>Client</code> çš„è¿æ¥è¯·æ±‚åï¼Œä¼šåœ¨ <code>authorized_keys</code> ä¸­åŒ¹é…åˆ° <code>Client</code> çš„å…¬é’¥ <code>pubKey</code>ï¼Œå¹¶ç”Ÿæˆéšæœºæ•° <code>R</code>ï¼Œç”¨ <code>Client</code> çš„å…¬é’¥å¯¹è¯¥éšæœºæ•°è¿›è¡ŒåŠ å¯†å¾—åˆ° <code>pubKey(R)</code>ï¼Œç„¶åå°†åŠ å¯†åä¿¡æ¯å‘é€ç»™ <code>Client</code>ã€‚</li>
<li><code>Client</code> ç«¯é€šè¿‡ç§é’¥è¿›è¡Œè§£å¯†å¾—åˆ°éšæœºæ•° <code>R</code>ï¼Œç„¶åå¯¹éšæœºæ•° <code>R</code> å’Œæœ¬æ¬¡ä¼šè¯çš„ <code>SessionKey</code> åˆ©ç”¨ <code>MD5</code> ç”Ÿæˆæ‘˜è¦ <code>Digest1</code>ï¼Œå‘é€ç»™ <code>Server</code> ç«¯ã€‚</li>
<li><code>Server</code> ç«¯ä¼šä¹Ÿä¼šå¯¹ <code>R</code> å’Œ <code>SessionKey</code> åˆ©ç”¨åŒæ ·æ‘˜è¦ç®—æ³•ç”Ÿæˆ <code>Digest2</code>ã€‚</li>
<li><code>Server</code> ç«¯ä¼šæœ€åæ¯”è¾ƒ <code>Digest1</code> å’Œ <code>Digest2</code> æ˜¯å¦ç›¸åŒï¼Œå®Œæˆè®¤è¯è¿‡ç¨‹ã€‚</li>
</ul>
<h4 id="æ“ä½œæ­¥éª¤"><a href="#æ“ä½œæ­¥éª¤" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h4><p>ï¼ˆ1ï¼‰è·å–å®¢æˆ·ç«¯å…¬é’¥ï¼š<code>~/.ssh/id_rsa.pub</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># cat ~/.ssh/id_rsa.pub</span></span><br><span class="line"><span class="string">ssh-rsa</span> <span class="string">AAAAB3NzaC1yc2EAAAADAQABAAABAQCp7KnYj1baMhQn4FPfV6YiMogWw5cu57kfGoZYMdp8KNyJ5zmqz7UZUfmURYeoiMQB7v8oY3zVq13X8Gmmw/rzROS/vR/mqSbbnSruHh+x42oVtjZz67/UtFLTO1DT/+YmT+XkrkuI2Cx6CxWFQgThLXMNStYif3Rl0+aKC7Gb0hlPwoNT+UPHMLAW7Y2x+R7I8Tdvt75jSI4TANq8QzG+/Iy9tZiG80VC2KbgGdTkDLDZrIoftfVWihm4Ec29uJocpbxMRNpMTb7yn12ySWbY7mJ2fpqGAh+s1toF94ASPfg4Hlv6Y6lx2QumePKKIGQh1bWEOirxKljUbVfqD6NF</span> <span class="string">root@hlhtapp29</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰å°†å…¬é’¥éƒ¨ç½²åˆ°æœåŠ¡ç«¯ï¼š <code>~/.ssh/authorized_keys</code> </p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vi ~/.ssh/authorized_keys</span></span><br><span class="line"><span class="string">ssh-rsa</span> <span class="string">AAAAB3NzaC1yc2EAAAADAQABAAABAQCp7KnYj1baMhQn4FPfV6YiMogWw5cu57kfGoZYMdp8KNyJ5zmqz7UZUfmURYeoiMQB7v8oY3zVq13X8Gmmw/rzROS/vR/mqSbbnSruHh+x42oVtjZz67/UtFLTO1DT/+YmT+XkrkuI2Cx6CxWFQgThLXMNStYif3Rl0+aKC7Gb0hlPwoNT+UPHMLAW7Y2x+R7I8Tdvt75jSI4TANq8QzG+/Iy9tZiG80VC2KbgGdTkDLDZrIoftfVWihm4Ec29uJocpbxMRNpMTb7yn12ySWbY7mJ2fpqGAh+s1toF94ASPfg4Hlv6Y6lx2QumePKKIGQh1bWEOirxKljUbVfqD6NF</span> <span class="string">root@hlhtapp29</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¤‡æ³¨ï¼šè‹¥æœåŠ¡ç«¯ä¸å­˜åœ¨ <code>authorized_keys</code> æ–‡ä»¶ï¼Œæ‰§è¡Œ ssh-keygen å‘½ä»¤ï¼Œç”Ÿæˆå…¬åŒ™å’Œç§åŒ™ï¼Œæ²¡æœ‰ç‰¹æ®Šéœ€è¦çš„è¯ï¼Œè¾“å®Œè¿™ä¸ªå‘½ä»¤åç›´æ¥è¿æŒ‰å›è½¦ï¼Œå°±ä¼šè‡ªåŠ¨æŠŠæ–‡ä»¶ç”Ÿæˆåˆ° ~/.ssh/ æ–‡ä»¶å¤¹ä¸­äº†ã€‚</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ssh-keygen</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> which to save the key (/root/.ssh/id_rsa): </span><br><span class="line">/root/.ssh/id_rsa already exists.</span><br><span class="line">Overwrite (y/n)? y</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:<span class="number">4</span>qHMkrfb8bchDuoYV1DjGFy3JYzegeCidBa5yRvmBAU root@CSB-service-<span class="number">2</span></span><br><span class="line">The key<span class="string">'s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 2048]----+</span></span><br><span class="line"><span class="string">| Eo++o++o .      |</span></span><br><span class="line"><span class="string">| . oo=ooo+       |</span></span><br><span class="line"><span class="string">| .+o*.....       |</span></span><br><span class="line"><span class="string">|..oO .. .        |</span></span><br><span class="line"><span class="string">|. + o + S        |</span></span><br><span class="line"><span class="string">|   * + o         |</span></span><br><span class="line"><span class="string">|  + * + . .      |</span></span><br><span class="line"><span class="string">|   * + = ...     |</span></span><br><span class="line"><span class="string">|  ..=.. o...     |</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br><span class="line"><span class="string">You have mail in /var/spool/mail/root</span></span><br></pre></td></tr></table></figure>

<h3 id="æœåŠ¡å™¨åˆå§‹åŒ–"><a href="#æœåŠ¡å™¨åˆå§‹åŒ–" class="headerlink" title="æœåŠ¡å™¨åˆå§‹åŒ–"></a>æœåŠ¡å™¨åˆå§‹åŒ–</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ $(id -u) != <span class="string">"0"</span> ]; then</span><br><span class="line">errorLog <span class="string">"é”™è¯¯ï¼šè¯·ç”¨rootè´¦æˆ·è¿è¡Œæ­¤è„šæœ¬"</span></span><br><span class="line"><span class="keyword">exit</span> <span class="number">1</span></span><br><span class="line">fi</span><br><span class="line">echo <span class="string">"æå‡æƒé™..."</span></span><br><span class="line"><span class="keyword">if</span> [[ ! `cat /etc/sudoers | grep -v grep | grep haieradmin` ]] ; then</span><br><span class="line">    echo <span class="string">"éœ€è¦æå‡æƒé™ã€‚ã€‚ã€‚"</span></span><br><span class="line">    sed -i <span class="string">'/## Allow root to run any commands anywhere / a\haieradmin ALL=(ALL) NOPASSWD:ALL'</span> /etc/sudoers</span><br><span class="line">    <span class="keyword">if</span> [[ ! `cat /etc/sudoers | grep -v grep | grep haieradmin` ]] ; then</span><br><span class="line">        echo <span class="string">"æƒé™æå‡å¤±è´¥..."</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        echo <span class="string">"æƒé™æå‡æˆåŠŸ..."</span></span><br><span class="line">    fi</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    echo <span class="string">"haieradminå·²ç»æ˜¯sudoers"</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo <span class="string">"å¼€å¯22ç«¯å£è®¿é—®..."</span></span><br><span class="line">firewall-cmd --permanent --zone=public --add-port=<span class="number">22</span>/tcp</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">echo <span class="string">"åˆ é™¤hosts.deny..."</span></span><br><span class="line">sed -i <span class="string">'s/sshd:all/ /g'</span> /etc/hosts.deny</span><br><span class="line"></span><br><span class="line">echo <span class="string">"è¿½åŠ hosts.allow..."</span></span><br><span class="line"><span class="keyword">if</span> [[ `cat /etc/hosts.allow | grep -v <span class="number">10.138</span>.*.*` ]]; then</span><br><span class="line">    echo <span class="string">"è¿½åŠ 10.138.*.*"</span></span><br><span class="line">    echo <span class="string">"sshd:10.138.*.*"</span> &gt;&gt; /etc/hosts.allow</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h3 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h3><p><strong>é—®é¢˜</strong>ï¼šCentOS 7.3 é…ç½® SSH å…å¯†ç ç™»å½•åä»è¦è¾“å…¥å¯†ç çš„è§£å†³æ–¹æ³•ï¼Ÿ</p>
<p><strong>åŸå› åˆ†æ</strong>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> tail /var/log/secure -n 20</span><br><span class="line">Authentication refused: bad ownership or modes for directory /home/haieradmin</span><br></pre></td></tr></table></figure>

<p>sshd ä¸ºäº†å®‰å…¨ï¼Œå¯¹å±ä¸»çš„ç›®å½•å’Œæ–‡ä»¶æƒé™æœ‰æ‰€è¦æ±‚ï¼Œå¦‚æœæƒé™ä¸å¯¹ï¼Œåˆ™sshçš„å…å¯†ç ç™»é™†ä¸ç”Ÿæ•ˆã€‚</p>
<ul>
<li>.ssh ç›®å½•æƒé™ä¸º 700</li>
<li>rsa_id.pub åŠ authorized_keys æƒé™ä¸€èˆ¬ä¸º 644</li>
<li>rsa_id æƒé™å¿…é¡»ä¸º 600</li>
</ul>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼šæ£€æµ‹ç›®å½•æƒé™ï¼ŒæŠŠä¸ç¬¦åˆè¦æ±‚çš„æŒ‰è¦æ±‚è®¾ç½®æƒé™å³å¯ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>SSH</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL Â· SQL</title>
    <url>/blog/2019/07/05/mysql-sql/</url>
    <content><![CDATA[<h3 id="åº“"><a href="#åº“" class="headerlink" title="åº“"></a>åº“</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæ•°æ®åº“</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="string">'dbname'</span> <span class="comment">/*!40100 DEFAULT CHARACTER SET utf8 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æ•°æ®åº“</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> <span class="string">'dbname'</span></span><br></pre></td></tr></table></figure>

<h3 id="è¡¨"><a href="#è¡¨" class="headerlink" title="è¡¨"></a>è¡¨</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ’å…¥è¡¨</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tabname(field1,field2) <span class="keyword">values</span>(value1,value2)</span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">test</span>(<span class="keyword">name</span>,age) <span class="keyword">values</span>(<span class="string">'raohui'</span>,<span class="number">29</span>);</span><br><span class="line">mysql&gt; insert into test(name,age) values('yangnan',22);</span><br><span class="line">mysql&gt; select * from test;</span><br><span class="line">+<span class="comment">----+---------+-----+---------------------+---------------------+</span></span><br><span class="line">| id | name    | age | gmt_create          | gmt_modified        |</span><br><span class="line">+<span class="comment">----+---------+-----+---------------------+---------------------+</span></span><br><span class="line">|  1 | raohui  |  29 | 2019-09-24 16:19:13 | 2019-09-24 16:29:16 |</span><br><span class="line">|  2 | yangnan |  22 | 2019-09-24 16:19:24 | 2019-09-24 16:19:24 |</span><br><span class="line">+<span class="comment">----+---------+-----+---------------------+---------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹è¡¨å</span></span><br><span class="line"><span class="keyword">rename</span> <span class="keyword">table</span> <span class="string">'oldname'</span> <span class="keyword">to</span> <span class="string">'newname'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè¡¨</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`testdemo`</span> (</span><br><span class="line">	<span class="string">`id`</span> <span class="built_in">bigint</span> <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">	<span class="string">`name`</span> <span class="built_in">char</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`address`</span> <span class="built_in">varchar</span>(<span class="number">50</span>),</span><br><span class="line">	<span class="string">`age`</span> <span class="built_in">tinyint</span> <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">	<span class="string">`gmt_create`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">	<span class="string">`gmt_modified`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">	PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è¡¨ç»“æ„</span></span><br><span class="line">desc test;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">test</span>\G</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶è¡¨</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">'newname'</span> <span class="keyword">LIKE</span> <span class="string">'oldname'</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">'newname'</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="string">'oldname'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹è¡¨å­˜å‚¨å¼•æ“</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">'table_name'</span> <span class="keyword">engine</span>=myisam;</span><br></pre></td></tr></table></figure>

<h3 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤ç´¢å¼•</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">index</span> idx_name <span class="keyword">on</span> <span class="string">'table_name'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ è‡ªå¢ä¸»é”®</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">'table_name'</span> <span class="keyword">ADD</span> <span class="keyword">id</span> <span class="built_in">bigint</span>(<span class="number">10</span>) PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è¡¨ç´¢å¼•</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">INDEX</span> <span class="keyword">FROM</span> <span class="string">'table_name'</span>ï¼›</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ ä¸»é”®</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">'table_name'</span> <span class="keyword">ADD</span> PRIMARY <span class="keyword">KEY</span> (<span class="keyword">column</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå”¯ä¸€ç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">'table_name'</span> <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> (<span class="keyword">column</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ™®é€šç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">'table_name'</span> <span class="keyword">ADD</span> <span class="string">'index_name'</span>(<span class="keyword">column</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºèšåˆç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">'table_name'</span> <span class="keyword">ADD</span> <span class="keyword">INDEX</span> <span class="string">'index_name'</span> (column1, column2, column3)</span><br></pre></td></tr></table></figure>

<h3 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢è§†å›¾</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> information_schema.views;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè§†å›¾</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> <span class="string">'viewname'</span> <span class="keyword">as</span> <span class="string">'sql'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤è§†å›¾</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> <span class="string">'viewname'</span></span><br></pre></td></tr></table></figure>

<h3 id="å¤æ‚æŸ¥è¯¢"><a href="#å¤æ‚æŸ¥è¯¢" class="headerlink" title="å¤æ‚æŸ¥è¯¢"></a>å¤æ‚æŸ¥è¯¢</h3><h4 id="LIKE"><a href="#LIKE" class="headerlink" title="LIKE"></a>LIKE</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="string">'table'</span> <span class="keyword">where</span> <span class="keyword">field</span> <span class="keyword">like</span> <span class="string">'%value%'</span></span><br></pre></td></tr></table></figure>

<h4 id="UNION-amp-UNION-ALL"><a href="#UNION-amp-UNION-ALL" class="headerlink" title="UNION &amp; UNION ALL"></a>UNION &amp; UNION ALL</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table_name1</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table_name2</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table_name1</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table_name2</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šé»˜è®¤åœ°ï¼Œ<span class="keyword">UNION</span> æ“ä½œç¬¦é€‰å–ä¸åŒçš„å€¼ï¼Œå¦‚æœå…è®¸é‡å¤çš„å€¼ï¼Œè¯·ä½¿ç”¨ <span class="keyword">UNION</span> <span class="keyword">ALL</span>ã€‚</span><br></pre></td></tr></table></figure>

<h4 id="å­æŸ¥è¯¢"><a href="#å­æŸ¥è¯¢" class="headerlink" title="å­æŸ¥è¯¢"></a>å­æŸ¥è¯¢</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> a,b,c <span class="keyword">from</span> a <span class="keyword">where</span> d <span class="keyword">IN</span> (<span class="keyword">select</span> d <span class="keyword">from</span> b )</span><br></pre></td></tr></table></figure>

<h4 id="BETWEEN-AND"><a href="#BETWEEN-AND" class="headerlink" title="BETWEEN AND"></a>BETWEEN AND</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> table1 <span class="keyword">where</span> <span class="built_in">time</span> <span class="keyword">between</span> time1 <span class="keyword">and</span> time2</span><br></pre></td></tr></table></figure>

<h4 id="IN"><a href="#IN" class="headerlink" title="IN"></a>IN</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> table1 <span class="keyword">where</span> a [<span class="keyword">not</span>] <span class="keyword">in</span> (â€˜å€¼<span class="number">1</span>â€™,â€™å€¼<span class="number">2</span>â€™,â€™å€¼<span class="number">4</span>â€™,â€™å€¼<span class="number">6</span>â€™)</span><br></pre></td></tr></table></figure>

<h4 id="Group-By"><a href="#Group-By" class="headerlink" title="Group By"></a>Group By</h4><h4 id="ORDER-BY"><a href="#ORDER-BY" class="headerlink" title="ORDER BY"></a>ORDER BY</h4><p><strong>è¯­æ³•ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> field1, field2,...fieldN <span class="keyword">FROM</span> table_name1, table_name2...</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> field1, [field2...] [<span class="keyword">ASC</span> [<span class="keyword">DESC</span>]]</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½ å¯ä»¥ä½¿ç”¨ ASC æˆ– DESC å…³é”®å­—æ¥è®¾ç½®æŸ¥è¯¢ç»“æœæ˜¯æŒ‰å‡åºæˆ–é™åºæ’åˆ—ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒæŒ‰å‡åºæ’åˆ—ã€‚</li>
<li>ä½ å¯ä»¥æ·»åŠ  WHEREâ€¦LIKE å­å¥æ¥è®¾ç½®æ¡ä»¶ã€‚</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="string">'tabname'</span> <span class="keyword">order</span> <span class="keyword">by</span> field1,field2 [<span class="keyword">desc</span>]</span><br></pre></td></tr></table></figure>

<h4 id="JOIN"><a href="#JOIN" class="headerlink" title="JOIN"></a>JOIN</h4><h3 id="ç»Ÿè®¡ä¿¡æ¯"><a href="#ç»Ÿè®¡ä¿¡æ¯" class="headerlink" title="ç»Ÿè®¡ä¿¡æ¯"></a>ç»Ÿè®¡ä¿¡æ¯</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢æ‰€æœ‰åº“æ•°æ®é‡å¹¶æ’åº</span></span><br><span class="line"><span class="keyword">SELECT</span> table_schema, <span class="keyword">CONCAT</span>(</span><br><span class="line"><span class="keyword">TRUNCATE</span>(<span class="keyword">SUM</span>(data_length)/<span class="number">1024</span>/<span class="number">1024</span>,<span class="number">2</span>),<span class="string">'MB'</span>) <span class="keyword">AS</span> data_size, <span class="keyword">CONCAT</span>(</span><br><span class="line"><span class="keyword">TRUNCATE</span>(<span class="keyword">SUM</span>(index_length)/<span class="number">1024</span>/<span class="number">1024</span>,<span class="number">2</span>),<span class="string">'MB'</span>) <span class="keyword">AS</span> index_size</span><br><span class="line"><span class="keyword">FROM</span> information_schema.tables</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> table_schema</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">SUM</span>(data_length) <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line">+<span class="comment">--------------------+------------+------------+</span></span><br><span class="line">| table_schema       | data_size  | index_size |</span><br><span class="line">+<span class="comment">--------------------+------------+------------+</span></span><br><span class="line">| csomo-barcode      | 51872.64MB | 49203.56MB |</span><br><span class="line">| cosmodb            | 30257.57MB | 13855.68MB |</span><br><span class="line">| cosmo_im_1001      | 19769.54MB | 6251.67MB  |</span><br><span class="line">| cosmoimbase        | 17594.54MB | 18239.81MB |</span><br><span class="line">| cosmo_im_1004      | 3141.99MB  | 4099.13MB  |</span><br><span class="line">| cosmo_im_1012      | 1524.87MB  | 1592.03MB  |</span><br><span class="line">| cosmo_im_1010      | 1464.20MB  | 2176.00MB  |</span><br><span class="line">| cosmo_im_1016      | 1092.29MB  | 1543.65MB  |</span><br><span class="line">| cosmo_im_1009      | 793.96MB   | 1612.11MB  |</span><br><span class="line">| cosmo_im_1003      | 662.42MB   | 1417.97MB  |</span><br><span class="line">| cosmo_im_1006      | 200.44MB   | 288.24MB   |</span><br><span class="line">| cosmo_im_1047      | 184.14MB   | 90.46MB    |</span><br><span class="line">| cosmo_im_1038      | 32.15MB    | 46.03MB    |</span><br><span class="line">| mysql              | 22.60MB    | 0.14MB     |</span><br><span class="line">| test               | 7.06MB     | 0.03MB     |</span><br><span class="line">| information_schema | 0.00MB     | 0.00MB     |</span><br><span class="line">| performance_schema | 0.00MB     | 0.00MB     |</span><br><span class="line">+<span class="comment">--------------------+------------+------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢å•ä¸ªè¡¨æ•°æ®é‡</span></span><br><span class="line"><span class="keyword">select</span> table_name,table_rows,<span class="keyword">CONCAT</span>(</span><br><span class="line"><span class="keyword">TRUNCATE</span>(<span class="keyword">SUM</span>(data_length)/<span class="number">1024</span>/<span class="number">1024</span>,<span class="number">2</span>),<span class="string">'MB'</span>) <span class="keyword">AS</span> data_size, <span class="keyword">CONCAT</span>(</span><br><span class="line"><span class="keyword">TRUNCATE</span>(<span class="keyword">SUM</span>(index_length)/<span class="number">1024</span>/<span class="number">1024</span>,<span class="number">2</span>),<span class="string">'MB'</span>) <span class="keyword">AS</span> index_size <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> TABLE_SCHEMA = <span class="string">'mqm'</span> <span class="keyword">and</span> table_name=<span class="string">'t_batch'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢å•ä¸ªåº“ä¸­è¡¨æ•°æ®æ’åº</span></span><br><span class="line"><span class="keyword">select</span> table_name,table_rows <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> TABLE_SCHEMA= <span class="string">'employees'</span> <span class="keyword">order</span> <span class="keyword">by</span> table_rows <span class="keyword">desc</span>;</span><br><span class="line">+<span class="comment">----------------------+------------+</span></span><br><span class="line">| table_name           | table_rows |</span><br><span class="line">+<span class="comment">----------------------+------------+</span></span><br><span class="line">| salaries             |    2838426 |</span><br><span class="line">| titles               |     441772 |</span><br><span class="line">| dept_emp             |     331570 |</span><br><span class="line">| employees            |     299600 |</span><br><span class="line">| dept_manager         |         24 |</span><br><span class="line">| departments          |          9 |</span><br><span class="line">| current_dept_emp     |       NULL |</span><br><span class="line">| dept_emp_latest_date |       NULL |</span><br><span class="line">+<span class="comment">----------------------+------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢å•ä¸ªåº“ä¸­è¡¨æ’åº</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(table_schema,<span class="string">'.'</span>,table_name) <span class="keyword">AS</span> <span class="string">'Table Name'</span>, table_rows <span class="keyword">AS</span> <span class="string">'Rows'</span>, <span class="keyword">CONCAT</span>(<span class="keyword">ROUND</span>(data_length/(<span class="number">1024</span>*<span class="number">1024</span>),<span class="number">2</span>),<span class="string">'M'</span>) <span class="keyword">AS</span> <span class="string">'Data Size'</span>,<span class="keyword">CONCAT</span>(<span class="keyword">ROUND</span>(index_length/(<span class="number">1024</span>*<span class="number">1024</span>),<span class="number">2</span>),<span class="string">'M'</span>) <span class="keyword">AS</span> <span class="string">'Index Size'</span>, <span class="keyword">CONCAT</span>(<span class="keyword">ROUND</span>((data_length+index_length)/(<span class="number">1024</span>*<span class="number">1024</span>),<span class="number">2</span>),<span class="string">'M'</span>) <span class="keyword">AS</span><span class="string">'Total'</span><span class="keyword">FROM</span> information_schema.TABLES <span class="keyword">WHERE</span> TABLE_SCHEMA= <span class="string">'employees'</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="comment">--total DESC;</span></span><br><span class="line">+<span class="comment">--------------------------------+---------+-----------+------------+--------+</span></span><br><span class="line">| <span class="keyword">Table</span> <span class="keyword">Name</span>                     | <span class="keyword">Rows</span>    | <span class="keyword">Data</span> <span class="keyword">Size</span> | <span class="keyword">Index</span> <span class="keyword">Size</span> | Total  |</span><br><span class="line">+<span class="comment">--------------------------------+---------+-----------+------------+--------+</span></span><br><span class="line">| employees.salaries             | <span class="number">2838426</span> | <span class="number">95.63</span>M    | <span class="number">0.00</span>M      | <span class="number">95.63</span>M |</span><br><span class="line">| employees.titles               |  <span class="number">441772</span> | <span class="number">19.56</span>M    | <span class="number">0.00</span>M      | <span class="number">19.56</span>M |</span><br><span class="line">| employees.dept_emp             |  <span class="number">331570</span> | <span class="number">11.52</span>M    | <span class="number">5.52</span>M      | <span class="number">17.03</span>M |</span><br><span class="line">| employees.employees            |  <span class="number">299600</span> | <span class="number">14.52</span>M    | <span class="number">0.00</span>M      | <span class="number">14.52</span>M |</span><br><span class="line">| employees.dept_manager         |      <span class="number">24</span> | <span class="number">0.02</span>M     | <span class="number">0.02</span>M      | <span class="number">0.03</span>M  |</span><br><span class="line">| employees.departments          |       <span class="number">9</span> | <span class="number">0.02</span>M     | <span class="number">0.02</span>M      | <span class="number">0.03</span>M  |</span><br><span class="line">| employees.current_dept_emp     |    <span class="literal">NULL</span> | <span class="literal">NULL</span>      | <span class="literal">NULL</span>       | <span class="literal">NULL</span>   |</span><br><span class="line">| employees.dept_emp_latest_date |    <span class="literal">NULL</span> | <span class="literal">NULL</span>      | <span class="literal">NULL</span>       | <span class="literal">NULL</span>   |</span><br><span class="line">+<span class="comment">--------------------------------+---------+-----------+------------+--------+</span></span><br></pre></td></tr></table></figure>

<h3 id="å¤åˆ¶"><a href="#å¤åˆ¶" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å–æ¶ˆå¤åˆ¶</span></span><br><span class="line"><span class="keyword">stop</span> <span class="keyword">slave</span>;</span><br><span class="line"><span class="keyword">reset</span> <span class="keyword">slave</span> <span class="keyword">all</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»ºç«‹å¤åˆ¶</span></span><br><span class="line"><span class="keyword">CHANGE</span> <span class="keyword">MASTER</span> <span class="keyword">TO</span> </span><br><span class="line">MASTER_HOST=<span class="string">'10.133.7.18'</span>,</span><br><span class="line">MASTER_USER=<span class="string">'repl'</span>,</span><br><span class="line">MASTER_PASSWORD=<span class="string">'Changeme_123'</span>,</span><br><span class="line">MASTER_PORT=<span class="number">3306</span>,</span><br><span class="line">MASTER_LOG_FILE=<span class="string">'mysql-binlog.000297'</span>, </span><br><span class="line">MASTER_LOG_POS=<span class="number">900834433</span>,</span><br><span class="line">MASTER_CONNECT_RETRY=<span class="number">10</span>;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>SQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Percona Toolkit Â· ç®€ä»‹å®‰è£…</title>
    <url>/blog/2019/07/05/mysql-toolkit/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><a href="https://github.com/percona/percona-toolkit" target="_blank" rel="noopener"><strong>Percona Toolkit</strong></a> ç®€ç§° <code>pt</code>ï¼Œä¸“ç”¨äº <code>MySQL</code> è¿ç»´ç®¡ç†çš„å·¥å…·ç®±ï¼Œå‡ ä¹èƒ½æ»¡è¶³ <code>MySQL</code> æ—¥å¸¸è¿ç»´çš„æ‰€æœ‰éœ€æ±‚ï¼Œä½¿ç”¨ <code>Perl</code> ç¼–å†™ã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>â‘   å®‰è£…</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ wget http://devops-files.oss-cn-qingdao.aliyuncs.com/percona-toolkit-<span class="number">3.0</span>.<span class="number">13</span>-el7-x86_64-bundle.tar</span><br><span class="line">$ tar xvf percona-toolkit-<span class="number">3.0</span>.<span class="number">13</span>-el7-x86_64-bundle.tar</span><br><span class="line">$ rpm -ivh percona-toolkit-<span class="number">3.0</span>.<span class="number">13</span>-<span class="number">1</span>.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">warning: percona-toolkit-<span class="number">3.0</span>.<span class="number">13</span>-<span class="number">1</span>.el7.x86_64.rpm: Header V4 RSA/SHA256 Signature, key ID <span class="number">8507</span>efa5: NOKEY</span><br><span class="line">error: Failed dependencies:</span><br><span class="line">	perl(DBD::mysql) &gt;= <span class="number">1.0</span> is needed by percona-toolkit-<span class="number">3.0</span>.<span class="number">13</span>-<span class="number">1</span>.el7.x86_64</span><br><span class="line">	perl(IO::Socket::SSL) is needed by percona-toolkit-<span class="number">3.0</span>.<span class="number">13</span>-<span class="number">1</span>.el7.x86_64</span><br><span class="line">	perl(Digest::MD5) is needed by percona-toolkit-<span class="number">3.0</span>.<span class="number">13</span>-<span class="number">1</span>.el7.x86_64</span><br><span class="line">	perl(Time::HiRes) is needed by percona-toolkit-<span class="number">3.0</span>.<span class="number">13</span>-<span class="number">1</span>.el7.x86_64</span><br><span class="line">	perl(Term::ReadKey) is needed by percona-toolkit-<span class="number">3.0</span>.<span class="number">13</span>-<span class="number">1</span>.el7.x86_64</span><br></pre></td></tr></table></figure>

<p>â‘¡  è§£å†³ä¾èµ–</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ yum -y install perl-DBD-MySQL</span><br><span class="line">$ yum -y install perl-Digest-MD5</span><br><span class="line">$ yum -y install perl-IO-Socket-SSL</span><br><span class="line">$ yum -y install perl-TermReadKey</span><br><span class="line">$ yum -y install perl-Time-HiRes</span><br><span class="line">$ rpm -ivh percona-toolkit-<span class="number">3.0</span>.<span class="number">13</span>-<span class="number">1</span>.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">$ pt-archiver --help</span><br><span class="line">Usage: pt-archiver [OPTIONS] --source DSN --where WHERE</span><br></pre></td></tr></table></figure>

<h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>pt-align</td>
<td>å¯¹é½å…¶ä»–å·¥å…·çš„è¾“å‡º</td>
</tr>
<tr>
<td>pt-archiver</td>
<td>å°†è¡¨æ•°æ®å½’æ¡£åˆ°å¦ä¸€ä¸ªè¡¨æˆ–æ–‡ä»¶ä¸­</td>
</tr>
<tr>
<td>pt-config-diff</td>
<td>æ¯”è¾ƒé…ç½®æ–‡ä»¶å’Œå‚æ•°</td>
</tr>
<tr>
<td>pt-deadlock-logger</td>
<td>æå–å’Œè®°å½• <code>mysql</code> æ­»é”ä¿¡æ¯</td>
</tr>
<tr>
<td>pt-diskstats</td>
<td>æŸ¥çœ‹ç³»ç»Ÿç£ç›˜çŠ¶æ€</td>
</tr>
<tr>
<td>pt-duplicate-key-checker</td>
<td>åˆ—å‡ºå¹¶åˆ é™¤é‡å¤çš„ç´¢å¼•å’Œå¤–é”®</td>
</tr>
<tr>
<td>pt-fifo-split</td>
<td>æ¨¡æ‹Ÿåˆ‡å‰²æ–‡ä»¶å¹¶è¾“å‡º</td>
</tr>
<tr>
<td>pt-find</td>
<td>æŸ¥æ‰¾è¡¨å¹¶æ‰§è¡Œå‘½ä»¤</td>
</tr>
<tr>
<td>pt-fingerprint</td>
<td>å°†æŸ¥è¯¢è½¬æˆå¯†æ–‡</td>
</tr>
<tr>
<td>pt-fk-error-logger</td>
<td>æå–å’Œè®°å½•å¤–é”®ä¿¡æ¯</td>
</tr>
<tr>
<td>pt-heartbeat</td>
<td>ç›‘æ§å¤åˆ¶å»¶è¿Ÿ</td>
</tr>
<tr>
<td>pt-index-usage</td>
<td>åˆ†ææ—¥å¿—ä¸­ç´¢å¼•ä½¿ç”¨æƒ…å†µï¼Œå¹¶å‡ºæŠ¥å‘Š</td>
</tr>
<tr>
<td>pt-ioprofile</td>
<td>æŸ¥è¯¢è¿›ç¨‹ <code>IO</code> å¹¶æ‰“å°æ´»åŠ¨è¡¨</td>
</tr>
<tr>
<td>pt-kill</td>
<td><code>kill</code> æ‰ç¬¦åˆæ¡ä»¶çš„ <code>sql</code></td>
</tr>
<tr>
<td>pt-mext</td>
<td>å¹¶è¡ŒæŸ¥çœ‹ <code>status</code> æ ·æœ¬ä¿¡æ¯</td>
</tr>
<tr>
<td>pt-mysql-summary</td>
<td>å¯¹ <code>mysql</code> é…ç½®å’Œ <code>status</code> è¿›è¡Œæ±‡æ€»</td>
</tr>
<tr>
<td>pt-online-schema-change</td>
<td>åœ¨çº¿ä¿®æ”¹è¡¨ç»“æ„</td>
</tr>
<tr>
<td>pt-pmp</td>
<td>ä¸ºæŸ¥è¯¢ç»“æœè·Ÿè¸ªï¼Œå¹¶æ±‡æ€»è·Ÿè¸ªç»“æœ</td>
</tr>
<tr>
<td>pt-query-digest</td>
<td>åˆ†ææŸ¥è¯¢æ—¥å¿—ï¼Œå¹¶äº§ç”ŸæŠ¥å‘Š</td>
</tr>
<tr>
<td>pt-secure-collect</td>
<td>æ”¶é›†ã€æ‰“åŒ…ã€åŠ å¯†æ•°æ®</td>
</tr>
<tr>
<td>pt-show-grants</td>
<td>è§„èŒƒåŒ–å’Œæ‰“å°æƒé™</td>
</tr>
<tr>
<td>pt-sift</td>
<td>æµè§ˆç”± <code>pt-stalk</code> åˆ›å»ºçš„æ–‡ä»¶</td>
</tr>
<tr>
<td>pt-slave-delay</td>
<td>è®¾å®šä»è½åä¸»çš„æ—¶é—´</td>
</tr>
<tr>
<td>pt-slave-find</td>
<td>æŸ¥æ‰¾å’Œæ‰“å°æ‰€æœ‰å¤åˆ¶å±‚çº§å…³ç³»</td>
</tr>
<tr>
<td>pt-slave-restart</td>
<td>ç›‘æ§ <code>salve</code> é”™è¯¯ï¼Œå¹¶å°è¯•é‡å¯ <code>salve</code></td>
</tr>
<tr>
<td>pt-stalk</td>
<td>å‡ºç°é—®é¢˜æ—¶ï¼Œæ”¶é›†è¯Šæ–­æ•°æ®</td>
</tr>
<tr>
<td>pt-summary</td>
<td>æ”¶é›†å’Œæ˜¾ç¤ºç³»ç»Ÿæ¦‚å†µ</td>
</tr>
<tr>
<td>pt-table-checksum</td>
<td>æ ¡éªŒä¸»ä»å¤åˆ¶ä¸€è‡´æ€§</td>
</tr>
<tr>
<td>pt-table-sync</td>
<td>é«˜æ•ˆåŒæ­¥è¡¨æ•°æ®</td>
</tr>
<tr>
<td>pt-table-usage</td>
<td>åˆ†ææ—¥å¿—ä¸­æŸ¥è¯¢å¹¶åˆ†æè¡¨ä½¿ç”¨æƒ…å†µ</td>
</tr>
<tr>
<td>pt-upgrade</td>
<td>åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šæ‰§è¡ŒæŸ¥è¯¢ï¼Œå¹¶æ¯”è¾ƒä¸åŒ</td>
</tr>
<tr>
<td>pt-variable-advisor</td>
<td>åˆ†æå‚æ•°ï¼Œå¹¶æå‡ºå»ºè®®</td>
</tr>
<tr>
<td>pt-visual-explain</td>
<td>æ ¼å¼åŒ–æ‰§è¡Œè®¡åˆ’</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>Toolkit</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL Â· é…ç½®å‚æ•° Â· innodb_buffer_pool_size</title>
    <url>/blog/2019/06/18/mysql-innodb_buffer_pool_size/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><strong>ç¼“å­˜</strong>æ˜¯è®¡ç®—æœºç³»ç»Ÿéå¸¸é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œå› ä¸ºè®¿é—®ç¡¬ç›˜ç›¸æ¯”ç¼“å­˜å¯èƒ½ä¼šæ…¢ <code>100</code> åˆ° <code>100000</code> å€ï¼Œå–å†³äºè®¿é—®çš„æ•°æ®é‡ã€‚<code>MySQL</code> ä½œä¸ºä¸€ä¸ªå­˜å‚¨ç³»ç»Ÿï¼ŒåŒæ ·å…·æœ‰<strong>ç¼“å†²æ± </strong>ï¼ˆ<code>Buffer Pool</code>ï¼‰æœºåˆ¶ï¼Œä»¥é¿å…æ¯æ¬¡æŸ¥è¯¢æ•°æ®éƒ½è¿›è¡Œç£ç›˜ <code>IO</code>ï¼Œä¸åŒå­˜å‚¨å¼•æ“ç¼“å­˜æ–¹å¼æœ‰æ‰€åŒºåˆ«ï¼š</p>
<ul>
<li><p><a href="https://baike.baidu.com/item/myisam" target="_blank" rel="noopener"><strong>MyISAM</strong></a> ä½¿ç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼Œæ¥ç¼“å­˜é‚£äº›ç»å¸¸è¢«æŸ¥è¯¢çš„æ•°æ®ã€‚</p>
</li>
<li><p><a href="https://baike.baidu.com/item/innodb" target="_blank" rel="noopener"><strong>InnoDB</strong></a> ä¸ä¾èµ–æ“ä½œç³»ç»Ÿçš„ç¼“å­˜ï¼Œè‡ªå·±åœ¨ <a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-buffer-pool-resize.html" target="_blank" rel="noopener"><strong>InnoDB Buffer Pool</strong></a> å¤„ç†ç¼“å­˜ã€‚</p>
</li>
</ul>
<p><strong>â‘   InnoDB Buffer Pool ä¸»è¦ä½œç”¨ï¼Ÿ</strong></p>
<p>ç¼“å­˜è¡¨æ•°æ®ä¸ç´¢å¼•æ•°æ®ï¼ŒæŠŠç£ç›˜ä¸Šçš„æ•°æ®åŠ è½½åˆ°ç¼“å†²æ± ï¼Œé¿å…æ¯æ¬¡è®¿é—®éƒ½è¿›è¡Œç£ç›˜ <code>IO</code>ï¼Œèµ·åˆ°åŠ é€Ÿè®¿é—®çš„ä½œç”¨ã€‚</p>
<p><strong>â‘¡  ä¸ºä»€ä¹ˆä¸æŠŠæ‰€æœ‰æ•°æ®éƒ½æ”¾åˆ°ç¼“å†²æ± é‡Œï¼Ÿ</strong></p>
<p>å‡¡äº‹éƒ½å…·å¤‡ä¸¤é¢æ€§ï¼ŒæŠ›å¼€æ•°æ®æ˜“å¤±æ€§ä¸è¯´ï¼Œè®¿é—®å¿«é€Ÿçš„åé¢æ˜¯å­˜å‚¨å®¹é‡å°ï¼š</p>
<ul>
<li>ç¼“å­˜è®¿é—®å¿«ï¼Œä½†å®¹é‡å°ï¼Œæ•°æ®åº“å­˜å‚¨äº† <code>200G</code> æ•°æ®ï¼Œç¼“å­˜å®¹é‡å¯èƒ½åªæœ‰ <code>64G</code>ï¼›</li>
<li>å†…å­˜è®¿é—®å¿«ï¼Œä½†å®¹é‡å°ï¼Œä¹°ä¸€å°ç¬”è®°æœ¬ç£ç›˜æœ‰ <code>2T</code>ï¼Œå†…å­˜å¯èƒ½åªæœ‰ <code>16G</code>ï¼›</li>
</ul>
<p>å› æ­¤ï¼Œ<strong>åªèƒ½æŠŠâ€œæœ€çƒ­â€çš„æ•°æ®æ”¾åˆ°â€œæœ€è¿‘â€çš„åœ°æ–¹ï¼Œä»¥â€œæœ€å¤§é™åº¦â€ çš„é™ä½ç£ç›˜è®¿é—®</strong>ã€‚</p>
<p><strong>â‘¢  å¦‚ä½•ç®¡ç†ä¸æ·˜æ±°ç¼“å†²æ± ï¼Œä½¿å¾—æ€§èƒ½æœ€å¤§åŒ–å‘¢ï¼Ÿ</strong></p>
<h2 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h2><p><strong>å‚æ•°</strong>ï¼šinnodb_buffer_pool_size</p>
<p><strong>ä»‹ç»</strong>ï¼šé…ç½®ç¼“å†²æ± çš„å¤§å°ï¼Œåœ¨å†…å­˜å…è®¸çš„æƒ…å†µä¸‹ï¼ŒDBA å¾€å¾€ä¼šå»ºè®®è°ƒå¤§è¿™ä¸ªå‚æ•°ï¼Œè¶Šå¤šæ•°æ®å’Œç´¢å¼•æ”¾åˆ°å†…å­˜é‡Œï¼Œæ•°æ®åº“çš„æ€§èƒ½ä¼šè¶Šå¥½ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼šinnodb_old_blocks_pct</p>
<p><strong>ä»‹ç»</strong>ï¼šè€ç”Ÿä»£å æ•´ä¸ª <code>LRU</code> é“¾é•¿åº¦çš„æ¯”ä¾‹ï¼Œé»˜è®¤æ˜¯ <code>37</code>ï¼Œå³æ•´ä¸ª <code>LRU</code> ä¸­æ–°ç”Ÿä»£ä¸è€ç”Ÿä»£é•¿åº¦æ¯”ä¾‹æ˜¯ <code>63:37</code>ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼šinnodb_old_blocks_time</p>
<p><strong>ä»‹ç»</strong>ï¼šè€ç”Ÿä»£åœç•™æ—¶é—´çª—å£ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼Œé»˜è®¤æ˜¯ <code>1000</code>ï¼Œå³åŒæ—¶æ»¡è¶³â€œè¢«è®¿é—®â€ä¸â€œåœ¨è€ç”Ÿä»£åœç•™æ—¶é—´è¶…è¿‡ <code>1</code> ç§’ä¸¤ä¸ªæ¡ä»¶ï¼Œæ‰ä¼šè¢«æ’å…¥åˆ°æ–°ç”Ÿä»£å¤´éƒ¨ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; select @@innodb_buffer_pool_size/1024/1024;</span><br><span class="line">+<span class="comment">-----------------------------------	--+</span></span><br><span class="line">| @@innodb_buffer_pool_size/1024/1024 |</span><br><span class="line">+<span class="comment">-------------------------------------+</span></span><br><span class="line">|                       1024.00000000 |</span><br><span class="line">+<span class="comment">-------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'innodb_old%'</span>;</span><br><span class="line">+<span class="comment">------------------------+-------+</span></span><br><span class="line">| Variable_name          | Value |</span><br><span class="line">+<span class="comment">------------------------+-------+</span></span><br><span class="line">| innodb_old_blocks_pct  | 37    |</span><br><span class="line">| innodb_old_blocks_time | 1000  |</span><br><span class="line">+<span class="comment">------------------------+-------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<p>InnoDB Buffer Pool ç¼“å­˜å‘½ä¸­ç‡è®¡ç®—ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">è„é¡µç‡è®¡ç®—å…¬å¼ï¼šinnodb_buffer_pool_pages_dirty / innodb_buffer_pool_pages_data * <span class="number">100</span>%</span><br><span class="line">ä½¿ç”¨ç‡è®¡ç®—å…¬å¼ï¼šinnodb_buffer_pool_pages_data / ( innodb_buffer_pool_pages_data + innodb_buffer_pool_pages_free ) * <span class="number">100</span>%</span><br></pre></td></tr></table></figure>

<p>å°†ç¼“å†²æ± åˆ’åˆ†ä¸ºå¤šä¸ªå•ç‹¬çš„å®ä¾‹ï¼Œé€šè¿‡å‡å°‘ä¸åŒçº¿ç¨‹è¯»å–å’Œå†™å…¥ç¼“å­˜çš„äº‰ç”¨æ¥æé«˜å¹¶å‘æ€§ã€‚<code>Buffer Pool</code> å¯ä»¥å­˜æ”¾å¤šä¸ª <code>Instance</code>ï¼Œæ¯ä¸ª <code>Instance</code> ç”±å¤šä¸ª <code>Chunk</code> ç»„æˆã€‚<code>Instance</code> çš„æ•°é‡èŒƒå›´å’Œ <code>Chunk</code> çš„æ€»æ•°é‡èŒƒå›´åˆ†åˆ«ä¸º <code>1-64</code>ï¼Œ<code>1-1000</code>ã€‚</p>
<p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-09-26-093000.png" alt="img"></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤å€¼</span></span><br><span class="line">innodb_buffer_pool_size é»˜è®¤å€¼ä¸º<span class="number">128</span>M</span><br><span class="line">innodb_buffer_pool_instances é»˜è®¤å€¼ä¸º<span class="number">1</span></span><br><span class="line">innodb_buffer_pool_chunk_size é»˜è®¤å€¼ä¸º<span class="number">128</span>M</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—å…¬å¼</span></span><br><span class="line">innodb_buffer_pool_size = innodb_buffer_pool_chunk_size * innodb_buffer_pool_instances * N</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ€»ç¼“å­˜å¤§å°</span></span><br><span class="line">select @@innodb_buffer_pool_size/<span class="number">1024</span>/<span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼“å­˜æ± æ•°é‡</span></span><br><span class="line">select @@innodb_buffer_pool_instances;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯ä¸ªç¼“å­˜æ± çš„å¤§å°</span></span><br><span class="line">select @@innodb_buffer_pool_chunk_size/<span class="number">1024</span>/<span class="number">1024</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tipsï¼šå½“è®¾ç½®çš„ <code>Buffer Pool</code> ä¸ç­‰äº <code>Chunk</code> * <code>Instance</code> å€æ•°æ—¶ï¼ŒMySQL ä¼šè‡ªåŠ¨è°ƒæ•´ <code>Buffer Pool</code> çš„å¤§å° ( å‘ä¸Šå–å€¼åˆ°æœ€è¿‘çš„ä¸€æ¬¡å€æ•° )ã€‚</p>
</blockquote>
<p><strong>å°ç»“</strong>ï¼š</p>
<ul>
<li><p>ç¼“å†²æ± ï¼ˆbuffer poolï¼‰æ˜¯ä¸€ç§å¸¸è§çš„<strong>é™ä½ç£ç›˜è®¿é—®çš„æœºåˆ¶</strong></p>
</li>
<li><p>ç¼“å†²æ± é€šå¸¸ä»¥<strong>é¡µï¼ˆpageï¼‰</strong>ä¸ºå•ä½ç¼“å­˜æ•°æ®</p>
</li>
<li><p>ç¼“å†²æ± çš„å¸¸è§ç®¡ç†ç®—æ³•æ˜¯ <strong>LRU</strong>ï¼Œmemcacheï¼ŒOSï¼ŒInnoDB éƒ½ä½¿ç”¨äº†è¿™ç§ç®—æ³•</p>
</li>
<li><p>InnoDB å¯¹æ™®é€š LRU è¿›è¡Œäº†ä¼˜åŒ–ï¼šï¼ˆ1ï¼‰å°†ç¼“å†²æ± åˆ†ä¸ºè€ç”Ÿä»£å’Œæ–°ç”Ÿä»£ï¼Œå…¥ç¼“å†²æ± çš„é¡µï¼Œä¼˜å…ˆè¿›å…¥è€ç”Ÿä»£ï¼Œé¡µè¢«è®¿é—®æ‰è¿›å…¥æ–°ç”Ÿä»£ï¼Œä»¥è§£å†³é¢„è¯»å¤±æ•ˆçš„é—®é¢˜ï¼›ï¼ˆ2ï¼‰é¡µè¢«è®¿é—®ï¼Œä¸”åœ¨è€ç”Ÿä»£åœç•™æ—¶é—´è¶…è¿‡é…ç½®é˜ˆå€¼çš„ï¼Œæ‰è¿›å…¥æ–°ç”Ÿä»£ï¼Œä»¥è§£å†³æ‰¹é‡æ•°æ®è®¿é—®ï¼Œå¤§é‡çƒ­æ•°æ®æ·˜æ±°çš„é—®é¢˜ã€‚</p>
</li>
</ul>
<h2 id="è®¾ç½®-InnoDB-Buffer-Pool"><a href="#è®¾ç½®-InnoDB-Buffer-Pool" class="headerlink" title="è®¾ç½® InnoDB Buffer Pool"></a>è®¾ç½® InnoDB Buffer Pool</h2><p>InnoDB Buffer Pool ç¼“å­˜äº†è¡¨æ•°æ®å’ŒäºŒçº§ç´¢å¼•åœ¨å†…å­˜ä¸­ï¼Œè®¾ç½® <code>innodb_buffer_pool_size</code> åˆç†æ•°å€¼å¯¹å®ä¾‹æ€§èƒ½å½±å“å¾ˆå¤§ã€‚</p>
<ul>
<li>è®¾ç½®åå°ï¼Œä¼šå¯¼è‡´æ•°æ®åº“å¤§é‡ç›´æ¥å¯¹ç£ç›˜çš„è®¿é—®ï¼ŒæŸ¥è¯¢æ•ˆç‡ä½ã€‚</li>
<li>è®¾ç½®è¿‡å¤§ï¼Œä¼šå¯¼è‡´æ•°æ®åº“è¿›ç¨‹å ç”¨å†…å­˜å¤ªå¤šï¼Œå‘ç”Ÿ <code>OOM</code>ã€‚</li>
</ul>
<p><strong>ç‹¬ç«‹æœåŠ¡å™¨</strong></p>
<p>å¦‚æœä»… <code>MySQL</code> æœåŠ¡ç‹¬äº«æœåŠ¡å™¨èµ„æºï¼Œæ¨èè®¾ç½® <code>innodb_buffer_pool_size</code> ä¸ºæœåŠ¡å™¨æ€»å¯ç”¨å†…å­˜çš„ <code>80%</code>ï¼Œå…·ä½“è®¾ç½®å¤šå°‘ï¼Œéœ€è¦æ ¹æ®æœåŠ¡å™¨å†…å­˜å¤§å°å’Œæ¶ˆè€—è¿›è¡Œè°ƒæ•´ã€‚</p>
<p>è®¾ç½® <code>80%</code> çš„åŸå› ï¼Œæ˜¯å› ä¸ºå…¶å®ƒä¹Ÿéœ€è¦å†…å­˜ï¼š</p>
<ul>
<li>å•æ¬¡æŸ¥è¯¢è‡³å°‘éœ€è¦å‡ Kï¼ˆç”šè‡³å‡ Mï¼‰çš„å†…å­˜</li>
<li>å…¶ä»–å„ç§å†…éƒ¨çš„ <code>MySQL</code> ç»“æ„å’Œç¼“å­˜</li>
<li>æœ‰ä¸€äº› <code>MySQL</code> æ–‡ä»¶æ˜¯åœ¨ <code>OS</code> ç¼“å­˜é‡Œï¼ˆ<code>binary</code> æ—¥å¿—ï¼Œ<code>relay</code> æ—¥å¿—ï¼Œäº‹åŠ¡æ—¥å¿—ç­‰ï¼‰</li>
<li>æ“ä½œç³»ç»Ÿæ¶ˆè€—å†…å­˜</li>
</ul>
<h2 id="ä¿®æ”¹æ–¹æ³•"><a href="#ä¿®æ”¹æ–¹æ³•" class="headerlink" title="ä¿®æ”¹æ–¹æ³•"></a>ä¿®æ”¹æ–¹æ³•</h2><ul>
<li><code>MySQL 5.7</code> ç‰ˆæœ¬ä¹‹åï¼Œå¯ä»¥åœ¨çº¿ä¿®æ”¹</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">set global innodb_buffer_pool_size = size_in_bytes;</span><br><span class="line">select @@innodb_buffer_pool_size/<span class="number">1024</span>/<span class="number">1024</span>;</span><br><span class="line">+-------------------------------------+</span><br><span class="line">| @@innodb_buffer_pool_size/<span class="number">1024</span>/<span class="number">1024</span> |</span><br><span class="line">+-------------------------------------+</span><br><span class="line">|                        <span class="number">128.00000000</span> |</span><br><span class="line">+-------------------------------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">Tips:</span><br><span class="line">â‘  innodb_buffer_pool_size åœ¨çº¿ä¿®æ”¹æ—¶ï¼Œç”¨æˆ·çš„è¯·æ±‚å°†ä¼šé˜»å¡ï¼Œéœ€è¦åœ¨ä¸šåŠ¡ä½å³°æœŸå’Œæ²¡æœ‰å¤§äº‹åŠ¡æ“ä½œæ—¶å€™è¿›è¡Œ</span><br><span class="line">â‘¡ åŒæ—¶è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ my.cnfï¼Œé˜²æ­¢é‡å¯åæ¢å¤åˆ°åŸæ¥çš„å€¼</span><br></pre></td></tr></table></figure>

<ul>
<li><code>MySQL 5.7</code> ç‰ˆæœ¬ä¹‹å‰ï¼Œéœ€è¦ä¿®æ”¹ <code>my.cnf</code> é…ç½®æ–‡ä»¶ï¼Œç„¶åé‡å¯ <code>MySQL</code> æœåŠ¡</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">innodb_buffer_pool_size  = <span class="number">20480</span>M</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>å‚è€ƒ</strong></p>
</blockquote>
<p><a href="http://mysql.taobao.org/monthly/2018/03/06/" target="_blank" rel="noopener"><strong>æ•°æ®åº“å†…æ ¸æœˆæŠ¥</strong></a></p>
<p><a href="https://www.centos.bz/2016/11/innodb_buffer_pool_size-set-the-right-size/" target="_blank" rel="noopener"><strong>INNODB_BUFFER_POOL_SIZEï¼šè®¾ç½®æœ€ä½³å†…å­˜å€¼</strong></a></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>my.cnf</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL Â· å¤‡ä»½å·¥å…· Â· Percona XtraBackup</title>
    <url>/blog/2019/06/18/mysql-xtrabackup/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><a href="https://github.com/percona/percona-xtrabackup" target="_blank" rel="noopener"><strong>Percona XtraBackup</strong></a> æ˜¯ <code>Percona</code> å…¬å¸åŸºäº <code>C++</code> å¼€å‘çš„ä¸€ä¸ªç”¨äº <code>MySQL</code> æ•°æ®åº“ <strong>ç‰©ç†çƒ­å¤‡</strong> çš„ <strong>å…è´¹å¼€æº</strong> çš„å¤‡ä»½å·¥å…·ã€‚</p>
<p><strong>XtraBackup ä¼˜åŠ¿</strong></p>
<ul>
<li>æ”¯æŒ <code>InnoDB</code> çƒ­å¤‡å’Œå¢é‡å¤‡ä»½</li>
<li>æ”¯æŒæµå‹ç¼©ä¼ è¾“åˆ°å…¶å®ƒæœåŠ¡å™¨</li>
<li>å¤‡ä»½é€Ÿåº¦å¿«ï¼Œæ¯”è¾ƒå®¹æ˜“åœ°åˆ›å»ºä¸»ä»åŒæ­¥</li>
<li>å¤‡ä»½æ—¶ä¸ä¼šå¢åŠ æœåŠ¡å™¨è´Ÿè½½</li>
</ul>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>1ã€ä¸‹è½½ <code>Percona-XtraBackup</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ wget http://devops-files.oss-cn-qingdao.aliyuncs.com/percona-xtrabackup-<span class="number">24</span>-<span class="number">2.4</span>.<span class="number">12</span>-<span class="number">1</span>.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p>2ã€<code>rpm</code> æ–¹å¼å®‰è£…</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ rpm -ivh percona-xtrabackup-<span class="number">24</span>-<span class="number">2.4</span>.<span class="number">12</span>-<span class="number">1</span>.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p><strong>æŠ¥é”™ä¿¡æ¯</strong>ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">warning: percona-xtrabackup-<span class="number">24</span>-<span class="number">2.4</span>.<span class="number">12</span>-<span class="number">1</span>.el7.x86_64.rpm: Header V4 DSA/SHA1 Signature, key ID cd2efd2a: NOKEY</span><br><span class="line">error: Failed dependencies:</span><br><span class="line">	libev.so.<span class="number">4</span>()(<span class="number">64</span>bit) is needed by percona-xtrabackup-<span class="number">24</span>-<span class="number">2.4</span>.<span class="number">12</span>-<span class="number">1</span>.el7.x86_64</span><br><span class="line">	perl(DBD::mysql) is needed by percona-xtrabackup-<span class="number">24</span>-<span class="number">2.4</span>.<span class="number">12</span>-<span class="number">1</span>.el7.x86_64</span><br><span class="line">	perl(Digest::MD5) is needed by percona-xtrabackup-<span class="number">24</span>-<span class="number">2.4</span>.<span class="number">12</span>-<span class="number">1</span>.el7.x86_64</span><br></pre></td></tr></table></figure>

<p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ wget http://devops-files.oss-cn-qingdao.aliyuncs.com/libev-<span class="number">4.15</span>-<span class="number">1</span>.el6.x86_64.rpm</span><br><span class="line">$ yum -y install perl-DBD-MySQL</span><br><span class="line">$ yum -y install perl-Digest-MD5</span><br><span class="line">$ rpm -ivh libev-<span class="number">4.15</span>-<span class="number">1</span>.el6.x86_64.rpm</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ rpm -ivh percona-xtrabackup-<span class="number">24</span>-<span class="number">2.4</span>.<span class="number">12</span>-<span class="number">1</span>.el7.x86_64.rpm</span><br><span class="line">Preparing...                           <span class="comment">################################# [100%]</span></span><br><span class="line">Updating / installing...</span><br><span class="line">   <span class="number">1</span>:percona-xtrabackup-<span class="number">24</span>-<span class="number">2.4</span>.<span class="number">12</span>-<span class="number">1</span>.el <span class="comment">################################# [100%]</span></span><br><span class="line"></span><br><span class="line">$ xtrabackup --version </span><br><span class="line">xtrabackup version <span class="number">2.4</span>.<span class="number">12</span> based on MySQL server <span class="number">5.7</span>.<span class="number">19</span> Linux (x86_64)</span><br></pre></td></tr></table></figure>

<p><strong>æŠ¥é”™ä¿¡æ¯</strong>ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[root@hop02 src]<span class="comment"># rpm -ivh percona-xtrabackup-24-2.4.12-1.el7.x86_64.rpm</span></span><br><span class="line">warning: percona-xtrabackup-<span class="number">24</span>-<span class="number">2.4</span>.<span class="number">12</span>-<span class="number">1</span>.el7.x86_64.rpm: Header V4 DSA/SHA1 Signature, key ID cd2efd2a: NOKEY</span><br><span class="line">error: Failed dependencies:</span><br><span class="line">â€‹	libc.so.<span class="number">6</span>(GLIBC_2.<span class="number">14</span>)(<span class="number">64</span>bit) is needed by percona-xtrabackup-<span class="number">24</span>-<span class="number">2.4</span>.<span class="number">12</span>-<span class="number">1</span>.el7.x86_64</span><br><span class="line">â€‹	libstdc++.so.<span class="number">6</span>(GLIBCXX_3.<span class="number">4.15</span>)(<span class="number">64</span>bit) is needed by percona-xtrabackup-<span class="number">24</span>-<span class="number">2.4</span>.<span class="number">12</span>-<span class="number">1</span>.el7.x86_64</span><br></pre></td></tr></table></figure>

<p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p>
<p>æŸ¥çœ‹æ“ä½œç³»ç»Ÿç‰ˆæœ¬ï¼Œ<code>CentOS 6</code> ä¸‹è½½ <code>el6</code> çš„å®‰è£…åŒ…å³å¯ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ cat /etc/redhat-release</span><br><span class="line">CentOS release <span class="number">6.5</span> (Final)</span><br><span class="line"></span><br><span class="line">$ wget http://devops-files.oss-cn-qingdao.aliyuncs.com/percona-xtrabackup-<span class="number">24</span>-<span class="number">2.4</span>.<span class="number">12</span>-<span class="number">1</span>.el6.x86_64.rpm</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tipsï¼šä¸è¦è½»æ˜“åœ¨çœŸå®ç”Ÿäº§ç¯å¢ƒä¸­ç›´æ¥å®‰è£…ï¼Œå› ä¸ºå‡çº§çš„è¿‡ç¨‹ä¸­æ¯”è¾ƒå®¹æ˜“å‡ºç°ç³»ç»Ÿå‡ºé”™ã€‚</p>
</blockquote>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p><strong>å¤‡ä»½åŸç†</strong></p>
<p><code>innobackupex</code> åœ¨åå°çº¿ç¨‹ä¸æ–­è¿½è¸ª <code>InnoDB</code> çš„æ—¥å¿—æ–‡ä»¶ï¼Œç„¶åå¤åˆ¶ <code>InnoDB</code> çš„æ•°æ®æ–‡ä»¶ã€‚æ•°æ®æ–‡ä»¶å¤åˆ¶å®Œæˆä¹‹åï¼Œæ—¥å¿—çš„å¤åˆ¶çº¿ç¨‹ä¹Ÿä¼šç»“æŸã€‚è¿™æ ·å°±å¾—åˆ°äº†ä¸åœ¨åŒä¸€æ—¶é—´ç‚¹çš„æ•°æ®å‰¯æœ¬å’Œå¼€å§‹å¤‡ä»½ä»¥åçš„äº‹åŠ¡æ—¥å¿—ã€‚å®Œæˆä¸Šé¢çš„æ­¥éª¤ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>InnoDB</code> å´©æºƒæ¢å¤ä»£ç æ‰§è¡Œäº‹åŠ¡æ—¥å¿—ï¼ˆ<code>redo log</code>ï¼‰ï¼Œä»¥è¾¾åˆ°æ•°æ®çš„ä¸€è‡´æ€§ã€‚å¤‡ä»½åˆ†ä¸ºä¸¤ä¸ªè¿‡ç¨‹ï¼š</p>
<ul>
<li><strong>backup</strong>ï¼Œå¤‡ä»½é˜¶æ®µï¼Œè¿½è¸ªäº‹åŠ¡æ—¥å¿—å’Œå¤åˆ¶æ•°æ®æ–‡ä»¶ï¼ˆç‰©ç†å¤‡ä»½ï¼‰ã€‚</li>
<li><strong>preparing</strong>ï¼Œé‡æ”¾äº‹åŠ¡æ—¥å¿—ï¼Œä½¿æ‰€æœ‰çš„æ•°æ®å¤„äºåŒä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œè¾¾åˆ°ä¸€è‡´æ€§çŠ¶æ€ã€‚</li>
</ul>
<p><strong>å¤‡ä»½è¿‡ç¨‹</strong></p>
<p><img src="http://ww4.sinaimg.cn/large/006tNc79ly1g5r4dhuzpvj30hi0srwtk.jpg" alt="PXB"></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>ï¼‰å¤åˆ¶å·²æœ‰çš„redo logï¼Œç„¶åç›‘å¬redo logå˜åŒ–å¹¶æŒç»­å¤åˆ¶</span><br><span class="line"><span class="number">2</span>ï¼‰å¤åˆ¶äº‹åŠ¡å¼•æ“æ•°æ®æ–‡ä»¶</span><br><span class="line"><span class="number">3</span>ï¼‰ç­‰åˆ°æ•°æ®æ–‡ä»¶å¤åˆ¶å®Œæˆ</span><br><span class="line"><span class="number">4</span>ï¼‰åŠ é”ï¼šå…¨å±€è¯»é”</span><br><span class="line"><span class="number">5</span>ï¼‰å¤‡ä»½éäº‹åŠ¡å¼•æ“æ•°æ®æ–‡ä»¶åŠå…¶ä»–æ–‡ä»¶</span><br><span class="line"><span class="number">6</span>ï¼‰è·å–binlogç‚¹ä½ä¿¡æ¯ç­‰å…ƒæ•°æ®</span><br><span class="line"><span class="number">7</span>ï¼‰åœæ­¢å¤åˆ¶redo log</span><br><span class="line"><span class="number">8</span>ï¼‰è§£é”ï¼šå…¨å±€è¯»é”</span><br><span class="line"><span class="number">9</span>ï¼‰å¤åˆ¶buffer pool dump</span><br><span class="line"><span class="number">10</span>ï¼‰å¤‡ä»½å®Œæˆ</span><br></pre></td></tr></table></figure>

<p><code>XtraBackup</code> åŸºäº <code>InnoDB</code> çš„ <code>crash recovery</code> æœºåˆ¶ï¼Œåœ¨å¤‡ä»½è¿˜åŸæ—¶åˆ©ç”¨ <code>redo log</code> å¾—åˆ°å®Œæ•´çš„æ•°æ®æ–‡ä»¶ï¼Œå¹¶é€šè¿‡å…¨å±€è¯»é”ï¼Œä¿è¯ <code>InnoDB</code> æ•°æ®ä¸é <code>InnoDB</code> æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæœ€ç»ˆå®Œæˆå¤‡ä»½è¿˜åŸçš„åŠŸèƒ½ã€‚</p>
<p><strong>æ¢å¤è¿‡ç¨‹</strong></p>
<p>apply-log</p>
<ul>
<li>æ¨¡æ‹Ÿ <code>MySQL</code> è¿›è¡Œ <code>recover</code>ï¼Œå°† <code>redo log</code> å›æ”¾åˆ°æ•°æ®æ–‡ä»¶ä¸­ã€‚</li>
<li>ç­‰åˆ° <code>recover</code> å®Œæˆ ã€‚</li>
<li>é‡å»º <code>redo log</code>ï¼Œä¸ºå¯åŠ¨æ•°æ®åº“åšå‡†å¤‡ã€‚</li>
</ul>
<p>copy-back</p>
<ul>
<li>å°†æ•°æ®æ–‡ä»¶å¤åˆ¶å› <code>MySQL</code> æ•°æ®ç›®å½•ã€‚</li>
<li>è¿˜åŸå®Œæˆã€‚</li>
</ul>
<p><code>InnoDB</code> æ•°æ®ä¼šè¢«æ¢å¤è‡³å¤‡ä»½ç»“æŸæ—¶ï¼ˆå…¨å±€è¯»é”æ—¶ï¼‰çš„çŠ¶æ€ï¼Œè€Œé <code>InnoDB</code> æ•°æ®æœ¬èº«å³æ˜¯åœ¨å…¨å±€è¯»é”æ—¶è¢«å¤åˆ¶å‡ºæ¥ï¼Œå®ƒä»¬çš„æ•°æ®ä¸€è‡´ã€‚</p>
<h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><p><strong>å…¨é‡å¤‡ä»½</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#############################################################################</span></span><br><span class="line"><span class="comment"># Full Backup Using XtraBackup For MySQL</span></span><br><span class="line"><span class="comment">#############################################################################</span></span><br><span class="line"></span><br><span class="line">mode=<span class="variable">$1</span></span><br><span class="line">backupdir=<span class="string">'/data/backup'</span>   <span class="comment"># backup dir</span></span><br><span class="line"></span><br><span class="line">backup() &#123;</span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="variable">$backupdir</span> ]; then</span><br><span class="line">    mkdir -p <span class="variable">$backupdir</span> </span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤‡ä»½ä¸»åº“ï¼š</span></span><br><span class="line">innobackupex --defaults-file=/etc/my.cnf --user=root --password=Haier@<span class="number">123</span> --no-timestamp /<span class="variable">$backupdir</span>/full-`date +%Y%m%d%H%M`-bak</span><br><span class="line">find <span class="variable">$backupdir</span> -mtime +<span class="number">2</span> -name <span class="string">'full-*-bak'</span> -exec rm -rf &#123;&#125; \;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¼ è¾“åˆ°ä»åº“ï¼š</span></span><br><span class="line"><span class="comment"># scp -r /data/backup/* root@10.133.7.19:/data/backup</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case <span class="string">"<span class="variable">$mode</span>"</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">'full'</span>) backup ;;</span><br><span class="line">*)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># usage</span></span><br><span class="line">    basename=`basename <span class="string">"<span class="variable">$0</span>"</span>`</span><br><span class="line">    echo <span class="string">"Usage: <span class="variable">$basename</span> &#123;full&#125;"</span></span><br><span class="line">    <span class="keyword">exit</span> <span class="number">1</span></span><br><span class="line">    ;;</span><br><span class="line">esac</span><br><span class="line"><span class="keyword">exit</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯å¤©ä¸­åˆ12:00æ‰§è¡Œå…¨é‡å¤‡ä»½ï¼Œä¿ç•™å‰1å¤©æ•°æ®</span></span><br><span class="line">crontab -e</span><br><span class="line"><span class="number">0</span> <span class="number">12</span> * * <span class="number">0</span> sh /<span class="keyword">data</span>/backup.sh full</span><br></pre></td></tr></table></figure>

<p><strong>å¤‡ä»½æŠ¥é”™</strong>ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="number">190812</span> <span class="number">13</span>:<span class="number">39</span>:<span class="number">54</span> &gt;&gt; log scanned up to (<span class="number">491275222500</span>)</span><br><span class="line">xtrabackup: Generating a list of tablespaces</span><br><span class="line">InnoDB: Allocated tablespace ID <span class="number">2</span> <span class="keyword">for</span> mysql/plugin, old maximum was <span class="number">0</span></span><br><span class="line">InnoDB: Operating system error number <span class="number">24</span> <span class="keyword">in</span> a file operation.</span><br><span class="line">InnoDB: Error number <span class="number">24</span> means <span class="string">'Too many open files'</span></span><br><span class="line">InnoDB: Some operating system error numbers are described at http://dev.mysql.com/doc/refman/<span class="number">5.7</span>/en/operating-system-error-codes.html</span><br><span class="line">InnoDB: File ./cosmo_im_1023/bns_io_sapsourcinglist.ibd: <span class="string">'open'</span> returned OS error <span class="number">124</span>. Cannot <span class="keyword">continue</span> operation</span><br><span class="line">InnoDB: Cannot <span class="keyword">continue</span> operation.</span><br></pre></td></tr></table></figure>

<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>ï¼‰shell&gt; ulimit -n <span class="number">65535</span></span><br><span class="line"><span class="number">2</span>ï¼‰ä¿®æ”¹ my.cnf é…ç½®æ–‡ä»¶çš„å‚æ•°</span><br><span class="line">innodb_open_files = <span class="number">10240</span></span><br><span class="line">open_files_limit = <span class="number">10240</span></span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>ä¼˜å…ˆä½¿ç”¨é«˜ç‰ˆæœ¬ <code>XtraBackup</code> ã€‚</li>
<li>å°½é‡ä¸è¦ä½¿ç”¨ <code>XtraBackup</code> è‡ªå¸¦çš„å¢é‡ å¤‡ä»½ï¼Œå› ä¸ºåæœŸä½¿ç”¨æˆ–è€…æ¢å¤ä¸å¤ªæ–¹ä¾¿ã€‚</li>
<li>å¤‡ä»½ç»“æŸæ—¶ï¼Œè¯·ç«‹å³ <code>apply-log</code> ï¼Œè¿™æ ·èƒ½å¤ŸçŸ¥é“å¤‡ä»½é›†æ˜¯å¦å¯ç”¨ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>XtraBackup</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL Â· ç›‘æ§å‘Šè­¦ Â· PMM</title>
    <url>/blog/2019/06/12/mysql-pmm/</url>
    <content><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><strong>Percona Monitoring and Management (PMM)</strong>ï¼šæ˜¯ä¸€æ¬¾ <code>Percona</code> å‘å¸ƒçš„ç”¨äºç®¡ç†å’Œç›‘æ§ <code>Linux</code>ã€<code>MySQL</code>ã€<code>MongoDB</code>ã€<code>PostgreSQL</code>ã€<code>ProxySQL</code>  çš„å¼€æºå¹³å°ï¼Œé€šè¿‡ <code>PMM</code> å®¢æˆ·ç«¯æ”¶é›†åˆ°çš„ç›‘æ§æ•°æ®ï¼Œé€šè¿‡ç¬¬ä¸‰æ–¹è½¯ä»¶ <code>Grafana</code> å±•ç¤ºå‡ºæ¥ã€‚</p>
<blockquote>
<p><strong>PMMåŠŸèƒ½</strong></p>
</blockquote>
<ul>
<li>æ”¯æŒå¯¹ä¸»æœºçš„ç¡¬ç›˜ã€ç½‘ç»œã€CPUã€å†…å­˜çš„ç›‘æ§ã€‚</li>
<li>æ”¯æŒå¯¹ <code>MyISAM</code>ã€<code>InnoDB</code>ã€<code>TokuDB</code> å’Œ <code>PXC/Glarera</code> çš„ç›‘æ§ã€‚</li>
<li>æ”¯æŒ <code>Query Analytics</code> çš„åŠŸèƒ½ï¼Œå¯ä»¥æ£€è§†æ‰§è¡Œäº†å“ªäº› <code>SQL</code> æŒ‡ä»¤ï¼Œå¹¶å¯¹æ‰§è¡Œæ€§èƒ½è¾ƒå·®çš„ <code>SQL</code> è¿›è¡Œä¼˜åŒ–ã€‚</li>
<li>æ”¯æŒäº† <code>MySQL</code> å¤åˆ¶æ‹“æ‰‘å›¾ç»“æ„æ„é€ ã€‚</li>
</ul>
<blockquote>
<p>å®˜ç½‘ <a href="http://pmmdemo.percona.com" target="_blank" rel="noopener"><strong>Demo</strong></a> </p>
</blockquote>
<h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><p><img src="http://bolg-picture.oss-cn-qingdao.aliyuncs.com/blog/2019-08-28-070801.jpg" alt="PMMæ¶æ„"></p>
<h3 id="PMM-Client"><a href="#PMM-Client" class="headerlink" title="PMM Client"></a>PMM Client</h3><ul>
<li><p><strong>pmm-mysql-queries-0</strong>ï¼šæ˜¯ä¸€ä¸ªç®¡ç† <code>qan</code> ä»£ç†çš„æœåŠ¡ï¼Œå®ƒä» <code>MySQL</code> æ”¶é›†æ€§èƒ½æ•°æ®ï¼Œç„¶åé€šè¿‡ <code>QAN API</code> å‘é€åˆ° <code>PMM Server</code>ã€‚</p>
</li>
<li><p><strong>pmm-mongodb-queries-0</strong>ï¼šæ˜¯ä¸€ä¸ªç®¡ç† <code>qan</code> ä»£ç†çš„æœåŠ¡ï¼Œå®ƒä» <code>mongodb</code> æ”¶é›†æ€§èƒ½æ•°æ®ï¼Œç„¶åé€šè¿‡ <code>QAN API</code> å‘é€åˆ° <code>PMM Server</code>ã€‚</p>
</li>
<li><p><a href="https://github.com/percona/pmm-admin" target="_blank" rel="noopener"><strong>pmm-admin</strong></a>ï¼šç”¨äºç®¡ç† <code>PMM Client</code> çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä¾‹å¦‚ï¼šæ·»åŠ ã€åˆ é™¤è¦ç›‘è§†çš„æ•°æ®åº“å®ä¾‹ã€‚</p>
</li>
<li><p><a href="https://github.com/prometheus/node_exporter" target="_blank" rel="noopener"><strong>node_exporter</strong></a>ï¼šé‡‡é›†ä¸»æœºç›‘æ§æŒ‡æ ‡ã€‚</p>
</li>
<li><p><a href="https://github.com/prometheus/mysqld_exporter" target="_blank" rel="noopener"><strong>mysqld_exporter</strong></a>ï¼šé‡‡é›† <code>MySQL</code> ç›‘æ§æŒ‡æ ‡ã€‚</p>
</li>
<li><p><a href="https://github.com/percona/mongodb_exporter" target="_blank" rel="noopener"><strong>mongodb_exporter</strong></a>ï¼šé‡‡é›† <code>MongoDB</code> ç›‘æ§æŒ‡æ ‡ã€‚</p>
</li>
<li><p><a href="https://github.com/percona/proxysql_exporter" target="_blank" rel="noopener"><strong>proxysql_exporter</strong></a>ï¼šé‡‡é›† <code>ProxySQL</code> ç›‘æ§æŒ‡æ ‡ã€‚</p>
</li>
</ul>
<h3 id="PMM-Server"><a href="#PMM-Server" class="headerlink" title="PMM Server"></a>PMM Server</h3><p><strong>Query Analyticsï¼ˆQANï¼‰</strong>ï¼šä¸»è¦ç”¨æ¥æœé›†æŒ‡ä»¤å¹¶ä½œæ€§èƒ½åˆ†æã€‚</p>
<ul>
<li><strong>QAN API</strong>ï¼šä½œä¸ºåç«¯å‚¨å­˜å’Œè¯»å– <code>Query</code> èµ„æ–™ç”¨ã€‚</li>
<li><strong>QAN APP</strong>ï¼šæä¾›å›¾å½¢åŒ–åˆ†æç•Œé¢ã€‚</li>
</ul>
<p><strong>Metrics Monitorï¼ˆMMï¼‰</strong>ï¼šä¸»è¦æä¾› <code>MySQL</code> å’Œ <code>MongoDB</code> å†å²ç›‘æ§ä¿¡æ¯ã€‚ç»„ä»¶è¯´æ˜å¦‚ä¸‹ï¼š</p>
<ul>
<li><a href="https://prometheus.io/" target="_blank" rel="noopener"><strong>Prometheus</strong></a>ï¼šä¸€ä¸ªå¼€æºçš„æœåŠ¡ç›‘æ§ç³»ç»Ÿå’Œæ—¶é—´åºåˆ—æ•°æ®åº“ï¼Œå®ƒè¿æ¥åˆ° <code>PMM Client</code> ä¸Šçš„ <code>exporter</code> èšé›†çš„ç›‘æ§æ•°æ®ã€‚</li>
<li><a href="https://www.consul.io/" target="_blank" rel="noopener"><strong>Consul</strong></a>ï¼šæä¾› <code>API</code> è®© <code>PMM Client</code> å¯ä»¥è¿œç«¯æ›¿ <code>Prometheus</code> æ–°å¢ã€ç§»é™¤ <code>Hosts</code>ï¼ŒåŒæ—¶å®ƒä¹Ÿå‚¨å­˜äº†ç›‘æ§çš„<code>metadata</code>ã€‚</li>
<li><a href="http://grafana.org/" target="_blank" rel="noopener"><strong>Grafana</strong></a>ï¼š è¿™æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹ <code>Dashboard</code> å’Œå›¾å½¢æ„å»ºå™¨ï¼Œç”¨äºå¯è§†åŒ– <code>Prometheus</code> ä¸­èšåˆçš„æ•°æ®ï¼Œä»¥ <code>Web</code> æ–¹å¼å‘ˆç°ã€‚</li>
<li><a href="https://github.com/percona/grafana-dashboards" target="_blank" rel="noopener"><strong>Percona Dashboards</strong></a>ï¼šæ˜¯ç”± <code>Percona</code> å¼€å‘çš„ä¸€ç»„ç”¨äº <code>Grafana</code> çš„ä»ªè¡¨æ¿ã€‚ä¸Šè¿°çš„ <code>Web</code> é¡µé¢éƒ½èƒ½ä» <code>PMM Landing Page</code>ç›´æ¥è¿æ¥ã€‚</li>
</ul>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="PMM-Server-1"><a href="#PMM-Server-1" class="headerlink" title="PMM Server"></a>PMM Server</h3><p>ï¼ˆ1ï¼‰<strong>å®‰è£… docker</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ yum -y install docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½ docker</span></span><br><span class="line">$ yum remove docker</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰<strong>è¿è¡Œ docker</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ systemctl start docker</span><br><span class="line">$ systemctl enable docker</span><br><span class="line">$ systemctl stop docker</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ3ï¼‰<strong>ä¸‹è½½å®¹å™¨é•œåƒ</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ docker pull percona/pmm-server:latest</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ4ï¼‰<strong>åˆ›å»ºæ•°æ®å·å®¹å™¨</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ docker create \</span><br><span class="line">-v /opt/prometheus/<span class="keyword">data</span> \</span><br><span class="line">-v /opt/consul-data \</span><br><span class="line">-v /var/lib/mysql \</span><br><span class="line">-v /var/lib/grafana \</span><br><span class="line">--name pmm-data \</span><br><span class="line">percona/pmm-server:latest /bin/true</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ5ï¼‰<strong>è¿è¡Œ PMM Server</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ docker run -d \</span><br><span class="line">-p <span class="number">8090</span>:<span class="number">80</span> \</span><br><span class="line">--volumes-from pmm-data \</span><br><span class="line">--name pmm-server \</span><br><span class="line">--restart always \</span><br><span class="line">percona/pmm-server:latest</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ6ï¼‰<strong>éªŒè¯</strong>ï¼Œé€šè¿‡ <a href="http://pmm.ilearning.fun" target="_blank" rel="noopener"><strong>ç™»å½•</strong></a> æŸ¥çœ‹æ˜¯å¦æ­£å¸¸æ˜¾ç¤ºï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ curl http://<span class="number">10.133</span>.<span class="number">0.53</span>/ping</span><br><span class="line">&#123;<span class="string">'version'</span>: <span class="string">'1.8.0'</span>&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–å‘½ä»¤ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ docker exec -it <span class="string">'xx'</span> /bin/bash</span><br><span class="line">$ docker ps -a</span><br><span class="line">$ docker stop pmm-server &amp;&amp; docker rm pmm-server (åœæ­¢ pmm-server)</span><br></pre></td></tr></table></figure>

<h3 id="PMM-Client-1"><a href="#PMM-Client-1" class="headerlink" title="PMM Client"></a>PMM Client</h3><p>1ï¼‰ç¡®ä¿ <code>PMM Server</code> ä¸»æœºå¯è®¿é—®</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ ping <span class="number">10.133</span>.<span class="number">0.52</span></span><br></pre></td></tr></table></figure>

<p>2ï¼‰å®‰è£… <code>Client</code> åŒ…</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ yum install -y https://repo.percona.com/yum/percona-release-latest.noarch.rpm</span><br><span class="line">$ yum install -y pmm-client</span><br><span class="line"></span><br><span class="line">$ scp pmm-client-<span class="number">1.17</span>.<span class="number">1</span>-<span class="number">1</span>.el7.x86_64.rpm haieradmin@<span class="number">10.133</span>.<span class="number">0.52</span>:/tmp</span><br><span class="line">$ wget http://<span class="number">10.190</span>.<span class="number">179.84</span>:<span class="number">8085</span>/pmm-client-<span class="number">1.17</span>.<span class="number">1</span>-<span class="number">1</span>.el7.x86_64.rpm</span><br><span class="line">$ rpm -ivh pmm-client-<span class="number">1.17</span>.<span class="number">1</span>-<span class="number">1</span>.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½ pmm-client</span></span><br><span class="line">$ yum remove pmm-client</span><br></pre></td></tr></table></figure>

<p>3ï¼‰è¿æ¥ <code>PMM Client</code> åˆ° <code>PMM Server</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ pmm-admin config --server <span class="number">10.133</span>.<span class="number">0.52</span></span><br><span class="line">OK, PMM server is alive.</span><br><span class="line">PMM Server      | <span class="number">10.133</span>.<span class="number">0.52</span> </span><br><span class="line">Client Name     | cmp15</span><br><span class="line">Client Address  | <span class="number">10.138</span>.<span class="number">228.236</span></span><br><span class="line"></span><br><span class="line">$ pmm-admin config --server <span class="number">10.133</span>.<span class="number">0.52</span>:<span class="number">8080</span> ï¼ˆé€‚ç”¨äºé<span class="number">80</span>ç«¯å£ï¼‰</span><br></pre></td></tr></table></figure>

<h2 id="ç›‘æ§"><a href="#ç›‘æ§" class="headerlink" title="ç›‘æ§"></a>ç›‘æ§</h2><h3 id="ä¸»æœº"><a href="#ä¸»æœº" class="headerlink" title="ä¸»æœº"></a>ä¸»æœº</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ ç›‘æ§</span></span><br><span class="line">$ pmm-admin add linux:metrics</span><br><span class="line"></span><br><span class="line"><span class="comment"># å–æ¶ˆç›‘æ§</span></span><br><span class="line">$ pmm-admin remove linux:metrics</span><br></pre></td></tr></table></figure>

<h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ ç›‘æ§</span></span><br><span class="line">$ pmm-admin add mysql --socket /<span class="keyword">data</span>/mysql3306/mysql.sock --user root --password Haier@<span class="number">123</span></span><br><span class="line">$ pmm-admin list</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ wget http://<span class="number">10.190</span>.<span class="number">179.84</span>:<span class="number">8085</span>/pmm-client-<span class="number">1.17</span>.<span class="number">1</span>-<span class="number">1</span>.el7.x86_64.rpm</span><br><span class="line">$ rpm -ivh pmm-client-<span class="number">1.17</span>.<span class="number">1</span>-<span class="number">1</span>.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">$ pmm-admin config --server <span class="number">10.133</span>.<span class="number">0.52</span>:<span class="number">8080</span></span><br><span class="line">OK, PMM server is alive.</span><br><span class="line">PMM Server      | <span class="number">10.133</span>.<span class="number">0.52</span>:<span class="number">8080</span> </span><br><span class="line">Client Name     | GPCMS-DB-P</span><br><span class="line">Client Address  | <span class="number">10.133</span>.<span class="number">7.19</span></span><br><span class="line"></span><br><span class="line">$ pmm-admin add linux:metrics</span><br><span class="line">OK, now monitoring this system.</span><br><span class="line"></span><br><span class="line">$ pmm-admin add mysql --user hdm --password Hdm@<span class="number">123</span>!</span><br><span class="line">[linux:metrics] OK, already monitoring this system.</span><br><span class="line">[mysql:metrics] OK, now monitoring MySQL metrics using DSN hdm:***@unix(/<span class="keyword">data</span>/mysql3306/mysql.sock)</span><br><span class="line">[mysql:queries] OK, now monitoring MySQL queries from slowlog using DSN hdm:***@unix(/<span class="keyword">data</span>/mysql3306/mysql.sock)</span><br><span class="line"></span><br><span class="line">$ pmm-admin check-network</span><br><span class="line">PMM Network Status</span><br><span class="line"></span><br><span class="line">Server Address | <span class="number">10.133</span>.<span class="number">0.52</span>:<span class="number">8080</span></span><br><span class="line">Client Address | <span class="number">10.133</span>.<span class="number">7.19</span> </span><br><span class="line"></span><br><span class="line">* System Time</span><br><span class="line">NTP Server (<span class="number">0</span>.pool.ntp.org)         | <span class="number">2019</span>-<span class="number">07</span>-<span class="number">26</span> <span class="number">10</span>:<span class="number">18</span>:<span class="number">20</span> +<span class="number">0000</span> UTC</span><br><span class="line">PMM Server                          | <span class="number">2019</span>-<span class="number">07</span>-<span class="number">26</span> <span class="number">10</span>:<span class="number">18</span>:<span class="number">20</span> +<span class="number">0000</span> GMT</span><br><span class="line">PMM Client                          | <span class="number">2019</span>-<span class="number">07</span>-<span class="number">26</span> <span class="number">18</span>:<span class="number">18</span>:<span class="number">20</span> +<span class="number">0800</span> CST</span><br><span class="line">PMM Server Time Drift               | OK</span><br><span class="line">PMM Client Time Drift               | OK</span><br><span class="line">PMM Client to PMM Server Time Drift | OK</span><br><span class="line"></span><br><span class="line">* Connection: Client --&gt; Server</span><br><span class="line">-------------------- -------      </span><br><span class="line">SERVER SERVICE       STATUS       </span><br><span class="line">-------------------- -------      </span><br><span class="line">Consul API           OK</span><br><span class="line">Prometheus API       OK</span><br><span class="line">Query Analytics API  OK</span><br><span class="line"></span><br><span class="line">Connection duration | <span class="number">702.217</span>Âµs</span><br><span class="line">Request duration    | <span class="number">4.66389</span>ms</span><br><span class="line">Full round trip     | <span class="number">5.366107</span>ms</span><br><span class="line"></span><br><span class="line">* Connection: Client &lt;-- Server</span><br><span class="line">-------------- ----------- ------------------ ------- ---------- ---------</span><br><span class="line">SERVICE TYPE   NAME        REMOTE ENDPOINT    STATUS  HTTPS/TLS  PASSWORD </span><br><span class="line">-------------- ----------- ------------------ ------- ---------- ---------</span><br><span class="line">linux:metrics  GPCMS-DB-P  <span class="number">10.133</span>.<span class="number">7.19</span>:<span class="number">42000</span>  OK      YES        -        </span><br><span class="line">mysql:metrics  GPCMS-DB-P  <span class="number">10.133</span>.<span class="number">7.19</span>:<span class="number">42002</span>  OK      YES        -</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯é˜²ç«å¢™ç«¯å£</span></span><br><span class="line">firewall-cmd --zone=public --add-port=<span class="number">42000</span>/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=<span class="number">42002</span>/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ›´æ”¹å­˜å‚¨ç±»å‹ä¸ºMySQL</span></span><br><span class="line">docker exec -i -t pmm-server /bin/bash</span><br><span class="line">vi /etc/grafana/grafana.ini</span><br><span class="line"></span><br><span class="line">æŸ¥/sqliteæ”¹ä¸ºMYSQLå­˜å‚¨</span><br><span class="line">type=mysql</span><br><span class="line">host=<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">3306</span></span><br><span class="line">name=grafana</span><br><span class="line">user=root</span><br><span class="line">password =</span><br></pre></td></tr></table></figure>

<p>åœ¨å®¹å™¨è¿›å…¥ mysql å®¢æˆ·ç«¯,åˆ›å»ºæ•°æ®åº“ grafana</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ create database grafana;</span><br><span class="line">$ docker restart pmm-server</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ pmm-admin --help</span><br><span class="line">Usage:</span><br><span class="line">pmm-admin [flags]</span><br><span class="line">pmm-admin [command]</span><br><span class="line">Available Commands:</span><br><span class="line">config         Configure PMM Client. <span class="comment"># é…ç½®PMMå®¢æˆ·ç«¯</span></span><br><span class="line">add            Add service to monitoring. <span class="comment"># å¢åŠ ç›‘æ§</span></span><br><span class="line">remove         Remove service from monitoring. <span class="comment"># åˆ é™¤ç›‘æ§æœåŠ¡</span></span><br><span class="line">list           List monitoring services <span class="keyword">for</span> this system. <span class="comment"># åˆ—å‡ºç›‘æ§æœåŠ¡</span></span><br><span class="line">info           Display PMM Client information (works offline). <span class="comment"># æ‰“å°PMMå®¢æˆ·ç«¯ä¿¡æ¯</span></span><br><span class="line">check-network  Check network connectivity between client and server. <span class="comment"># æ£€æŸ¥ç½‘ç»œ</span></span><br><span class="line">ping           Check <span class="keyword">if</span> PMM server is alive. </span><br><span class="line">start          Start monitoring service. <span class="comment"># å¼€å¯æœåŠ¡</span></span><br><span class="line">stop           Stop monitoring service. <span class="comment"># åœæ­¢æœåŠ¡</span></span><br><span class="line">restart        Restart monitoring service. <span class="comment"># é‡å¯æœåŠ¡</span></span><br><span class="line">show-passwords Show PMM Client password information (works offline). <span class="comment"># æ˜¾ç¤ºå®¢æˆ·ç«¯å¯†ç </span></span><br><span class="line">purge          Purge metrics <span class="keyword">data</span> on PMM server. <span class="comment"># åˆ é™¤PMM serverç«¯ç›‘æ§ä¿¡æ¯</span></span><br><span class="line">repair         Repair installation. <span class="comment"># é‡æ–°å®‰è£…</span></span><br><span class="line">uninstall      Removes all monitoring services with the best effort. <span class="comment"># åˆ é™¤æ‰€æœ‰æœåŠ¡</span></span><br><span class="line">help           Help about any command</span><br><span class="line">Flags:</span><br><span class="line">-c, --config-file string   PMM config file (default <span class="string">"/usr/local/percona/pmm-client/pmm.yml"</span>)</span><br><span class="line">-h, --help                 help <span class="keyword">for</span> pmm-admin</span><br><span class="line">    --verbose              verbose output</span><br><span class="line">-v, --version              show version</span><br><span class="line">Use <span class="string">"pmm-admin [command] --help"</span> <span class="keyword">for</span> more information about a command.</span><br></pre></td></tr></table></figure>

<h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><p><strong>å®‰è£… pmm-client</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ scp /usr/local/src/pmm-client-<span class="number">1.17</span>.<span class="number">1</span>-<span class="number">1</span>.el7.x86_64.rpm haieradmin@x.x.x.x:/tmp</span><br><span class="line">$ rpm -ivh pmm-client-<span class="number">1.17</span>.<span class="number">1</span>-<span class="number">1</span>.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p><strong>ç›‘æ§ä¸»æœº</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å°†client_nameä¿®æ”¹ä¸ºæœåŠ¡å™¨ip</span></span><br><span class="line">$ vi /usr/local/percona/pmm-client/pmm.yml</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯pmm-client</span></span><br><span class="line">$ pmm-admin restart --all</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ ç›‘æ§</span></span><br><span class="line">$ pmm-admin add linux:metrics</span><br></pre></td></tr></table></figure>

<p><strong>ç›‘æ§MySQL</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ pmm-admin add mysql --user hdm --password Hdm@<span class="number">123</span>! x.x.x.x:port</span><br><span class="line">$ pmm-admin list</span><br></pre></td></tr></table></figure>

<p><strong>é…ç½®å‘Šè­¦</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥docker</span></span><br><span class="line">$ docker exec -it pmm-server /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–ç¼‰ grafana.ini</span></span><br><span class="line">vim /etc/grafana/grafana.ini</span><br><span class="line"></span><br><span class="line">[smtp]</span><br><span class="line">enabled = true</span><br><span class="line">host = [smtp.healthmall.cn](http://smtp.healthmall.cn/):<span class="number">25</span></span><br><span class="line">user = liuqian@healthmall.cn</span><br><span class="line">password = <span class="number">123456</span></span><br><span class="line">from_address = liuqian@healthmall.cn</span><br><span class="line">from_name = Grafana</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯pmm-serverå®¹å™¨</span></span><br><span class="line">$ docker restart pmm-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># é’‰é’‰æŠ¥è­¦é…ç½®</span></span><br><span class="line">http://docs.grafana.org/alerting/notifications/</span><br></pre></td></tr></table></figure>

<p><strong>å‡çº§</strong></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ docker pull percona/pmm-server:latest</span><br><span class="line">$ docker stop pmm-server &amp;&amp; docker rm pmm-server</span><br><span class="line">$ docker run -d -p <span class="number">80</span>:<span class="number">80</span> -p <span class="number">9090</span>:<span class="number">9090</span> --volumes-from pmm-data --name pmm-server -e SERVER_USER=pmm -e SERVER_PASSWORD=ngiISI0Q4g9gfqWz89folKJSi --restart always --init percona/pmm-server:latest</span><br></pre></td></tr></table></figure>

<h2 id="FA-amp-Q"><a href="#FA-amp-Q" class="headerlink" title="FA&amp;Q"></a>FA&amp;Q</h2><p>ï¼ˆ1ï¼‰<code>docker</code> é»˜è®¤ç›®å½• <code>/var/lib/docker</code> ä¿®æ”¹ä¸º <code>/data/dockerfile</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ docker info</span><br><span class="line">Kernel Version: <span class="number">3.10</span>.<span class="number">0</span>-<span class="number">693</span>.el7.x86_64</span><br><span class="line">Operating System: CentOS Linux <span class="number">7</span> (Core)</span><br><span class="line">OSType: linux</span><br><span class="line">Architecture: x86_64</span><br><span class="line">Number of Docker Hooks: <span class="number">3</span></span><br><span class="line">CPUs: <span class="number">6</span></span><br><span class="line">Total Memory: <span class="number">15.66</span> GiB</span><br><span class="line">Name: console</span><br><span class="line">ID: <span class="number">7</span>MYD:NQPC:<span class="number">4</span>TNL:IT3W:<span class="number">6</span>KZS:TY6L:CORW:L432:UE3M:<span class="number">4</span>LBJ:OFUU:HSMB</span><br><span class="line">Docker Root Dir: /var/lib/docker</span><br><span class="line">Debug Mode (client): false</span><br><span class="line">Debug Mode (server): false</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœæ­¢dockeræœåŠ¡</span></span><br><span class="line">$ systemctl stop docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†dockeræ–‡ä»¶è¿ç§»åˆ°æŒ‡å®šç›®å½•</span></span><br><span class="line">$ mkdir /<span class="keyword">data</span>/dockerfile</span><br><span class="line">$ mv /var/lib/docker/* /<span class="keyword">data</span>/dockerfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤åŸç›®å½•</span></span><br><span class="line">$ rm -rf /var/lib/docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè½¯è¿æ¥</span></span><br><span class="line">$ ln -s/<span class="keyword">data</span>/dockerfile/ /var/lib/docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨dockeræœåŠ¡</span></span><br><span class="line">$ systemctl start docker</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ docker info</span><br><span class="line">Kernel Version: <span class="number">3.10</span>.<span class="number">0</span>-<span class="number">693</span>.el7.x86_64</span><br><span class="line">Operating System: CentOS Linux <span class="number">7</span> (Core)</span><br><span class="line">OSType: linux</span><br><span class="line">Architecture: x86_64</span><br><span class="line">Number of Docker Hooks: <span class="number">3</span></span><br><span class="line">CPUs: <span class="number">6</span></span><br><span class="line">Total Memory: <span class="number">15.66</span> GiB</span><br><span class="line">Name: console</span><br><span class="line">ID: <span class="number">7</span>MYD:NQPC:<span class="number">4</span>TNL:IT3W:<span class="number">6</span>KZS:TY6L:CORW:L432:UE3M:<span class="number">4</span>LBJ:OFUU:HSMB</span><br><span class="line">Docker Root Dir: /<span class="keyword">data</span>/dockerfile</span><br><span class="line">Debug Mode (client): false</span><br><span class="line">Debug Mode (server): false</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰<code>PMM</code> ä¿®æ”¹ä¸»æœºåä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œä¿®æ”¹ä¸º <code>ip</code>ã€<code>port</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">[root@ptdsmapp03 pmm-client]<span class="comment"># pmm-admin check-network</span></span><br><span class="line">PMM Network Status</span><br><span class="line"></span><br><span class="line">Server Address | <span class="number">10.133</span>.<span class="number">0.53</span>:<span class="number">8090</span></span><br><span class="line">Client Address | <span class="number">10.133</span>.<span class="number">0.51</span> </span><br><span class="line"></span><br><span class="line">*** System Time**</span><br><span class="line">NTP Server (<span class="number">0</span>.pool.ntp.org)         | <span class="number">2019</span>-<span class="number">09</span>-<span class="number">02</span> <span class="number">08</span>:<span class="number">59</span>:<span class="number">28</span> +<span class="number">0000</span> UTC</span><br><span class="line">PMM Server                          | <span class="number">2019</span>-<span class="number">09</span>-<span class="number">02</span> <span class="number">08</span>:<span class="number">59</span>:<span class="number">28</span> +<span class="number">0000</span> GMT</span><br><span class="line">PMM Client                          | <span class="number">2019</span>-<span class="number">09</span>-<span class="number">02</span> <span class="number">16</span>:<span class="number">59</span>:<span class="number">28</span> +<span class="number">0800</span> CST</span><br><span class="line">PMM Server Time Drift               | **OK**</span><br><span class="line">PMM Client Time Drift               | **OK**</span><br><span class="line">PMM Client to PMM Server Time Drift | **OK**</span><br><span class="line"></span><br><span class="line">*** Connection: Client --&gt; Server**</span><br><span class="line">-------------------- -------      </span><br><span class="line">SERVER SERVICE       STATUS       </span><br><span class="line">-------------------- -------      </span><br><span class="line">Consul API           **OK**</span><br><span class="line">Prometheus API       **OK**</span><br><span class="line">Query Analytics API  **OK**</span><br><span class="line"></span><br><span class="line">Connection duration | <span class="number">433.939</span>Âµs</span><br><span class="line">Request duration    | <span class="number">3.335106</span>ms</span><br><span class="line">Full round trip     | <span class="number">3.769045</span>ms</span><br><span class="line"></span><br><span class="line">*** Connection: Client &lt;-- Server**</span><br><span class="line">-------------- ----------------- ------------------ ------- ---------- ---------</span><br><span class="line">SERVICE TYPE   NAME              REMOTE ENDPOINT    STATUS  HTTPS/TLS  PASSWORD </span><br><span class="line">-------------- ----------------- ------------------ ------- ---------- ---------</span><br><span class="line">linux:metrics  <span class="number">10.133</span>.<span class="number">0.51</span>       <span class="number">10.133</span>.<span class="number">0.51</span>:<span class="number">42000</span>  **OK**      **YES**        -        </span><br><span class="line">mysql:metrics  <span class="number">10.133</span>.<span class="number">0.51</span>:<span class="number">3306</span>  <span class="number">10.133</span>.<span class="number">0.51</span>:<span class="number">42002</span>  **OK**      **YES**        -</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>Prometheus</tag>
        <tag>Grafana</tag>
        <tag>Consul</tag>
      </tags>
  </entry>
  <entry>
    <title>Github Page + Hexo + Next æ­å»ºä¸ªäººåšå®¢</title>
    <url>/blog/2019/04/29/new-blog/</url>
    <content><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p><img src="http://ww4.sinaimg.cn/large/006tNc79ly1g5os777yb2j30m80dcaba.jpg" alt></p>
<blockquote>
<p><a href="https://pages.github.com/" target="_blank" rel="noopener">Github Page</a>ï¼šæ˜¯ <a href="https://github.com/" target="_blank" rel="noopener">Github</a> æä¾›çš„ä¸€ç§å…è´¹çš„é™æ€ç½‘é¡µæ‰˜ç®¡æœåŠ¡ï¼Œå¯ä»¥ç”¨æ¥æ‰˜ç®¡åšå®¢ã€é¡¹ç›®å®˜ç½‘ç­‰é™æ€ç½‘é¡µã€‚æ”¯æŒ <a href="http://www.jekyllrb.com/" target="_blank" rel="noopener">Jekyll</a>ã€<a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a>ã€<a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">Hexo</a> ç­‰ç¼–è¯‘é™æ€èµ„æºã€‚</p>
</blockquote>
<blockquote>
<p><a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">Hexo</a>ï¼šæ˜¯åŸºäº <a href="http://nodejs.cn/" target="_blank" rel="noopener">Node.js</a> é©±åŠ¨çš„ä¸€æ¬¾å¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ï¼Œæœ‰å¤šä¸ª <a href="https://hexo.io/themes/" target="_blank" rel="noopener">ä¸»é¢˜</a> å¯é€‰ã€‚é€šè¿‡ <a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">Hexo</a> ä½ å¯ä»¥è½»æ¾åœ°ä½¿ç”¨ <a href="http://markdownpad.com/" target="_blank" rel="noopener">Markdown</a> ç¼–å†™æ–‡ç« ï¼Œé™¤äº† <a href="http://markdownpad.com/" target="_blank" rel="noopener">Markdown</a> æœ¬èº«çš„è¯­æ³•ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">Hexo</a> æä¾›çš„ <a href="https://hexo.io/zh-cn/docs/tag-plugins.html" target="_blank" rel="noopener">æ ‡ç­¾æ’ä»¶</a> æ¥å¿«é€Ÿçš„æ’å…¥ç‰¹å®šå½¢å¼çš„å†…å®¹ã€‚</p>
</blockquote>
<blockquote>
<p><a href="http://theme-next.iissnan.com" target="_blank" rel="noopener">Next</a>ï¼šæ˜¯ä¸€æ¬¾é«˜è´¨é‡çš„ <a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">Hexo</a> ä¸»é¢˜ã€‚</p>
</blockquote>
<h2 id="æ­å»ºæµç¨‹"><a href="#æ­å»ºæµç¨‹" class="headerlink" title="æ­å»ºæµç¨‹"></a>æ­å»ºæµç¨‹</h2><h3 id="å®‰è£…-Node-js"><a href="#å®‰è£…-Node-js" class="headerlink" title="å®‰è£… Node.js"></a>å®‰è£… Node.js</h3><p><a href="https://nodejs.org/en/" target="_blank" rel="noopener">ä¸‹è½½åœ°å€</a></p>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨å®‰è£…æ—¶ï¼Œå‹¾é€‰ <strong><u>Add to PATH</u></strong> é€‰é¡¹</p>
</blockquote>
<h3 id="å®‰è£…-Git"><a href="#å®‰è£…-Git" class="headerlink" title="å®‰è£… Git"></a>å®‰è£… Git</h3><p><a href="https://git-scm.com" target="_blank" rel="noopener">ä¸‹è½½åœ°å€</a></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ git version</span><br><span class="line">$ node -v</span><br><span class="line">$ npm -v</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…-Hexo"><a href="#å®‰è£…-Hexo" class="headerlink" title="å®‰è£… Hexo"></a>å®‰è£… Hexo</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ npm install -g hexo-cli</span><br><span class="line">$ hexo init blog</span><br><span class="line">$ cd blog</span><br><span class="line">$ npm install</span><br></pre></td></tr></table></figure>

<p>æ–‡ä»¶å¤¹ç›®å½•è¯´æ˜ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ _config.yml            <span class="comment"># ç«™ç‚¹é…ç½®æ–‡ä»¶ </span></span><br><span class="line">â”œâ”€â”€ package.json</span><br><span class="line">â”œâ”€â”€ scaffolds              <span class="comment"># æ¨¡ç‰ˆæ–‡ä»¶å¤¹</span></span><br><span class="line">â”œâ”€â”€ source                 <span class="comment"># èµ„æºæ–‡ä»¶å¤¹</span></span><br><span class="line">|   â”œâ”€â”€ _drafts            <span class="comment"># è‰ç¨¿æ–‡ä»¶</span></span><br><span class="line">|   â””â”€â”€ _posts             <span class="comment"># *.mdæ–‡ä»¶ </span></span><br><span class="line">â””â”€â”€ themes                 <span class="comment"># ä¸»é¢˜æ–‡ä»¶å¤¹</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸Šé¢çš„å‘½ä»¤éƒ½æ²¡æŠ¥é”™çš„è¯ï¼Œè¿è¡Œ <code>hexo s</code> å‘½ä»¤ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ <code>http://localhost:4000</code> å¯ä»¥çœ‹åˆ° <code>Hello World</code>ï¼Œè¯´æ˜å®‰è£…æˆåŠŸäº†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo s</span><br></pre></td></tr></table></figure>

<p><code>hexo</code> å‘½ä»¤è¯´æ˜ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ hexo generate            <span class="comment"># ç”Ÿæˆé™æ€æ–‡ä»¶è‡³publicç›®å½•</span></span><br><span class="line">$ hexo deploy              <span class="comment"># å°†.deployç›®å½•éƒ¨ç½²åˆ°github</span></span><br><span class="line">$ hexo new <span class="string">"postName"</span>      <span class="comment"># æ–°å»ºæ–‡ç« </span></span><br><span class="line">$ hexo new page <span class="string">"pageName"</span> <span class="comment"># æ–°å»ºé¡µé¢</span></span><br><span class="line">$ hexo server              <span class="comment"># å¯åŠ¨æœåŠ¡</span></span><br><span class="line">$ hexo clean               <span class="comment"># æ¸…é™¤éƒ¨ç½²ç·©å­˜</span></span><br><span class="line">$ hexo g -d                <span class="comment"># ç”ŸæˆåŠ éƒ¨ç½²</span></span><br><span class="line">$ hexo g -s                <span class="comment"># ç”ŸæˆåŠ é¢„è§ˆ</span></span><br></pre></td></tr></table></figure>

<h3 id="è®¾ç½®ä¸»é¢˜-Next"><a href="#è®¾ç½®ä¸»é¢˜-Next" class="headerlink" title="è®¾ç½®ä¸»é¢˜ Next"></a>è®¾ç½®ä¸»é¢˜ Next</h3><blockquote>
<p><strong>ç«™ç‚¹é…ç½®æ–‡ä»¶</strong>ï¼š<code>E:\Rao&#39;s Blog\hexo\_config.yml</code></p>
</blockquote>
<blockquote>
<p><strong>ä¸»é¢˜é…ç½®æ–‡ä»¶</strong>ï¼š<code>E:\Rao&#39;s Blog\hexo\themes\next\_config.yml</code></p>
</blockquote>
<p>å®‰è£…ä¸»é¢˜çš„æ–¹å¼éå¸¸ç®€å•ï¼Œåªéœ€è¦å°†ä¸»é¢˜æ–‡ä»¶æ‹·è´è‡³ç«™ç‚¹ç›®å½•çš„ <code>themes</code> ç›®å½•ä¸‹ï¼Œ ç„¶åä¿®æ”¹ä¸‹é…ç½®æ–‡ä»¶å³å¯ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ cd hexo</span><br><span class="line">$ git clone https://github.com/iissnan/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>

<p>å½“ä¸‹è½½å®Œæˆåï¼Œæ‰“å¼€ç«™ç‚¹é…ç½®æ–‡ä»¶ï¼Œ æ‰¾åˆ° <code>theme</code> å­—æ®µï¼Œå¹¶å°†å…¶å€¼æ›´æ”¹ä¸º <code>next</code>ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">theme: next</span><br></pre></td></tr></table></figure>

<p>æœ€å¥½ä½¿ç”¨ <code>hexo clean</code> æ¥æ¸…é™¤ <code>Hexo</code> çš„ç¼“å­˜ï¼Œç„¶åå³å¯ä½¿ç”¨æµè§ˆå™¨è®¿é—® <code>http://localhost:4000</code>ï¼Œæ£€æŸ¥ç«™ç‚¹æ˜¯å¦æ­£ç¡®è¿è¡Œã€‚</p>
<p><img src="http://ww4.sinaimg.cn/large/006tNc79ly1g5osgyn3e9j30wc0h2405.jpg" alt></p>
<p>è‡³æ­¤ï¼Œä½ æœ¬åœ°çš„åšå®¢å°±å·²ç»æ­å»ºæˆåŠŸï¼Œä¹Ÿå¯ä»¥å¯¹ä¸»é¢˜è¿›è¡Œ<a href="http://theme-next.iissnan.com/getting-started.html" target="_blank" rel="noopener">ä¸ªæ€§åŒ–è®¾å®š</a>ï¼Œæ¥ä¸‹æ¥å°±æ˜¯éƒ¨ç½²åˆ° <a href="https://pages.github.com/" target="_blank" rel="noopener">Github Page</a> äº†ã€‚</p>
<h3 id="è®¾ç½®-Github-Page"><a href="#è®¾ç½®-Github-Page" class="headerlink" title="è®¾ç½® Github Page"></a>è®¾ç½® Github Page</h3><p>é¦–å…ˆå¦‚æœä½ è¿˜æ²¡æœ‰ <code>Github</code> è´¦å·çš„å…ˆ<a href="https://github.com/" target="_blank" rel="noopener">æ³¨å†Œ</a> ä¸€ä¸ªï¼Œç‚¹å‡» <code>Start project</code> æˆ–è€…ä¸‹é¢çš„ <code>new repository</code> åˆ›å»ºä¸€ä¸ªæ–°çš„ä»“åº“ <code>blog</code>ï¼Œ<code>GitHub Pages</code> é€‰æ‹© <code>master</code> åˆ†æ”¯ï¼Œå‡ºç°åœ°å€ <code>https://huiraoo.github.io/blog/</code> å°±æ˜¯ä½ çš„ä¸ªäººåšå®¢ã€‚</p>
<p><img src="http://ww1.sinaimg.cn/large/006tNc79ly1g5osf29m0aj30kc0ea3yx.jpg" alt></p>
<h3 id="éƒ¨ç½²åˆ°-Github"><a href="#éƒ¨ç½²åˆ°-Github" class="headerlink" title="éƒ¨ç½²åˆ° Github"></a>éƒ¨ç½²åˆ° Github</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é…ç½®SSH key</span></span><br><span class="line">cat ~/.ssh/id_rsa.pub</span><br><span class="line">git config --global user.name <span class="string">"ç”¨æˆ·å"</span></span><br><span class="line">git config --global user.email <span class="string">"é‚®ç®±åœ°å€"</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">'ä¸Šé¢çš„é‚®ç®±'</span></span><br><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure>

<p><img src="http://ww2.sinaimg.cn/large/006tNc79ly1g5osh133vgj30sb0c9wj3.jpg" alt></p>
<p>ä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶ï¼ŒæŠŠä»“åº“çš„ <code>git</code> åœ°å€æ·»åŠ è¿›å»å°±è¡Œäº†</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repository: git@github.com:huiraoo/blog.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œéƒ¨ç½²å‘½ä»¤</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ hexo clean</span><br><span class="line">$ hexo g -d</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®å›¾åºŠ"><a href="#é…ç½®å›¾åºŠ" class="headerlink" title="é…ç½®å›¾åºŠ"></a>é…ç½®å›¾åºŠ</h3><p><a href="https://toolinbox.net/iPic/AddAliOSS.html" target="_blank" rel="noopener">é˜¿é‡Œäº‘OSS</a></p>
<h3 id="é…ç½®æœç´¢"><a href="#é…ç½®æœç´¢" class="headerlink" title="é…ç½®æœç´¢"></a>é…ç½®æœç´¢</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½æ’ä»¶</span></span><br><span class="line">cd /Users/raohui/Blog/hexo</span><br><span class="line">npm install hexo-generator-searchdb --save</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç«™ç‚¹é…ç½®</span></span><br><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  format: html</span><br><span class="line">  limit: <span class="number">10000</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># ä¸»é¢˜é…ç½®</span></span><br><span class="line">local_search:</span><br><span class="line">  enable: true</span><br></pre></td></tr></table></figure>

<h2 id="FA-amp-Q"><a href="#FA-amp-Q" class="headerlink" title="FA&amp;Q"></a>FA&amp;Q</h2><p><strong>é—®é¢˜æè¿°</strong>ï¼š<code>Hexo</code> ä¸»é¢˜æ— æ³•åŠ è½½åˆ° <code>Github Page</code>ï¼Œè®¿é—® <code>https://huiraoo.github.io/blog</code> æ˜¾ç¤ºä¹±ç </p>
<p><strong>è§£å†³åŠæ³•</strong>ï¼šä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶ï¼Œå¡«å†™ <code>url</code> å’Œ <code>root</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="comment">## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'</span></span><br><span class="line">url: https://huiraoo.github.io/blog</span><br><span class="line">root: /blog/</span><br><span class="line">permalink: :year/:month/:day/:title/</span><br><span class="line">permalink_defaults:</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Next</tag>
        <tag>Github Page</tag>
      </tags>
  </entry>
</search>
